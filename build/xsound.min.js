/**
 * xsound.min.js
 * @fileoverview Web Audio API Library
 *
 * Copyright (c) 2012, 2013, 2014 Tomohiro IKEDA (Korilakkuma)
 * Released under the MIT license
 */
!function(a){function b(){}function c(){this.media=null,this.ext="",this.duration=0,this.volume=1,this.playbackRate=1,this.controls=!1,this.loop=!1,this.muted=!1,this.listeners={}}function d(c,e){function f(c){function d(a){b.call(this),this.isActive=!1,this.sampleRate=a,this.graphics="",this.canvas=null,this.context=null,this.svg=null,this.interval=1e3,this.timerid=null,this.styles={shape:"line",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],wave:"rgba(0, 0, 255, 1.0)",grid:"rgba(255, 0, 0, 1.0)",text:"rgba(255, 255, 255, 1.0)",font:{family:"Arial",size:"13px",style:"normal",weight:"normal"},width:1.5,cap:"round",join:"miter",top:15,right:30,bottom:15,left:30}}function e(a){d.call(this,a),this.savedImage=null,this.length=0,this.currentTime="rgba(255, 255, 255, 1.0)",this.plotInterval=.0625,this.textInterval=60}function f(a){d.call(this,a),this.type=f.TYPES.UINT,this.textInterval=.005}function g(a){d.call(this,a),this.type=g.TYPES.UINT,this.size=256,this.textInterval=1e3}a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},a.cancelAnimationFrame=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.clearTimeout,this.analyser=c.createAnalyser(),this.input=c.createGain(),this.output=c.createGain(),this.input.connect(this.analyser),this.analyser.connect(this.output),d.prototype=Object.create(b.prototype),d.prototype.constructor=d,e.prototype=Object.create(d.prototype),f.prototype=Object.create(d.prototype),g.prototype=Object.create(d.prototype),e.prototype.constructor=e,f.prototype.constructor=f,g.prototype.constructor=g,this.analyser.fftSize=2048,this.analyser.minDecibels=-100,this.analyser.maxDecibels=-30,this.analyser.smoothingTimeConstant=.8,d.GRAPHICS={},d.GRAPHICS.CANVAS="canvas",d.GRAPHICS.SVG="svg",d.XMLNS="http://www.w3.org/2000/svg",d.XLINK="http://www.w3.org/1999/xlink",d.SVG_LINEAR_GRADIENT_IDS={},d.SVG_LINEAR_GRADIENT_IDS.TIME_OVERVIEW="svg-linear-gradient-time-overview",d.SVG_LINEAR_GRADIENT_IDS.TIME="svg-linear-gradient-time",d.SVG_LINEAR_GRADIENT_IDS.FFT="svg-linear-gradient-fft",d.prototype.setup=function(a){return a instanceof HTMLCanvasElement?(this.graphics=d.GRAPHICS.CANVAS,this.canvas=a,this.context=this.canvas.getContext("2d")):a instanceof SVGElement&&(this.graphics=d.GRAPHICS.SVG,this.svg=a,this.svg.setAttribute("xmlns",d.XMLNS),this.svg.setAttribute("xmlns:xlink",d.XLINK)),this},d.prototype.param=function(a,b){var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"interval":if(void 0===b)return this.interval;if("auto"===String(b).toLowerCase())this.interval="auto";else{var d=parseFloat(b);d>=0&&(this.interval=d)}break;case"shape":if(void 0===b)return this.styles.shape;var d=String(b).toLowerCase();"line"!==d&&"rect"!==d||(this.styles.shape="gradient"!==this.styles.wave?d:"rect");break;case"grad":if(void 0===b)return this.styles.grad;Array.isArray(b)||(b=[b]);for(var e=!1,f=0,g=b.length;f<g;f++){var h=b[f];if(!("offset"in h&&"color"in h)){e=!0;break}var i=parseFloat(h.offset);if(isNaN(i)||i<0||i>1){e=!0;break}}e||(this.styles.grad=b);break;case"font":if(void 0===b)return this.styles[c];if("[object Object]"===Object.prototype.toString.call(b))for(var j in b)/family|size|style|weight/i.test(j)&&(this.styles.font[j]=String(b[j]));break;case"wave":case"grid":case"text":case"cap":case"join":if(void 0===b)return this.styles[c];"[object String]"===Object.prototype.toString.call(b)&&("wave"===c&&"gradient"===b&&(this.styles.shape="rect"),this.styles[c]=b.toLowerCase());break;case"width":case"top":case"right":case"bottom":case"left":if(void 0===b)return this.styles[c];var d="width"===c?parseFloat(b):parseInt(b);d>=0&&(this.styles[c]=d)}},d.prototype.start=function(a,b,c){switch(this.graphics){case d.GRAPHICS.CANVAS:this.drawToCanvas(a,b,c);break;case d.GRAPHICS.SVG:this.drawToSVG(a,b,c)}return this},d.prototype.create=function(){switch(this.graphics){case d.GRAPHICS.CANVAS:return this.canvas.toDataURL("image/png").replace("image/png","image/octet-stream");case d.GRAPHICS.SVG:return this.svg.outerHTML;default:return this}},d.prototype.state=function(a){return void 0===a?this.isActive:("toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a),this)},d.prototype.drawTimeDomainFloat32ArrayToCanvas=function(a,b,c,d,e,f){if(!(a instanceof CanvasRenderingContext2D))return this;if(!(b instanceof Float32Array))return this;var g=0,h=0,i=parseInt(c),j=parseInt(d),k=parseInt(e);switch(isNaN(i)&&(i=0),isNaN(j)&&(j=0),isNaN(k)&&(k=0),this.styles.shape){case"line":a.strokeStyle=this.styles.wave,a.lineWidth=this.styles.width,a.lineCap=this.styles.cap,a.lineJoin=this.styles.join,a.beginPath();for(var l=0,m=b.length;l<m;l++)null!==f&&void 0!==f&&l%f!==0||(g=Math.floor(l/m*i)+this.styles.left,h=Math.floor((1-b[l])*(j/2))+this.styles.top,0===l?a.moveTo(g+this.styles.width/2,h):a.lineTo(g,h));a.stroke();break;case"rect":"gradient"!==this.styles.wave&&(a.fillStyle=this.styles.wave);for(var l=0,m=b.length;l<m;l++)if(null===f||void 0===f||l%f===0){if(g=Math.floor(l/m*i)+this.styles.left,h=-1*Math.floor(b[l]*(j/2)),"gradient"===this.styles.wave){for(var n=d/2+this.styles.top,o=a.createLinearGradient(0,n,0,n+h),p=0,q=this.styles.grad.length;p<q;p++){var r=this.styles.grad[p];o.addColorStop(r.offset,r.color)}a.fillStyle=o}a.fillRect(g,k,this.styles.width,h)}}return this},d.prototype.drawTimeDomainFloat32ArrayToSVG=function(a,b,c,e,f,g){var h=0,i=0,j=parseInt(b),k=parseInt(c),l=parseInt(e);switch(isNaN(j)&&(j=0),isNaN(k)&&(k=0),isNaN(l)&&(l=0),this.styles.shape){case"line":for(var m=document.createElementNS(d.XMLNS,"path"),n="",o=0,p=a.length;o<p;o++)null!==f&&void 0!==f&&o%f!==0||(h=Math.floor(o/p*j)+this.styles.left,i=Math.floor((1-a[o])*(k/2))+this.styles.top,0===o?n+="M"+(h+this.styles.width/2)+" "+i:(n+=" ",n+="L"+h+" "+i));return m.setAttribute("d",n),m.setAttribute("stroke",this.styles.wave),m.setAttribute("fill","none"),m.setAttribute("stroke-width",this.styles.width),m.setAttribute("stroke-linecap",this.styles.cap),m.setAttribute("stroke-linejoin",this.styles.join),m;case"rect":var q=null;"gradient"===this.styles.wave&&(q=this.createSVGLinearGradient(g));var r=document.createElementNS(d.XMLNS,"g");null!==q&&r.appendChild(q);for(var o=0,p=a.length;o<p;o++)if(null===f||void 0===f||o%f===0){var s=document.createElementNS(d.XMLNS,"rect");h=Math.floor(o/p*j)+this.styles.left,i=Math.floor(a[o]*(c/2)),s.setAttribute("x",h),s.setAttribute("y",l),s.setAttribute("width",this.styles.width),i<0?s.setAttribute("height",-i):(s.setAttribute("height",i),s.setAttribute("transform","rotate(180 "+(h+this.styles.width/2)+" "+l+")")),s.setAttribute("stroke","none"),s.setAttribute("fill",null===q?this.styles.wave:"url(#"+g+")"),r.appendChild(s)}return r;default:return null}},d.prototype.createSVGLinearGradient=function(a){var b=document.createElementNS(d.XMLNS,"defs"),c=document.createElementNS(d.XMLNS,"linearGradient");c.setAttribute("id",String(a)),c.setAttribute("x1","0%"),c.setAttribute("y1","0%"),c.setAttribute("x2","0%"),c.setAttribute("y2","100%");for(var e=0,f=this.styles.grad.length;e<f;e++){var g=document.createElementNS(d.XMLNS,"stop"),h=this.styles.grad[e];g.setAttribute("offset",h.offset),g.setAttribute("stop-color",h.color),c.appendChild(g)}return b.appendChild(c),b},d.prototype.createFontString=function(){return this.styles.font.size+" "+this.styles.font.style+" "+this.styles.font.weight+' "'+this.styles.font.family+'"'},d.prototype.drawToCanvas=function(a){},d.prototype.drawToSVG=function(a){},d.prototype.toString=function(){return"[SoundModule Analyser Visualizer]"},e.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);if(void 0!==e)return e;switch(c){case"currenttime":if(void 0===b)return this.currentTime;this.currentTime=String(b).toLowerCase();break;case"plotinterval":case"textinterval":if(void 0===b)return this[c.replace("interval","Interval")];var f=parseFloat(b);f>0&&(this[c.replace("interval","Interval")]=f)}}return this},e.prototype.drawToCanvas=function(a){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var b=this.context,c=this.canvas.width,d=this.canvas.height,e=c-(this.styles.left+this.styles.right),f=d-(this.styles.top+this.styles.bottom),g=Math.floor(f/2)+this.styles.top,h=0,i=0,j="",k=Math.floor(this.plotInterval*this.sampleRate),l=Math.floor(this.textInterval*this.sampleRate);if(b.clearRect(0,0,c,d),this.drawTimeDomainFloat32ArrayToCanvas(b,a,e,f,g,k),"none"!==this.styles.grid||"none"!==this.styles.text){for(var m=0,n=a.length;m<n;m++)m%l===0&&(h=Math.floor(m/n*e)+this.styles.left,j=Math.floor(m/this.sampleRate/60)+" min","none"!==this.styles.grid&&(b.fillStyle=this.styles.grid,b.fillRect(h,this.styles.top,1,f)),"none"!==this.styles.text&&(b.fillStyle=this.styles.text,b.font=this.createFontString(),b.fillText(j,h-b.measureText(j).width/2,this.styles.top+f+parseInt(this.styles.font.size))));for(var o=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"],m=0,n=o.length;m<n;m++)j=o[m],h=Math.floor(this.styles.left-b.measureText(j).width),i=Math.floor((1-parseFloat(j.trim()))*(f/2))+this.styles.top,"none"!==this.styles.grid&&(b.fillStyle=this.styles.grid,b.fillRect(this.styles.left,i,e,1)),i-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text&&(b.fillStyle=this.styles.text,b.font=this.createFontString(),b.fillText(j,h,i))}return this.savedImage=b.getImageData(0,0,c,d),this.length=a.length,b.fillStyle=this.currentTime,b.fillRect(this.styles.left,this.styles.top,1,f),this},e.prototype.drawToSVG=function(a){if(!(this.svg instanceof SVGElement&&this.isActive))return this;var b=this.svg,c=parseInt(b.getAttribute("width")),e=parseInt(b.getAttribute("height")),f=c-(this.styles.left+this.styles.right),g=e-(this.styles.top+this.styles.bottom),h=Math.floor(g/2)+this.styles.top,i=0,j=0,k="",l=Math.floor(this.plotInterval*this.sampleRate),m=Math.floor(this.textInterval*this.sampleRate);if(b.innerHTML="",b.appendChild(this.drawTimeDomainFloat32ArrayToSVG(a,f,g,h,l,d.SVG_LINEAR_GRADIENT_IDS.TIME_OVERVIEW)),"none"!==this.styles.grid||"none"!==this.styles.text){for(var n=0,o=a.length;n<o;n++)if(n%m===0){if(i=Math.floor(n/o*f)+this.styles.left,k=Math.floor(n/this.sampleRate/60)+" min","none"!==this.styles.grid){var p=document.createElementNS(d.XMLNS,"rect");p.setAttribute("x",i),p.setAttribute("y",this.styles.top),p.setAttribute("width",1),p.setAttribute("height",g),p.setAttribute("stroke","none"),p.setAttribute("fill",this.styles.grid),b.appendChild(p)}if("none"!==this.styles.text){var q=document.createElementNS(d.XMLNS,"text");q.textContent=k,q.setAttribute("x",i),q.setAttribute("y",this.styles.top+g+parseInt(this.styles.font.size)),q.setAttribute("text-anchor","middle"),q.setAttribute("stroke","none"),q.setAttribute("fill",this.styles.text),q.setAttribute("font-family",this.styles.font.family),q.setAttribute("font-size",this.styles.font.size),q.setAttribute("font-style",this.styles.font.style),q.setAttribute("font-weight",this.styles.font.weight),b.appendChild(q)}}for(var r=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"],n=0,o=r.length;n<o;n++){if(k=r[n],i=this.styles.left,j=Math.floor((1-parseFloat(k.trim()))*(g/2))+this.styles.top,"none"!==this.styles.grid){var p=document.createElementNS(d.XMLNS,"rect");p.setAttribute("x",i),p.setAttribute("y",j),p.setAttribute("width",f),p.setAttribute("height",1),p.setAttribute("stroke","none"),p.setAttribute("fill",this.styles.grid),b.appendChild(p)}if(j-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text){var q=document.createElementNS(d.XMLNS,"text");q.textContent=k,q.setAttribute("x",i),q.setAttribute("y",j),q.setAttribute("text-anchor","end"),q.setAttribute("stroke","none"),q.setAttribute("fill",this.styles.text),q.setAttribute("font-family",this.styles.font.family),q.setAttribute("font-size",this.styles.font.size),q.setAttribute("font-style",this.styles.font.style),q.setAttribute("font-weight",this.styles.font.weight),b.appendChild(q)}}}var p=document.createElementNS(d.XMLNS,"rect");return p.setAttribute("class","svg-current-time"),p.setAttribute("x",this.styles.left),p.setAttribute("y",this.styles.top),p.setAttribute("width",1),p.setAttribute("height",g),p.setAttribute("stroke","none"),p.setAttribute("fill",this.currentTime),b.appendChild(p),this.savedImage=b,this.length=a.length,this},e.prototype.update=function(a){var b=parseFloat(a);if(!(isNaN(b)||b<0)){var c=0,e=0,f=0,g=0,h=0;switch(this.graphics){case d.GRAPHICS.CANVAS:if(this.savedImage instanceof ImageData){var i=this.context;c=this.canvas.width,e=this.canvas.height,f=c-(this.styles.left+this.styles.right),g=e-(this.styles.top+this.styles.bottom),h=Math.floor(b*this.sampleRate/this.length*f)+this.styles.left,i.clearRect(0,0,c,e),i.putImageData(this.savedImage,0,0),i.fillStyle=this.currentTime,i.fillRect(h,this.styles.top,1,g)}break;case d.GRAPHICS.SVG:var j=this.svg.querySelector(".svg-current-time");j instanceof SVGElement&&(c=parseInt(this.svg.getAttribute("width")),e=parseInt(this.svg.getAttribute("height")),f=c-(this.styles.left+this.styles.right),g=e-(this.styles.top+this.styles.bottom),h=Math.floor(b*this.sampleRate/this.length*f),j.setAttribute("transform","translate("+h+" 0)"))}return this}},e.prototype.drag=function(b){var c=null,e=this,f="",g="",h="";switch(/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?(f="touchstart",g="touchmove",h="touchend"):(f="mousedown",g="mousemove",h="mouseup"),this.graphics){case d.GRAPHICS.CANVAS:c=this.canvas;break;case d.GRAPHICS.SVG:c=this.svg;break;default:return}var i=function(a){var c=0,f=0;switch(e.graphics){case d.GRAPHICS.CANVAS:c=e.canvas.offsetLeft,f=e.canvas.width;break;case d.GRAPHICS.SVG:c=e.svg.parentNode.offsetLeft,f=parseInt(e.svg.getAttribute("width"))}var g=a-(c+e.styles.left);f-=e.styles.left+e.styles.right,g<0&&(g=0),g>f&&(g=f);var h=g/f*e.length,i=h/e.sampleRate;e.update(i),"[object Function]"===Object.prototype.toString.call(b)&&b(i)},j=function(a){return a.pageX?a.pageX:a.touches[0]?a.touches[0].pageX:void 0},k=!1;return c.addEventListener(f,function(a){i(j(a)),k=!0},!0),c.addEventListener(g,function(a){k&&(a.preventDefault(),i(j(a)))},!0),a.addEventListener(h,function(a){k&&(k=!1)},!0),this},e.prototype.toString=function(){return"[SoundModule Analyser TimeOverview]"},f.TYPES={},f.TYPES.UINT="uint",f.TYPES.FLOAT="float",f.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);if(void 0!==e)return e;switch(c){case"type":if(void 0===b)return this.type;var g=String(b).toLowerCase();g!==f.TYPES.UINT&&g!==f.TYPES.FLOAT||(this.type=g);break;case"textinterval":if(void 0===b)return this.textInterval;var g=parseFloat(b);g>0&&(this.textInterval=g)}}return this},f.prototype.drawToCanvas=function(a){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var b=this.context,c=this.canvas.width,d=this.canvas.height,e=c-(this.styles.left+this.styles.right),g=d-(this.styles.top+this.styles.bottom),h=Math.floor(g/2)+this.styles.top,i=0,j=0,k="",l=Math.floor(this.textInterval*this.sampleRate);switch(b.clearRect(0,0,c,d),this.type){case f.TYPES.FLOAT:this.drawTimeDomainFloat32ArrayToCanvas(b,a,e,g,h);break;case f.TYPES.UINT:default:switch(this.styles.shape){case"line":b.strokeStyle=this.styles.wave,b.lineWidth=this.styles.width,b.lineCap=this.styles.cap,b.lineJoin=this.styles.join,b.beginPath();for(var m=0,n=a.length;m<n;m++)i=Math.floor(m/n*e)+this.styles.left,j=Math.floor((1-a[m]/255)*g)+this.styles.top,0===m?b.moveTo(i+this.styles.width/2,j):b.lineTo(i,j);b.stroke();break;case"rect":"gradient"!==this.styles.wave&&(b.fillStyle=this.styles.wave);for(var m=0,n=a.length;m<n;m++){if(i=Math.floor(m/n*e)+this.styles.left,j=Math.floor((.5-a[m]/255)*g),"gradient"===this.styles.wave){for(var o=g/2+this.styles.top,p=b.createLinearGradient(0,o,0,o+j),q=0,r=this.styles.grad.length;q<r;q++){var s=this.styles.grad[q];p.addColorStop(s.offset,s.color)}b.fillStyle=p}b.fillRect(i,h,this.styles.width,j)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(var m=0,n=a.length;m<n;m++)m%l===0&&(i=Math.floor(m/n*e)+this.styles.left,k=Math.floor(m/this.sampleRate*1e3)+" ms","none"!==this.styles.grid&&(b.fillStyle=this.styles.grid,b.fillRect(i,this.styles.top,1,g)),"none"!==this.styles.text&&(b.fillStyle=this.styles.text,b.font=this.createFontString(),b.fillText(k,i-b.measureText(k).width/2,this.styles.top+g+parseInt(this.styles.font.size))));for(var t=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"],m=0,n=t.length;m<n;m++)k=t[m],i=Math.floor(this.styles.left-b.measureText(k).width),j=Math.floor((1-parseFloat(k.trim()))*(g/2))+this.styles.top,"none"!==this.styles.grid&&(b.fillStyle=this.styles.grid,b.fillRect(this.styles.left,j,e,1)),j-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text&&(b.fillStyle=this.styles.text,b.font=this.createFontString(),b.fillText(k,i,j))}return this},f.prototype.drawToSVG=function(a){if(!(this.svg instanceof SVGElement&&this.isActive))return this;var b=this.svg,c=parseInt(b.getAttribute("width")),e=parseInt(b.getAttribute("height")),g=c-(this.styles.left+this.styles.right),h=e-(this.styles.top+this.styles.bottom),i=Math.floor(h/2)+this.styles.top,j=0,k=0,l="",m=Math.floor(this.textInterval*this.sampleRate);switch(b.innerHTML="",this.type){case f.TYPES.FLOAT:b.appendChild(this.drawTimeDomainFloat32ArrayToSVG(a,g,h,i,null,d.SVG_LINEAR_GRADIENT_IDS.TIME));break;case f.TYPES.UINT:default:switch(this.styles.shape){case"line":for(var n=document.createElementNS(d.XMLNS,"path"),o="",p=0,q=a.length;p<q;p++)j=Math.floor(p/q*g)+this.styles.left,k=Math.floor((1-a[p]/255)*h)+this.styles.top,0===p?o+="M"+(j+this.styles.width/2)+" "+k:(o+=" ",o+="L"+j+" "+k);n.setAttribute("d",o),n.setAttribute("stroke",this.styles.wave),n.setAttribute("fill","none"),n.setAttribute("stroke-width",this.styles.width),n.setAttribute("stroke-linecap",this.styles.cap),n.setAttribute("stroke-linejoin",this.styles.join),b.appendChild(n);break;case"rect":var r=null;"gradient"===this.styles.wave&&(r=this.createSVGLinearGradient(d.SVG_LINEAR_GRADIENT_IDS.TIME));var s=document.createElementNS(d.XMLNS,"g");null!==r&&s.appendChild(r);for(var p=0,q=a.length;p<q;p++){var t=document.createElementNS(d.XMLNS,"rect");j=Math.floor(p/q*g)+this.styles.left,k=Math.floor((a[p]/255-.5)*h),t.setAttribute("x",j),t.setAttribute("y",i),t.setAttribute("width",this.styles.width),k<0?t.setAttribute("height",-k):(t.setAttribute("height",k),t.setAttribute("transform","rotate(180 "+(j+this.styles.width/2)+" "+i+")")),t.setAttribute("stroke","none"),t.setAttribute("fill",null===r?this.styles.wave:"url(#"+d.SVG_LINEAR_GRADIENT_IDS.TIME+")"),s.appendChild(t)}b.appendChild(s)}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(var p=0,q=a.length;p<q;p++)if(p%m===0){if(j=Math.floor(p/q*g)+this.styles.left,l=Math.floor(p/this.sampleRate*1e3)+" ms","none"!==this.styles.grid){var t=document.createElementNS(d.XMLNS,"rect");t.setAttribute("x",j),t.setAttribute("y",this.styles.top),t.setAttribute("width",1),t.setAttribute("height",h),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.grid),b.appendChild(t)}if("none"!==this.styles.text){var u=document.createElementNS(d.XMLNS,"text");u.textContent=l,u.setAttribute("x",j),u.setAttribute("y",this.styles.top+h+parseInt(this.styles.font.size)),u.setAttribute("text-anchor","middle"),u.setAttribute("stroke","none"),u.setAttribute("fill",this.styles.text),u.setAttribute("font-family",this.styles.font.family),u.setAttribute("font-size",this.styles.font.size),u.setAttribute("font-style",this.styles.font.style),u.setAttribute("font-weight",this.styles.font.weight),b.appendChild(u)}}for(var v=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"],p=0,q=v.length;p<q;p++){if(l=v[p],j=this.styles.left,k=Math.floor((1-parseFloat(l.trim()))*(h/2))+this.styles.top,"none"!==this.styles.grid){var t=document.createElementNS(d.XMLNS,"rect");t.setAttribute("x",j),t.setAttribute("y",k),t.setAttribute("width",g),t.setAttribute("height",1),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.grid),b.appendChild(t)}if(k-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text){var u=document.createElementNS(d.XMLNS,"text");u.textContent=l,u.setAttribute("x",j),u.setAttribute("y",k),u.setAttribute("text-anchor","end"),u.setAttribute("stroke","none"),u.setAttribute("fill",this.styles.text),u.setAttribute("font-family",this.styles.font.family),u.setAttribute("font-size",this.styles.font.size),u.setAttribute("font-style",this.styles.font.style),u.setAttribute("font-weight",this.styles.font.weight),b.appendChild(u)}}}return this},f.prototype.toString=function(){return"[SoundModule Analyser Time]"},g.TYPES={},g.TYPES.UINT="uint",g.TYPES.FLOAT="float",g.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);if(void 0!==e)return e;switch(c){case"type":if(void 0===b)return this.type;var f=String(b).toLowerCase();f!==g.TYPES.UINT&&f!==g.TYPES.FLOAT||(this.type=f);break;case"size":if(void 0===b)return this.size;var f=parseInt(b),h=1024;f>0&&f<=h&&(this.size=f);break;case"textinterval":if(void 0===b)return this.textInterval;var f=parseFloat(b);f>0&&(this.textInterval=f)}}return this},g.prototype.drawToCanvas=function(a,b,c){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var d=parseFloat(b),e=parseFloat(c),f=e-d,h=this.context,i=this.canvas.width,j=this.canvas.height,k=i-(this.styles.left+this.styles.right),l=j-(this.styles.top+this.styles.bottom),m=0,n=0,o="",p=this.size>a.length?a.length:this.size,q=this.sampleRate/(2*a.length),r=Math.floor(this.textInterval/q);switch(h.clearRect(0,0,i,j),this.type){case g.TYPES.FLOAT:h.strokeStyle="gradient"!==this.styles.wave?this.styles.wave:"rgba(0, 0, 255, 1.0)",h.lineWidth=this.styles.width,h.lineCap=this.styles.cap,h.lineJoin=this.styles.join,h.beginPath();for(var s=0;s<p;s++)m=Math.floor(s/p*k)+this.styles.left,n=Math.abs(a[s]-e)*(l/f)+this.styles.top,0===s?h.moveTo(m+this.styles.width/2,n):h.lineTo(m,n);h.stroke();break;case g.TYPES.UINT:default:switch(this.styles.shape){case"line":h.strokeStyle=this.styles.wave,h.lineWidth=this.styles.width,h.lineCap=this.styles.cap,h.lineJoin=this.styles.join,h.beginPath();for(var s=0;s<p;s++)m=Math.floor(s/p*k)+this.styles.left,n=Math.floor((1-a[s]/255)*l)+this.styles.top,0===s?h.moveTo(m+this.styles.width/2,n):h.lineTo(m,n);h.stroke();break;case"rect":"gradient"!==this.styles.wave&&(h.fillStyle=this.styles.wave);for(var s=0;s<p;s++){if(m=Math.floor(s/p*k)+this.styles.left,n=-1*Math.floor(a[s]/255*l),"gradient"===this.styles.wave){for(var t=l+this.styles.top,u=h.createLinearGradient(0,t,0,t+n),v=0,w=this.styles.grad.length;v<w;v++){var x=this.styles.grad[v];u.addColorStop(x.offset,x.color)}h.fillStyle=u}h.fillRect(m,l+this.styles.top,this.styles.width,n)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(var y=0,s=0;s<p;s++)s%r===0&&(m=Math.floor(s/p*k)+this.styles.left,y=Math.floor(this.textInterval*(s/r)),o=y<1e3?y+" Hz":String(y/1e3).slice(0,3)+" kHz","none"!==this.styles.grid&&(h.fillStyle=this.styles.grid,h.fillRect(m,this.styles.top,1,l)),"none"!==this.styles.text&&(h.fillStyle=this.styles.text,h.font=this.createFontString(),h.fillText(o,m-h.measureText(o).width/2,this.styles.top+l+parseInt(this.styles.font.size))));switch(this.type){case g.TYPES.FLOAT:for(var s=d;s<=e;s+=10)o=s+" dB",m=Math.floor(this.styles.left-h.measureText(o).width),n=Math.floor(-1*(s-e)/f*l)+this.styles.top,"none"!==this.styles.grid&&(h.fillStyle=this.styles.grid,h.fillRect(this.styles.left,n,k,1)),n-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text&&(h.fillStyle=this.styles.text,h.font=this.createFontString(),h.fillText(o,m,n));break;case g.TYPES.UINT:default:for(var z=["0.00","0.25","0.50","0.75","1.00"],s=0,A=z.length;s<A;s++)o=z[s],m=Math.floor(this.styles.left-h.measureText(o).width),n=(1-parseFloat(o))*l+this.styles.top,"none"!==this.styles.grid&&(h.fillStyle=this.styles.grid,h.fillRect(this.styles.left,n,k,1)),n-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text&&(h.fillStyle=this.styles.text,h.font=this.createFontString(),h.fillText(o,m,n))}}return this},g.prototype.drawToSVG=function(a,b,c){if(!(this.svg instanceof SVGElement&&this.isActive))return this;var e=parseFloat(b),f=parseFloat(c),h=f-e,i=this.svg,j=i.getAttribute("width"),k=i.getAttribute("height"),l=j-(this.styles.left+this.styles.right),m=k-(this.styles.top+this.styles.bottom),n=0,o=0,p="",q=this.size>a.length?a.length:this.size,r=this.sampleRate/(2*a.length),s=Math.floor(this.textInterval/r);switch(i.innerHTML="",this.type){case g.TYPES.FLOAT:for(var t=document.createElementNS(d.XMLNS,"path"),u="",v=0;v<q;v++)n=Math.floor(v/q*l)+this.styles.left,o=Math.floor(-1*(a[v]-f)*(m/h))+this.styles.top,0===v?u+="M"+(n+this.styles.width/2)+" "+o:(u+=" ",u+="L"+n+" "+o);t.setAttribute("d",u),t.setAttribute("stroke",this.styles.wave),t.setAttribute("fill","none"),t.setAttribute("stroke-width",this.styles.width),t.setAttribute("stroke-linecap",this.styles.cap),t.setAttribute("stroke-linejoin",this.styles.join),i.appendChild(t);break;case g.TYPES.UINT:default:switch(this.styles.shape){case"line":for(var t=document.createElementNS(d.XMLNS,"path"),u="",v=0;v<q;v++)n=Math.floor(v/q*l)+this.styles.left,o=Math.floor((1-a[v]/255)*m)+this.styles.top,0===v?u+="M"+(n+this.styles.width/2)+" "+o:(u+=" ",u+="L"+n+" "+o);t.setAttribute("d",u),t.setAttribute("stroke",this.styles.wave),t.setAttribute("fill","none"),t.setAttribute("stroke-width",this.styles.width),t.setAttribute("stroke-linecap",this.styles.cap),t.setAttribute("stroke-linejoin",this.styles.join),i.appendChild(t);break;case"rect":var w=null;"gradient"===this.styles.wave&&(w=this.createSVGLinearGradient(d.SVG_LINEAR_GRADIENT_IDS.FFT));var x=document.createElementNS(d.XMLNS,"g");null!==w&&x.appendChild(w);for(var v=0;v<q;v++){var y=document.createElementNS(d.XMLNS,"rect");n=Math.floor(v/q*l)+this.styles.left,o=Math.floor(a[v]/255*m),y.setAttribute("x",n),y.setAttribute("y",this.styles.top+m),y.setAttribute("width",this.styles.width),o<0?y.setAttribute("height",-o):(y.setAttribute("height",o),y.setAttribute("transform","rotate(180 "+(n+this.styles.width/2)+" "+(this.styles.top+m)+")")),y.setAttribute("stroke","none"),y.setAttribute("fill",null===w?this.styles.wave:"url(#"+d.SVG_LINEAR_GRADIENT_IDS.FFT+")"),x.appendChild(y)}i.appendChild(x)}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(var z=0,v=0;v<q;v++)if(v%s===0){if(n=Math.floor(v/q*l)+this.styles.left,z=Math.floor(this.textInterval*(v/s)),p=z<1e3?z+" Hz":String(z/1e3).slice(0,3)+" kHz","none"!==this.styles.grid){var y=document.createElementNS(d.XMLNS,"rect");y.setAttribute("x",n),y.setAttribute("y",this.styles.top),y.setAttribute("width",1),y.setAttribute("height",m),y.setAttribute("stroke","none"),y.setAttribute("fill",this.styles.grid),i.appendChild(y)}if("none"!==this.styles.text){var A=document.createElementNS(d.XMLNS,"text");A.textContent=p,A.setAttribute("x",n),A.setAttribute("y",this.styles.top+m+parseInt(this.styles.font.size)),A.setAttribute("text-anchor","middle"),A.setAttribute("stroke","none"),A.setAttribute("fill",this.styles.text),A.setAttribute("font-family",this.styles.font.family),A.setAttribute("font-size",this.styles.font.size),A.setAttribute("font-style",this.styles.font.style),A.setAttribute("font-weight",this.styles.font.weight),i.appendChild(A)}}switch(this.type){case g.TYPES.FLOAT:for(var v=e;v<=f;v+=10){if(p=v+"dB",n=this.styles.left,o=Math.floor(-1*(v-f)/h*m)+this.styles.top,"none"!==this.styles.grid){var y=document.createElementNS(d.XMLNS,"rect");y.setAttribute("x",n),y.setAttribute("y",o),y.setAttribute("width",l),y.setAttribute("height",1),y.setAttribute("stroke","none"),y.setAttribute("fill",this.styles.grid),i.appendChild(y)}if(o-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text){var A=document.createElementNS(d.XMLNS,"text");A.textContent=p,A.setAttribute("x",n),A.setAttribute("y",o),A.setAttribute("text-anchor","end"),A.setAttribute("stroke","none"),A.setAttribute("fill",this.styles.text),A.setAttribute("font-family",this.styles.font.family),A.setAttribute("font-size",this.styles.font.size),A.setAttribute("font-style",this.styles.font.style),A.setAttribute("font-weight",this.styles.font.weight),i.appendChild(A)}}break;case g.TYPES.UINT:default:for(var B=["0.00","0.25","0.50","0.75","1.00"],v=0,C=B.length;v<C;v++){if(p=B[v],n=this.styles.left,o=(1-parseFloat(p))*m+this.styles.top,"none"!==this.styles.grid){var y=document.createElementNS(d.XMLNS,"rect");y.setAttribute("x",n),y.setAttribute("y",o),y.setAttribute("width",l),y.setAttribute("height",1),y.setAttribute("stroke","none"),y.setAttribute("fill",this.styles.grid),i.appendChild(y)}if(o-=Math.floor(parseInt(this.styles.font.size)/4),"none"!==this.styles.text){var A=document.createElementNS(d.XMLNS,"text");A.textContent=p,A.setAttribute("x",n),A.setAttribute("y",o),A.setAttribute("text-anchor","end"),A.setAttribute("stroke","none"),A.setAttribute("fill",this.styles.text),A.setAttribute("font-family",this.styles.font.family),A.setAttribute("font-size",this.styles.font.size),A.setAttribute("font-style",this.styles.font.style),A.setAttribute("font-weight",this.styles.font.weight),i.appendChild(A)}}}}return this},g.prototype.toString=function(){return"[SoundModule Analyser FFT]"},this.timeOverviewL=new e(c.sampleRate),this.timeOverviewR=new e(c.sampleRate),this.time=new f(c.sampleRate),this.fft=new g(c.sampleRate)}function g(a,b,c,d){this.sampleRate=a.sampleRate,this.context=a,this.processor=a.createScriptProcessor(b,c,d),this.mixedLs=null,this.mixedRs=null,this.numberOfTracks=0,this.trackLs=[],this.trackRs=[],this.activeTrack=-1,this.paused=!0,this.gainL=1,this.gainR=1}function h(a,c,d,e,f){b.call(this),this.isActive=!1,this.context=a,this.analyser=f,this.sender=a.createScriptProcessor(c,d,e),this.receiver=a.createScriptProcessor(c,d,e),this.websocket=null,this.paused=!0}function i(a,c){b.call(this),this.isActive=!0,this.context=a,this.input=a.createGain(),this.output=a.createGain(),this.lfo=a.createOscillator(),this.depth=a.createGain(),this.rate=this.lfo.frequency,this.processor=a.createScriptProcessor(c,1,2),this.lfo.start=this.lfo.start||this.lfo.noteOn,this.lfo.stop=this.lfo.stop||this.lfo.noteOff,this.values={},this.isStop=!0}function j(a,b){i.call(this,a,b),this.compressor=a.createDynamicsCompressor(),this.compressor.threshold.value=-24,this.compressor.knee.value=30,this.compressor.ratio.value=12,this.compressor.attack.value=.003,this.compressor.release.value=.25,this.state(!0)}function k(a,b){i.call(this,a,b),this.distortion=a.createWaveShaper(),this.drive=a.createGain(),this.color=a.createBiquadFilter(),this.tone=a.createBiquadFilter(),this.type=k.CURVES.CLEAN,this.numberOfSamples=4096,this.drive.gain.value=1,this.color.type="[object String]"===Object.prototype.toString.call(this.color.type)?"bandpass":this.color.BANDPASS||2,this.color.frequency.value=350,this.color.Q.value=Math.SQRT1_2,this.color.gain.value=0,this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.state(!1)}function l(a,b){i.call(this,a,b),this.lowpass=a.createBiquadFilter(),this.lowpass.type="[object String]"===Object.prototype.toString.call(this.lowpass.type)?"lowpass":this.lowpass.LOWPASS||0,
this.lowpass.frequency.value=350,this.lowpass.Q.value=1,this.lowpass.gain.value=0,this.depth.gain.value=0,this.rate.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.lowpass.frequency)}function m(a,b){i.call(this,a,b),this.bass=a.createBiquadFilter(),this.middle=a.createBiquadFilter(),this.treble=a.createBiquadFilter(),this.presence=a.createBiquadFilter(),this.bass.type="[object String]"===Object.prototype.toString.call(this.bass.type)?"lowshelf":this.bass.LOWSHELF||3,this.middle.type="[object String]"===Object.prototype.toString.call(this.middle.type)?"peaking":this.middle.PEAKING||5,this.treble.type="[object String]"===Object.prototype.toString.call(this.treble.type)?"peaking":this.treble.PEAKING||5,this.presence.type="[object String]"===Object.prototype.toString.call(this.presence.type)?"highshelf":this.presence.HIGHSHELF||4,this.bass.frequency.value=500,this.middle.frequency.value=1e3,this.treble.frequency.value=2e3,this.presence.frequency.value=4e3,this.middle.Q.value=Math.SQRT1_2,this.treble.Q.value=Math.SQRT1_2,this.bass.gain.value=0,this.middle.gain.value=0,this.treble.gain.value=0,this.presence.gain.value=0,this.state(!1)}function n(a,b){i.call(this,a,b),this.filter=a.createBiquadFilter(),this.filter.frequency.setTargetAtTime=this.filter.frequency.setTargetAtTime||this.filter.frequency.setTargetValueAtTime,this.filter.type="[object String]"===Object.prototype.toString.call(this.filter.type)?"lowpass":this.filter.LOWPASS||0,this.filter.frequency.value=350,this.filter.Q.value=1,this.filter.gain.value=0,this.maxFrequency=this.filter.frequency.value,this.range=.1,this.attack=.01,this.decay=.3,this.sustain=1,this.release=1,this.state(!1)}function o(a,b){i.call(this,a,b),this.panner=a.createStereoPanner(),this.panner.pan.value=0,this.depth.gain.value=0,this.rate.value=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.panner.pan)}function p(a,b){i.call(this,a,b),this.amplitudeL=a.createGain(),this.amplitudeR=a.createGain(),this.splitter=a.createChannelSplitter(2),this.merger=a.createChannelMerger(2),this.amplitudeL.gain.value=1,this.amplitudeR.gain.value=1,this.depth.gain.value=0,this.rate.value=0,this.state(!1),this.lfoSplitter=a.createChannelSplitter(2),this.lfo.connect(this.depth),this.depth.connect(this.processor),this.processor.connect(this.lfoSplitter),this.lfoSplitter.connect(this.amplitudeL.gain,0),this.lfoSplitter.connect(this.amplitudeR.gain,1)}function q(a,b){i.call(this,a,b),this.amplitude=a.createGain(),this.amplitude.gain.value=1,this.depth.gain.value=0,this.rate.value=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)}function r(a,b){i.call(this,a,b),this.amplitude=a.createGain(),this.amplitude.gain.value=0,this.depth.gain.value=1,this.rate.value=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)}function s(a,b){i.call(this,a,b),this.numberOfStages=12,this.filters=new Array(s.MAXIMUM_STAGES);for(var c=0;c<s.MAXIMUM_STAGES;c++)this.filters[c]=a.createBiquadFilter(),this.filters[c].type="[object String]"===Object.prototype.toString.call(this.filters[c].type)?"allpass":this.filters[c].ALLPASS||7,this.filters[c].frequency.value=350,this.filters[c].Q.value=1,this.filters[c].gain.value=0;this.mix=a.createGain(),this.feedback=a.createGain(),this.depth.gain.value=0,this.rate.value=0,this.mix.gain.value=0,this.feedback.gain.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth);for(var c=0;c<s.MAXIMUM_STAGES;c++)this.depth.connect(this.filters[c].frequency)}function t(a,b){i.call(this,a,b),this.delay=a.createDelay(),this.mix=a.createGain(),this.tone=a.createBiquadFilter(),this.feedback=a.createGain(),this.delay.delayTime.value=0,this.depth.gain.value=0,this.rate.value=0,this.mix.gain.value=0,this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.feedback.gain.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)}function u(a,b){i.call(this,a,b),this.delay=a.createDelay(),this.mix=a.createGain(),this.tone=a.createBiquadFilter(),this.feedback=a.createGain(),this.delay.delayTime.value=0,this.depth.gain.value=0,this.rate.value=0,this.mix.gain.value=0,this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.feedback.gain.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)}function v(a,b){i.call(this,a,b),this.delay=a.createDelay(v.MAX_DELAY_TIME),this.dry=a.createGain(),this.wet=a.createGain(),this.tone=a.createBiquadFilter(),this.feedback=a.createGain(),this.delay.delayTime.value=0,this.dry.gain.value=1,this.wet.gain.value=0,this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.feedback.gain.value=0,this.state(!1)}function w(a,b){i.call(this,a,b),this.rirs=[],this.convolver=a.createConvolver(),this.dry=a.createGain(),this.wet=a.createGain(),this.tone=a.createBiquadFilter(),this.dry.gain.value=1,this.wet.gain.value=0,this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.state(!1)}function x(a,b){i.call(this,a,b),this.panner=a.createPanner(),this.positions={x:0,y:0,z:0},this.orientations={x:1,y:0,z:0},this.panner.refDistance=1,this.panner.maxDistance=1e4,this.panner.rolloffFactor=1,this.panner.coneInnerAngle=360,this.panner.coneOuterAngle=360,this.panner.coneOuterGain=0,this.panner.panningModel="[object String]"===Object.prototype.toString.call(this.panner.panningModel)?"HRTF":this.panner.HRTF||1,this.panner.distanceModel="[object String]"===Object.prototype.toString.call(this.panner.distanceModel)?"inverse":this.panner.INVERSE_DISTANCE||1,this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z),this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z),this.state(!1)}function y(a){this.listener=a.listener,this.positions={x:0,y:0,z:0},this.fronts={x:0,y:0,z:-1},this.ups={x:0,y:1,z:0},this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z),this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z)}function z(a){this.context=a,this.generators=[],this.activeIndexes=[],this.activeCounter=0,this.attack=.01,this.decay=.3,this.sustain=.5,this.release=1}this.context=c,this.sampleRate=c.sampleRate;var A=navigator.userAgent;if(void 0!==e)switch(parseInt(e)){case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:this.bufferSize=parseInt(e);break;default:return}else/(Win(dows )?NT 6\.2)/.test(A)?this.bufferSize=1024:/(Win(dows )?NT 6\.1)/.test(A)?this.bufferSize=1024:/(Win(dows )?NT 6\.0)/.test(A)?this.bufferSize=2048:/Win(dows )?(NT 5\.1|XP)/.test(A)?this.bufferSize=4096:/Mac|PPC/.test(A)?this.bufferSize=1024:/Linux/.test(A)?this.bufferSize=8192:/iPhone|iPad|iPod/.test(A)?this.bufferSize=2048:this.bufferSize=16384;this.mastervolume=c.createGain(),this.processor=c.createScriptProcessor(this.bufferSize,d.NUMBER_OF_INPUTS,d.NUMBER_OF_OUTPUTS),h.prototype=Object.create(b.prototype),i.prototype=Object.create(b.prototype),h.prototype.constructor=h,i.prototype.constructor=i,j.prototype=Object.create(i.prototype),k.prototype=Object.create(i.prototype),l.prototype=Object.create(i.prototype),m.prototype=Object.create(i.prototype),n.prototype=Object.create(i.prototype),q.prototype=Object.create(i.prototype),r.prototype=Object.create(i.prototype),o.prototype=Object.create(i.prototype),p.prototype=Object.create(i.prototype),s.prototype=Object.create(i.prototype),t.prototype=Object.create(i.prototype),u.prototype=Object.create(i.prototype),v.prototype=Object.create(i.prototype),w.prototype=Object.create(i.prototype),x.prototype=Object.create(i.prototype),j.prototype.constructor=j,k.prototype.constructor=k,l.prototype.constructor=l,m.prototype.constructor=m,n.prototype.constructor=n,q.prototype.constructor=q,r.prototype.constructor=r,o.prototype.constructor=o,p.prototype.constructor=p,s.prototype.constructor=s,t.prototype.constructor=t,u.prototype.constructor=u,v.prototype.constructor=v,w.prototype.constructor=w,x.prototype.constructor=x,this.Effector=i,this.plugins=[],f.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"fftsize":if(void 0===b)return this.analyser.fftSize;var d=parseInt(b);switch(d){case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:this.analyser.fftSize=d}break;case"frequencybincount":return this.analyser.frequencyBinCount;case"mindecibels":if(void 0===b)return this.analyser.minDecibels;var d=parseFloat(b),e=-30;d<e&&(this.analyser.minDecibels=d);break;case"maxdecibels":if(void 0===b)return this.analyser.maxDecibels;var d=parseFloat(b),f=-100;d>f&&(this.analyser.maxDecibels=d);break;case"smoothingtimeconstant":if(void 0===b)return this.analyser.smoothingTimeConstant;var d=parseFloat(b),f=0,e=1;d>=f&&d<=e&&(this.analyser.smoothingTimeConstant=d)}}return this},f.prototype.start=function(b,c){var d=String(b).replace(/-/g,"").toLowerCase(),e=this;switch(d){case"timeoverviewl":if(c instanceof AudioBuffer&&c.numberOfChannels>0){var f=new Float32Array(c.length);f.set(c.getChannelData(0)),this.timeOverviewL.start(f)}break;case"timeoverviewr":if(c instanceof AudioBuffer&&c.numberOfChannels>1){var f=new Float32Array(c.length);f.set(c.getChannelData(1)),this.timeOverviewR.start(f)}break;case"time":var f=null;"uint"===this.time.param("type")?(f=new Uint8Array(this.analyser.fftSize),this.analyser.getByteTimeDomainData(f),this.time.start(f)):(f=new Float32Array(this.analyser.fftSize),this.analyser.getFloatTimeDomainData(f),this.time.start(f)),"auto"===this.time.param("interval")?this.time.timerid=requestAnimationFrame(function(){e.start(b)}):this.time.timerid=a.setTimeout(function(){e.start(b)},this.time.param("interval"));break;case"fft":var f=null;"uint"===this.fft.param("type")?(f=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(f),this.fft.start(f)):(f=new Float32Array(this.analyser.frequencyBinCount),this.analyser.getFloatFrequencyData(f),this.fft.start(f,this.analyser.minDecibels,this.analyser.maxDecibels)),"auto"===this.fft.param("interval")?this.fft.timerid=requestAnimationFrame(function(){e.start(b)}):this.fft.timerid=a.setTimeout(function(){e.start(b)},this.fft.param("interval"))}return this},f.prototype.stop=function(b){var c=String(b).replace(/-/g,"").toLowerCase();switch(c){case"timeoverviewl":case"timeoverviewr":break;case"time":"auto"===this.time.param("interval")?a.cancelAnimationFrame(this.time.timerid):a.clearTimeout(this.time.timerid),this.time.timerid=null;break;case"fft":"auto"===this.fft.param("interval")?a.cancelAnimationFrame(this.fft.timerid):a.clearTimeout(this.fft.timerid),this.fft.timerid=null}return this},f.prototype.domain=function(a){var b=String(a).replace(/-/g,"").toLowerCase();switch(b){case"timeoverviewl":case"timeoverviewr":return this["timeOverview"+b.slice(-1).toUpperCase()];case"time":case"fft":return this[b]}},f.prototype.get=function(){return this.analyser},f.prototype.toString=function(){return"[SoundModule Analyser]"},g.prototype.setup=function(a){var b=parseInt(a);if(b>0){this.numberOfTracks=b,this.trackLs=new Array(this.numberOfTracks),this.trackRs=new Array(this.numberOfTracks);for(var c=0;c<b;c++)this.trackLs[c]=[];for(var c=0;c<b;c++)this.trackRs[c]=[]}else this.numberOfTracks=1,this.trackLs=new Array(this.numberOfTracks),this.trackRs=new Array(this.numberOfTracks),this.trackLs[0]=[],this.trackRs[0]=[];return this},g.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"gainl":case"gainr":if(void 0===b)return this["gain"+c.slice(-1).toUpperCase()];var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this["gain"+c.slice(-1).toUpperCase()]=d)}}return this},g.prototype.ready=function(a){return this.isTrack(a)?this.activeTrack=a:this.activeTrack=-1,this},g.prototype.start=function(){if(this.activeTrack!==-1&&this.paused){var a=this;this.paused=!1,this.processor.onaudioprocess=function(b){if(a.activeTrack!==-1){for(var c=b.inputBuffer.getChannelData(0),d=b.inputBuffer.getChannelData(1),e=new Float32Array(this.bufferSize),f=new Float32Array(this.bufferSize),g=0;g<this.bufferSize;g++)e[g]=a.gainL*c[g],f[g]=a.gainR*d[g];a.trackLs[a.activeTrack].push(e),a.trackRs[a.activeTrack].push(f)}else this.disconnect(0),this.onaudioprocess=null}}return this},g.prototype.stop=function(){return this.activeTrack=-1,this.paused=!0,this.processor.disconnect(0),this.processor.onaudioprocess=null,this},g.prototype.isTrack=function(a){var b=parseInt(a);return b>=0&&b<this.numberOfTracks},g.prototype.getActiveTrack=function(){return this.activeTrack},g.prototype.mixTrack=function(a){for(var b=this["track"+a+"s"],c={values:null,sum:0,num:0},d=0,e=0,f=0,g=0,h=b.length;g<h;g++)f<b[g].length&&(f=b[g].length);for(c.values=new Float32Array(f*this.processor.bufferSize);;){for(var i=0,j=b.length;i<j;i++)b[i][d]instanceof Float32Array&&(c.sum+=b[i][d][e],c.num++);if(!(c.num>0))return c.values;var k=d*this.processor.bufferSize;c.values[k+e]=c.sum/c.num,c.sum=0,c.num=0,e<this.processor.bufferSize-1?e++:(d++,e=0)}},g.prototype.mix=function(){return this.activeTrack!==-1&&this.stop(),this.mixedLs=this.mixTrack("L"),this.mixedRs=this.mixTrack("R"),this},g.prototype.clear=function(a){if(this.activeTrack!==-1&&this.stop(),"all"===String(a).toLowerCase()){for(var b=0,c=this.trackLs.length;b<c;b++)this.trackLs[b].length=0;for(var b=0,c=this.trackRs.length;b<c;b++)this.trackRs[b].length=0}else this.isTrack(a)&&(this.trackLs[a].length=0,this.trackRs[a].length=0);return this},g.prototype.create=function(b,c,d){this.activeTrack!==-1&&this.stop();var e=null,f=null;if("all"===String(b).toLowerCase()?(this.mix(),e=this.mixedLs,f=this.mixedRs):this.isTrack(b)&&(e=this.trackLs[b-1],f=this.trackRs[b-1]),0!==e.length||0!==f.length){var g=1===c?1:2,h=8===d?8:16,i=1===g?Math.min(e.length,f.length):2*Math.min(e.length,f.length),j=null;switch(h){case 8:j=new Uint8Array(i);for(var k=0;k<i;k++){var l=0;l=k%g===0?(e[Math.floor(k/g)]+1)/2*(Math.pow(2,8)-1):(f[Math.floor(k/g)]+1)/2*(Math.pow(2,8)-1),l>Math.pow(2,8)-1&&(l=Math.pow(2,8)-1),l<Math.pow(2,0)-1&&(l=Math.pow(2,0)-1),j[k]=l}break;case 16:j=new Int16Array(i);for(var k=0;k<i;k++){var l=0;l=k%g===0?e[Math.floor(k/g)]*Math.pow(2,15):f[Math.floor(k/g)]*Math.pow(2,15),l>+Math.pow(2,15)-1&&(l=Math.pow(2,15)-1),l<-Math.pow(2,15)-1&&(l=-Math.pow(2,15)-1),j[k]=l}}var m=28,n=8+i*(h/8),o=36+i*(h/8),p=8+(m+n),q=this.sampleRate,r=q*g*(h/8),s=i*(h/8);if(a.URL=a.URL||a.webkitURL||a.mozURL,a.URL&&a.URL.createObjectURL){var t=[];t[0]=82,t[1]=73,t[2]=70,t[3]=70,t[4]=o>>0&255,t[5]=o>>8&255,t[6]=o>>16&255,t[7]=o>>24&255,t[8]=87,t[9]=65,t[10]=86,t[11]=69,t[12]=102,t[13]=109,t[14]=116,t[15]=32,t[16]=16,t[17]=0,t[18]=0,t[19]=0,t[20]=1,t[21]=0,t[22]=g,t[23]=0,t[24]=q>>0&255,t[25]=q>>8&255,t[26]=q>>16&255,t[27]=q>>24&255,t[28]=r>>0&255,t[29]=r>>8&255,t[30]=r>>16&255,t[31]=r>>24&255,t[32]=g*(h/8),t[33]=0,t[34]=h,t[35]=0,t[36]=100,t[37]=97,t[38]=116,t[39]=97,t[40]=s>>0&255,t[41]=s>>8&255,t[42]=s>>16&255,t[43]=s>>24&255;for(var k=0;k<i;k++)switch(h){case 8:t[p-s+k]=j[k];break;case 16:t[p-s+2*k+0]=j[k]>>0&255,t[p-s+2*k+1]=j[k]>>8&255}var u=new Blob([new Uint8Array(t)],{type:"audio/wav"}),v=a.URL.createObjectURL(u);return v}var w="";w+="RIFF",w+=String.fromCharCode(o>>0&255,o>>8&255,o>>16&255,o>>24&255),w+="WAVE",w+="fmt "+String.fromCharCode(16,0,0,0),w+=String.fromCharCode(1,0),w+=String.fromCharCode(g,0),w+=String.fromCharCode(q>>0&255,q>>8&255,q>>16&255,q>>24&255),w+=String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255),w+=String.fromCharCode(g*(h/8),0),w+=String.fromCharCode(h,0),w+="data",w+=String.fromCharCode(s>>0&255,s>>8&255,s>>16&255,s>>24&255);for(var k=0;k<i;k++)switch(h){case 8:w+=String.fromCharCode(j[k]);break;case 16:w+=String.fromCharCode(j[k]>>0&255,j[k]>>8&255)}var x=a.btoa(w),y="data:audio/wav;base64,"+x;return y}},g.prototype.toString=function(){return"[SoundModule Recorder]"},h.prototype.setup=function(a,b,c,d,e,f,g){if(!navigator.onLine)throw this.isActive=!1,this.paused=!0,this.connect(),this.websocket=null,new Error("Now Offline.");if("[object Object]"===Object.prototype.toString.call(arguments[0])){var h=arguments[0];"tls"in h&&(a=h.tls),"host"in h&&(b=h.host),"port"in h&&(c=h.port),"path"in h&&(d=h.path),"open"in h&&(e=h.open),"close"in h&&(f=h.close),"error"in h&&(g=h.error)}var i=a?"wss://":"ws://";"/"!==d.charAt(0)&&(d="/"+d);var j=parseInt(c);if(isNaN(j)||j<0||j>65535)return this;this.websocket=new WebSocket(i+b+":"+j+d),this.websocket.binaryType="arraybuffer";var k=this;return this.websocket.onopen=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a)},this.websocket.onclose=function(a){k.isActive=!1,k.paused=!0,k.connect(),"[object Function]"===Object.prototype.toString.call(f)&&f(a)},this.websocket.onerror=function(a){k.isActive=!1,k.paused=!0,k.connect(),"[object Function]"===Object.prototype.toString.call(g)&&g(a)},this.websocket.onmessage=function(a){if(!k.isActive)return k.analyser.stop("time"),void k.analyser.stop("fft");if(a.data instanceof ArrayBuffer){var b=a.data.byteLength/Float32Array.BYTES_PER_ELEMENT,c=Math.floor(b/2),d=c*Float32Array.BYTES_PER_ELEMENT,e=new Float32Array(a.data,0,c),f=new Float32Array(a.data,d,c);k.analyser.start("time"),k.analyser.start("fft"),k.receiver.onaudioprocess=function(a){var b=a.outputBuffer.getChannelData(0),c=a.outputBuffer.getChannelData(1);e instanceof Float32Array&&b.set(e),f instanceof Float32Array&&c.set(f),e=null,f=null,k.isActive&&null!==k.websocket||(k.analyser.stop("time"),k.analyser.stop("fft"))}}},this},h.prototype.connect=function(){return this.receiver.disconnect(0),this.sender.disconnect(0),this.receiver.onaudioprocess=null,this.sender.onaudioprocess=null,this.isActive?(this.receiver.connect(this.analyser.input),this.analyser.output.connect(this.context.destination)):this.paused=!0,this},h.prototype.start=function(){if(this.isActive&&this.isConnected()&&this.paused){this.paused=!1;var a=this;this.sender.onaudioprocess=function(b){if(a.isActive&&a.isConnected()){for(var c=b.inputBuffer.getChannelData(0),d=b.inputBuffer.getChannelData(1),e=new Float32Array(2*this.bufferSize),f=parseInt(e.length/2),g=0;g<this.bufferSize;g++)e[g]=c[g],e[f+g]=d[g];0===a.websocket.bufferedAmount&&a.websocket.send(e)}}}return this},h.prototype.close=function(){return this.websocket instanceof WebSocket&&(this.isActive=!1,this.paused=!0,this.connect(),this.websocket.close(),this.websocket=null),this},h.prototype.isConnected=function(){return this.websocket instanceof WebSocket&&this.websocket.readyState===WebSocket.OPEN},h.prototype.state=function(b,c,d){if(void 0===b)return this.isActive;"[object Function]"===Object.prototype.toString.call(d)&&d();var e=this,f=a.setInterval(function(){e.websocket instanceof WebSocket&&0!==e.websocket.bufferedAmount||("toggle"===String(b).toLowerCase()?e.isActive=!e.isActive:e.isActive=Boolean(b),e.connect(),"[object Function]"===Object.prototype.toString.call(c)&&c(),a.clearInterval(f))},10);return this},h.prototype.get=function(){return this.websocket},h.prototype.toString=function(){return"[SoundModule Session]"},i.prototype.param=function(a,b){},i.prototype.connect=function(){},i.prototype.start=function(a){if(this.isActive&&this.isStop){var b=parseFloat(a);(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime),this.lfo.start(b),this.isStop=!1}return this},i.prototype.stop=function(a,b){if(this.isActive&&!this.isStop){var c=parseFloat(a),d=parseFloat(b);(isNaN(c)||c<this.context.currentTime)&&(c=this.context.currentTime),(isNaN(d)||d<0)&&(d=0);var e=this.lfo.type,f=this.lfo.frequency.value;this.lfo.stop(c+d),this.lfo=this.context.createOscillator(),this.lfo.start=this.lfo.start||this.lfo.noteOn,this.lfo.stop=this.lfo.stop||this.lfo.noteOff,this.lfo.type=e,this.lfo.frequency.value=f,this.rate=this.lfo.frequency,this.isStop=!0}return this},i.prototype.state=function(a){return void 0===a?this.isActive:("toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a),this.connect(),this.start(this.context.currentTime),this)},i.prototype.params=function(){return{}},i.prototype.toJSON=function(){return""},i.prototype.toString=function(){return"[SoundModule Effector]"},j.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();if(c in this.compressor){if(void 0===b)return this.compressor[c].value;var d=parseFloat(b),e={threshold:-100,knee:0,ratio:1,attack:0,release:0},f={threshold:0,knee:40,ratio:20,attack:1,release:1},g=this.compressor[c].minValue||e[c],h=this.compressor[c].maxValue||f[c];d>=g&&d<=h&&(this.compressor[c].value=d)}}return this},j.prototype.connect=function(){return this.input.disconnect(0),this.compressor.disconnect(0),this.isActive?(this.input.connect(this.compressor),this.compressor.connect(this.output)):this.input.connect(this.output),this},j.prototype.params=function(){var a={state:this.isActive,threshold:this.compressor.threshold.value,knee:this.compressor.knee.value,ratio:this.compressor.ratio.value,attack:this.compressor.attack.value,release:this.compressor.release.value};return a},j.prototype.toJSON=function(){return JSON.stringify(this.params())},j.prototype.toString=function(){return"[SoundModule Compressor]"},k.CURVES={},k.CURVES.CLEAN="clean",k.CURVES.CRUNCH="crunch",k.CURVES.OVERDRIVE="overdrive",k.CURVES.DISTORTION="distortion",k.CURVES.FUZZ="fuzz",k.createCurve=function(a,b){if(a>0&&a<1){for(var c=new Float32Array(b),d=2*a/(1-a),e=0;e<b;e++){var f=2*(e-0)/(b-0)+-1;c[e]=(1+d)*f/(1+d*Math.abs(f))}return c}return null},k.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"curve":if(void 0===b)return this.distortion.curve;var d={CLEAN:0,CRUNCH:.5,OVERDRIVE:.7,DISTORTION:.8,FUZZ:.9},e=null;switch(String(b).toLowerCase()){case k.CURVES.CLEAN:this.type=k.CURVES.CLEAN,e=k.createCurve(d.CLEAN,this.numberOfSamples);break;case k.CURVES.CRUNCH:this.type=k.CURVES.CRUNCH,e=k.createCurve(d.CRUNCH,this.numberOfSamples);break;case k.CURVES.OVERDRIVE:this.type=k.CURVES.OVERDRIVE,e=k.createCurve(d.OVERDRIVE,this.numberOfSamples);break;case k.CURVES.DISTORTION:this.type=k.CURVES.DISTORTION,e=k.createCurve(d.DISTORTION,this.numberOfSamples);break;case k.CURVES.FUZZ:this.type=k.CURVES.FUZZ,e=k.createCurve(d.FUZZ,this.numberOfSamples);break;default:b instanceof Float32Array&&(e=b)}this.distortion.curve=e;break;case"samples":if(void 0===b)return this.numberOfSamples;var f=parseInt(b);f>=0&&(this.numberOfSamples=f,this.param("curve",this.type));break;case"drive":if(void 0===b)return this.drive.gain.value;var f=parseFloat(b),g=this.drive.gain.minValue||0,h=this.drive.gain.maxValue||1;f>=g&&f<=h&&(this.drive.gain.value=f);break;case"color":case"tone":if(void 0===b)return this[c].frequency.value;var f=parseFloat(b),g=this[c].frequency.minValue||10,h=this[c].frequency.maxValue||this.context.sampleRate/2;f>=g&&f<=h&&(this[c].frequency.value=f)}}return this},k.prototype.connect=function(){this.input.disconnect(0),this.distortion.disconnect(0),this.drive.disconnect(0),this.color.disconnect(0),this.tone.disconnect(0),this.isActive?(this.input.connect(this.color),this.color.connect(this.distortion),this.distortion.connect(this.drive),this.drive.connect(this.tone),this.tone.connect(this.output)):this.input.connect(this.output)},k.prototype.params=function(){var a={state:this.isActive,curve:this.type,samples:this.numberOfSamples,drive:this.drive.gain.value,color:this.color.frequency.value,tone:this.tone.frequency.value};return a},k.prototype.toJSON=function(){return JSON.stringify(this.params())},k.prototype.toString=function(){return"[SoundModule Distortion]"},l.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"frequency":case"cutoff":if(void 0===b)return this.lowpass.frequency.value;var d=parseFloat(b),e=this.lowpass.frequency.minValue||10,f=this.lowpass.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.lowpass.frequency.value=d,this.depth.gain.value=this.lowpass.frequency.value*this.depthRate);break;case"depth":if(void 0===b)return this.depthRate;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.depth.gain.value=this.lowpass.frequency.value*d,this.depthRate=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d);break;case"resonance":if(void 0===b)return this.lowpass.Q.value;var d=parseFloat(b),e=this.lowpass.Q.minValue||1e-4,f=this.lowpass.Q.maxValue||1e3;d>=e&&d<=f&&(this.lowpass.Q.value=d)}}return this},l.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.lowpass.frequency)),this},l.prototype.connect=function(){this.input.disconnect(0),this.lowpass.disconnect(0),this.isActive?(this.input.connect(this.lowpass),this.lowpass.connect(this.output)):this.input.connect(this.output)},l.prototype.params=function(){var a={state:this.isActive,cutoff:this.lowpass.frequency.value,depth:this.depthRate,rate:this.rate.value,resonance:this.lowpass.Q.value};return a},l.prototype.toJSON=function(){return JSON.stringify(this.params())},l.prototype.toString=function(){return"[SoundModule Wah]"},m.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"bass":case"middle":case"treble":case"presence":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.minValue||-40,f=this[c].gain.maxValue||40;d>=e&&d<=f&&(this[c].gain.value=d)}}return this},m.prototype.connect=function(){this.input.disconnect(0),this.bass.disconnect(0),this.middle.disconnect(0),this.treble.disconnect(0),this.presence.disconnect(0),this.isActive?(this.input.connect(this.bass),this.bass.connect(this.middle),this.middle.connect(this.treble),this.treble.connect(this.presence),this.presence.connect(this.output)):this.input.connect(this.output)},m.prototype.params=function(){var a={state:this.isActive,bass:this.bass.gain.value,middle:this.middle.gain.value,treble:this.treble.gain.value,presence:this.presence.gain.value};return a},m.prototype.toJSON=function(){return JSON.stringify(this.params())},m.prototype.toString=function(){return"[SoundModule Equalizer]"},n.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"type":if(void 0===b)return this.filter.type;var d=String(b).toLowerCase(),e={lowpass:this.filter.LOWPASS||0,highpass:this.filter.HIGHPASS||1,bandpass:this.filter.BANDPASS||2,lowshelf:this.filter.LOWSHELF||3,highshelf:this.filter.HIGHSHELF||4,peaking:this.filter.PEAKING||5,notch:this.filter.NOTCH||6,allpass:this.filter.ALLPASS||7};d in e&&(this.filter.type="[object String]"===Object.prototype.toString.call(this.filter.type)?d:e[d]);break;case"frequency":case"cutoff":if(void 0===b)return this.filter.frequency.value;var d=parseFloat(b),f=this.filter.frequency.minValue||10,g=this.filter.frequency.maxValue||this.context.sampleRate/2;d>=f&&d<=g&&(this.maxFrequency=d,this.filter.frequency.value=d);break;case"gain":if(void 0===b)return this.filter.gain.value;var d=parseFloat(b),f=this.filter.gain.minValue||-40,g=this.filter.gain.maxValue||40;d>=f&&d<=g&&(this.filter.gain.value=d);break;case"q":if(void 0===b)return this.filter.Q.value;var d=parseFloat(b),f=this.filter.Q.minValue||1e-4,g=this.filter.Q.maxValue||1e3;d>=f&&d<=g&&(this.filter.Q.value=d);break;case"range":if(void 0===b)return this.range;var d=parseFloat(b),f=0,g=1;d>=f&&d<=g&&(this.range=d);break;case"attack":case"sustain":if(void 0===b)return this[c];var d=parseFloat(b);d>=0&&(this[c]=d);break;case"decay":case"release":if(void 0===b)return this[c];var d=parseFloat(b);d>0&&(this[c]=d)}}return this},n.prototype.connect=function(){this.input.disconnect(0),this.filter.disconnect(0),this.isActive?(this.input.connect(this.filter),this.filter.connect(this.output)):this.input.connect(this.output)},n.prototype.start=function(a){if(this.isActive){var b=parseFloat(a);(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime);var c=b,d=c+this.attack,e=this.decay,f=this.sustain*this.maxFrequency,g=this.maxFrequency*this.range;this.filter.frequency.cancelScheduledValues(c),this.filter.frequency.setValueAtTime(g,c),this.filter.frequency.linearRampToValueAtTime(this.maxFrequency,d),this.filter.frequency.setTargetAtTime(f,d,e)}return this},n.prototype.stop=function(a){if(this.isActive){var b=parseFloat(a)-this.release;(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime);var c=b,d=this.release,e=this.maxFrequency*this.range;this.filter.frequency.cancelScheduledValues(c),this.filter.frequency.setValueAtTime(this.filter.frequency.value,c),this.filter.frequency.setTargetAtTime(e,c,d)}return this},n.prototype.state=function(a){return void 0===a?this.isActive:("toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a),this.connect(),this)},n.prototype.params=function(){var a={state:this.isActive,type:this.filter.type,frequency:this.filter.frequency.value,Q:this.filter.Q.value,gain:this.filter.gain.value,range:this.range,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release};return a},n.prototype.toJSON=function(){return JSON.stringify(this.params())},n.prototype.toString=function(){return"[SoundModule Filter]"},o.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"depth":if(void 0===b)return this.depth.gain.value;var d=parseFloat(b),e=this.depth.gain.minValue||0,f=this.depth.gain.maxValue||1;d>=e&&d<=f&&(this.depth.gain.value=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d)}}return this},o.prototype.connect=function(){this.input.disconnect(0),this.panner.disconnect(0),this.isActive?(this.input.connect(this.panner),this.panner.connect(this.output)):this.input.connect(this.output)},o.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.panner.pan)),this},o.prototype.params=function(){var a={state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value};return a},o.prototype.toJSON=function(){return JSON.stringify(this.params())},o.prototype.toString=function(){return"[SoundModule Autopanner]"},p.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{
var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"depth":if(void 0===b)return this.depth.gain.value;var d=parseFloat(b),e=this.depth.gain.minValue||0,f=this.depth.gain.maxValue||1;d>=e&&d<=f&&(this.depth.gain.value=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d)}}return this},p.prototype.connect=function(){this.input.disconnect(0),this.amplitudeL.disconnect(0),this.amplitudeR.disconnect(0),this.splitter.disconnect(0),this.splitter.disconnect(1),this.merger.disconnect(0),this.isActive?(this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0,0),this.splitter.connect(this.amplitudeR,1,0),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output)):this.input.connect(this.output)},p.prototype.start=function(a){if(this.isActive&&this.isStop){var b=parseFloat(a);(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime),this.lfo.start(b),this.isStop=!1;var c=this;this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),d=a.outputBuffer.getChannelData(0),e=a.outputBuffer.getChannelData(1);if(c.isActive&&0!==c.depth.gain.value&&0!==c.rate.value)for(var f=0;f<this.bufferSize;f++)d[f]=b[f],e[f]=-b[f];else for(var f=0;f<this.bufferSize;f++)d[f]=0,e[f]=0}}return this},p.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.processor.disconnect(0),this.processor.onaudioprocess=null,this.lfo.connect(this.depth),this.depth.connect(this.processor),this.processor.connect(this.lfoSplitter),this.lfoSplitter.connect(this.amplitudeL.gain,0),this.lfoSplitter.connect(this.amplitudeR.gain,1)),this},p.prototype.params=function(){var a={state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value};return a},p.prototype.toJSON=function(){return JSON.stringify(this.params())},p.prototype.toString=function(){return"[SoundModule AutopannerFallback]"},q.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"depth":if(void 0===b)return this.depth.gain.value;var d=parseFloat(b),e=this.depth.gain.minValue||0,f=this.depth.gain.maxValue||1;d>=e&&d<=f&&(this.depth.gain.value=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d);break;case"wave":if(void 0===b)return this.lfo.type;var d=String(b).toLowerCase(),g={sine:this.lfo.SINE||0,square:this.lfo.SQUARE||1,sawtooth:this.lfo.SAWTOOTH||2,triangle:this.lfo.TRIANGLE||3};d in g&&(this.lfo.type="[object String]"===Object.prototype.toString.call(this.lfo.type)?d:g[d])}}return this},q.prototype.connect=function(){this.input.disconnect(0),this.amplitude.disconnect(0),this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output)},q.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)),this},q.prototype.params=function(){var a={state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value,wave:this.lfo.type};return a},q.prototype.toJSON=function(){return JSON.stringify(this.params())},q.prototype.toString=function(){return"[SoundModule Tremolo]"},r.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"depth":if(void 0===b)return this.depth.gain.value;var d=parseFloat(b),e=this.depth.gain.minValue||0,f=this.depth.gain.maxValue||1;d>=e&&d<=f&&(this.depth.gain.value=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d)}}return this},r.prototype.connect=function(){this.input.disconnect(0),this.amplitude.disconnect(0),this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output)},r.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)),this},r.prototype.params=function(){var a={state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value};return a},r.prototype.toJSON=function(){return JSON.stringify(this.params())},r.prototype.toString=function(){return"[SoundModule Ringmodulator]"},s.MAXIMUM_STAGES=24,s.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"stage":if(void 0===b)return this.numberOfStages;var d=parseInt(b);switch(d){case 0:case 2:case 4:case 8:case 12:case 24:this.numberOfStages=d,this.connect()}break;case"frequency":case"cutoff":if(void 0===b)return this.filters[0].frequency.value;var d=parseFloat(b),e=this.filters[0].frequency.minValue||10,f=this.filters[0].frequency.maxValue||this.context.sampleRate/2;if(d>=e&&d<=f){for(var g=0;g<s.MAXIMUM_STAGES;g++)this.filters[g].frequency.value=d;this.depth.gain.value=this.filters[0].frequency.value*this.depthRate}break;case"resonance":if(void 0===b)return this.filters[0].Q.value;var d=parseFloat(b),e=this.filters[0].Q.minValue||1e-4,f=this.filters[0].Q.maxValue||1e3;if(d>=e&&d<=f)for(var g=0;g<s.MAXIMUM_STAGES;g++)this.filters[0].Q.value=d;break;case"depth":if(void 0===b)return this.depthRate;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.depth.gain.value=this.filters[0].frequency.value*d,this.depthRate=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d);break;case"mix":case"feedback":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.minValue||0,f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d)}}return this},s.prototype.connect=function(){this.input.disconnect(0);for(var a=0;a<s.MAXIMUM_STAGES;a++)this.filters[a].disconnect(0);if(this.mix.disconnect(0),this.feedback.disconnect(0),this.input.connect(this.output),this.isActive&&this.numberOfStages>0){this.input.connect(this.filters[0]);for(var a=0;a<this.numberOfStages;a++)a<this.numberOfStages-1?this.filters[a].connect(this.filters[a+1]):(this.filters[a].connect(this.mix),this.mix.connect(this.output),this.filters[a].connect(this.feedback),this.feedback.connect(this.filters[0]))}},s.prototype.stop=function(a,b){if(i.prototype.stop.call(this,a,b),this.isActive){this.lfo.connect(this.depth);for(var c=0;c<s.MAXIMUM_STAGES;c++)this.depth.connect(this.filters[c].frequency)}return this},s.prototype.params=function(){var a={state:this.isActive,stage:this.numberOfStages,frequency:this.filters[0].frequency.value,resonance:this.filters[0].Q.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,feedback:this.feedback.gain.value};return a},s.prototype.toJSON=function(){return JSON.stringify(this.params())},s.prototype.toString=function(){return"[SoundModule Phaser]"},t.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"delaytime":case"time":if(void 0===b)return this.delay.delayTime.value;var d=parseFloat(b),e=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||1;d>=e&&d<=f&&(this.delay.delayTime.value=d,this.depth.gain.value=this.delay.delayTime.value*this.depthRate);break;case"depth":if(void 0===b)return this.depthRate;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.depth.gain.value=this.delay.delayTime.value*d,this.depthRate=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d);break;case"mix":case"feedback":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.minValue||0,f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;case"tone":if(void 0===b)return this.tone.frequency.value;var d=parseFloat(b),e=this.tone.frequency.minValue||10,f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d)}}return this},t.prototype.connect=function(){this.input.disconnect(0),this.delay.disconnect(0),this.mix.disconnect(0),this.tone.disconnect(0),this.feedback.disconnect(0),this.input.connect(this.output),this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay))},t.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)),this},t.prototype.params=function(){var a={state:this.isActive,time:this.delay.delayTime.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value};return a},t.prototype.toJSON=function(){return JSON.stringify(this.params())},t.prototype.toString=function(){return"[SoundModule Flanger]"},u.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"delaytime":case"time":if(void 0===b)return this.delay.delayTime.value;var d=parseFloat(b),e=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||1;d>=e&&d<=f&&(this.delay.delayTime.value=d,this.depth.gain.value=this.delay.delayTime.value*this.depthRate);break;case"depth":if(void 0===b)return this.depthRate;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.depth.gain.value=this.delay.delayTime.value*d,this.depthRate=d);break;case"rate":if(void 0===b)return this.rate.value;var d=parseFloat(b),e=this.rate.minValue||0,f=this.rate.maxValue||1e5;d>=e&&d<=f&&(this.rate.value=d);break;case"mix":case"feedback":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.minValue||0,f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;case"tone":if(void 0===b)return this.tone.frequency.value;var d=parseFloat(b),e=this.tone.frequency.minValue||10,f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d)}}return this},u.prototype.connect=function(){this.input.disconnect(0),this.delay.disconnect(0),this.mix.disconnect(0),this.tone.disconnect(0),this.feedback.disconnect(0),this.input.connect(this.output),this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay))},u.prototype.stop=function(a,b){return i.prototype.stop.call(this,a,b),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)),this},u.prototype.params=function(){var a={state:this.isActive,time:this.delay.delayTime.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value};return a},u.prototype.toJSON=function(){return JSON.stringify(this.params())},u.prototype.toString=function(){return"[SoundModule Chorus]"},v.MAX_DELAY_TIME=5,v.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"delaytime":case"time":if(void 0===b)return this.delay.delayTime.value;var d=parseFloat(b),e=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||v.MAX_DELAY_TIME;d>=e&&d<=f&&(this.delay.delayTime.value=d);break;case"dry":case"wet":case"feedback":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.minValue||0,f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;case"tone":if(void 0===b)return this.tone.frequency.value;var d=parseFloat(b),e=this.tone.frequency.minValue||10,f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d)}}return this},v.prototype.connect=function(){this.input.disconnect(0),this.delay.disconnect(0),this.dry.disconnect(0),this.wet.disconnect(0),this.tone.disconnect(0),this.feedback.disconnect(0),this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.wet),this.wet.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay)):this.input.connect(this.output)},v.prototype.params=function(){var a={state:this.isActive,time:this.delay.delayTime.value,dry:this.dry.gain.value,wet:this.wet.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value};return a},v.prototype.toJSON=function(){return JSON.stringify(this.params())},v.prototype.toString=function(){return"[SoundModule Delay]"},w.ERROR_AJAX="error",w.ERROR_AJAX_TIMEOUT="timeout",w.ERROR_DECODE="decode",w.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"type":if(void 0===b)return this.convolver.buffer;var d=parseInt(b),e=0,f=this.rirs.length-1;null===b?(this.convolver.buffer=null,this.input.disconnect(0),this.input.connect(this.output)):d>=e&&d<=f&&(this.convolver.buffer=this.rirs[d],this.connect());break;case"dry":case"wet":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.minValue||0,f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;case"tone":if(void 0===b)return this.tone.frequency.value;var d=parseFloat(b),e=this.tone.frequency.minValue||10,f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d);break;case"rirs":return this.rirs}}return this},w.prototype.connect=function(){this.input.disconnect(0),this.convolver.disconnect(0),this.dry.disconnect(0),this.wet.disconnect(0),this.tone.disconnect(0),this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output)):this.input.connect(this.output)},w.prototype.start=function(a,b){if(a instanceof AudioBuffer||null===a)this.convolver.buffer=a,this.rirs.push(a);else if(a instanceof ArrayBuffer){var c=this,d=function(a){c.convolver.buffer=a,c.rirs.push(a)};"[object Function]"!==Object.prototype.toString.call(b)&&(b=function(){}),this.context.decodeAudioData(a,d,b)}return this},w.prototype.preset=function(a,b,c,d,e){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var f=arguments[0];"rirs"in f&&(a=f.rirs),"timeout"in f&&(b=f.timeout),"success"in f&&(c=f.success),"error"in f&&(d=f.error),"progress"in f&&(e=f.progress)}Array.isArray(a)||(a=[a]),this.rirs=new Array(a.length);for(var g=!1,h=parseInt(b),i=this,j=function(a,b){var f=new XMLHttpRequest;f.timeout=h>0?h:6e4,f.ontimeout=function(a){g||"[object Function]"!==Object.prototype.toString.call(d)||d(a,w.ERROR_AJAX_TIMEOUT),g=!0},f.onprogresss=function(a){g?f.abort():"[object Function]"===Object.prototype.toString.call(e)&&e(a)},f.onerror=function(a){g||"[object Function]"!==Object.prototype.toString.call(d)||d(a,w.ERROR_AJAX),g=!0},f.onload=function(a){if(200===f.status){var e=f.response;if(!(e instanceof ArrayBuffer))return;var g=function(d){i.rirs[b]=d;for(var e=0,f=i.rirs.length;e<f;e++)if(void 0===i.rirs[e])return;"[object Function]"===Object.prototype.toString.call(c)&&c(a)},h=function(a){"[object Function]"===Object.prototype.toString.call(d)&&d(a,w.ERROR_DECODE)};i.context.decodeAudioData(e,g,h)}},f.open("GET",a,!0),f.responseType="arraybuffer",f.send(null)},k=0,l=a.length;k<l;k++)"[object String]"===Object.prototype.toString.call(a[k])?j(a[k],k):a[k]instanceof AudioBuffer&&(this.rirs[k]=a[k]);return this},w.prototype.state=function(a){return void 0===a?this.isActive:("toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a),this.connect(),this)},w.prototype.params=function(){var a={state:this.isActive,dry:this.dry.gain.value,wet:this.wet.gain.value,tone:this.tone.frequency.value};return a},w.prototype.toJSON=function(){return JSON.stringify(this.params())},w.prototype.toString=function(){return"[SoundModule Reverb]"},x.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"x":case"y":case"z":if(void 0===b)return this.positions[c];var d=parseFloat(b);isNaN(d)||(this.positions[c]=d,this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case"ox":case"oy":case"oz":if(void 0===b)return this.orientations[c.charAt(1)];var d=parseFloat(b);isNaN(d)||(this.orientations[c.charAt(1)]=d,this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z));break;case"refdistance":if(void 0===b)return this.panner.refDistance;var d=parseFloat(b);isNaN(d)||(this.panner.refDistance=d);break;case"maxdistance":if(void 0===b)return this.panner.maxDistance;var d=parseFloat(b);isNaN(d)||(this.panner.maxDistance=d);break;case"rollofffactor":if(void 0===b)return this.panner.rolloffFactor;var d=parseFloat(b);isNaN(d)||(this.panner.rolloffFactor=d);break;case"coneinnerangle":if(void 0===b)return this.panner.coneInnerAngle;var d=parseFloat(b);isNaN(d)||(this.panner.coneInnerAngle=d);break;case"coneouterangle":if(void 0===b)return this.panner.coneOuterAngle;var d=parseFloat(b);isNaN(d)||(this.panner.coneOuterAngle=d);break;case"coneoutergain":if(void 0===b)return this.panner.coneOuterGain;var d=parseFloat(b);isNaN(d)||(this.panner.coneOuterGain=d);break;case"panningmodel":if(void 0===b)return this.panner.panningModel;var d=/HRTF/i.test(b)?String(b).toUpperCase():String(b).toLowerCase(),e={equalpower:this.panner.EQUALPOWER||0,HRTF:this.panner.HRTF||1};d in e&&(this.panner.panningModel="[object String]"===Object.prototype.toString.call(this.panner.panningModel)?d:e[d]);break;case"distancemodel":if(void 0===b)return this.panner.distanceModel;var d=String(b).replace(/-/g,"").toLowerCase(),e={linear:this.panner.LINEAR_DISTANCE||0,inverse:this.panner.INVERSE_DISTANCE||1,exponential:this.panner.EXPONENTIAL_DISTANCE||2};d in e&&(this.panner.distanceModel="[object String]"===Object.prototype.toString.call(this.panner.distanceModel)?d:e[d])}}return this},x.prototype.connect=function(){this.input.disconnect(0),this.panner.disconnect(0),this.isActive?(this.input.connect(this.panner),this.panner.connect(this.output)):this.input.connect(this.output)},x.prototype.params=function(){var a={state:this.isActive,positions:this.positions,orientations:this.orientations,refDistance:this.panner.refDistance,maxDistance:this.panner.maxDistance,rolloffFactor:this.panner.rolloffFactor,coneInnerAngle:this.panner.coneInnerAngle,coneOuterAngle:this.panner.coneOuterAngle,coneOuterGain:this.panner.coneOuterGain,panningModel:this.panner.panningModel,distanceModel:this.panner.distanceModel};return a},x.prototype.toJSON=function(){return JSON.stringify(this.params())},x.prototype.toString=function(){return"[SoundModule Panner]"},y.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"x":case"y":case"z":if(void 0===b)return this.positions[c];var d=parseFloat(b);isNaN(d)||(this.positions[c]=d,this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case"fx":case"fy":case"fz":if(void 0===b)return this.fronts[c.charAt(1)];var d=parseFloat(b);isNaN(d)||(this.fronts[c.charAt(1)]=d,this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z));break;case"ux":case"uy":case"uz":if(void 0===b)return this.ups[c.charAt(1)];var d=parseFloat(b);isNaN(d)||(this.ups[c.charAt(1)]=d,this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z))}}return this},y.prototype.params=function(){var a={positions:this.positions,fronts:this.fronts,ups:this.ups};return a},y.prototype.toJSON=function(){return JSON.stringify(this.params())},y.prototype.toString=function(){return"[SoundModule Listener]"},z.MIN_GAIN=.001,z.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"attack":case"sustain":if(void 0===b)return this[c];var d=parseFloat(b);d>=0&&(this[c]=d);break;case"decay":case"release":if(void 0===b)return this[c];var d=parseFloat(b);d>0&&(this[c]=d)}}return this},z.prototype.ready=function(a,b,c){var d=parseInt(a)>=0?parseInt(a):0;return b.connect(this.generators[d]),this.generators[d].connect(c),this.activeIndexes[d]=d,this.activeCounter++,this},z.prototype.start=function(a){var b=parseFloat(a);(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime);for(var c=b,d=c+this.attack,e=this.decay,f=this.sustain,g=0,h=this.activeIndexes.length;g<h;g++){var i=this.activeIndexes[g];void 0!==i&&(this.generators[i].gain.cancelScheduledValues(c),this.generators[i].gain.setValueAtTime(0,c),this.generators[i].gain.linearRampToValueAtTime(1,d),this.generators[i].gain.setTargetAtTime(f,d,e))}return this},z.prototype.stop=function(a){var b=parseFloat(a)-this.release;(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime);for(var c=b,d=this.release,e=0,f=this.activeIndexes.length;e<f;e++){var g=this.activeIndexes[e];void 0!==g&&(this.generators[g].gain.cancelScheduledValues(c),this.generators[g].gain.setValueAtTime(this.generators[g].gain.value,c),this.generators[g].gain.setTargetAtTime(0,c,d))}return this},z.prototype.getGenerator=function(a){var b=parseInt(a)>=0?parseInt(a):0;return this.generators[b]},z.prototype.setGenerator=function(a){var b=parseInt(a)>=0?parseInt(a):0;return this.generators[b]=this.context.createGain(),this.generators[b].gain.setTargetAtTime=this.generators[b].gain.setTargetAtTime||this.generators[b].gain.setTargetValueAtTime,this},z.prototype.isStop=function(){for(var a=0,b=0,c=this.activeIndexes.length;b<c;b++){var d=this.activeIndexes[b];if(void 0!==d){if(this.generators[d].gain.value>z.MIN_GAIN)return!1;if(a++,a===this.activeCounter)return!0}}},z.prototype.clear=function(){this.activeIndexes.length=0,this.activeCounter=0;for(var a=0,b=this.generators.length;a<b;a++)this.generators[a].gain.value=1;return this},z.prototype.params=function(){var a={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release};return a},z.prototype.toJSON=function(){return JSON.stringify(this.params())},z.prototype.toString=function(){return"[SoundModule EnvelopeGenerator]"},this.analyser=new f(c),this.recorder=new g(c,this.bufferSize,d.NUMBER_OF_INPUTS,d.NUMBER_OF_OUTPUTS),this.session=new h(c,this.bufferSize,d.NUMBER_OF_INPUTS,d.NUMBER_OF_OUTPUTS,this.analyser),this.envelopegenerator=new z(c),this.compressor=new j(c,this.bufferSize),this.distortion=new k(c,this.bufferSize),this.wah=new l(c,this.bufferSize),this.equalizer=new m(c,this.bufferSize),this.filter=new n(c,this.bufferSize),this.tremolo=new q(c,this.bufferSize),this.ringmodulator=new r(c,this.bufferSize),this.autopanner=c.createStereoPanner?new o(c,this.bufferSize):new p(c,this.bufferSize),this.phaser=new s(c,this.bufferSize),this.flanger=new t(c,this.bufferSize),this.chorus=new u(c,this.bufferSize),this.delay=new v(c,this.bufferSize),this.reverb=new w(c,this.bufferSize),this.panner=new x(c,this.bufferSize),this.listener=new y(c),this.modules=[this.panner,this.compressor,this.distortion,this.wah,this.equalizer,this.filter,this.autopanner,this.tremolo,this.ringmodulator,this.phaser,this.flanger,this.chorus,this.delay,this.reverb]}function e(a){function b(a){this.context=a,this.frequencies={start:-1,end:0},this.time=0,this.type=b.TYPES.LINEAR}d.call(this,a),this.sources=[],this.times={start:0,stop:0},this.isAnalyser=!1,b.TYPES={},b.TYPES.LINEAR="linear",b.TYPES.EXPONENTIAL="exponential",b.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var d in arguments[0])this.param(d,arguments[0][d]);else{var d=String(a).replace(/-/g,"").toLowerCase();switch(d){case"time":if(void 0===c)return this.time;var e=parseFloat(c);e>=0&&(this.time=e);break;case"type":if(void 0===c)return this.type;var e=String(c).toUpperCase();e in b.TYPES&&(this.type=e.toLowerCase())}}return this},b.prototype.ready=function(a){this.frequencies.end=a;var b=this.frequencies.start===-1?0:this.frequencies.end-this.frequencies.start;return this.frequencies.start!==-1&&0!==this.time&&0!==b||(this.frequencies.start=this.frequencies.end),this},b.prototype.start=function(a,b){var c=parseFloat(b);(isNaN(c)||c<this.context.currentTime)&&(c=this.context.currentTime);var d=c,e=d+this.time;return a.frequency.cancelScheduledValues(d),a.frequency.setValueAtTime(this.frequencies.start,d),a.frequency[this.type+"RampToValueAtTime"](this.frequencies.end,e),this},b.prototype.stop=function(){return this.frequencies.start=this.frequencies.end,this},b.prototype.toString=function(){return"[OscillatorModule Glide]"},this.glide=new b(a)}function f(a){d.call(this,a),this.sources=[],this.resources=[],this.buffers=[],this.volumes=[],this.isStops=[],this.settings=[],this.times={start:0,stop:0},this.transpose=1,this.isStop=!0,this.isAnalyser=!1}function g(a){function b(){this.depth=0}d.call(this,a),this.source=a.createBufferSource(),this.buffer=null,this.currentTime=0,this.paused=!0,this.callbacks={decode:function(){},ready:function(){},start:function(){},stop:function(){},update:function(){},ended:function(){},error:function(){}},b.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"depth":if(void 0===b)return this.depth;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.depth=d)}}return this},b.prototype.start=function(a,b){return a-this.depth*b},b.prototype.toString=function(){return"[AudioModule VocalCanceler]"},this.vocalcanceler=new b}function h(a){g.call(this,a),this.source=null,this.media=null,this.ext="",this.duration=0,this.playbackRate=1,this.controls=!1,this.loop=!1,this.muted=!1,this.listeners={}}function i(a){function b(){this.level=0}d.call(this,a),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,this.source=null,this.medias={audio:!0,video:!1},this.callbacks={stream:function(){},error:function(){}},this.isStop=!0,b.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"level":if(void 0===b)return this.level;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.level=d)}}return this},b.prototype.start=function(a){var b=Math.abs(parseFloat(a));return b>this.level?b:0},b.prototype.toString=function(){return"[StreamModule NoiseGate]"},this.noisegate=new b}function j(a){d.call(this,a),this.sources=[],this.isAnalyser=!1}function k(a){this.context=a,this.midiAccess=null,this.inputs=[],this.outputs=[]}function l(a){this.context=a,this.source=null,this.sequences=[],this.timerids=[],this.prev=[],this.callbacks={start:function(){},stop:function(){},ended:function(){},error:function(){}}}var m,n=!(!a.AudioContext&&!a.webkitAudioContext);b.prototype.state=function(a){};var o=function(a,b,c,d,e){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var f=arguments[0];"file"in f&&(a=f.file),"type"in f&&(b=f.type),"success"in f&&(c=f.success),"error"in f&&(d=f.error),"progress"in f&&(e=f.progress)}if(!(a instanceof Blob))return void("[object Function]"===Object.prototype.toString.call(d)&&d(null,"FILE_IS_NOT_BLOB"));var g=new FileReader;g.onprogress=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a)},g.onerror=function(a){if("[object Function]"===Object.prototype.toString.call(d)){var b="";switch(g.error.code){case g.error.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case g.error.SECURITY_ERR:b="SECURITY_ERR";break;case g.error.ABORT_ERR:b="ABORT_ERR";break;case g.error.NOT_READABLE_ERR:b="NOT_READABLE_ERR";break;case g.error.ENCODING_ERR:b="ENCODING_ERR";break;default:b="ERR"}d(a,b)}},g.onload=function(a){if("[object Function]"===Object.prototype.toString.call(c)){var b=g.result;"[object String]"===Object.prototype.toString.call(b)&&b.indexOf("data:")===-1&&b.indexOf("blob:")===-1&&(b=b.replace(/<(\/?script.*?)>/gi,"&lt;$1&gt;")),c(a,b)}},/arraybuffer/i.test(b)?g.readAsArrayBuffer(a):/dataurl/i.test(b)?g.readAsDataURL(a):/text/i.test(b)&&g.readAsText(a,"UTF-8")},p=function(a,b,c,d,e){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var f=arguments[0];"event"in f&&(a=f.event),"type"in f&&(b=f.type),"success"in f&&(c=f.success),"error"in f&&(d=f.error),"progress"in f&&(e=f.progress)}if(a instanceof Event){var g=null;if("drop"===a.type)a.stopPropagation(),a.preventDefault(),g=a.dataTransfer.files[0];else{if(!("change"===a.type&&"files"in a.target))return;g=a.target.files[0]}if(g instanceof File){if(/text/i.test(b)&&g.type.indexOf("text")===-1)throw new Error("Please upload text file.");if(/arraybuffer|dataurl/i.test(b)&&g.type.indexOf("audio")===-1)throw new Error("Please upload audio file.");return this.read({file:g,type:b,success:c,error:d,progress:e}),g}throw new Error("Please upload file.")}},q=function(a,b,c,d,e){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var f=arguments[0];"url"in f&&(a=f.url),"timeout"in f&&(b=f.timeout),"success"in f&&(c=f.success),"error"in f&&(d=f.error),"progress"in f&&(e=f.progress)}var g="error",h="timeout",i=new XMLHttpRequest,j=parseInt(b);i.timeout=j>0?j:6e4,i.ontimeout=function(a){"[object Function]"===Object.prototype.toString.call(d)&&d(a,h)},i.onprogress=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a)},i.onerror=function(a){"[object Function]"===Object.prototype.toString.call(d)&&d(a,g)},i.onload=function(a){if(200===i.status){var b=i.response;b instanceof ArrayBuffer&&"[object Function]"===Object.prototype.toString.call(c)&&c(a,b)}},i.open("GET",a,!0),i.responseType="arraybuffer",i.send(null)},r=function(a,b,c,d){if(a instanceof AudioContext&&b instanceof ArrayBuffer)return"[object Function]"!==Object.prototype.toString.call(c)&&(c=function(){}),"[object Function]"!==Object.prototype.toString.call(d)&&(d=function(){}),a.decodeAudioData(b,c,d)},s=function(a){var b=Math.pow(2,1/12),c=27.5;Array.isArray(a)||(a=[a]);for(var d=new Array(a.length),e=0,f=a.length;e<f;e++){var g=parseInt(a[e]);d[e]=g>=0?c*Math.pow(b,g):0}return d},t=function(a){var b=parseFloat(a);if(b>=0){var c=Math.floor(b/60),d=Math.floor(b%60),e=b-parseInt(b);return{minutes:c,seconds:d,milliseconds:e}}},u=function(a){if(a instanceof Element)if(a.webkitRequestFullscreen)a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.msRequestFullscreen)a.msRequestFullscreen();else{if(!a.requestFullscreen)throw new Error("Cannot change to full screen.");a.requestFullscreen()}},v=function(){if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else if(document.cancelFullScreen)document.cancelFullScreen();else{
if(!document.exitFullscreen)throw new Error("Cannot exit from full screen.");document.exitFullscreen()}},w=function(b){return a.X===m&&(a.X=void 0),b&&a.XSound===m&&(a.XSound=void 0),m};if(c.TYPES={},c.TYPES.AUDIO="audio",c.TYPES.VIDEO="video",c.prototype.setup=function(a,b,d){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var e=arguments[0];"media"in e&&(a=e.media),"formats"in e&&(b=e.formats),"listeners"in e&&(d=e.listeners)}var f="";if(a instanceof HTMLAudioElement)f=c.TYPES.AUDIO;else{if(!(a instanceof HTMLVideoElement))return this;f=c.TYPES.VIDEO}this.media=a,Array.isArray(b)||(b=[b]);for(var g=0,h=b.length;g<h;g++){var i=f+"/"+String(b[g]).toLowerCase();if(/^(?:maybe|probably)/.test(this.media.canPlayType(i))){this.ext=b[g];break}}if(""===this.ext)throw new Error("Media format that can be played does not exist.");if("[object Object]"===Object.prototype.toString.call(d))for(var j in d)this.listeners[j.toLowerCase()]="[object Function]"===Object.prototype.toString.call(d[j])?d[j]:function(){};var k=this;this.media.addEventListener("loadedmetadata",function(a){k.duration=this.duration,"loadedmetadata"in k.listeners&&k.listeners.loadedmetadata(a)},!1);for(var j in this.listeners)this.media.addEventListener(j,function(a){k.listeners[a.type.toLowerCase()](a)},!1);return this},c.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"mastervolume":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media.volume:this.volume;var d=parseFloat(b),e=0,f=1;d>=e&&d<=f&&(this.media instanceof HTMLMediaElement&&(this.media.volume=d),this.volume=d);break;case"playbackrate":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;var d=parseFloat(b),e=.5;d>=e&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=d),this.playbackRate=d);break;case"currenttime":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media.currentTime:0;if(this.media instanceof HTMLMediaElement){var d=parseFloat(b),e=0,f=this.duration;d>=e&&d<=f&&(this.media.currentTime=d)}break;case"loop":case"muted":case"controls":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media[c]:this[c];this.media instanceof HTMLMediaElement&&(this.media[c]=Boolean(b)),this[c]=Boolean(b);break;case"width":case"height":if(void 0===b)return this.media instanceof HTMLVideoElement?this.media[c]:0;var d=parseInt(b),e=0;d>=e&&this.media instanceof HTMLVideoElement&&(this.media[c]=d);break;case"duration":return this.duration;case"channels":return}}return this},c.prototype.ready=function(a){var b=String(a);try{b.indexOf("data:")!==-1||b.indexOf("blob:")!==-1?this.media.src=b:this.media.src=b+"."+this.ext}catch(c){throw new Error("The designated resource cannot be loaded.")}return this},c.prototype.start=function(a){if(this.media instanceof HTMLMediaElement&&this.media.paused){this.media.play();var b=parseFloat(a);this.media.currentTime=b>=0&&b<=this.duration?b:0,this.media.playbackRate=this.playbackRate,this.media.controls=this.controls,this.media.loop=this.loop,this.media.muted=this.muted}return this},c.prototype.stop=function(){return this.media instanceof HTMLMediaElement&&!this.media.paused&&this.media.pause(),this},c.prototype.get=function(){return this.media},c.prototype.toggle=function(a){return this.media instanceof HTMLMediaElement&&(this.media.paused?this.start(a):this.stop()),this},c.prototype.isMedia=function(){return this.media instanceof HTMLMediaElement},c.prototype.isSource=function(){return this.isMedia()},c.prototype.isPaused=function(){return!(this.media instanceof HTMLMediaElement)||this.media.paused},c.prototype.toString=function(){return"[MediaFallbackModule]"},!n){var x=new c;return m=function(){return x},m.IS_XSOUND=n,m.SAMPLE_RATE=null,m.NUMBER_OF_INPUTS=null,m.NUMBER_OF_OUTPUTS=null,m.read=o,m.file=p,m.ajax=q,m.decode=r,m.toFrequencies=s,m.convertTime=t,m.fullscreen=u,m.exitFullscreen=v,m.noConflict=w,m.get=function(){return null},m.getCurrentTime=function(){return 0},m.clone=function(){return function(){return new c}},m.toString=function(){return"[XSound]"},a.XSound=m,void(a.X=m)}a.AudioContext=a.AudioContext||a.webkitAudioContext;var y=new AudioContext;y.createScriptProcessor=y.createScriptProcessor||y.createJavaScriptNode,y.createGain=y.createGain||y.createGainNode,y.createDelay=y.createDelay||y.createDelayNode,y.createPeriodicWave=y.createPeriodicWave||y.createWaveTable,d.NUMBER_OF_INPUTS=2,d.NUMBER_OF_OUTPUTS=2,d.prototype.setup=function(){},d.prototype.param=function(a,b){var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"mastervolume":if(void 0===b)return this.mastervolume.gain.value;var d=parseFloat(b),e=this.mastervolume.gain.minValue||0,f=this.mastervolume.gain.maxValue||1;d>=e&&d<=f&&(this.mastervolume.gain.value=d)}},d.prototype.ready=function(){},d.prototype.start=function(){},d.prototype.stop=function(){},d.prototype.get=function(){},d.prototype.resize=function(a){return d.call(this,this.context,a),this},d.prototype.getBufferSize=function(){return this.processor.bufferSize},d.prototype.connect=function(a,b){Array.isArray(b)&&(this.modules=b),a.disconnect(0),this.modules.length>0?a.connect(this.modules[0].input):a.connect(this.mastervolume);for(var c=0,d=this.modules.length;c<d;c++)this.modules[c].output.disconnect(0),c<this.modules.length-1?this.modules[c].output.connect(this.modules[c+1].input):this.modules[c].output.connect(this.mastervolume);return this.mastervolume.connect(this.analyser.input),this.analyser.output.connect(this.context.destination),this.mastervolume.connect(this.recorder.processor),this.recorder.processor.connect(this.context.destination),this.mastervolume.connect(this.session.sender),this.session.sender.connect(this.context.destination),this},d.prototype.module=function(a){var b=String(a).replace(/-/g,"").toLowerCase();switch(b){case"listener":case"analyser":case"recorder":case"session":case"compressor":case"distortion":case"wah":case"equalizer":case"filter":case"tremolo":case"ringmodulator":case"autopanner":case"phaser":case"flanger":case"chorus":case"delay":case"reverb":case"panner":return this[b];case"envelopegenerator":case"eg":return this.envelopegenerator;case"glide":if(b in this)return this[b];case"vocalcanceler":if(b in this)return this[b];case"noisegate":if(b in this)return this[b];default:for(var c=0,d=this.plugins.length;c<d;c++)if(b===this.plugins[c].name)return this.plugins[c].plugin}},d.prototype.on=function(a){var b=parseFloat(a);(isNaN(b)||b<this.context.currentTime)&&(b=this.context.currentTime),this.chorus.start(b),this.flanger.start(b),this.phaser.start(b),this.autopanner.start(b),this.tremolo.start(b),this.ringmodulator.start(b),this.wah.start(b),this.filter.start(b);for(var c=0,d=this.plugins.length;c<d;c++)this.plugins[c].plugin.start(b);return this},d.prototype.off=function(a,b){var c=parseFloat(a);if((isNaN(c)||c<this.context.currentTime)&&(c=this.context.currentTime),this.chorus.stop(c),this.flanger.stop(c),this.phaser.stop(c),this.autopanner.stop(c),this.tremolo.stop(c),this.ringmodulator.stop(c),this.wah.stop(c),b)for(var d=0,e=this.plugins.length;d<e;d++)this.plugins[d].plugin.stop(c);return this},d.prototype.install=function(a,b){return"[object Function]"===Object.prototype.toString.call(b)&&(b.prototype=new this.Effector(this.context,this.bufferSize),this.plugins.push({name:String(a).toLowerCase(),plugin:new b(this.context)})),this},d.prototype.params=function(){var a={};for(var b in this)if("[object Function]"!==Object.prototype.toString.call(this[b])){var c=b.toLowerCase();"mastervolume"===c?a[c]=this[b].gain.value:"[object Object]"===Object.prototype.toString.call(this[b])&&"params"in this[b]&&(a[c]=this[b].params())}return a},d.prototype.toJSON=function(){return JSON.stringify(this.params())},d.prototype.toString=function(){return"[SoundModule]"},e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.setup=function(a){function c(a,c){b.call(this),this.isActive=c,this.context=a,this.source=a.createOscillator(),this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable,this.source.start=this.source.start||this.source.noteOn,this.source.stop=this.source.stop||this.source.noteOff,this.volume=a.createGain(),this.isStop=!0,this.octave=0,this.fine=0,this.customs={real:new Float32Array([0,1]),imag:new Float32Array([0,1])}}c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),d=1200;switch(c){case"type":if(void 0===b)return this.source.type;if("[object Object]"!==Object.prototype.toString.call(b)){var e=String(b).toLowerCase(),f={sine:this.source.SINE||0,square:this.source.SQUARE||1,sawtooth:this.source.SAWTOOTH||2,triangle:this.source.TRIANGLE||3};e in f&&(this.source.type="[object String]"===Object.prototype.toString.call(this.source.type)?e:f[e])}else if("real"in b&&"imag"in b){var g=null,h=null;if(b.real instanceof Float32Array?g=b.real:Array.isArray(b.real)&&(g=new Float32Array(b.real)),b.imag instanceof Float32Array?h=b.imag:Array.isArray(b.imag)&&(h=new Float32Array(b.imag)),g instanceof Float32Array&&h instanceof Float32Array){var i=4096;g.length>i&&(g=g.subarray(0,i)),h.length>i&&(h=h.subarray(0,i)),0!==g[0]&&(g[0]=0),0!==h[0]&&(h[0]=0);var j=this.context.createPeriodicWave(g,h);this.source.setPeriodicWave(j),this.customs.real=g,this.customs.imag=h}}break;case"octave":if(void 0===b)return this.octave;var e=parseFloat(b),k=(this.source.detune.minValue||-4800)/d,l=(this.source.detune.maxValue||4800)/d;e>=k&&e<=l&&(this.octave=e,this.source.detune.value=this.fine+e*d);break;case"fine":if(void 0===b)return this.fine;var e=parseFloat(b),k=-d,l=d;e>=k&&e<=l&&(this.fine=e,this.source.detune.value=e+this.octave*d);break;case"volume":case"gain":if(void 0===b)return this.volume.gain.value;var e=parseFloat(b),k=this.volume.gain.minValue||0,l=this.volume.gain.maxValue||1;e>=k&&e<=l&&(this.volume.gain.value=e)}}return this},c.prototype.ready=function(a){if(this.isActive){var b={type:this.source.type,frequency:this.source.frequency.value,detune:this.source.detune.value};if(this.isStop||(this.source.stop(this.context.currentTime),this.source.disconnect(0)),this.source=this.context.createOscillator(),this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable,this.source.start=this.source.start||this.source.noteOn,this.source.stop=this.source.stop||this.source.noteOff,"custom"===b.type){var c=this.customs.real,d=this.customs.imag,e=this.context.createPeriodicWave(c,d);this.source.setPeriodicWave(e)}else this.source.type=b.type;this.source.frequency.value=b.frequency,this.source.detune.value=b.detune,this.volume.connect(a)}return this},c.prototype.start=function(a){return this.isActive?(this.source.start(a),this.isStop=!1):(this.isStop||(this.source.stop(this.context.currentTime),this.isStop=!0),this.source.disconnect(0)),this},c.prototype.stop=function(a){return this.isStop||(this.source.stop(a),this.source.disconnect(0),this.isStop=!0),this},c.prototype.state=function(a){return void 0===a?this.isActive:("toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a),this)},c.prototype.get=function(){return this.source},c.prototype.toString=function(){return"[OscillatorModule Oscillator]"},this.sources.length=0,Array.isArray(a)||(a=[a]);for(var d=0,e=a.length;d<e;d++)this.sources[d]=new c(this.context,Boolean(a[d])),this.envelopegenerator.setGenerator(d);return this},e.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);return void 0===e?this:e},e.prototype.ready=function(a,b){var c=parseFloat(a),d=parseFloat(b);return c>=0?this.times.start=c:this.times.start=0,d>=c?this.times.stop=d:this.times.stop=0,this.envelopegenerator.clear(),this},e.prototype.start=function(a,b,c){var d=this.context.currentTime+this.times.start;Array.isArray(a)||(a=[a]);for(var e=0,f=a.length;e<f;e++){var g=parseFloat(a[e]);a[e]=g>=0?g:0}this.envelopegenerator.clear(),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.connect(this.processor,b);for(var e=0,f=a.length;e<f&&!(e>=this.sources.length);e++){var h=this.sources[e],i=a[e];h.ready(this.processor),this.envelopegenerator.ready(e,h.source,h.volume),this.glide.ready(i).start(h.source,d),h.start(d)}this.envelopegenerator.start(d),this.on(d),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);var j=this;return"[object Function]"===Object.prototype.toString.call(c)?this.processor.onaudioprocess=c:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),d=a.outputBuffer.getChannelData(0),e=a.outputBuffer.getChannelData(1);if(j.envelopegenerator.isStop()){for(var f=j.context.currentTime,g=0,h=j.sources.length;g<h;g++)j.sources[g].stop(f);j.off(f),j.analyser.stop("time"),j.analyser.stop("fft"),j.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null}else d.set(b),e.set(c)},this},e.prototype.stop=function(){var a=this.context.currentTime+this.times.stop;this.envelopegenerator.stop(a),this.glide.stop(),this.filter.stop(a);for(var b=0,c=this.plugins.length;b<c;b++)this.plugins[b].plugin.stop(a,this.envelopegenerator.param("release"));return this},e.prototype.get=function(a){var b=parseInt(a);return b>=0&&b<this.sources.length?this.sources[b]:this.sources},e.prototype.length=function(){return this.sources.length},e.prototype.params=function(){var a=d.prototype.params.call(this);a.oscillator={glide:{type:this.glide.param("type"),time:this.glide.param("time")}};for(var b=0,c=this.sources.length;b<c;b++){var e=this.sources[b];a.oscillator["oscillator"+b]={state:e.state(),gain:e.param("gain"),type:e.param("type"),octave:e.param("octave"),fine:e.param("fine")}}return a},e.prototype.toString=function(){return"[OscillatorModule]"},f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f.ERROR_AJAX="error",f.ERROR_AJAX_TIMEOUT="timeout",f.ERROR_DECODE="decode",f.prototype.setup=function(a,b,c,d,e,g){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var h=arguments[0];"resources"in h&&(a=h.resources),"settings"in h&&(b=h.settings),"timeout"in h&&(c=h.timeout),"success"in h&&(d=h.success),"error"in h&&(e=h.error),"progress"in h&&(g=h.progress)}Array.isArray(a)||(a=[a]),this.resources=a,Array.isArray(b)||(b=[b]),this.buffers.length=a.length;for(var i=0,j=b.length;i<j;i++){if(!("buffer"in b[i]))return;var k=parseInt(b[i].buffer);if(!(k>=0&&k<this.buffers.length))return;b[i].buffer=k,b[i].rate="rate"in b[i]&&b[i].rate>=0?parseFloat(b[i].rate):1,b[i].loop="loop"in b[i]&&Boolean(b[i].loop),b[i].start="start"in b[i]&&b[i].start>=0?parseFloat(b[i].start):0,b[i].end="end"in b[i]&&b[i].end>=0?parseFloat(b[i].end):0,b[i].volume="volume"in b[i]&&b[i].volume>=0&&b[i].volume<=1?parseFloat(b[i].volume):1,this.isStops[i]=!0,this.volumes[i]=this.context.createGain(),this.envelopegenerator.setGenerator(i)}this.settings=b;for(var l=!1,m=parseInt(c),n=this,o=function(a,b){var c=new XMLHttpRequest;c.timeout=m>0?m:6e4,c.ontimeout=function(a){l||"[object Function]"!==Object.prototype.toString.call(e)||e(a,f.ERROR_AJAX_TIMEOUT),l=!0},c.onprogress=function(a){l?c.abort():"[object Function]"===Object.prototype.toString.call(g)&&g(a)},c.onerror=function(a){l||"[object Function]"!==Object.prototype.toString.call(e)||e(a,f.ERROR_AJAX),l=!0},c.onload=function(a){if(200===c.status){var g=c.response;if(!(g instanceof ArrayBuffer))return;var h=function(c){n.buffers[b]=c;for(var e=0,f=n.buffers.length;e<f;e++)if(void 0===n.buffers[e])return;"[object Function]"===Object.prototype.toString.call(d)&&d.call(n,a,n.buffers)},i=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a,f.ERROR_DECODE)};n.context.decodeAudioData(g,h,i)}},c.open("GET",a,!0),c.responseType="arraybuffer",c.send(null)},i=0,j=this.resources.length;i<j;i++)"[object String]"===Object.prototype.toString.call(this.resources[i])?o(this.resources[i],i):this.resources[i]instanceof AudioBuffer&&(this.buffers[i]=this.resources[i]);return this},f.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);if(void 0!==e)return e;switch(c){case"transpose":if(void 0===b)return this.transpose;var f=parseFloat(b),g=0;f>g&&(this.transpose=f)}}return this},f.prototype.ready=function(a,b){var c=parseFloat(a),d=parseFloat(b);return c>=0?this.times.start=c:this.times.start=0,d>=c?this.times.stop=d:this.times.stop=0,this.envelopegenerator.clear(),this},f.prototype.start=function(b,c,d){var e=parseInt(b);if(!(isNaN(e)||e<0||e>=this.settings.length)){var f=this.settings[e].buffer,g=this.settings[e].rate,h=this.settings[e].loop,i=this.settings[e].start,j=this.settings[e].end,k=this.settings[e].volume;if(this.buffers[f]instanceof AudioBuffer){this.sources[e]instanceof AudioBufferSourceNode&&(this.sources[e].stop(this.context.currentTime),this.sources[e].disconnect(0),this.sources[e]=null);var l=this.context.createBufferSource();l.start=l.start||l.noteGrainOn,l.stop=l.stop||l.noteOff,l.buffer=this.buffers[f],l.playbackRate.value=g*this.transpose,l.loop=h,l.loopStart=i,l.loopEnd=j,this.volumes[e].gain.value=k,this.envelopegenerator.clear(),this.envelopegenerator.ready(e,l,this.volumes[e]),this.volumes[e].connect(this.processor),this.connect(this.processor,c);var m=this.context.currentTime+this.times.start;l.start(m),this.sources[e]=l,this.envelopegenerator.start(m),this.on(m),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0),this.isStops[e]=!1;var n=this;return this.times.stop>0&&a.setTimeout(function(){n.stop(e)},1e3*this.times.stop),l.onended=function(){n.isStops[e]=!0},"[object Function]"===Object.prototype.toString.call(d)?this.processor.onaudioprocess=d:this.processor.onaudioprocess=function(a){if(n.isStop=n.isStops.every(function(a,b,c){return a}),n.isStop)n.off(n.context.currentTime),n.envelopegenerator.clear(),n.analyser.stop("time"),n.analyser.stop("fft"),n.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null;else{var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),d=a.outputBuffer.getChannelData(0),e=a.outputBuffer.getChannelData(1);d.set(b),e.set(c)}},this}}},f.prototype.stop=function(a){var b=parseInt(a);if(!(isNaN(b)||b<0||b>=this.settings.length)){var c=this.settings[b].buffer;if(this.buffers[c]instanceof AudioBuffer&&this.sources[b]instanceof AudioBufferSourceNode){var d=this.context.currentTime+this.times.stop;this.envelopegenerator.stop(d),this.filter.stop(d);for(var e=0,f=this.plugins.length;e<f;e++)this.plugins[e].plugin.stop(d,this.envelopegenerator.param("release"));return this}}},f.prototype.get=function(a){var b=parseInt(a);return b>=0&&b<this.buffers.length?this.buffers[b]:this.buffers},f.prototype.params=function(){var a=d.prototype.params.call(this);return a.oneshot={transpose:this.transpose},a},f.prototype.reset=function(a,b,c){var d=parseInt(a);return String(b).toLowerCase()in this.settings[d]&&(this.settings[d][b.toLowerCase()]=c),this},f.prototype.toString=function(){return"[OneshotModule]"},g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.setup=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.setup(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase();c in this.callbacks&&"[object Function]"===Object.prototype.toString.call(b)&&(this.callbacks[c]=b)}return this},g.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);if(void 0!==e)return e;switch(c){case"playbackrate":if(void 0===b)return this.source.playbackRate.value;var f=parseFloat(b),g=this.source.playbackRate.minValue||0,h=this.source.playbackRate.maxValue||1024;f>=g&&f<=h&&(this.source.playbackRate.value=f);break;case"loop":case"looping":if(void 0===b)return this.source.loop;this.source.loop=Boolean(b);break;case"currenttime":if(void 0===b)return this.currentTime;if(this.buffer instanceof AudioBuffer){var f=parseFloat(b),h=this.buffer.duration,g=0;f>=g&&f<=h&&(this.paused?(this.stop(),this.currentTime=f):(this.stop(),this.start(f)))}else this.currentTime=0;break;case"duration":return this.buffer instanceof AudioBuffer?this.buffer.duration:0;case"samplerate":return this.buffer instanceof AudioBuffer?this.buffer.sampleRate:this.sampleRate;case"channels":return this.buffer instanceof AudioBuffer?this.buffer.numberOfChannels:0}}return this},g.prototype.ready=function(a){if(a instanceof ArrayBuffer){var b=this,c=function(a){b.buffer=a,b.analyser.start("timeOverviewL",a),b.analyser.start("timeOverviewR",a),b.callbacks.ready(a)};this.context.decodeAudioData(a,c,this.callbacks.error),this.callbacks.decode(a)}return this},g.prototype.start=function(a,b,c){if(this.buffer instanceof AudioBuffer&&this.paused){var d=this.context.currentTime,e=parseFloat(a);this.currentTime=e>=0&&e<=this.buffer.duration?e:0;var f=this.source.playbackRate.value,g=this.source.loop;this.source=this.context.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.buffer=this.buffer,this.source.playbackRate.value=f,this.source.loop=g,this.source.connect(this.processor),this.connect(this.processor,b),this.source.start(d,e,this.buffer.duration-e),this.analyser.start("time"),this.analyser.start("fft"),this.paused=!1,this.on(d),this.callbacks.start(this.source,this.currentTime);var h=this;"[object Function]"===Object.prototype.toString.call(c)?this.processor.onaudioprocess=c:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),d=a.outputBuffer.getChannelData(0),e=a.outputBuffer.getChannelData(1);if(h.currentTime<Math.floor(h.source.buffer.duration)){for(var f=0;f<this.bufferSize;f++){d[f]=h.vocalcanceler.start(b[f],c[f]),e[f]=h.vocalcanceler.start(c[f],b[f]),h.currentTime+=1*h.source.playbackRate.value/h.source.buffer.sampleRate;var g=Math.floor(h.currentTime*h.source.buffer.sampleRate),i=.1*h.source.buffer.sampleRate;g%i===0&&h.callbacks.update(h.source,h.currentTime)}h.analyser.timeOverviewL.update(h.currentTime),h.analyser.timeOverviewR.update(h.currentTime)}else h.source.loop?h.currentTime=0:h.end.call(h)}}return this},g.prototype.stop=function(){if(this.buffer instanceof AudioBuffer&&!this.paused){var a=this.context.currentTime;this.source.stop(a),this.off(a,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.paused=!0,this.callbacks.stop(this.source,this.currentTime)}return this},g.prototype.get=function(){return this.source},g.prototype.toggle=function(a,b,c){return this.paused?this.start(a,b,c):this.stop(),this},g.prototype.end=function(){return this.stop(),this.currentTime=0,this.callbacks.ended(this.source,this.currentTime),this},g.prototype.isBuffer=function(){return this.buffer instanceof AudioBuffer},g.prototype.isSource=function(){return this.source instanceof AudioBufferSourceNode&&this.source.buffer instanceof AudioBuffer},g.prototype.isPaused=function(){return this.paused},g.prototype.params=function(){var a=d.prototype.params.call(this);return a.audio={playbackrate:this.source.playbackRate.value,vocalcanceler:{depth:this.vocalcanceler.param("depth")}},a},g.prototype.toString=function(){return"[AudioModule]"},h.prototype=Object.create(g.prototype),h.prototype.constructor=h,h.TYPES={},h.TYPES.AUDIO="audio",h.TYPES.VIDEO="video",h.prototype.setup=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(arguments[0])){var d=arguments[0];"media"in d&&(a=d.media),"formats"in d&&(b=d.formats),"listeners"in d&&(c=d.listeners)}var e="";if(a instanceof HTMLAudioElement)e=h.TYPES.AUDIO;else{if(!(a instanceof HTMLVideoElement))return this;e=h.TYPES.VIDEO}this.media=a,Array.isArray(b)||(b=[b]);for(var f=0,g=b.length;f<g;f++){var i=e+"/"+String(b[f]).toLowerCase();if(/^(?:maybe|probably)/.test(this.media.canPlayType(i))){this.ext=b[f];break}}if(""===this.ext)throw new Error("Media format that can be played does not exist.");if("[object Object]"===Object.prototype.toString.call(c))for(var j in c)this.listeners[j.toLowerCase()]="[object Function]"===Object.prototype.toString.call(c[j])?c[j]:function(){};var k=this;this.media.addEventListener("loadstart",function(a){k.source instanceof MediaElementAudioSourceNode||(k.source=k.context.createMediaElementSource(this)),"loadstart"in k.listeners&&k.listeners.loadstart(a)},!1),this.media.addEventListener("loadedmetadata",function(a){k.duration=this.duration,"loadedmetadata"in k.listeners&&k.listeners.loadedmetadata(a)},!1),this.media.addEventListener("ended",function(a){this.pause(),k.off(k.context.currentTime),k.analyser.stop("time"),k.analyser.stop("fft"),k.processor.disconnect(0),k.processor.onaudioprocess=null,"ended"in k.listeners&&k.listeners.ended(a)},!1);for(var j in this.listeners)this.media.addEventListener(j,function(a){k.listeners[a.type.toLowerCase()](a)},!1);return this},h.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else{var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);if(void 0!==e)return e;switch(c){case"playbackrate":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;var f=parseFloat(b),g=.5;f>=g&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=f),this.playbackRate=f);break;case"currenttime":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media.currentTime:0;if(this.media instanceof HTMLMediaElement){var f=parseFloat(b),g=0,h=this.duration;f>=g&&f<=h&&(this.media.currentTime=f)}break;case"loop":case"muted":case"controls":if(void 0===b)return this.media instanceof HTMLMediaElement?this.media[c]:this[c];this.media instanceof HTMLMediaElement&&(this.media[c]=Boolean(b)),this[c]=Boolean(b);break;case"width":case"height":if(void 0===b)return this.media instanceof HTMLVideoElement?this.media[c]:0;var f=parseInt(b),g=0;f>=g&&this.media instanceof HTMLVideoElement&&(this.media[c]=f);break;case"duration":return this.duration;case"channels":return this.source instanceof MediaElementAudioSourceNode?this.source.channelCount:0}}return this},h.prototype.ready=function(a){var b=String(a);try{b.indexOf("data:")!==-1||b.indexOf("blob:")!==-1?this.media.src=b:this.media.src=b+"."+this.ext}catch(c){throw new Error("The designated resource cannot be loaded.")}return this},h.prototype.start=function(a,b,c){if(this.source instanceof MediaElementAudioSourceNode&&this.media.paused){this.source.connect(this.processor),this.connect(this.processor,b),this.media.play();var d=parseFloat(a);this.media.currentTime=d>=0&&d<=this.duration?d:0,this.media.playbackRate=this.playbackRate,this.media.controls=this.controls,this.media.loop=this.loop,this.media.muted=this.muted,this.on(this.context.currentTime),this.analyser.start("time"),this.analyser.start("fft");var e=this;"[object Function]"===Object.prototype.toString.call(c)?this.processor.onaudioprocess=c:this.processor.onaudioprocess=function(a){for(var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),d=a.outputBuffer.getChannelData(0),f=a.outputBuffer.getChannelData(1),g=0;g<this.bufferSize;g++)d[g]=e.vocalcanceler.start(b[g],c[g]),f[g]=e.vocalcanceler.start(c[g],b[g])}}return this},h.prototype.stop=function(){return this.source instanceof MediaElementAudioSourceNode&&!this.media.paused&&(this.media.pause(),this.off(this.context.currentTime,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null),this},h.prototype.get=function(){return this.media},h.prototype.toggle=function(a,b,c){return this.media instanceof HTMLMediaElement&&(this.media.paused?this.start(a,b,c):this.stop()),this},h.prototype.isMedia=function(){return this.media instanceof HTMLMediaElement},h.prototype.isSource=function(){return this.source instanceof MediaElementAudioSourceNode},h.prototype.isPaused=function(){return!(this.media instanceof HTMLMediaElement)||this.media.paused},h.prototype.params=function(){var a=d.prototype.params.call(this);return a.media={playbackrate:this.playbackRate,vocalcanceler:{depth:this.vocalcanceler.param("depth")}},a},h.prototype.toString=function(){return"[MediaModule]"},i.prototype=Object.create(d.prototype),i.prototype.constructor=i,i.prototype.setup=function(a,b,c){return Boolean(a)&&(this.medias.video=!0),"[object Function]"===Object.prototype.toString.call(b)&&(this.callbacks.stream=b),"[object Function]"===Object.prototype.toString.call(c)&&(this.callbacks.error=c),this},i.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.param(c,arguments[0][c]);else var c=String(a).replace(/-/g,"").toLowerCase(),e=d.prototype.param.call(this,c,b);return void 0===e?this:e},i.prototype.ready=function(){return this},i.prototype.start=function(a,b){if(void 0===navigator.getUserMedia)throw new Error("Cannot use WebRTC.");var c=!1,d=this,e=function(a,b,e){d.source=d.context.createMediaStreamSource(a),d.source.connect(d.processor),d.connect(d.processor,b),d.on(d.context.currentTime),c||(d.analyser.start("time"),d.analyser.start("fft"),c=!0),"[object Function]"===Object.prototype.toString.call(e)?d.processor.onaudioprocess=e:d.processor.onaudioprocess=function(a){for(var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0),f=a.outputBuffer.getChannelData(1),g=0;g<this.bufferSize;g++)e[g]=d.noisegate.start(b[g]),f[g]=d.noisegate.start(c[g])}};return this.isStop=!1,navigator.getUserMedia(this.medias,function(c){d.isStop||(e(c,a,b),d.callbacks.stream(c))},function(a){d.callbacks.error(a)}),this},i.prototype.stop=function(){return this.source=null,this.off(this.context.currentTime,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.isStop=!0,this},i.prototype.get=function(){return this.source},i.prototype.toggle=function(a,b){return this.isStreaming()?this.stop():this.start(a,b),this},i.prototype.isStreaming=function(){return!this.isStop},i.prototype.params=function(){var a=d.prototype.params.call(this);return a.stream={noisegate:{level:this.noisegate.param("level")}},a},i.prototype.toString=function(){return"[StreamModule]"},j.prototype=Object.create(d.prototype),j.prototype.constructor=j,j.prototype.mix=function(a){Array.isArray(a)||(a=[a]),this.sources=a;for(var b=0,c=this.sources.length;b<c;b++){var d=this.sources[b];if(!(d instanceof e||d instanceof f||d instanceof g||d instanceof h||d instanceof i))return;var j=this.context.currentTime;this.off(j,!1),d.analyser.stop("time"),d.analyser.stop("fft"),d.isAnalyser=!1,d.recorder.stop(),d.session.close(),d.processor.disconnect(0),d.processor.connect(this.processor)}this.connect(this.processor);var k=this.context.currentTime;this.on(k),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);var l=this;return this.processor.onaudioprocess=function(b){
var c=b.inputBuffer.getChannelData(0),d=b.inputBuffer.getChannelData(1),j=b.outputBuffer.getChannelData(0),k=b.outputBuffer.getChannelData(1),m=!1,n=0;for(l.sources.length;n<10;n++){var o=a[n];o instanceof e&&o.envelopegenerator.isStop()?m=!0:o instanceof f&&o.isStop?m=!0:o instanceof g&&o.paused?m=!0:o instanceof h&&o.media.paused?m=!0:o instanceof i&&o.isStop&&(m=!0)}if(m){var p=l.context.currentTime;l.on(p,!0),l.analyser.stop("time"),l.analyser.stop("fft"),l.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null}else j.set(c),k.set(d)},this},j.prototype.get=function(a){var b=parseInt(a);return b>=0&&b<this.sources.length?this.sources[b]:this.sources},j.prototype.toString=function(){return"[MixerModule]"},k.prototype.setup=function(a,b,c){if(!navigator.requestMIDIAccess)throw new Error("Cannot use Web MIDI API.");var d=this;return navigator.requestMIDIAccess({sysex:Boolean(a)}).then(function(a){if(d.midiAccess=a,"[object Function]"===Object.prototype.toString.call(a))d.inputs=a.inputs(),d.outputs=a.outputs();else{for(var c=a.inputs.values(),e=a.outputs.values(),f=c.next();!f.done;f=c.next())d.inputs.push(f.value);for(var g=e.next();!g.done;g=e.next())d.outputs.push(g.value)}"[object Function]"===Object.prototype.toString.call(b)&&b(d.midiAccess,d.inputs,d.outputs)},function(a){"[object Function]"===Object.prototype.toString.call(c)&&c(a)}),this},k.prototype.get=function(){return this.midiAccess},k.prototype.toString=function(){return"[MIDI]"},l.ONE_MINUTES=60,l.EQUAL_TEMPERAMENT=12,l.QUARTER_NOTE=4,l.REGEXP_MML=/\s*(?:T\d+)\s*|\s*(?:O\d+)\s*|\s*(?:(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*\s*/gi,l.REGEXP_TEMPO=/T\d+/i,l.REGEXP_OCTAVE=/O\d+/i,l.REGEXP_NOTE=/(?:(?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*/i,l.REGEXP_CHORD=/((?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*/i,l.REGEXP_DURATION=/(?:[CDEFGABR][#+-]?)+((?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*)/i,l.ERROR_STRING="MML",l.ERROR_TEMPO="TEMPO",l.ERROR_OCTAVE="OCTAVE",l.ERROR_NOTE="NOTE",l.computeIndex=function(a,b){var c=0;switch(b){case"C":c=3;break;case"D":c=5;break;case"E":c=7;break;case"F":c=8;break;case"G":c=10;break;case"A":c=12;break;case"B":c=14;break;case"R":return"R"}var d=l.EQUAL_TEMPERAMENT*(a-1)+c;return d>=0?d:-1},l.computeFrequency=function(a){var b=Math.pow(2,1/12),c=27.5;return a>=0?c*Math.pow(b,a):-1},l.toAscii=function(a){for(var b="",c=0,d=a.length;c<d;c++){var e=a.charCodeAt(c);b+=e>255?"&#"+e+";":a.charAt(c)}return b},l.prototype.setup=function(a,b){if(arguments.length>0&&"[object Object]"===Object.prototype.toString.call(arguments[0]))for(var c in arguments[0])this.setup(c,arguments[0][c]);else if(arguments.length>1){var c=String(a).toLowerCase();c in this.callbacks&&"[object Function]"===Object.prototype.toString.call(b)&&(this.callbacks[c]=b)}return this},l.prototype.ready=function(a,b){if(null!==this.source&&this.stop(),this.sequences.length=0,this.timerids.length=0,this.prev.length=0,Array.isArray(a)){for(var c=0,d=a.length;c<d;c++)if(!(a[c]instanceof OscillatorNode))return this;this.source=a}else if(a instanceof OscillatorNode)this.source=[a];else{if(!(a instanceof e||a instanceof f))return this;this.source=a}for(Array.isArray(b)||(b=[b]);b.length>0;){var g=String(b.shift()),h=[],i=g.match(l.REGEXP_MML);if(null===i)return void this.callbacks.error(l.ERROR_STRING,"");for(var j=0;i.length>0;){var k=i.shift().trim();if(l.REGEXP_TEMPO.test(k)){var m=parseInt(k.slice(1));if(!(m>0))return void this.callbacks.error(l.ERROR_TEMPO,k);var n=l.ONE_MINUTES/m}else if(l.REGEXP_OCTAVE.test(k)){var o=parseInt(k.slice(1));if(o<0)return void this.callbacks.error(l.ERROR_OCTAVE,k)}else if(l.REGEXP_NOTE.test(k)){if(void 0===n)return void this.callbacks.error(l.ERROR_TEMPO,k);if(void 0===o)return void this.callbacks.error(l.ERROR_OCTAVE,k);for(var p=k.match(l.REGEXP_CHORD)[1],q=[],c=0,d=p.length;c<d;c++){var r=p.charAt(c),s=l.computeIndex(o,r.toUpperCase());switch(p.charAt(c+1)){case"#":case"+":s++,c++;break;case"-":s--,c++}if(s>=q[0]&&(s-=l.EQUAL_TEMPERAMENT),s<0)return void this.callbacks.error(l.ERROR_NOTE,k);q.push(s)}for(var t=[],c=0,d=q.length;c<d;c++){var u="R"!==q[c]?l.computeFrequency(q[c]):0;if(u===-1)return void this.callbacks.error(l.ERROR_NOTE,k);t.push(u)}for(var v=k.split("&"),w=0;v.length>0;){var x=v.shift().match(l.REGEXP_DURATION)[1];switch(parseInt(x)){case 1:case 2:case 4:case 8:case 16:case 32:case 64:case 128:case 256:var y=l.QUARTER_NOTE/parseInt(x);w+=x.indexOf(".")!==-1?1.5*y*n:y*n;break;case 6:w+=2*n/3;break;case 12:w+=n/3;break;case 18:w+=2*n/9;break;case 24:w+=.5*n/3;break;case 36:w+=n/9;break;case 48:w+=.25*n/3;break;case 72:w+=.5*n/9;break;case 96:w+=.125*n/3;break;case 144:w+=.25*n/9;break;case 192:w+=.0625*n/3;break;default:this.callbacks.error(l.ERROR_NOTE,k)}}var z=j,A=z+w;j+=w,h.push({indexes:q,frequencies:t,start:z,duration:w,stop:A})}}h.length>0&&(h.reverse(),this.sequences.push(h),this.timerids.push(null))}return this},l.prototype.start=function(b,c,d){var g=parseInt(b);if(g>=0&&g<this.sequences.length){if(!Array.isArray(this.sequences[g]))return this;if(0===this.sequences[g].length)return this.stop(d),this.callbacks.ended(),this;var h=this.sequences[g].pop();if(Array.isArray(this.source)){for(var i=0,j=this.source.length;i<j;i++){var k=this.source[i],l=k.type,m=k.detune.value;if(k=this.context.createOscillator(),k.start=k.start||k.noteOn,k.stop=k.stop||k.noteOff,k.type=l,k.frequency.value=h.frequencies[i],k.detune.value=m,Array.isArray(c)){k.connect(c[0]);for(var i=0,j=c.length;i<j;i++){var n=c[i];if(i<j-1){var o=c[i+1];if(!(n instanceof AudioNode&&o instanceof AudioNode))return;n.connect(o)}else n.connect(this.context.destination)}}else k.connect(this.context.destination);k.start(this.context.currentTime),k.stop(this.context.currentTime+h.duration),this.source[i]=k}for(var i=0,j=h.indexes.length;i<j;i++)"R"!==h.indexes[i]&&this.callbacks.start(h,i)}else if(this.source instanceof e){this.source.start(h.frequencies,c,d);for(var i=0,j=h.indexes.length;i<j;i++)"R"!==h.indexes[i]&&this.callbacks.start(h,i)}else if(this.source instanceof f)for(var i=0,j=h.indexes.length;i<j;i++)"R"!==h.indexes[i]&&(this.source.start(h.indexes[i],c,d),this.callbacks.start(h,i));var p=this;this.timerids[g]=a.setTimeout(function(){if(Array.isArray(p.source))for(var a=0,b=h.indexes.length;a<b;a++)"R"!==h.indexes[a]&&p.callbacks.stop(h,a);else if(p.source instanceof e){p.source.stop(h.frequencies,d);for(var a=0,b=h.indexes.length;a<b;a++)"R"!==h.indexes[a]&&p.callbacks.stop(h,a)}else if(p.source instanceof f)for(var a=0,b=h.indexes.length;a<b;a++)"R"!==h.indexes[a]&&(p.source.stop(h.indexes[a],d),p.callbacks.stop(h,a));p.prev=h,p.start(g,c,d),h=null},1e3*h.duration)}return this},l.prototype.stop=function(b){var c=this.prev;if(0===c.length)return this;if(Array.isArray(this.source))for(var d=0,g=c.indexes.length;d<g;d++)"R"!==c.indexes[d]&&this.callbacks.stop(c,d);else if(this.source instanceof e){this.source.stop(c.frequencies,b);for(var d=0,g=c.indexes.length;d<g;d++)"R"!==c.indexes[d]&&this.callbacks.stop(c,d)}else if(this.source instanceof f)for(var d=0,g=c.indexes.length;d<g;d++)"R"!==c.indexes[d]&&(this.source.stop(c.indexes[d],b),this.callbacks.stop(c,d));for(var d=0,g=this.timerids.length;d<g;d++)a.clearTimeout(this.timerids[d]),this.timerids[d]=null;return this},l.prototype.get=function(a){var b=parseInt(a);return b>=0&&b<this.sequences.length?this.sequences[b]:this.sequences},l.prototype.toggle=function(a,b,c){return this.isPaused()?this.start(a,b,c):this.stop(),this},l.prototype.isSequences=function(){return Array.isArray(this.sequences[0])},l.prototype.isPaused=function(){for(var a=0,b=this.timerids.length;a<b;a++){var c=this.timerids[a];if(null!==c&&void 0!==c)return!1}return!0},l.prototype.create=function(b){var c=a.btoa(l.toAscii(String(b))),d="data:text/plain;base64,"+c;return d},l.prototype.toString=function(){return"[MML]"};var z={oscillator:new e(y),oneshot:new f(y),audio:new g(y),media:new h(y),fallback:new c,stream:new i(y),mixer:new j(y),midi:new k(y),mml:new l(y)};m=function(a,b){var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case"oscillator":if(void 0===b)return z.oscillator;var d=parseInt(b);if(d>=0&&d<z.oscillator.length())return z.oscillator.get(d);break;case"oneshot":case"audio":case"media":case"fallback":case"stream":case"mixer":case"midi":case"mml":return z[c]}},m.IS_XSOUND=n,m.SAMPLE_RATE=y.sampleRate,m.NUMBER_OF_INPUTS=d.NUMBER_OF_INPUTS,m.NUMBER_OF_OUTPUTS=d.NUMBER_OF_OUTPUTS,m.read=o,m.file=p,m.ajax=q,m.decode=r,m.toFrequencies=s,m.convertTime=t,m.fullscreen=u,m.exitFullscreen=v,m.noConflict=w,m.clone=function(){var a={oscillator:new e(y),oneshot:new f(y),audio:new g(y),media:new h(y),fallback:new c,stream:new i(y),mixer:new j(y),midi:new k(y),mml:new l(y)},b=function(b,c){var d=String(b).replace(/-/g,"").toLowerCase();switch(d){case"oscillator":if(void 0===c)return a.oscillator;var e=parseInt(c);if(e>=0&&e<a.oscillator.length())return a.oscillator.get(e);break;case"oneshot":case"audio":case"media":case"fallback":case"stream":case"mixer":case"midi":case"mml":return a[d]}};return b.free=function(b){Array.isArray(b)||(b=[b]);for(var c=0,d=b.length;c<d;c++){var e=b[c];if(null!==e)for(var f in a)e===a[f]&&(a[f]=null)}},b},m.free=function(a){Array.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;b++){var d=a[b];if(null!==d)for(var e in z)d===z[e]&&(z[e]=null)}},m.get=function(){return y},m.getCurrentTime=function(){return y.currentTime},m.toString=function(){return"[XSound]"},a.XSound=m,a.X=m}(window);
//# sourceMappingURL=xsound.js.map