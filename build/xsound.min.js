/** 
 * xsound.min.js
 * @fileoverview Web Audio API Library
 *
 * Copyright 2012, 2013, 2014@Tomohiro IKEDA
 * Released under the MIT license
 */
(function(x){function K(){}function E(){this.media=null;this.ext="";this.duration=0;this.playbackRate=this.volume=1;this.muted=this.loop=this.controls=!1;this.callbacks={}}function v(a,c){function b(a){this.listener=a.listener;this.dopplerFactor=1;this.speedOfSound=343.3;this.positions={x:0,y:0,z:0};this.fronts={x:0,y:0,z:-1};this.ups={x:0,y:1,z:0};this.velocities={x:0,y:0,z:0};this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z);this.listener.setOrientation(this.fronts.x,
this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z);this.listener.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z)}function e(a){function b(a){this.isActive=!1;this.SAMPLE_RATE=a;this.drawType="";this.svgParent=this.svg=this.context=this.canvas=null;this.interval=1E3;this.timerid=null;this.styles={shape:"line",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],wave:"rgba(0, 0, 255, 1.0)",grid:"rgba(255, 0, 0, 1.0)",text:"rgba(255, 255, 255, 1.0)",
font:"13px Arial",width:1.5,cap:"round",join:"miter",top:15,right:15,bottom:15,left:15}}function l(a){b.call(this,a);this.savedImage=null;this.length=0;this.currentTime="rgba(255, 255, 255, 1.0)";this.plotinterval=.0625;this.textinterval=60}function d(a){b.call(this,a);this.type="uint";this.textinterval=.005}function c(a){b.call(this,a);this.type="uint";this.size=256;this.textinterval=1E3}x.requestAnimationFrame=x.requestAnimationFrame||x.webkitRequestAnimationFrame||x.mozRequestAnimationFrame||function(a){x.setTimeout(a,
1E3/60)};x.cancelAnimationFrame=x.cancelAnimationFrame||x.webkitCancelAnimationFrame||x.mozCancelAnimationFrame||x.clearTimeout;this.analyser=a.createAnalyser();this.input=a.createGain();this.output=a.createGain();this.input.connect(this.analyser);this.analyser.connect(this.output);b.prototype=Object.create(K.prototype);b.prototype.constructor=b;l.prototype=Object.create(b.prototype);d.prototype=Object.create(b.prototype);c.prototype=Object.create(b.prototype);l.prototype.constructor=l;d.prototype.constructor=
d;c.prototype.constructor=c;this.timeAllL=new l(a.sampleRate);this.timeAllR=new l(a.sampleRate);this.time=new d(a.sampleRate);this.fft=new c(a.sampleRate);this.analyser.fftSize=2048;this.analyser.minDecibels=-100;this.analyser.maxDecibels=-30;this.analyser.smoothingTimeConstant=.8;b.prototype.setup=function(a,d,k){switch(String(a).toLowerCase()){case "canvas":this.drawType="canvas";this.canvas=document.getElementById(String(d));this.canvas instanceof HTMLCanvasElement&&(this.context=this.canvas.getContext("2d"));
break;case "svg":this.drawType="svg",this.svg=document.getElementById(String(d)),this.svg instanceof SVGElement&&(this.svgParent=document.getElementById(String(k)))}return this};b.prototype.param=function(a,d){var k=String(a).replace(/-/g,"").toLowerCase();switch(k){case "interval":if(void 0===d)return this.interval;if("auto"===String(d).toLowerCase())this.interval="auto";else{var b=parseFloat(d);0<=b&&(this.interval=b)}break;case "shape":if(void 0===d)return this.styles.shape;b=String(d).toLowerCase();
if("line"===b||"rect"===b)this.styles.shape="gradient"!==this.styles.wave?b:"rect";break;case "grad":if(void 0===d)return this.styles.grad;Array.isArray(d)||(d=[d]);for(var k=!1,b=0,l=d.length;b<l;b++){var c=d[b];if("offset"in c&&"color"in c){if(c=parseFloat(c.offset),isNaN(c)||0>c||1<c){k=!0;break}}else{k=!0;break}}k||(this.styles.grad=d);break;case "wave":case "grid":case "text":case "font":case "cap":case "join":if(void 0===d)return this.styles[k];"[object String]"===Object.prototype.toString.call(d)&&
("wave"===k&&"gradient"===d&&(this.styles.shape="rect"),this.styles[k]="font"===k?d:d.toLowerCase());break;case "width":case "top":case "right":case "bottom":case "left":if(void 0===d)return this.styles[k];b="width"===k?parseFloat(d):parseInt(d);0<=b&&(this.styles[k]=b)}};b.prototype.start=function(a,d,k){switch(this.drawType){case "canvas":this.drawToCanvas(a,d,k);break;case "svg":this.drawToSVG(a,d,k)}return this};b.prototype.download=function(){switch(this.drawType){case "canvas":return this.canvas.toDataURL("image/png").replace("image/png",
"image/octet-stream");case "svg":return this.svgParent.innerHTML;default:return this}};b.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);return this};b.prototype.drawTimeDomainFloat32ArrayToCanvas=function(a,d,k,b,l,c){if(!(a instanceof CanvasRenderingContext2D&&d instanceof Float32Array))return this;var u=0,e=0;k=parseInt(k);var g=parseInt(b);l=parseInt(l);isNaN(k)&&(k=0);isNaN(g)&&(g=0);isNaN(l)&&
(l=0);switch(this.styles.shape){case "line":a.strokeStyle=this.styles.wave;a.lineWidth=this.styles.width;a.lineCap=this.styles.cap;a.lineJoin=this.styles.join;a.beginPath();for(var f=0,h=d.length;f<h;f++)if(void 0===c||0===f%c)u=Math.floor(f/h*k)+this.styles.left,e=Math.floor(g/2*(1-d[f]))+this.styles.top,0===f?a.moveTo(u,e):a.lineTo(u,e);a.stroke();break;case "rect":for("gradient"!==this.styles.wave&&(a.fillStyle=this.styles.wave),f=0,h=d.length;f<h;f++)if(void 0===c||0===f%c){u=Math.floor(f/h*k)+
this.styles.left;e=-1*Math.floor(g/2*d[f]);if("gradient"===this.styles.wave){for(var q=b/2+this.styles.top,q=a.createLinearGradient(0,q,0,q+e),m=0,r=this.styles.grad.length;m<r;m++){var p=this.styles.grad[m];q.addColorStop(p.offset,p.color)}a.fillStyle=q}a.fillRect(u,l,this.styles.width,e)}}return this};b.prototype.drawTimeDomainFloat32ArrayToSVG=function(a,d,k,b,l,c){var u="",e=0,f=0;k=parseInt(k);var g=parseInt(b);l=parseInt(l);isNaN(k)&&(k=0);isNaN(g)&&(g=0);isNaN(l)&&(l=0);switch(this.styles.shape){case "line":for(var u=
u+('<path style="'+a+'" d="'),h=0,q=d.length;h<q;h++)if(void 0===c||0===h%c)e=Math.floor(h/q*k)+this.styles.left,f=Math.floor(g/2*(1-d[h]))+this.styles.top,0===h?u+="M"+e+" "+f:(u+=" ",u+="L"+e+" "+f);u+='" />';break;case "rect":for(h=0,q=d.length;h<q;h++)if(void 0===c||0===h%c)e=Math.floor(h/q*k)+this.styles.left,f=Math.floor(b/2*d[h]),u+=0>f?'<rect style="'+a+'" x="'+e+'" y="'+l+'" width="'+this.styles.width+'" height="'+-f+'" />':'<rect style="'+a+'" x="'+e+'" y="'+l+'" width="'+this.styles.width+
'" height="'+f+'" transform="translate('+this.styles.width+" 0) rotate(180 "+e+" "+l+')" />'}return u};b.prototype.drawToCanvas=function(a){};b.prototype.drawToSVG=function(a){};b.prototype.toString=function(){return"[SoundModule Visualizer]"};l.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var k in a)this.param(k,a[k]);else{k=String(a).replace(/-/g,"").toLowerCase();var l=b.prototype.param.call(this,k,d);if(void 0!==l)return l;switch(k){case "currenttime":if(void 0===
d)return this.currentTime;"[object String]"===Object.prototype.toString.call(d)&&(this.currentTime=d.toLowerCase());break;case "plotinterval":case "textinterval":if(void 0===d)return this[k];l=parseFloat(d);0<l&&(this[k]=l)}}return this};l.prototype.drawToCanvas=function(a){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var d=this.context,k=this.canvas.width,b=this.canvas.height,l=k-(this.styles.left+this.styles.right),c=b-(this.styles.top+this.styles.bottom),u=Math.floor(c/
2)+this.styles.top,e=0,f=0,g="",e=Math.floor(this.plotinterval*this.SAMPLE_RATE),f=Math.floor(this.textinterval*this.SAMPLE_RATE);d.clearRect(0,0,k,b);this.drawTimeDomainFloat32ArrayToCanvas(d,a,l,c,u,e);if("none"!==this.styles.grid||"none"!==this.styles.text){for(var u=0,h=a.length;u<h;u++)0===u%f&&(e=Math.floor(u/h*l)+this.styles.left,g=Math.floor(u/this.SAMPLE_RATE)+" min","none"!==this.styles.grid&&(d.fillStyle=this.styles.grid,d.fillRect(e,this.styles.top,1,c)),"none"!==this.styles.text&&(d.fillStyle=
this.styles.text,d.font=this.styles.font,d.fillText(g,e-d.measureText(g).width/2,b)));for(var q=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"],u=0,h=q.length;u<h;u++)g=q[u],e=Math.floor(k-d.measureText(g).width),f=Math.floor((1-parseFloat(g.trim()))*(c/2))+this.styles.top,"none"!==this.styles.grid&&(d.fillStyle=this.styles.grid,d.fillRect(this.styles.left,f,l,1)),f-=parseInt(d.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(d.fillStyle=this.styles.text,d.font=this.styles.font,d.fillText(g,
e,f))}this.savedImage=d.getImageData(0,0,k,b);this.length=a.length;d.fillStyle=this.currentTime;d.fillRect(this.styles.left,this.styles.top,1,c);return this};l.prototype.drawToSVG=function(a){if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return this;var d=this.svgParent.innerHTML.match(/(<svg[^<>]*>).*<\/svg>/)[1]+"</svg>",k=this.svg.getAttribute("width"),b=this.svg.getAttribute("height"),l=k-(this.styles.left+this.styles.right),u=b-(this.styles.top+this.styles.bottom),
c=Math.floor(u/2)+this.styles.top,e=0,f=0,g="",e=Math.floor(this.plotinterval*this.SAMPLE_RATE),f=Math.floor(this.textinterval*this.SAMPLE_RATE),g="";switch(this.styles.shape){case "line":g+="stroke : "+this.styles.wave+"; ",g=g+"fill : none; "+("stroke-width : "+this.styles.width+"; "),g+="stroke-linecap : "+this.styles.cap+"; ",g+="stroke-linejoin : "+this.styles.join+";";case "rect":if("gradient"===this.styles.wave){var h;h='<defs><linearGradient id="svg-linear-gradient" x1="0%" y1="0%" x2="0%" y2="100%">';
for(var q=0,m=this.styles.grad.length;q<m;q++){var r=this.styles.grad[q];h+='<stop offset="'+r.offset+'" stop-color="'+r.color+'" />'}h+="</linearGradient>";h+="</defs>";g+="stroke : none; ";g+="fill : url(#svg-linear-gradient); "}else g+="stroke : none; ",g+="fill : "+this.styles.wave+"; ";g+="stroke-width : 0;"}var r="stroke : none; "+("fill : "+this.styles.grid+"; "),r=r+"stroke-width : 0;",m=this.styles.font.match(/\s*(\d+)px (.*)/),q=m[2],p=m[1],n;n="stroke : none; "+("fill : "+this.styles.text+
"; ");n+="font-family : "+q+"; ";n+="font-size : "+p+";";var C;C="stroke : none; "+("fill : "+this.currentTime+"; ");C+="stroke-width : 0;";this.svgParent.innerHTML=d;d=this.svgParent.innerHTML.replace("</svg>","");"gradient"===this.styles.wave&&(d+=h);d+=this.drawTimeDomainFloat32ArrayToSVG(g,a,l,u,c,e);if("none"!==this.styles.grid||"none"!==this.styles.text){q=0;for(m=a.length;q<m;q++)0===q%f&&(e=Math.floor(q/m*l)+this.styles.left,g=Math.floor(q/this.SAMPLE_RATE)+" min","none"!==this.styles.grid&&
(d+='<rect style="'+r+'" x="'+e+'" y="'+this.styles.top+'" width="1" height="'+u+'" />'),"none"!==this.styles.text&&(d+='<text text-anchor="middle" style="'+n+'" x="'+e+'" y="'+b+'">'+g+"</text>"));b=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];q=0;for(m=b.length;q<m;q++)g=b[q],e=k,f=Math.floor((1-parseFloat(g.trim()))*(u/2))+this.styles.top,"none"!==this.styles.grid&&(d+='<rect style="'+r+'" x="'+this.styles.left+'" y="'+f+'" width="'+l+'" height="1" />'),f-=Math.floor(parseInt(p)/4),"none"!==this.styles.text&&
(d+='<text text-anchor="end" style="'+n+'" x="'+e+'" y="'+f+'">'+g+"</text>")}d+='<rect class="svg-current-time" style="'+C+'" x="'+this.styles.left+'" y="'+this.styles.top+'" width="1" height="'+u+'" />';d+="</svg>";this.savedImage=this.svgParent.innerHTML=d;this.length=a.length;return this};l.prototype.update=function(a){switch(this.drawType){case "canvas":if(this.canvas instanceof HTMLCanvasElement&&this.isActive)break;else return;case "svg":if(!(this.svg instanceof SVGElement&&this.svgParent instanceof
HTMLElement&&this.isActive))return}a=parseFloat(a);if(!(isNaN(a)||0>a)){var d=0,k=0,b=0,l=0,b=0;switch(this.drawType){case "canvas":if(this.savedImage instanceof ImageData){var u=this.context,d=this.canvas.width,k=this.canvas.height,b=d-(this.styles.left+this.styles.right),l=k-(this.styles.top+this.styles.bottom),b=Math.floor(a*this.SAMPLE_RATE/this.length*b)+this.styles.left;u.clearRect(0,0,d,k);u.putImageData(this.savedImage,0,0);u.fillStyle=this.currentTime;u.fillRect(b,this.styles.top,1,l)}break;
case "svg":k=this.svgParent.querySelector(".svg-current-time"),k instanceof SVGElement&&(d=this.svg.getAttribute("width"),this.svg.getAttribute("height"),b=d-(this.styles.left+this.styles.right),b=Math.floor(a*this.SAMPLE_RATE/this.length*b),k.setAttribute("transform","translate("+b+" 0)"))}return this}};l.prototype.drag=function(a){var d=null;switch(this.drawType){case "canvas":if(this.canvas instanceof HTMLCanvasElement&&this.isActive){d=this.canvas;break}else return;case "svg":if(this.svg instanceof
SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive)d=this.svgParent;else return}var k="",b="",l="";/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?(k="touchstart",b="touchmove",l="touchend"):(k="mousedown",b="mousemove",l="mouseup");var u=function(d){var k=0,b=0;switch(this.drawType){case "canvas":k=this.canvas.offsetLeft;b=this.canvas.width;break;case "svg":k=this.svgParent.offsetLeft,b=this.svg.getAttribute("width")}d-=k+this.styles.left;b-=this.styles.left+this.styles.right;
0>d&&(d=0);d>b&&(d=b);b=d/b*this.length/this.SAMPLE_RATE;this.update(b);"[object Function]"===Object.prototype.toString.call(a)&&a(b)},c=function(a){if(a.pageX)return a.pageX;if(a.touches[0])return a.touches[0].pageX},g=!1,e=this;d.addEventListener(k,function(a){null!==e.savedImage&&(u.call(e,c(a)),g=!0)},!0);d.addEventListener(b,function(a){a.preventDefault();g&&null!==e.savedImage&&u.call(e,c(a))},!0);x.addEventListener(l,function(a){g&&(g=!1)},!0);return this};l.prototype.toString=function(){return"[SoundModule Analyser TimeAll]"};
d.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var k in a)this.param(k,a[k]);else{k=String(a).replace(/-/g,"").toLowerCase();var l=b.prototype.param.call(this,k,d);if(void 0!==l)return l;switch(k){case "type":if(void 0===d)return this.type;k=String(d).toLowerCase();if("uint"===k||"float"===k)this.type=k;break;case "textinterval":if(void 0===d)return this.textinterval;k=parseFloat(d);0<k&&(this.textinterval=k)}}return this};d.prototype.drawToCanvas=function(a,
d,k){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;parseFloat(d);parseFloat(k);d=this.context;k=this.canvas.width;var b=this.canvas.height,l=k-(this.styles.left+this.styles.right),u=b-(this.styles.top+this.styles.bottom),c=Math.floor(u/2)+this.styles.top,g=0,e=0,f="",h=Math.floor(this.textinterval*this.SAMPLE_RATE);d.clearRect(0,0,k,b);switch(this.type){case "float":this.drawTimeDomainFloat32ArrayToCanvas(d,a,l,u,c);break;default:switch(this.styles.shape){case "line":d.strokeStyle=
this.styles.wave;d.lineWidth=this.styles.width;d.lineCap=this.styles.cap;d.lineJoin=this.styles.join;d.beginPath();for(var q=0,m=a.length;q<m;q++)g=Math.floor(q/m*l)+this.styles.left,e=Math.floor((1-a[q]/255)*u)+this.styles.top,0===q?d.moveTo(g,e):d.lineTo(g,e);d.stroke();break;case "rect":for("gradient"!==this.styles.wave&&(d.fillStyle=this.styles.wave),q=0,m=a.length;q<m;q++){g=Math.floor(q/m*l)+this.styles.left;e=Math.floor((.5-a[q]/255)*u);if("gradient"===this.styles.wave){for(var f=u/2+this.styles.top,
f=d.createLinearGradient(0,f,0,f+e),r=0,n=this.styles.grad.length;r<n;r++){var p=this.styles.grad[r];f.addColorStop(p.offset,p.color)}d.fillStyle=f}d.fillRect(g,c,this.styles.width,e)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){q=0;for(m=a.length;q<m;q++)0===q%h&&(g=Math.floor(q/m*l)+this.styles.left,f=Math.floor(q/this.SAMPLE_RATE*1E3)+" ms","none"!==this.styles.grid&&(d.fillStyle=this.styles.grid,d.fillRect(g,this.styles.top,1,u)),"none"!==this.styles.text&&(d.fillStyle=this.styles.text,
d.font=this.styles.font,d.fillText(f,g-d.measureText(f).width/2,b)));a=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];q=0;for(m=a.length;q<m;q++)f=a[q],g=Math.floor(k-d.measureText(f).width),e=Math.floor((1-parseFloat(f.trim()))*(u/2))+this.styles.top,"none"!==this.styles.grid&&(d.fillStyle=this.styles.grid,d.fillRect(this.styles.left,e,l,1)),e-=parseInt(d.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(d.fillStyle=this.styles.text,d.font=this.styles.font,d.fillText(f,g,e))}return this};d.prototype.drawToSVG=
function(a){if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return this;var d=this.svgParent.innerHTML.match(/(<svg[^<>]*>).*<\/svg>/)[1]+"</svg>",k=this.svg.getAttribute("width"),b=this.svg.getAttribute("height"),l=k-(this.styles.left+this.styles.right),u=b-(this.styles.top+this.styles.bottom),c=Math.floor(u/2)+this.styles.top,g=0,e=0,f="",q=Math.floor(this.textinterval*this.SAMPLE_RATE),f="";switch(this.styles.shape){case "line":f+="stroke : "+this.styles.wave+
"; ";f=f+"fill : none; "+("stroke-width : "+this.styles.width+"; ");f+="stroke-linecap : "+this.styles.cap+"; ";f+="stroke-linejoin : "+this.styles.join+";";break;case "rect":if("gradient"===this.styles.wave){var h;h='<defs><linearGradient id="svg-linear-gradient" x1="0%" y1="0%" x2="0%" y2="100%">';for(var m=0,r=this.styles.grad.length;m<r;m++){var p=this.styles.grad[m];h+='<stop offset="'+p.offset+'" stop-color="'+p.color+'" />'}h+="</linearGradient>";h+="</defs>";f+="stroke : none; ";f+="fill : url(#svg-linear-gradient); "}else f+=
"stroke : none; ",f+="fill : "+this.styles.wave+"; ";f+="stroke-width : 0;"}var p="stroke : none; "+("fill : "+this.styles.grid+"; "),p=p+"stroke-width : 0;",r=this.styles.font.match(/\s*(\d+)px (.*)/),m=r[2],n=r[1],C;C="stroke : none; "+("fill : "+this.styles.text+"; ");C+="font-family : "+m+"; ";C+="font-size : "+n+";";this.svgParent.innerHTML=d;d=this.svgParent.innerHTML.replace("</svg>","");"gradient"===this.styles.wave&&(d+=h);switch(this.type){case "float":d+=this.drawTimeDomainFloat32ArrayToSVG(f,
a,l,u,c);break;default:switch(this.styles.shape){case "line":d+='<path style="'+f+'" d="';m=0;for(r=a.length;m<r;m++)g=Math.floor(m/r*l)+this.styles.left,e=Math.floor((1-a[m]/255)*u)+this.styles.top,0===m?d+="M"+g+" "+e:(d+=" ",d+="L"+g+" "+e);d+='" />';break;case "rect":for(m=0,r=a.length;m<r;m++)g=Math.floor(m/r*l)+this.styles.left,e=Math.floor((a[m]/255-.5)*u),d+=0>e?'<rect style="'+f+'" x="'+g+'" y="'+c+'" width="'+this.styles.width+'" height="'+-e+'" />':'<rect style="'+f+'" x="'+g+'" y="'+c+
'" width="'+this.styles.width+'" height="'+e+'" transform="translate('+this.styles.width+" 0) rotate(180 "+g+" "+c+')" />'}}if("none"!==this.styles.grid||"none"!==this.styles.text){m=0;for(r=a.length;m<r;m++)0===m%q&&(g=Math.floor(m/r*l)+this.styles.left,f=Math.floor(m/this.SAMPLE_RATE*1E3)+" ms","none"!==this.styles.grid&&(d+='<rect style="'+p+'" x="'+g+'" y="'+this.styles.top+'" width="1" height="'+u+'" />'),"none"!==this.styles.text&&(d+='<text text-anchor="middle" style="'+C+'" x="'+g+'" y="'+
b+'">'+f+"</text>"));a=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];m=0;for(r=a.length;m<r;m++)f=a[m],g=k,e=Math.floor((1-parseFloat(f.trim()))*(u/2))+this.styles.top,"none"!==this.styles.grid&&(d+='<rect style="'+p+'" x="'+this.styles.left+'" y="'+e+'" width="'+l+'" height="1" />'),e-=Math.floor(parseInt(n)/4),"none"!==this.styles.text&&(d+='<text text-anchor="end" style="'+C+'" x="'+g+'" y="'+e+'">'+f+"</text>")}this.svgParent.innerHTML=d+"</svg>";return this};d.prototype.toString=function(){return"[SoundModule Analyser Time]"};
c.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var k in a)this.param(k,a[k]);else{k=String(a).replace(/-/g,"").toLowerCase();var l=b.prototype.param.call(this,k,d);if(void 0!==l)return l;switch(k){case "type":if(void 0===d)return this.type;k=String(d).toLowerCase();if("uint"===k||"float"===k)this.type=k;break;case "size":if(void 0===d)return this.size;k=parseFloat(d);0<=k&&1024>=k&&(this.size=k);break;case "textinterval":if(void 0===d)return this.textinterval;
k=parseFloat(d);0<k&&(this.textinterval=k)}}return this};c.prototype.drawToCanvas=function(a,d,k){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var b=parseFloat(d),l=parseFloat(k),u=l-b;k=this.context;d=this.canvas.width;var c=this.canvas.height,f=d-(this.styles.left+this.styles.right),g=c-(this.styles.top+this.styles.bottom),e=0,q=0,h="",m=this.size>a.length?a.length:this.size,r=Math.floor(this.textinterval/(this.SAMPLE_RATE/(2*a.length)));k.clearRect(0,0,d,c);switch(this.type){case "float":k.strokeStyle=
"gradient"!==this.styles.wave?this.styles.wave:"rgba(0, 0, 255, 1.0)";k.lineWidth=this.styles.width;k.lineCap=this.styles.cap;k.lineJoin=this.styles.join;k.beginPath();for(var p=0;p<m;p++)e=Math.floor(p/m*f)+this.styles.left,q=Math.abs(a[p]-l)*(g/u)+this.styles.top,0===p?k.moveTo(e,q):k.lineTo(e,q);k.stroke();break;default:switch(this.styles.shape){case "line":k.strokeStyle=this.styles.wave;k.lineWidth=this.styles.width;k.lineCap=this.styles.cap;k.lineJoin=this.styles.join;k.beginPath();for(p=0;p<
m;p++)e=Math.floor(p/m*f)+this.styles.left,q=Math.floor((1-a[p]/255)*g)+this.styles.top,0===p?k.moveTo(e,q):k.lineTo(e,q);k.stroke();break;case "rect":for("gradient"!==this.styles.wave&&(k.fillStyle=this.styles.wave),p=0;p<m;p++){e=Math.floor(p/m*f)+this.styles.left;q=-1*Math.floor(a[p]/255*g);if("gradient"===this.styles.wave){for(var h=g+this.styles.top,h=k.createLinearGradient(0,h,0,h+q),n=0,C=this.styles.grad.length;n<C;n++){var t=this.styles.grad[n];h.addColorStop(t.offset,t.color)}k.fillStyle=
h}k.fillRect(e,g+this.styles.top,this.styles.width,q)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(p=a=0;p<m;p++)0===p%r&&(e=Math.floor(p/m*f)+this.styles.left,a=Math.floor(p/r*this.textinterval),h=1E3>a?a+" Hz":String(a/1E3).slice(0,3)+" kHz","none"!==this.styles.grid&&(k.fillStyle=this.styles.grid,k.fillRect(e,this.styles.top,1,g)),"none"!==this.styles.text&&(k.fillStyle=this.styles.text,k.font=this.styles.font,k.fillText(h,e-k.measureText(h).width/2,c)));switch(this.type){case "float":for(p=
b;p<=l;p+=10)h=p+"dB",e=d-Math.floor(k.measureText(h).width),q=Math.floor(-1*(p-l)/u*g)+this.styles.top,"none"!==this.styles.grid&&(k.fillStyle=this.styles.grid,k.fillRect(this.styles.left,q,f,1)),q-=parseInt(k.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(k.fillStyle=this.styles.text,k.font=this.styles.font,k.fillText(h,e,q));break;default:for(a=["0.00","0.25","0.50","0.75","1.00"],p=0,b=a.length;p<b;p++)h=a[p],e=d-Math.floor(k.measureText(h).width),q=(1-parseFloat(h))*g+this.styles.top,
"none"!==this.styles.grid&&(k.fillStyle=this.styles.grid,k.fillRect(this.styles.left,q,f,1)),q-=parseInt(k.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(k.fillStyle=this.styles.text,k.font=this.styles.font,k.fillText(h,e,q))}}return this};c.prototype.drawToSVG=function(a,d,k){if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return this;d=parseFloat(d);var b=parseFloat(k),l=b-d;k=this.svgParent.innerHTML.match(/(<svg[^<>]*>).*<\/svg>/)[1]+"</svg>";
var u=this.svg.getAttribute("width"),c=this.svg.getAttribute("height"),e=u-(this.styles.left+this.styles.right),f=c-(this.styles.top+this.styles.bottom),g=0,q=0,h="",m=this.size>a.length?a.length:this.size,r=Math.floor(this.textinterval/(this.SAMPLE_RATE/(2*a.length))),h="";switch(this.styles.shape){case "line":h+="stroke : "+this.styles.wave+"; ";h=h+"fill : none; "+("stroke-width : "+this.styles.width+"; ");h+="stroke-linecap : "+this.styles.cap+"; ";h+="stroke-linejoin : "+this.styles.join+";";
break;case "rect":if("uint"===this.type&&"gradient"===this.styles.wave){var p;p='<defs><linearGradient id="svg-linear-gradient" x1="0%" y1="0%" x2="0%" y2="100%">';for(var n=0,C=this.styles.grad.length;n<C;n++){var t=this.styles.grad[n];p+='<stop offset="'+t.offset+'" stop-color="'+t.color+'" />'}p+="</linearGradient>";p+="</defs>";h+="stroke : none; ";h+="fill : url(#svg-linear-gradient); ";h+="stroke-width : 0;"}else"uint"===this.type&&"gradient"!==this.styles.wave?(h+="stroke : none; ",h+="fill : "+
this.styles.wave+"; ",h+="stroke-width : 0;"):"uint"!==this.type&&(h+="stroke : rgba(0, 0, 255, 1.0); ",h+="fill : none; ",h+="stroke-width : "+this.styles.width+"; ",h+="stroke-linecap : "+this.styles.cap+"; ",h+="stroke-linejoin : "+this.styles.join+";")}var t="stroke : none; "+("fill : "+this.styles.grid+"; "),t=t+"stroke-width : 0;",w=this.styles.font.match(/\s*(\d+)px (.*)/),n=w[2],w=w[1],v;v="stroke : none; "+("fill : "+this.styles.text+"; ");v+="font-family : "+n+"; ";v+="font-size : "+w+";";
this.svgParent.innerHTML=k;k=this.svgParent.innerHTML.replace("</svg>","");"uint"===this.type&&"gradient"===this.styles.wave&&(k+=p);switch(this.type){case "float":k+='<path style="'+h+'" d="';for(n=0;n<m;n++)g=Math.floor(n/m*e)+this.styles.left,q=Math.floor(f/l*(a[n]-b)*-1)+this.styles.top,0===n?k+="M"+g+" "+q:(k+=" ",k+="L"+g+" "+q);k+='" />';break;default:switch(this.styles.shape){case "line":k+='<path style="'+h+'" d="';for(n=0;n<m;n++)g=Math.floor(n/m*e)+this.styles.left,q=Math.floor((1-a[n]/
255)*f)+this.styles.top,0===n?k+="M"+g+" "+q:(k+=" ",k+="L"+g+" "+q);k+='" />';break;case "rect":for(n=0;n<m;n++)g=Math.floor(n/m*e)+this.styles.left,q=Math.floor(a[n]/255*f),k+='<rect style="'+h+'" x="'+g+'" y="'+(this.styles.top+f)+'" width="'+this.styles.width+'" height="'+q+'" transform="translate('+this.styles.width+" 0) rotate(180 "+g+" "+(this.styles.top+f)+')" />'}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(n=a=0;n<m;n++)0===n%r&&(g=Math.floor(n/m*e)+this.styles.left,a=Math.floor(n/
r*this.textinterval),h=1E3>a?a+" Hz":String(a/1E3).slice(0,3)+" kHz","none"!==this.styles.grid&&(k+='<rect style="'+t+'" x="'+g+'" y="'+this.styles.top+'" width="1" height="'+f+'" />'),"none"!==this.styles.text&&(k+='<text text-anchor="middle" style="'+v+'" x="'+g+'" y="'+c+'">'+h+"</text>"));switch(this.type){case "float":for(n=d;n<=b;n+=10)h=n+"dB",g=u,q=Math.floor(-1*(n-b)/l*f)+this.styles.top,"none"!==this.styles.grid&&(k+='<rect style="'+t+'" x="'+this.styles.left+'" y="'+q+'" width="'+e+'" height="1" />'),
q-=Math.floor(parseInt(w)/4),"none"!==this.styles.text&&(k+='<text text-anchor="end" style="'+v+'" x="'+g+'" y="'+q+'">'+h+"</text>");break;default:for(a=["0.00","0.25","0.50","0.75","1.00"],n=0,C=a.length;n<C;n++)h=a[n],g=u,q=(1-parseFloat(h))*f+this.styles.top,"none"!==this.styles.grid&&(k+='<rect style="'+t+'" x="'+this.styles.left+'" y="'+q+'" width="'+e+'" height="1" />'),q-=Math.floor(parseInt(w)/4),"none"!==this.styles.text&&(k+='<text text-anchor="end" style="'+v+'" x="'+g+'" y="'+q+'">'+
h+"</text>")}}this.svgParent.innerHTML=k+"</svg>";return this};c.prototype.toString=function(){return"[SoundModule Analyser FFT]"}}function f(a,b,l,d){this.SAMPLE_RATE=a.sampleRate;this.context=a;this.processor=a.createScriptProcessor(b,l,d);this.mixRs=this.mixLs=null;this.trackLs=[];this.trackRs=[];this.numtrack=0;this.activeTrack=-1;this.paused=!0;this.gainR=this.gainL=1}function h(a,b,l,d,c){this.isActive=!1;this.context=a;this.analyser=c;this.sender=a.createScriptProcessor(b,l,d);this.receiver=
a.createScriptProcessor(b,l,d);this.websocket=null;this.paused=!0}function g(a,b){this.isActive=!0;this.context=a;this.input=a.createGain();this.output=a.createGain();this.lfo=a.createOscillator();this.depth=a.createGain();this.rate=this.lfo.frequency;this.processor=a.createScriptProcessor(b,1,2);this.lfo.start=this.lfo.start||this.lfo.noteOn;this.lfo.stop=this.lfo.stop||this.lfo.noteOff;this.values={};this.isStop=!0}function m(a,b){g.call(this,a,b);this.compressor=a.createDynamicsCompressor();this.compressor.threshold.value=
-24;this.compressor.knee.value=30;this.compressor.ratio.value=12;this.compressor.attack.value=.003;this.compressor.release.value=.25;this.connect()}function r(a,b){g.call(this,a,b);this.distortion=a.createWaveShaper();this.drive=a.createGain();this.color=a.createBiquadFilter();this.tone=a.createBiquadFilter();this.type="clean";this.numberOfSamples=4096;this.drive.gain.value=1;this.color.type="[object String]"===Object.prototype.toString.call(this.color.type)?"bandpass":this.color.BANDPASS||2;this.color.frequency.value=
350;this.color.Q.value=Math.SQRT1_2;this.color.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.state(!1)}function n(a,b){g.call(this,a,b);this.lowpass=a.createBiquadFilter();this.lowpass.type="[object String]"===Object.prototype.toString.call(this.lowpass.type)?"lowpass":this.lowpass.LOWPASS||0;this.lowpass.frequency.value=350;this.lowpass.gain.value=
0;this.lowpass.Q.value=1;this.depth.gain.value=0;this.depthRate=this.rate.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.lowpass.frequency)}function p(a,b){g.call(this,a,b);this.bass=a.createBiquadFilter();this.middle=a.createBiquadFilter();this.treble=a.createBiquadFilter();this.presence=a.createBiquadFilter();this.bass.type="[object String]"===Object.prototype.toString.call(this.bass.type)?"lowshelf":this.bass.LOWSHELF||3;this.middle.type="[object String]"===Object.prototype.toString.call(this.middle.type)?
"peaking":this.middle.PEAKING||5;this.treble.type="[object String]"===Object.prototype.toString.call(this.treble.type)?"peaking":this.treble.PEAKING||5;this.presence.type="[object String]"===Object.prototype.toString.call(this.presence.type)?"highshelf":this.presence.HIGHSHELF||4;this.bass.frequency.value=500;this.middle.frequency.value=1E3;this.treble.frequency.value=2E3;this.presence.frequency.value=4E3;this.middle.Q.value=Math.SQRT1_2;this.treble.Q.value=Math.SQRT1_2;this.bass.gain.value=0;this.middle.gain.value=
0;this.treble.gain.value=0;this.presence.gain.value=0;this.connect()}function C(a,b){g.call(this,a,b);this.filter=a.createBiquadFilter();this.filter.frequency.setTargetAtTime=this.filter.frequency.setTargetAtTime||this.filter.frequency.setTargetValueAtTime;this.filter.type="[object String]"===Object.prototype.toString.call(this.filter.type)?"lowpass":this.filter.LOWPASS||0;this.filter.frequency.value=350;this.filter.Q.value=1;this.filter.gain.value=0;this.maxFrequency=this.filter.frequency.value;
this.range=.1;this.attack=.01;this.decay=.3;this.release=this.sustain=1;this.state(!1)}function t(a,b){g.call(this,a,b);this.amplitudeL=a.createGain();this.amplitudeR=a.createGain();this.splitter=a.createChannelSplitter(2);this.merger=a.createChannelMerger(2);this.amplitudeL.gain.value=1;this.amplitudeR.gain.value=1;this.depth.gain.value=0;this.rate.value=0;this.state(!1);this.lfoSplitter=a.createChannelSplitter(2);this.lfo.connect(this.depth);this.depth.connect(this.processor);this.processor.connect(this.lfoSplitter);
this.lfoSplitter.connect(this.amplitudeL.gain,0);this.lfoSplitter.connect(this.amplitudeR.gain,1)}function w(a,b){g.call(this,a,b);this.amplitude=a.createGain();this.amplitude.gain.value=1;this.depth.gain.value=0;this.rate.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.amplitude.gain)}function v(a,b){g.call(this,a,b);this.amplitude=a.createGain();this.amplitude.gain.value=0;this.depth.gain.value=1;this.rate.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.amplitude.gain)}
function y(a,b){g.call(this,a,b);this.MAXIMUM_STAGES=24;this.numberOfStages=12;this.filters=Array(this.MAXIMUM_STAGES);for(var l=0;l<this.MAXIMUM_STAGES;l++)this.filters[l]=a.createBiquadFilter(),this.filters[l].type="[object String]"===Object.prototype.toString.call(this.filters[l].type)?"allpass":this.filters[l].ALLPASS||7,this.filters[l].frequency.value=350,this.filters[l].Q.value=1,this.filters[l].gain.value=0;this.mix=a.createGain();this.feedback=a.createGain();this.depth.gain.value=0;this.rate.value=
0;this.mix.gain.value=0;this.depthRate=this.feedback.gain.value=0;this.state(!1);this.lfo.connect(this.depth);for(l=0;l<this.MAXIMUM_STAGES;l++)this.depth.connect(this.filters[l].frequency)}function z(a,b){g.call(this,a,b);this.delay=a.createDelay();this.mix=a.createGain();this.tone=a.createBiquadFilter();this.feedback=a.createGain();this.delay.delayTime.value=0;this.depth.gain.value=0;this.rate.value=0;this.mix.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?
"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.depthRate=this.feedback.gain.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.delay.delayTime)}function B(a,b){g.call(this,a,b);this.delay=a.createDelay();this.mix=a.createGain();this.tone=a.createBiquadFilter();this.feedback=a.createGain();this.delay.delayTime.value=0;this.depth.gain.value=0;this.rate.value=0;this.mix.gain.value=0;this.tone.type="[object String]"===
Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.depthRate=this.feedback.gain.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.delay.delayTime)}function G(a,b){g.call(this,a,b);this.delay=a.createDelay(G.MAX_DELAY_TIME);this.dry=a.createGain();this.wet=a.createGain();this.tone=a.createBiquadFilter();this.feedback=a.createGain();this.delay.delayTime.value=
0;this.dry.gain.value=1;this.wet.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.feedback.gain.value=0;this.state(!1)}function A(a,b){g.call(this,a,b);this.rirs=[];this.convolver=a.createConvolver();this.dry=a.createGain();this.wet=a.createGain();this.tone=a.createBiquadFilter();this.decodeAudioData=function(b,d,c){a.decodeAudioData(b,
d,c)};this.dry.gain.value=1;this.wet.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.state(!1)}function D(a,b){g.call(this,a,b);this.panner=a.createPanner();this.positions={x:0,y:0,z:0};this.orientations={x:1,y:0,z:0};this.velocities={x:0,y:0,z:0};this.panner.refDistance=1;this.panner.maxDistance=1E4;this.panner.rolloffFactor=1;this.panner.coneInnerAngle=
360;this.panner.coneOuterAngle=360;this.panner.coneOuterGain=0;this.panner.panningModel="[object String]"===Object.prototype.toString.call(this.panner.panningModel)?"HRTF":this.panner.HRTF||1;this.panner.distanceModel="[object String]"===Object.prototype.toString.call(this.panner.distanceModel)?"inverse":this.panner.INVERSE_DISTANCE||1;this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z);this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z);
this.panner.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z);this.state(!1)}function E(a){this.context=a;this.generators=[];this.activeIndexes=[];this.activeCounter=0;this.attack=.01;this.decay=.3;this.sustain=.5;this.release=1}this.context=a;this.SAMPLE_RATE=a.sampleRate;this.NUM_OUTPUT=this.NUM_INPUT=2;var F=navigator.userAgent;if(void 0!==c)switch(parseInt(c)){case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:this.BUFFER_SIZE=parseInt(c);break;default:return}else/(Win(dows )?NT 6\.2)/.test(F)?
this.BUFFER_SIZE=1024:/(Win(dows )?NT 6\.1)/.test(F)?this.BUFFER_SIZE=1024:/(Win(dows )?NT 6\.0)/.test(F)?this.BUFFER_SIZE=2048:/Win(dows )?(NT 5\.1|XP)/.test(F)?this.BUFFER_SIZE=4096:/Mac|PPC/.test(F)?this.BUFFER_SIZE=1024:/Linux/.test(F)?this.BUFFER_SIZE=8192:/iPhone|iPad|iPod/.test(F)?this.BUFFER_SIZE=2048:this.BUFFER_SIZE=16384;this.masterVolume=a.createGain();this.processor=a.createScriptProcessor(this.BUFFER_SIZE,this.NUM_INPUT,this.NUM_OUTPUT);h.prototype=Object.create(K.prototype);g.prototype=
Object.create(K.prototype);h.prototype.constructor=h;g.prototype.constructor=g;m.prototype=Object.create(g.prototype);r.prototype=Object.create(g.prototype);n.prototype=Object.create(g.prototype);p.prototype=Object.create(g.prototype);C.prototype=Object.create(g.prototype);w.prototype=Object.create(g.prototype);v.prototype=Object.create(g.prototype);t.prototype=Object.create(g.prototype);y.prototype=Object.create(g.prototype);z.prototype=Object.create(g.prototype);B.prototype=Object.create(g.prototype);
G.prototype=Object.create(g.prototype);A.prototype=Object.create(g.prototype);D.prototype=Object.create(g.prototype);m.prototype.constructor=m;r.prototype.constructor=r;n.prototype.constructor=n;p.prototype.constructor=p;C.prototype.constructor=C;w.prototype.constructor=w;v.prototype.constructor=v;t.prototype.constructor=t;y.prototype.constructor=y;z.prototype.constructor=z;B.prototype.constructor=B;G.prototype.constructor=G;A.prototype.constructor=A;D.prototype.constructor=D;this.Effector=g;this.plugins=
[];b.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var l in a)this.param(l,a[l]);else switch(l=String(a).replace(/-/g,"").toLowerCase(),l){case "dopplerfactor":if(void 0===b)return this.listener.dopplerFactor;var d=parseFloat(b);0<=d&&(this.listener.dopplerFactor=d);break;case "speedofsound":if(void 0===b)return this.listener.speedOfSound;d=parseFloat(b);0<=d&&(this.listener.speedOfSound=d);break;case "x":case "y":case "z":if(void 0===b)return this.positions[l];
d=parseFloat(b);isNaN(d)||(this.positions[l]=d,this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case "fx":case "fy":case "fz":if(void 0===b)return this.fronts[l.charAt(1)];d=parseFloat(b);isNaN(d)||(this.fronts[l.charAt(1)]=d,this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z));break;case "ux":case "uy":case "uz":if(void 0===b)return this.ups[l.charAt(1)];d=parseFloat(b);isNaN(d)||(this.ups[l.charAt(1)]=d,this.listener.setOrientation(this.fronts.x,
this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z));break;case "vx":case "vy":case "vz":if(void 0===b)return this.velocities[l.charAt(1)];d=parseFloat(b);isNaN(d)||(this.velocities[l.charAt(1)]=d,this.listener.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z))}return this};b.prototype.params=function(){return{dopplerfactor:this.listener.dopplerfactor,speedOfSound:this.listener.speedOfSound,positions:this.positions,fronts:this.fronts,ups:this.ups,velocities:this.velocities}};
b.prototype.toJSON=function(){return JSON.stringify(this.params())};b.prototype.toString=function(){return"[SoundModule Listener]"};e.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var l in a)this.param(l,a[l]);else switch(l=String(a).replace(/-/g,"").toLowerCase(),l){case "fftsize":if(void 0===b)return this.analyser.fftSize;var d=parseInt(b);switch(d){case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:this.analyser.fftSize=d}break;case "frequencybincount":return this.analyser.frequencyBinCount;
case "mindecibels":case "maxdecibels":if(void 0===b)return this.analyser[l.replace("decibels","Decibels")];d=parseFloat(b);isNaN(d)||(this.analyser[l.replace("decibels","Decibels")]=d,this.analyser.minDecibels>=this.analyser.maxDecibels&&(this.analyser.minDecibels=-100,this.analyser.maxDecibels=-30));break;case "smoothingtimeconstant":if(void 0===b)return this.analyser.smoothingTimeConstant;d=parseFloat(b);0<=d&&1>=d&&(this.analyser.smoothingTimeConstant=d)}return this};e.prototype.start=function(a,
b){var l=this;switch(String(a).replace(/-/g,"").toLowerCase()){case "timealll":if(b instanceof AudioBuffer&&0<b.numberOfChannels){var d=new Float32Array(b.length);d.set(b.getChannelData(0));this.timeAllL.start(d)}break;case "timeallr":b instanceof AudioBuffer&&1<b.numberOfChannels&&(d=new Float32Array(b.length),d.set(b.getChannelData(1)),this.timeAllR.start(d));break;case "time":d=null;"uint"===this.time.type?(d=new Uint8Array(this.analyser.fftSize),this.analyser.getByteTimeDomainData(d),this.time.start(d)):
(d=new Float32Array(this.analyser.fftSize),this.analyser.getFloatTimeDomainData(d),this.time.start(d,this.analyser.minDecibels,this.analyser.maxDecibels));this.time.timerid="auto"===this.time.interval?requestAnimationFrame(function(){l.start(a)}):x.setTimeout(function(){l.start(a)},this.time.interval);break;case "fft":d=null,"uint"===this.fft.type?(d=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(d),this.fft.start(d)):(d=new Float32Array(this.analyser.frequencyBinCount),
this.analyser.getFloatFrequencyData(d),this.fft.start(d,this.analyser.minDecibels,this.analyser.maxDecibels)),this.fft.timerid="auto"===this.fft.interval?requestAnimationFrame(function(){l.start(a)}):x.setTimeout(function(){l.start(a)},this.fft.interval)}return this};e.prototype.stop=function(a){switch(String(a).replace(/-/g,"").toLowerCase()){case "time":"auto"===this.time.interval?x.cancelAnimationFrame(this.time.timerid):x.clearTimeout(this.time.timerid);this.time.timerid=null;break;case "fft":"auto"===
this.fft.interval?x.cancelAnimationFrame(this.fft.timerid):x.clearTimeout(this.fft.timerid),this.fft.timerid=null}return this};e.prototype.domain=function(a){a=String(a).replace(/-/g,"").toLowerCase();switch(a){case "timealll":case "timeallr":return this["timeAll"+a.slice(-1).toUpperCase()];case "time":case "fft":return this[a]}};e.prototype.get=function(){return this.analyser};e.prototype.toString=function(){return"[SoundModule Analyser]"};f.prototype.setup=function(a){a=parseInt(a);if(0<a){this.numTrack=
a;this.trackLs=Array(this.numTrack);this.trackRs=Array(this.numTrack);for(var b=0;b<a;b++)this.trackLs[b]=[];for(b=0;b<a;b++)this.trackRs[b]=[]}else this.numTrack=1,this.trackLs=Array(this.numTrack),this.trackRs=Array(this.numTrack),this.trackLs[0]=[],this.trackRs[0]=[];return this};f.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var l in a)this.param(l,a[l]);else switch(l=String(a).replace(/-/g,"").toLowerCase(),l){case "gainl":case "gainr":if(void 0===
b)return this["gain"+l.slice(-1).toUpperCase()];var d=parseFloat(b);0<=d&&1>=d&&(this["gain"+l.slice(-1).toUpperCase()]=d)}return this};f.prototype.ready=function(a){this.isTrack(a)&&(this.activeTrack=a);return this};f.prototype.start=function(){if(-1!==this.activeTrack&&this.paused){var a=this;this.paused=!1;this.processor.onaudioprocess=function(b){if(-1!==a.activeTrack){var l=b.inputBuffer.getChannelData(0);b=b.inputBuffer.getChannelData(1);for(var d=new Float32Array(this.bufferSize),c=new Float32Array(this.bufferSize),
g=0;g<this.bufferSize;g++)d[g]=a.gainL*l[g],c[g]=a.gainR*b[g];a.trackLs[a.activeTrack].push(d);a.trackRs[a.activeTrack].push(c)}else this.disconnect(0),this.onaudioprocess=null}}return this};f.prototype.stop=function(){this.activeTrack=-1;this.paused=!0;this.processor.disconnect(0);this.processor.onaudioprocess=null;return this};f.prototype.isTrack=function(a){a=parseInt(a);return 0<=a&&a<this.numTrack?!0:!1};f.prototype.getActiveTrack=function(){return this.activeTrack};f.prototype.mix=function(){-1!==
this.activeTrack&&this.stop();var a=function(a){for(var b=this["track"+a+"s"],d=null,k=0,c=0,g=0,e=0,f=d=0,h=b.length;f<h;f++)d<b[f].length&&(d=b[f].length);for(d=new Float32Array(d*this.processor.bufferSize);;){f=0;for(h=b.length;f<h;f++)b[f][g]instanceof Float32Array&&(k+=b[f][g][e],c++);if(0<c)d[g*this.processor.bufferSize+e]=k/c,c=k=0,e<this.processor.bufferSize-1?e++:(g++,e=0);else{this["mix"+a+"s"]=d;break}}};a.call(this,"L");a.call(this,"R");return this};f.prototype.clear=function(a){-1!==
this.activeTrack&&this.stop();if("all"===String(a).toLowerCase()){a=0;for(var b=this.trackLs.length;a<b;a++)this.trackLs[a].length=0;a=0;for(b=this.trackRs.length;a<b;a++)this.trackRs[a].length=0}else this.isTrack(a)&&(this.trackLs[a].length=0,this.trackRs[a].length=0);return this};f.prototype.create=function(a,b,l,d){-1!==this.activeTrack&&this.stop();var c=null,g=null;"all"===String(a).toLowerCase()?(this.mix(),c=this.mixLs,g=this.mixRs):this.isTrack(a)&&(c=this.trackLs[a-1],g=this.trackRs[a-1]);
if(0!==c.length||0!==g.length){a=1===b?1:2;l=8===l?8:16;b=1===a?Math.min(c.length,g.length):2*Math.min(c.length,g.length);var f=null;switch(l){case 8:for(var f=new Uint8Array(b),e=0;e<b;e++){var h=0,h=0===e%a?(c[parseInt(e/a)]+1)/2*(Math.pow(2,8)-1):(g[parseInt(e/a)]+1)/2*(Math.pow(2,8)-1);h>Math.pow(2,8)-1&&(h=Math.pow(2,8)-1);h<Math.pow(2,0)-1&&(h=Math.pow(2,0)-1);f[e]=parseInt(h)}break;case 16:for(f=new Int16Array(b),e=0;e<b;e++)h=0===e%a?c[parseInt(e/a)]*Math.pow(2,15):g[parseInt(e/a)]*Math.pow(2,
15),h>+Math.pow(2,15)-1&&(h=Math.pow(2,15)-1),h<-Math.pow(2,15)-1&&(h=-Math.pow(2,15)-1),f[e]=parseInt(h)}var m=36+l/8*b,g=8+(28+(8+l/8*b)),e=this.SAMPLE_RATE,h=l/8*a*e,c=l/8*b;switch(String(d).toLowerCase()){case "base64":d="RIFF"+String.fromCharCode(m>>0&255,m>>8&255,m>>16&255,m>>24&255);d+="WAVE";d+="fmt "+String.fromCharCode(16,0,0,0);d+=String.fromCharCode(1,0);d+=String.fromCharCode(a,0);d+=String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255);d+=String.fromCharCode(h>>0&255,h>>8&255,h>>
16&255,h>>24&255);d+=String.fromCharCode(l/8*a,0);d+=String.fromCharCode(l,0);d+="data";d+=String.fromCharCode(c>>0&255,c>>8&255,c>>16&255,c>>24&255);for(e=0;e<b;e++)switch(l){case 8:d+=String.fromCharCode(f[e]);break;case 16:d+=String.fromCharCode(f[e]>>0&255,f[e]>>8&255)}return"data:audio/wav;base64,"+x.btoa(d);default:d=[82,73,70,70];d[4]=m>>0&255;d[5]=m>>8&255;d[6]=m>>16&255;d[7]=m>>24&255;d[8]=87;d[9]=65;d[10]=86;d[11]=69;d[12]=102;d[13]=109;d[14]=116;d[15]=32;d[16]=16;d[17]=0;d[18]=0;d[19]=
0;d[20]=1;d[21]=0;d[22]=a;d[23]=0;d[24]=e>>0&255;d[25]=e>>8&255;d[26]=e>>16&255;d[27]=e>>24&255;d[28]=h>>0&255;d[29]=h>>8&255;d[30]=h>>16&255;d[31]=h>>24&255;d[32]=l/8*a;d[33]=0;d[34]=l;d[35]=0;d[36]=100;d[37]=97;d[38]=116;d[39]=97;d[40]=c>>0&255;d[41]=c>>8&255;d[42]=c>>16&255;d[43]=c>>24&255;for(e=0;e<b;e++)switch(l){case 8:d[g-c+e]=f[e];break;case 16:d[g-c+2*e+0]=f[e]>>0&255,d[g-c+2*e+1]=f[e]>>8&255}x.URL=x.URL||x.webkitURL;d=new Blob([new Uint8Array(d)],{type:"audio/wav"});return x.URL.createObjectURL(d)}}};
f.prototype.toString=function(){return"[SoundModule Recorder]"};h.prototype.setup=function(a,b,l,d,c,e,g){if(!navigator.onLine)throw this.isActive=!1,this.paused=!0,this.connect(),this.websocket=null,Error("Now Offline.");if("[object Object]"===Object.prototype.toString.call(a)){var f=a;"tls"in f&&(a=f.tls);"host"in f&&(b=f.host);"port"in f&&(l=f.port);"path"in f&&(d=f.path);"open"in f&&(c=f.open);"close"in f&&(e=f.close);"error"in f&&(g=f.error)}a=a?"wss://":"ws://";"/"!==d.charAt(0)&&(d="/"+d);
l=parseInt(l);if(!(isNaN(l)||0>l||65535<l)){this.websocket=new WebSocket(a+b+":"+l+d);this.websocket.binaryType="arraybuffer";var h=this;this.websocket.onopen=function(a){"[object Function]"===Object.prototype.toString.call(c)&&c(a,h.websocket)};this.websocket.onclose=function(a){h.isActive=!1;h.paused=!0;h.connect();"[object Function]"===Object.prototype.toString.call(e)&&e(a,h.websocket)};this.websocket.onerror=function(a){h.isActive=!1;h.paused=!0;h.connect();"[object Function]"===Object.prototype.toString.call(g)&&
g(a,h.websocket)};this.websocket.onmessage=function(a){if(!h.isActive)h.analyser.stop("time"),h.analyser.stop("fft");else if(a.data instanceof ArrayBuffer){var d=Math.floor(a.data.byteLength/Float32Array.BYTES_PER_ELEMENT/2),b=d*Float32Array.BYTES_PER_ELEMENT,k=new Float32Array(a.data,0,d),l=new Float32Array(a.data,b,d);h.analyser.start("time");h.analyser.start("fft");h.receiver.onaudioprocess=function(a){var d=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);k instanceof Float32Array&&
d.set(k);l instanceof Float32Array&&a.set(l);l=k=null;h.isActive&&null!==h.websocket||(h.analyser.stop("time"),h.analyser.stop("fft"))}}};return this}};h.prototype.connect=function(){this.receiver.disconnect(0);this.sender.disconnect(0);this.receiver.onaudioprocess=null;this.sender.onaudioprocess=null;this.isActive?(this.receiver.connect(this.analyser.input),this.analyser.output.connect(this.context.destination)):this.paused=!0;return this};h.prototype.start=function(){if(this.isActive&&this.isConnected()&&
this.paused){this.paused=!1;var a=this;this.sender.onaudioprocess=function(b){if(a.isActive&&a.isConnected()){var l=b.inputBuffer.getChannelData(0);b=b.inputBuffer.getChannelData(1);for(var d=new Float32Array(2*this.bufferSize),c=parseInt(d.length/2),e=0;e<this.bufferSize;e++)d[e]=l[e],d[c+e]=b[e];0===a.websocket.bufferedAmount&&a.websocket.send(d)}}}return this};h.prototype.close=function(){this.websocket instanceof WebSocket&&(this.isActive=!1,this.paused=!0,this.connect(),this.websocket.close(),
this.websocket=null);return this};h.prototype.isConnected=function(){return this.websocket instanceof WebSocket&&this.websocket.readyState===WebSocket.OPEN?!0:!1};h.prototype.state=function(a,b,l){if(void 0===a)return this.isActive;"[object Function]"===Object.prototype.toString.call(l)&&l();var d=this,c=x.setInterval(function(){d.websocket instanceof WebSocket&&0!==d.websocket.bufferedAmount||("toggle"===String(a).toLowerCase()?d.isActive=!d.isActive:d.isActive=Boolean(a),d.connect(),"[object Function]"===
Object.prototype.toString.call(b)&&b(),x.clearInterval(c))},10);return this};h.prototype.get=function(){return this.websocket};h.prototype.toString=function(){return"[SoundModule Session]"};g.prototype.param=function(a,b){};g.prototype.connect=function(){};g.prototype.start=function(a){if(this.isActive&&this.isStop){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;this.lfo.start(a);this.isStop=!1}return this};g.prototype.stop=function(a,b){if(this.isActive&&!this.isStop){var l=
parseFloat(a),d=parseFloat(b);if(isNaN(l)||l<this.context.currentTime)l=this.context.currentTime;if(isNaN(d)||0>d)d=0;var c=this.lfo.type,e=this.lfo.frequency.value;this.lfo.stop(l+d);this.lfo=this.context.createOscillator();this.lfo.start=this.lfo.start||this.lfo.noteOn;this.lfo.stop=this.lfo.stop||this.lfo.noteOff;this.lfo.type=c;this.lfo.frequency.value=e;this.rate=this.lfo.frequency;this.isStop=!0}return this};g.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?
this.isActive=!this.isActive:this.isActive=Boolean(a);this.connect();this.start(this.context.currentTime);return this};g.prototype.params=function(){return{}};g.prototype.toJSON=function(){return""};g.prototype.toString=function(){return"[SoundModule Effector]"};m.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var l in a)this.param(l,a[l]);else if(l=String(a).replace(/-/g,"").toLowerCase(),l in this.compressor){if(void 0===b)return this.compressor[l].value;
var d=parseFloat(b),c={threshold:-100,knee:0,ratio:1,attack:0,release:0},e={threshold:0,knee:40,ratio:20,attack:1,release:1},e=this.compressor[l].maxValue||e[l];d>=(this.compressor[l].minValue||c[l])&&d<=e&&(this.compressor[l].value=d)}return this};m.prototype.connect=function(){this.input.disconnect(0);this.compressor.disconnect(0);this.isActive?(this.input.connect(this.compressor),this.compressor.connect(this.output)):this.input.connect(this.output);return this};m.prototype.params=function(){return{state:this.isActive,
threshold:this.compressor.threshold.value,knee:this.compressor.knee.value,ratio:this.compressor.ratio.value,attack:this.compressor.attack.value,release:this.compressor.release.value}};m.prototype.toJSON=function(){return JSON.stringify(this.params())};m.prototype.toString=function(){return"[SoundModule Compressor]"};r.createCurve=function(a,b){if(0<a&&1>a){for(var l=new Float32Array(b),d=2*a/(1-a),c=0;c<b;c++){var e=2*(c-0)/(b-0)+-1;l[c]=(1+d)*e/(1+d*Math.abs(e))}return l}return null};r.prototype.param=
function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var l in a)this.param(l,a[l]);else switch(l=String(a).replace(/-/g,"").toLowerCase(),l){case "curve":if(void 0===b)return this.distortion.curve;l=null;switch(String(b).toLowerCase()){case "clean":this.type="clean";l=r.createCurve(0,this.numberOfSamples);break;case "crunch":this.type="crunch";l=r.createCurve(.5,this.numberOfSamples);break;case "overdrive":this.type="overdrive";l=r.createCurve(.7,this.numberOfSamples);break;
case "distortion":this.type="distortion";l=r.createCurve(.8,this.numberOfSamples);break;case "fuzz":this.type="fuzz";l=r.createCurve(.9,this.numberOfSamples);break;default:b instanceof Float32Array&&(l=b)}this.distortion.curve=l;break;case "samples":if(void 0===b)return this.numberOfSamples;var d=parseInt(b);0<=d&&(this.numberOfSamples=d,this.param("curve",this.type));break;case "drive":if(void 0===b)return this.drive.gain.value;var d=parseFloat(b),c=this.drive.gain.minValue||0,e=this.drive.gain.maxValue||
1;d>=c&&d<=e&&(this.drive.gain.value=d);break;case "color":case "tone":if(void 0===b)return this[l].frequency.value;d=parseFloat(b);c=this[l].frequency.minValue||10;e=this[l].frequency.maxValue||this.context.sampleRate/2;d>=c&&d<=e&&(this[l].frequency.value=d)}return this};r.prototype.connect=function(){this.input.disconnect(0);this.distortion.disconnect(0);this.drive.disconnect(0);this.color.disconnect(0);this.tone.disconnect(0);this.isActive?(this.input.connect(this.color),this.color.connect(this.distortion),
this.distortion.connect(this.drive),this.drive.connect(this.tone),this.tone.connect(this.output)):this.input.connect(this.output)};r.prototype.params=function(){return{state:this.isActive,curve:this.type,samples:this.numberOfSamples,drive:this.drive.gain.value,color:this.color.frequency.value,tone:this.tone.frequency.value}};r.prototype.toJSON=function(){return JSON.stringify(this.params())};r.prototype.toString=function(){return"[SoundModule Distortion]"};n.prototype.param=function(a,b){if("[object Object]"===
Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "frequency":case "cutoff":if(void 0===b)return this.lowpass.frequency.value;c=parseFloat(b);var d=this.lowpass.frequency.minValue||10,e=this.lowpass.frequency.maxValue||this.context.sampleRate/2;c>=d&&c<=e&&(this.lowpass.frequency.value=c,this.depth.gain.value=this.lowpass.frequency.value*this.depthRate);break;case "depth":if(void 0===b)return this.depthRate;c=parseFloat(b);
0<=c&&1>=c&&(this.depth.gain.value=this.lowpass.frequency.value*c,this.depthRate=c);break;case "rate":if(void 0===b)return this.rate.value;c=parseFloat(b);d=this.rate.minValue||0;e=this.rate.maxValue||1E5;c>=d&&c<=e&&(this.rate.value=c);break;case "resonance":if(void 0===b)return this.lowpass.Q.value;c=parseFloat(b);d=this.lowpass.Q.minValue||1E-4;e=this.lowpass.Q.maxValue||1E3;c>=d&&c<=e&&(this.lowpass.Q.value=c)}return this};n.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);this.isActive&&
(this.lfo.connect(this.depth),this.depth.connect(this.lowpass.frequency));return this};n.prototype.connect=function(){this.input.disconnect(0);this.lowpass.disconnect(0);this.isActive?(this.input.connect(this.lowpass),this.lowpass.connect(this.output)):this.input.connect(this.output)};n.prototype.params=function(){return{state:this.isActive,cutoff:this.lowpass.frequency.value,depth:this.depthRate,rate:this.rate.value,resonance:this.lowpass.Q.value}};n.prototype.toJSON=function(){return JSON.strignify(this.params())};
n.prototype.toString=function(){return"[SoundModule Wah]"};p.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "bass":case "middle":case "treble":case "presence":if(void 0===b)return this[c].gain.value;var d=parseFloat(b),e=this[c].gain.maxValue||40;d>=(this[c].gain.minValue||-40)&&d<=e&&(this[c].gain.value=d)}return this};p.prototype.connect=function(){this.input.disconnect(0);
this.bass.disconnect(0);this.middle.disconnect(0);this.treble.disconnect(0);this.presence.disconnect(0);this.isActive?(this.input.connect(this.bass),this.bass.connect(this.middle),this.middle.connect(this.treble),this.treble.connect(this.presence),this.presence.connect(this.output)):this.input.connect(this.output)};p.prototype.params=function(){return{state:this.isActive,bass:this.bass.gain.value,middle:this.middle.gain.value,treble:this.treble.gain.value,presence:this.presence.gain.value}};p.prototype.toJSON=
function(){return JSON.stringify(params)};p.prototype.toString=function(){return"[SoundModule Equalizer]"};C.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "type":if(void 0===b)return this.filter.type;var d=String(b).toLowerCase();c={lowpass:this.filter.LOWPASS||0,highpass:this.filter.HIGHPASS||1,bandpass:this.filter.BANDPASS||2,lowshelf:this.filter.LOWSHELF||3,
highshelf:this.filter.HIGHSHELF||4,peaking:this.filter.PEAKING||5,notch:this.filter.NOTCH||6,allpass:this.filter.ALLPASS||7};d in c&&(this.filter.type="[object String]"===Object.prototype.toString.call(this.filter.type)?d:c[d]);break;case "frequency":case "cutoff":if(void 0===b)return this.filter.frequency.value;d=parseFloat(b);c=this.filter.frequency.minValue||10;var e=this.filter.frequency.maxValue||this.context.sampleRate/2;d>=c&&d<=e&&(this.maxFrequency=d,this.filter.frequency.value=d);break;
case "gain":if(void 0===b)return this.filter.gain.value;d=parseFloat(b);c=this.filter.gain.minValue||-40;e=this.filter.gain.maxValue||40;d>=c&&d<=e&&(this.filter.gain.value=d);break;case "q":if(void 0===b)return this.filter.Q.value;d=parseFloat(b);c=this.filter.Q.minValue||1E-4;e=this.filter.Q.maxValue||1E3;d>=c&&d<=e&&(this.filter.Q.value=d);break;case "range":if(void 0===b)return this.range;d=parseFloat(b);0<=d&&1>=d&&(this.range=d);break;case "attack":case "decay":case "sustain":case "release":if(void 0===
b)return this[c];d=parseFloat(b);0<=d&&(this[c]=d)}return this};C.prototype.connect=function(){this.input.disconnect(0);this.filter.disconnect(0);this.isActive?(this.input.connect(this.filter),this.filter.connect(this.output)):this.input.connect(this.output)};C.prototype.start=function(a){if(this.isActive){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;var b=a+this.attack,c=this.decay,d=this.sustain*this.maxFrequency,e=this.maxFrequency*this.range;this.filter.frequency.cancelScheduledValues(a);
this.filter.frequency.setValueAtTime(e,a);this.filter.frequency.linearRampToValueAtTime(this.maxFrequency,b);this.filter.frequency.setTargetAtTime(d,b,c)}return this};C.prototype.stop=function(a){if(this.isActive){a=parseFloat(a)-this.release;if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;var b=this.release,c=this.maxFrequency*this.range;this.filter.frequency.cancelScheduledValues(a);this.filter.frequency.setValueAtTime(this.filter.frequency.value,a);this.filter.frequency.setTargetAtTime(c,
a,b)}return this};C.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);this.connect();return this};C.prototype.params=function(){return{state:this.isActive,type:this.filter.type,frequency:this.filter.frequency.value,Q:this.filter.Q.value,gain:this.filter.gain.value,range:this.range,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}};C.prototype.toJSON=function(){return JSON.stringify(this.params())};
C.prototype.toString=function(){return"[SoundModule Filter]"};t.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "depth":if(void 0===b)return this.depth.gain.value;c=parseFloat(b);var d=this.depth.gain.minValue||0,e=this.depth.gain.maxValue||1;c>=d&&c<=e&&(this.depth.gain.value=c);break;case "rate":if(void 0===b)return this.rate.value;c=parseFloat(b);d=this.rate.minValue||
0;e=this.rate.maxValue||1E5;c>=d&&c<=e&&(this.rate.value=c)}return this};t.prototype.connect=function(){this.input.disconnect(0);this.amplitudeL.disconnect(0);this.amplitudeR.disconnect(0);this.splitter.disconnect(0);this.splitter.disconnect(1);this.merger.disconnect(0);this.isActive?(this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0,0),this.splitter.connect(this.amplitudeR,1,0),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output)):
this.input.connect(this.output)};t.prototype.start=function(a){if(this.isActive&&this.isStop){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;this.lfo.start(a);this.isStop=!1;var b=this;this.processor.onaudioprocess=function(a){var d=a.inputBuffer.getChannelData(0),c=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);if(b.isActive&&0!==b.depth.gain.value&&0!==b.rate.value)for(var e=0;e<this.bufferSize;e++)c[e]=d[e],a[e]=-d[e];else for(e=0;e<this.bufferSize;e++)c[e]=
0,a[e]=0}}return this};t.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);this.isActive&&(this.processor.disconnect(0),this.processor.onaudioprocess=null,this.lfo.connect(this.depth),this.depth.connect(this.processor),this.processor.connect(this.lfoSplitter),this.lfoSplitter.connect(this.amplitudeL.gain,0),this.lfoSplitter.connect(this.amplitudeR.gain,1));return this};t.prototype.params=function(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value}};t.prototype.toJSON=
function(){return JSON.stringify(this.params())};t.prototype.toString=function(){return"[SoundModule Autopanner]"};w.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "depth":if(void 0===b)return this.depth.gain.value;c=parseFloat(b);var d=this.depth.gain.minValue||0,e=this.depth.gain.maxValue||1;c>=d&&c<=e&&(this.depth.gain.value=c);break;case "rate":if(void 0===b)return this.rate.value;
c=parseFloat(b);d=this.rate.minValue||0;e=this.rate.maxValue||1E5;c>=d&&c<=e&&(this.rate.value=c);break;case "wave":if(void 0===b)return this.lfo.type;c=String(b).toLowerCase();d={sine:this.lfo.SINE||0,square:this.lfo.SQUARE||1,sawtooth:this.lfo.SAWTOOTH||2,triangle:this.lfo.TRIANGLE||3};c in d&&(this.lfo.type="[object String]"===Object.prototype.toString.call(this.lfo.type)?c:d[c])}return this};w.prototype.connect=function(){this.input.disconnect(0);this.amplitude.disconnect(0);this.isActive?(this.input.connect(this.amplitude),
this.amplitude.connect(this.output)):this.input.connect(this.output)};w.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain));return this};w.prototype.params=function(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value,wave:this.lfo.type}};w.prototype.toJSON=function(){return JSON.stringify(this.param())};w.prototype.toString=function(){return"[SoundModule Tremolo]"};v.prototype.param=
function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "depth":if(void 0===b)return this.depth.gain.value;c=parseFloat(b);var d=this.depth.gain.minValue||0,e=this.depth.gain.maxValue||1;c>=d&&c<=e&&(this.depth.gain.value=c);break;case "rate":if(void 0===b)return this.rate.value;c=parseFloat(b);d=this.rate.minValue||0;e=this.rate.maxValue||1E5;c>=d&&c<=e&&(this.rate.value=c)}return this};
v.prototype.connect=function(){this.input.disconnect(0);this.amplitude.disconnect(0);this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output)};v.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain));return this};v.prototype.params=function(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value}};v.prototype.toJSON=function(){return JSON.stringify(this.params())};
v.prototype.toString=function(){return"[SoundModule Ringmodulator]"};y.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "stage":if(void 0===b)return this.numberOfStages;var d=parseInt(b),e,f=this.MAXIMUM_STAGES;0<=d&&d<=f&&(this.numberOfStages=d,this.connect());break;case "frequency":case "cutoff":if(void 0===b)return this.filters[0].frequency.value;d=parseFloat(b);
e=this.filters[0].frequency.minValue||10;f=this.filters[0].frequency.maxValue||this.context.sampleRate/2;if(d>=e&&d<=f){for(c=0;c<this.MAXIMUM_STAGES;c++)this.filters[c].frequency.value=d;this.depth.gain.value=this.filters[0].frequency.value*this.depthRate}break;case "resonance":if(void 0===b)return this.filters[0].Q.value;d=parseFloat(b);e=this.filters[0].Q.minValue||1E-4;f=this.filters[0].Q.maxValue||1E3;if(d>=e&&d<=f)for(c=0;c<this.MAXIMUM_STAGES;c++)this.filters[0].Q.value=d;break;case "depth":if(void 0===
b)return this.depthRate;d=parseFloat(b);f=this.filters[0].frequency.value;0<=d&&d<=f&&(this.depth.gain.value=this.filters[0].frequency.value*d,this.depthRate=d);break;case "rate":if(void 0===b)return this.rate.value;d=parseFloat(b);e=this.rate.minValue||0;f=this.rate.maxValue||1E5;d>=e&&d<=f&&(this.rate.value=d);break;case "mix":case "feedback":if(void 0===b)return this[c].gain.value;d=parseFloat(b);e=this[c].gain.minValue||0;f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d)}return this};
y.prototype.connect=function(){this.input.disconnect(0);for(var a=0;a<this.MAXIMUM_STAGES;a++)this.filters[a].disconnect(0);this.mix.disconnect(0);this.feedback.disconnect(0);this.input.connect(this.output);if(this.isActive&&0<this.numberOfStages)for(this.input.connect(this.filters[0]),a=0;a<this.numberOfStages;a++)a<this.numberOfStages-1?this.filters[a].connect(this.filters[a+1]):(this.filters[a].connect(this.mix),this.mix.connect(this.output),this.filters[a].connect(this.feedback),this.feedback.connect(this.filters[0]))};
y.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);if(this.isActive){this.lfo.connect(this.depth);for(var c=0;c<this.MAXIMUM_STAGES;c++)this.depth.connect(this.filters[c].frequency)}return this};y.prototype.params=function(){return{state:this.isActive,stage:this.numberOfStages,frequency:this.filters[0].frequency.value,resonance:this.filters[0].Q.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,feedback:this.feedback.gain.value}};y.prototype.toJSON=function(){return JSON.stringify(this.params())};
y.prototype.toString=function(){return"[SoundModule Phaser]"};z.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "delaytime":case "time":if(void 0===b)return this.delay.delayTime.value;var d=parseFloat(b),e=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||1;d>=e&&d<=f&&(this.delay.delayTime.value=d,this.depth.gain.value=this.delay.delayTime.value*
this.depthRate);break;case "depth":if(void 0===b)return this.depthRate;d=parseFloat(b);0<=d&&1>=d&&(this.depth.gain.value=this.delay.delayTime.value*d,this.depthRate=d);break;case "rate":if(void 0===b)return this.rate.value;d=parseFloat(b);e=this.rate.minValue||0;f=this.rate.maxValue||1E5;d>=e&&d<=f&&(this.rate.value=d);break;case "mix":case "feedback":if(void 0===b)return this[c].gain.value;d=parseFloat(b);e=this[c].gain.minValue||0;f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;
case "tone":if(void 0===b)return this.tone.frequency.value;d=parseFloat(b);e=this.tone.frequency.minValue||10;f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d)}return this};z.prototype.connect=function(){this.input.disconnect(0);this.delay.disconnect(0);this.mix.disconnect(0);this.tone.disconnect(0);this.feedback.disconnect(0);this.input.connect(this.output);this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),
this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay))};z.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime));return this};z.prototype.params=function(){return{state:this.isActive,time:this.delay.delayTime.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value}};z.prototype.toJSON=
function(){return JSON.stringify(this.params())};z.prototype.toString=function(){return"[SoundModule Flanger]"};B.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "delaytime":case "time":if(void 0===b)return this.delay.delayTime.value;var d=parseFloat(b),e=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||1;d>=e&&d<=f&&(this.delay.delayTime.value=d,
this.depth.gain.value=this.delay.delayTime.value*this.depthRate);break;case "depth":if(void 0===b)return this.depthRate;d=parseFloat(b);0<=d&&1>=d&&(this.depth.gain.value=this.delay.delayTime.value*d,this.depthRate=d);break;case "rate":if(void 0===b)return this.rate.value;d=parseFloat(b);e=this.rate.minValue||0;f=this.rate.maxValue||1E5;d>=e&&d<=f&&(this.rate.value=d);break;case "mix":case "feedback":if(void 0===b)return this[c].gain.value;d=parseFloat(b);e=this[c].gain.minValue||0;f=this[c].gain.maxValue||
1;d>=e&&d<=f&&(this[c].gain.value=d);break;case "tone":if(void 0===b)return this.tone.frequency.value;d=parseFloat(b);e=this.tone.frequency.minValue||10;f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d)}return this};B.prototype.connect=function(){this.input.disconnect(0);this.delay.disconnect(0);this.mix.disconnect(0);this.tone.disconnect(0);this.feedback.disconnect(0);this.input.connect(this.output);this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),
this.delay.connect(this.mix),this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay))};B.prototype.stop=function(a,b){g.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime));return this};B.prototype.params=function(){return{state:this.isActive,time:this.delay.delayTime.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,tone:this.tone.frequency.value}};B.prototype.toJSON=function(){return JSON.stringify(this.params())};
B.prototype.toString=function(){return"[SoundModule Chorus]"};G.MAX_DELAY_TIME=5;G.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "delaytime":case "time":if(void 0===b)return this.delay.delayTime.value;var d=parseFloat(b),e=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||G.MAX_DELAY_TIME;d>=e&&d<=f&&(this.delay.delayTime.value=d);break;case "dry":case "wet":case "feedback":if(void 0===
b)return this[c].gain.value;d=parseFloat(b);e=this[c].gain.minValue||0;f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;case "tone":if(void 0===b)return this.tone.frequency.value;d=parseFloat(b);e=this.tone.frequency.minValue||10;f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d)}return this};G.prototype.connect=function(){this.input.disconnect(0);this.delay.disconnect(0);this.dry.disconnect(0);this.wet.disconnect(0);this.tone.disconnect(0);
this.feedback.disconnect(0);this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.wet),this.wet.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay)):this.input.connect(this.output)};G.prototype.params=function(){return{state:this.isActive,time:this.delay.delayTime.value,dry:this.dry.gain.value,wet:this.wet.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value}};
G.prototype.toJSON=function(){return JSON.stringify(this.params())};G.prototype.toString=function(){return"[SoundModule Delay]"};A.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "type":if(void 0===b)return this.convolver.buffer;var d=parseInt(b),e=0,f=this.rirs.length-1;null===b?(this.convolver.buffer=null,this.input.disconnect(0),this.input.connect(this.output)):
d>=e&&d<=f&&(this.convolver.buffer=this.rirs[d],this.connect());break;case "dry":case "wet":if(void 0===b)return this[c].gain.value;d=parseFloat(b);e=this[c].gain.minValue||0;f=this[c].gain.maxValue||1;d>=e&&d<=f&&(this[c].gain.value=d);break;case "tone":if(void 0===b)return this.tone.frequency.value;d=parseFloat(b);e=this.tone.frequency.minValue||10;f=this.tone.frequency.maxValue||this.context.sampleRate/2;d>=e&&d<=f&&(this.tone.frequency.value=d);break;case "rirs":return this.rirs}return this};
A.prototype.connect=function(){this.input.disconnect(0);this.convolver.disconnect(0);this.dry.disconnect(0);this.wet.disconnect(0);this.tone.disconnect(0);this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output)):this.input.connect(this.output)};A.prototype.start=function(a,b){if(a instanceof AudioBuffer||null===a)this.convolver.buffer=a,this.rirs.push(a);
else if(a instanceof ArrayBuffer){var c=this;"[object Function]"!==Object.prototype.toString.call(b)&&(b=function(){});this.decodeAudioData(a,function(a){c.convolver.buffer=a;c.rirs.push(a)},b)}return this};A.prototype.preset=function(a,b,c,d,e){if("[object Object]"===Object.prototype.toString.call(a)){var f=a;"rirs"in f&&(a=f.rirs);"timeout"in f&&(b=f.timeout);"success"in f&&(c=f.success);"error"in f&&(d=f.error);"progress"in f&&(e=f.progress)}Array.isArray(a)||(a=[a]);this.rirs=Array(a.length);
var g=!1,h=parseInt(b),m=this;b=function(a,b){var f=new XMLHttpRequest;f.timeout=0<h?h:6E4;f.ontimeout=function(a){g||"[object Function]"!==Object.prototype.toString.call(d)||d(a,"timeout");g=!0};f.onprogresss=function(a){g?f.abort():"[object Function]"===Object.prototype.toString.call(e)&&e(a)};f.onerror=function(a){g||"[object Function]"!==Object.prototype.toString.call(d)||d(a,"error");g=!0};f.onload=function(a){200===f.status&&function(e){e instanceof ArrayBuffer&&m.context.decodeAudioData(e,
function(d){m.rirs[b]=d;d=0;for(var e=m.rirs.length;d<e;d++)if(void 0===m.rirs[d])return;"[object Function]"===Object.prototype.toString.call(c)&&c.call(m,a,m.rirs)},function(a){"[object Function]"===Object.prototype.toString.call(d)&&d(a,"decode")})}.call(m,f.response)};f.open("GET",a,!0);f.responseType="arraybuffer";f.send(null)};for(var f=0,r=a.length;f<r;f++)"[object String]"===Object.prototype.toString.call(a[f])?b.call(this,a[f],f):a[f]instanceof AudioBuffer&&(this.rirs[f]=a[f]);return this};
A.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);this.connect();return this};A.prototype.params=function(){return{state:this.isActive,dry:this.dry.gain.value,wet:this.wet.gain.value,tone:this.tone.frequency.value}};A.prototype.toJSON=function(){return JSON.stringify(this.params())};A.prototype.toString=function(){return"[SoundModule Reverb]"};D.prototype.param=function(a,b){if("[object Object]"===
Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "x":case "y":case "z":if(void 0===b)return this.positions[c];var d=parseFloat(b);isNaN(d)||(this.positions[c]=d,this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case "ox":case "oy":case "oz":if(void 0===b)return this.orientations[c.charAt(1)];d=parseFloat(b);isNaN(d)||(this.orientations[c.charAt(1)]=d,this.panner.setOrientation(this.orientations.x,
this.orientations.y,this.orientations.z));break;case "vx":case "vy":case "vz":if(void 0===b)return this.velocities[c.charAt(1)];d=parseFloat(b);isNaN(d)||(this.velocities[c.charAt(1)]=d,this.panner.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z));break;case "refdistance":if(void 0===b)return this.panner.refDistance;d=parseFloat(b);isNaN(d)||(this.panner.refDistance=d);break;case "maxdistance":if(void 0===b)return this.panner.maxDistance;d=parseFloat(b);isNaN(d)||(this.panner.maxDistance=
d);break;case "rollofffactor":if(void 0===b)return this.panner.rolloffFactor;d=parseFloat(b);isNaN(d)||(this.panner.rolloffFactor=d);break;case "coneinnerangle":if(void 0===b)return this.panner.coneInnerAngle;d=parseFloat(b);isNaN(d)||(this.panner.coneInnerAngle=d);break;case "coneouterangle":if(void 0===b)return this.panner.coneOuterAngle;d=parseFloat(b);isNaN(d)||(this.panner.coneOuterAngle=d);break;case "coneoutergain":if(void 0===b)return this.panner.coneOuterGain;d=parseFloat(b);isNaN(d)||(this.panner.coneOuterGain=
d);break;case "panningmodel":if(void 0===b)return this.panner.panningModel;d=/HRTF/i.test(b)?String(b).toUpperCase():String(b).toLowerCase();c={equalpower:this.panner.EQUALPOWER||0,HRTF:this.panner.HRTF||1};d in c&&(this.panner.panningModel="[object String]"===Object.prototype.toString.call(this.panner.panningModel)?d:c[d]);break;case "distancemodel":if(void 0===b)return this.panner.distanceModel;d=String(b).replace(/-/g,"").toLowerCase();c={linear:this.panner.LINEAR_DISTANCE||0,inverse:this.panner.INVERSE_DISTANCE||
1,exponential:this.panner.EXPONENTIAL_DISTANCE||2};d in c&&(this.panner.distanceModel="[object String]"===Object.prototype.toString.call(this.panner.distanceModel)?d:c[d])}return this};D.prototype.connect=function(){this.input.disconnect(0);this.panner.disconnect(0);this.isActive?(this.input.connect(this.panner),this.panner.connect(this.output)):this.input.connect(this.output)};D.prototype.params=function(){return{state:this.isActive,positions:this.positions,orientations:this.orientations,velocities:this.velocities,
refdistance:this.panner.refDistance,maxdistance:this.panner.maxDistance,rollofffactor:this.panner.rolloffFactor,coneinnerangle:this.panner.coneInnerAngle,coneouterangle:this.panner.coneOuterAngle,coneoutergain:this.panner.coneOuterGain,panningmodel:this.panner.panningModel,distancemodel:this.panner.distanceModel}};D.prototype.toJSON=function(){return JSON.stringify(this.params())};D.prototype.toString=function(){return"[SoundModule Panner]"};E.prototype.param=function(a,b){if("[object Object]"===
Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "attack":case "decay":case "sustain":case "release":if(void 0===b)return this[c];var d=parseFloat(b);0<=d&&(this[c]=d)}return this};E.prototype.isStop=function(){for(var a=0,b=0,c=this.activeIndexes.length;b<c;b++){var d=this.activeIndexes[b];if(void 0!==d){if(.001<this.generators[d].gain.value)return!1;a++;if(a===this.activeCounter)return!0}}};E.prototype.ready=function(a,
b,c){a=0<=parseInt(a)?parseInt(a):0;b.connect(this.generators[a]);this.generators[a].connect(c);this.activeIndexes[a]=a;this.activeCounter++;return this};E.prototype.start=function(a){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;for(var b=a+this.attack,c=this.decay,d=this.sustain,e=0,f=this.activeIndexes.length;e<f;e++){var g=this.activeIndexes[e];void 0!==g&&(this.generators[g].gain.cancelScheduledValues(a),this.generators[g].gain.setValueAtTime(0,a),this.generators[g].gain.linearRampToValueAtTime(1,
b),this.generators[g].gain.setTargetAtTime(d,b,c))}return this};E.prototype.stop=function(a){a=parseFloat(a)-this.release;if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;for(var b=this.release,c=0,d=this.activeIndexes.length;c<d;c++){var e=this.activeIndexes[c];void 0!==e&&(this.generators[e].gain.cancelScheduledValues(a),this.generators[e].gain.setValueAtTime(this.generators[e].gain.value,a),this.generators[e].gain.setTargetAtTime(0,a,b))}return this};E.prototype.clear=function(){this.activeIndexes=
[];this.activeCounter=0;return this};E.prototype.params=function(){return{attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}};E.prototype.toJSON=function(){return JSON.strignify(this.params())};E.prototype.toString=function(){return"[SoundModule EnvelopeGenerator]"};this.listener=new b(a);this.analyser=new e(a);this.recorder=new f(a,this.BUFFER_SIZE,this.NUM_INPUT,this.NUM_OUTPUT);this.session=new h(a,this.BUFFER_SIZE,this.NUM_INPUT,this.NUM_OUTPUT,this.analyser);this.eg=
new E(a);this.compressor=new m(a,this.BUFFER_SIZE);this.distortion=new r(a,this.BUFFER_SIZE);this.wah=new n(a,this.BUFFER_SIZE);this.equalizer=new p(a,this.BUFFER_SIZE);this.filter=new C(a,this.BUFFER_SIZE);this.tremolo=new w(a,this.BUFFER_SIZE);this.ringmodulator=new v(a,this.BUFFER_SIZE);this.autopanner=new t(a,this.BUFFER_SIZE);this.phaser=new y(a,this.BUFFER_SIZE);this.flanger=new z(a,this.BUFFER_SIZE);this.chorus=new B(a,this.BUFFER_SIZE);this.delay=new G(a,this.BUFFER_SIZE);this.reverb=new A(a,
this.BUFFER_SIZE);this.panner=new D(a,this.BUFFER_SIZE);this.modules=[this.panner,this.compressor,this.distortion,this.wah,this.equalizer,this.filter,this.autopanner,this.tremolo,this.ringmodulator,this.phaser,this.flanger,this.chorus,this.delay,this.reverb]}function A(a){function c(a){this.context=a;this.frequencies={start:-1,end:0};this.time=this.rate=0;this.type="linear"}v.call(this,a);this.sources=[];this.times={start:0,stop:0};this.isAnalyser=!1;this.glide=new c(a);c.prototype.param=function(a,
c){if("[object Object]"===Object.prototype.toString.call(a))for(var f in a)this.param(f,a[f]);else switch(f=String(a).replace(/-/g,"").toLowerCase(),f){case "time":if(void 0===c)return this.time;f=parseFloat(c);0<=f&&(this.time=f);break;case "type":if(void 0===c)return this.type;f=String(c).toLowerCase();if("linear"===f||"exponential"===f)this.type=f}return this};c.prototype.ready=function(a){this.frequencies.end=a;a=-1===this.frequencies.start?0:this.frequencies.end-this.frequencies.start;-1===this.frequencies.start||
0===this.time||0===a?this.frequencies.start=this.frequencies.end:this.rate=a/this.time;return this};c.prototype.start=function(a,c){var f=parseFloat(c);if(isNaN(f)||f<this.context.currentTime)f=this.context.currentTime;var h=f+this.time;a.frequency.cancelScheduledValues(f);a.frequency.setValueAtTime(this.frequencies.start,f);a.frequency[this.type+"RampToValueAtTime"](this.frequencies.end,h);return this};c.prototype.stop=function(){this.frequencies.start=this.frequencies.end;return this};c.prototype.toString=
function(){return"[OscillatorModule Glide]"}}function D(a){v.call(this,a);this.sources=[];this.resources=[];this.buffers=[];this.volumes=[];this.isStops=[];this.settings=[];this.times={start:0,stop:0};this.transpose=1;this.isStop=!0;this.isAnalyser=!1}function z(a){function c(){this.depth=0}v.call(this,a);this.source=a.createBufferSource();this.buffer=null;this.currentTime=0;this.paused=!0;this.callbacks={decode:function(){},ready:function(){},start:function(){},stop:function(){},update:function(){},
ended:function(){},error:function(){}};this.vocalcanceler=new c;c.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var f in a)this.param(f,a[f]);else switch(f=String(a).replace(/-/g,"").toLowerCase(),f){case "depth":if(void 0===c)return this.depth;f=parseFloat(c);0<=f&&1>=f&&(this.depth=f)}return this};c.prototype.start=function(a,c){return a-this.depth*c};c.prototype.toString=function(){return"[AudioModule VocalCanceler]"}}function B(a){z.call(this,a);this.media=
this.source=null;this.ext="";this.duration=0;this.playbackRate=1;this.muted=this.loop=this.controls=!1;this.callbacks={loadstart:function(){}}}function F(a){function c(){this.level=0}v.call(this,a);this.source=null;this.medias={audio:!0,video:!1};this.callbacks={stream:function(){},error:function(){}};this.isStop=!0;this.noisegate=new c;c.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var f in a)this.param(f,a[f]);else switch(f=String(a).replace(/-/g,"").toLowerCase(),
f){case "level":if(void 0===c)return this.level;f=parseFloat(c);0<=f&&1>=f&&(this.level=f)}return this};c.prototype.start=function(a){a=Math.abs(parseFloat(a));return a>this.level?a:0};c.prototype.toString=function(){return"[StreamModule NoiseGate]"}}function H(a){v.call(this,a);this.sources=[];this.isAnalyser=!1}function t(a){this.context=a;this.source=null;this.sequences=[];this.timerids=[];this.prev=[];this.callbacks={start:function(){},stop:function(){},ended:function(){},error:function(){}}}
var w,M=x.AudioContext||x.webkitAudioContext?!0:!1;K.prototype.state=function(a){};var N=function(a,c,b,e,f){if("[object Object]"===Object.prototype.toString.call(a)){var h=a;"file"in h&&(a=h.file);"type"in h&&(c=h.type);"success"in h&&(b=h.success);"error"in h&&(e=h.error);"progress"in h&&(f=h.progress)}if(a instanceof Blob){var g=new FileReader;g.onprogress=function(a){"[object Function]"===Object.prototype.toString.call(f)&&f(a)};g.onerror=function(a){if("[object Function]"===Object.prototype.toString.call(e)){var b=
"";switch(g.error.code){case g.error.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case g.error.SECURITY_ERR:b="SECURITY_ERR";break;case g.error.ABORT_ERR:b="ABORT_ERR";break;case g.error.NOT_READABLE_ERR:b="NOT_READABLE_ERR";break;case g.error.ENCODING_ERR:b="ENCODING_ERR";break;default:b="ERR"}e(a,b)}};g.onload=function(a){if("[object Function]"===Object.prototype.toString.call(b)){var c=g.result;"[object String]"===Object.prototype.toString.call(c)&&-1===c.indexOf("data:")&&-1===c.indexOf("blob:")&&(c=
c.replace(/<(\/?script.*?)>/gi,"<$1>"));b(a,c)}};/arraybuffer/i.test(c)?g.readAsArrayBuffer(a):/dataurl/i.test(c)?g.readAsDataURL(a):/text/i.test(c)&&g.readAsText(a,"UTF-8")}else"[object Function]"===Object.prototype.toString.call(e)&&e(null,"FILE_IS_NOT_BLOB")},O=function(a,c,b,e,f){if("[object Object]"===Object.prototype.toString.call(a)){var h=a;"event"in h&&(a=h.event);"type"in h&&(c=h.type);"success"in h&&(b=h.success);"error"in h&&(e=h.error);"progress"in h&&(f=h.progress)}if(a instanceof Event){h=
null;if("drop"===a.type)a.stopImmediatePropagation(),a.preventDefault(),h=a.dataTransfer.files[0];else if("change"===a.type&&"files"in a.target)h=a.target.files[0];else return;if(h instanceof File){if(/text/i.test(c)&&-1===h.type.indexOf("text"))throw Error("Please upload text file.");if(/arraybuffer|dataurl/i.test(c)&&-1===h.type.indexOf("audio"))throw Error("Please upload audio file.");this.read({file:h,type:c,success:b,error:e,progress:f});return h}throw Error("Please upload file.");}},P=function(a,
c,b,e,f){if("[object Object]"===Object.prototype.toString.call(a)){var h=a;"url"in h&&(a=h.url);"timeout"in h&&(c=h.timeout);"success"in h&&(b=h.success);"error"in h&&(e=h.error);"progress"in h&&(f=h.progress)}var g=new XMLHttpRequest;c=parseInt(c);g.timeout=0<c?c:6E4;g.ontimeout=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a,"timeout")};g.onprogress=function(a){"[object Function]"===Object.prototype.toString.call(f)&&f(a)};g.onerror=function(a){"[object Function]"===Object.prototype.toString.call(e)&&
e(a,"error")};g.onload=function(a){if(200===g.status){var c=g.response;c instanceof ArrayBuffer&&"[object Function]"===Object.prototype.toString.call(b)&&b(a,c)}};g.open("GET",a,!0);g.responseType="arraybuffer";g.send(null)},Q=function(a,c,b,e){a instanceof AudioContext&&c instanceof ArrayBuffer&&("[object Function]"!==Object.prototype.toString.call(b)&&(b=function(){}),"[object Function]"!==Object.prototype.toString.call(e)&&(e=function(){}),a.decodeAudioData(c,b,e))},R=function(a){var c=Math.pow(2,
1/12);Array.isArray(a)||(a=[a]);for(var b=Array(a.length),e=0,f=a.length;e<f;e++){var h=parseInt(a[e]);b[e]=0<=h?27.5*Math.pow(c,h):0}return b},S=function(a){var c=parseFloat(a);if(0<=c){a=Math.floor(c/60);var b=Math.floor(c%60),c=c-parseInt(c);return{minutes:a,seconds:b,milliseconds:c}}},T=function(a){x.X===w&&(x.X=void 0);a&&x.XSound===w&&(x.XSound=void 0);return w};E.prototype.setup=function(a,c,b,e){if("[object Object]"===Object.prototype.toString.call(a)){var f=a;"id"in f&&(a=f.id);"type"in f&&
(c=f.type);"formats"in f&&(b=f.formats);"callbacks"in f&&(e=f.callbacks)}f=String(a);c="video"!==String(c).toLowerCase()?"audio":"video";this.media=null!==a&&""!==f?document.getElementById(f):document.createElement(c);if(this.media instanceof HTMLMediaElement){Array.isArray(b)||(b=[b]);a=0;for(f=b.length;a<f;a++){var h=c+"/"+String(b[a]).toLowerCase();if(/^(?:maybe|probably)/.test(this.media.canPlayType(h))){this.ext=b[a];break}}if(""===this.ext)throw Error("Media format that can be played does not exist.");
if("[object Object]"===Object.prototype.toString.call(e))for(var g in e)this.callbacks[g.toLowerCase()]="[object Function]"===Object.prototype.toString.call(e[g])?e[g]:function(){};var m=this;this.media.addEventListener("loadedmetadata",function(a){m.duration=this.duration;"loadedmetadata"in m.callbacks&&m.callbacks.loadedmetadata(a,this)},!1);for(g in this.callbacks)this.media.addEventListener(g,function(a){m.callbacks[a.type.toLowerCase()](a,this)},!1);return this}this.media=null};E.prototype.param=
function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else switch(b=String(a).replace(/-/g,"").toLowerCase(),b){case "mastervolume":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media.volume:this.volume;var e=parseFloat(c);0<=e&&1>=e&&(this.media instanceof HTMLMediaElement&&(this.media.volume=e),this.volume=e);break;case "playbackrate":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;
e=parseFloat(c);.5<=e&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=e),this.playbackRate=e);break;case "currenttime":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media.currentTime:0;e=parseFloat(c);if(this.media instanceof HTMLMediaElement)b=this.duration;else return;0<=e&&e<=b&&(this.media.currentTime=e);break;case "loop":case "muted":case "controls":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media[b]:this[b];this.media instanceof HTMLMediaElement&&
(this.media[b]=Boolean(c));this[b]=Boolean(c);break;case "width":case "height":if(void 0===c)return this.media instanceof HTMLVideoElement?this.media[b]:0;e=parseInt(c);0<=e&&this.media instanceof HTMLVideoElement&&(this.media[b]=e);break;case "duration":return this.duration;case "channels":return}return this};E.prototype.ready=function(a){a=String(a);try{-1!==a.indexOf("data:")||-1!==a.indexOf("blob:")?this.media.src=a:this.media.src=a+"."+this.ext}catch(c){throw Error("The designated resource cannot be loaded.");
}return this};E.prototype.start=function(a){this.media instanceof HTMLMediaElement&&this.media.paused&&(this.media.play(),a=parseFloat(a),this.media.currentTime=0<=a&&a<=this.duration?a:0,this.media.playbackRate=this.playbackRate,this.media.controls=this.controls,this.media.loop=this.loop,this.media.muted=this.muted);return this};E.prototype.stop=function(){this.media instanceof HTMLMediaElement&&!this.media.paused&&this.media.pause();return this};E.prototype.toggle=function(a){this.media instanceof
HTMLMediaElement&&(this.media.paused?this.start(a):this.stop());return this};E.prototype.get=function(){return this.media};E.prototype.isMedia=function(){return this.media instanceof HTMLMediaElement?!0:!1};E.prototype.isSource=function(){return this.isMedia()};E.prototype.isPaused=function(){return this.media instanceof HTMLMediaElement?this.media.paused:!0};E.prototype.fullscreen=function(){if(this.media instanceof HTMLVideoElement)if(this.media.webkitRequestFullscreen)this.media.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
else if(this.media.mozRequestFullScreen)this.media.mozRequestFullScreen();else if(this.media.requestFullscreen)this.media.requestFullscreen();else throw Error("Cannot change to full screen.");return this};E.prototype.exitFullscreen=function(){if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullscreen)document.mozCancelFullscreen();else if(document.exitFullscreen)document.exitFullscreen();else throw Error("Cannot exit from full screen.");return this};E.prototype.toString=
function(){return"[MediaFallbackModule]"};if(M){x.AudioContext=x.AudioContext||x.webkitAudioContext;var y=new AudioContext;y.createScriptProcessor=y.createScriptProcessor||y.createJavaScriptNode;y.createGain=y.createGain||y.createGainNode;y.createDelay=y.createDelay||y.createDelayNode;y.createPeriodicWave=y.createPeriodicWave||y.createWaveTable;v.prototype.setup=function(){};v.prototype.param=function(a,c){switch(String(a).replace(/-/g,"").toLowerCase()){case "mastervolume":if(void 0===c)return this.masterVolume.gain.value;
var b=parseFloat(c),e=this.masterVolume.gain.maxValue||1;b>=(this.masterVolume.gain.minValue||0)&&b<=e&&(this.masterVolume.gain.value=b)}};v.prototype.ready=function(){};v.prototype.start=function(){};v.prototype.stop=function(){};v.prototype.get=function(){};v.prototype.resize=function(a){v.call(this,y,a);return this};v.prototype.connect=function(a,c){Array.isArray(c)&&(this.modules=c);a.disconnect(0);0<this.modules.length?a.connect(this.modules[0].input):a.connect(this.masterVolume);for(var b=0,
e=this.modules.length;b<e;b++)this.modules[b].output.disconnect(0),b<this.modules.length-1?this.modules[b].output.connect(this.modules[b+1].input):this.modules[b].output.connect(this.masterVolume);this.masterVolume.connect(this.analyser.input);this.analyser.output.connect(this.context.destination);this.masterVolume.connect(this.recorder.processor);this.recorder.processor.connect(this.context.destination);this.masterVolume.connect(this.session.sender);this.session.sender.connect(this.context.destination);
return this};v.prototype.module=function(a){a=String(a).replace(/-/g,"").toLowerCase();switch(a){case "listener":case "analyser":case "recorder":case "session":case "compressor":case "distortion":case "wah":case "equalizer":case "filter":case "tremolo":case "ringmodulator":case "autopanner":case "phaser":case "flanger":case "chorus":case "delay":case "reverb":case "panner":return this[a];case "eg":if(a in this)return this[a];case "glide":if(a in this)return this[a];case "vocalcanceler":if(a in this)return this[a];
case "noisegate":if(a in this)return this[a];default:for(var c=0,b=this.plugins.length;c<b;c++)if(a===this.plugins[c].name)return this.plugins[c].plugin}};v.prototype.on=function(a){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;this.chorus.start(a);this.flanger.start(a);this.phaser.start(a);this.autopanner.start(a);this.tremolo.start(a);this.ringmodulator.start(a);this.wah.start(a);this.filter.start(a);for(var c=0,b=this.plugins.length;c<b;c++)this.plugins[c].plugin.start(a);
return this};v.prototype.off=function(a,c){var b=parseFloat(a);if(isNaN(b)||b<this.context.currentTime)b=this.context.currentTime;this.chorus.stop(b);this.flanger.stop(b);this.phaser.stop(b);this.autopanner.stop(b);this.tremolo.stop(b);this.ringmodulator.stop(b);this.wah.stop(b);if(c)for(var e=0,f=this.plugins.length;e<f;e++)this.plugins[e].plugin.stop(b);return this};v.prototype.install=function(a,c){"[object Function]"===Object.prototype.toString.call(c)&&(c.prototype=new this.Effector(y,this.BUFFER_SIZE),
this.plugins.push({name:String(a).toLowerCase(),plugin:new c(y)}));return this};v.prototype.params=function(){var a={},c;for(c in this)if("[object Function]"!==Object.prototype.toString.call(this[c])){var b=c.toLowerCase();"mastervolume"===b?a[b]=this[c].gain.value:"[object Object]"===Object.prototype.toString.call(this[c])&&"params"in this[c]&&(a[b]=this[c].params())}return a};v.prototype.toJSON=function(){return JSON.stringify(this.params())};v.prototype.toString=function(){return"[SoundModule]"};
A.prototype=Object.create(v.prototype);A.prototype.constructor=A;A.prototype.setup=function(a){function c(a,b){this.isActive=b;this.context=a;this.source=a.createOscillator();this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable;this.source.start=this.source.start||this.source.noteOn;this.source.stop=this.source.stop||this.source.noteOff;this.volume=a.createGain();this.isStop=!0;this.fine=this.octave=0;this.customs={real:new Float32Array([0,1]),imag:new Float32Array([0,
1])}}c.prototype=Object.create(K.prototype);c.prototype.constructor=c;c.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else switch(c=String(a).replace(/-/g,"").toLowerCase(),c){case "type":if(void 0===b)return this.source.type;if("[object Object]"!==Object.prototype.toString.call(b)){c=String(b).toLowerCase();var e={sine:this.source.SINE||0,square:this.source.SQUARE||1,sawtooth:this.source.SAWTOOTH||2,triangle:this.source.TRIANGLE||
3};c in e&&(this.source.type="[object String]"===Object.prototype.toString.call(this.source.type)?c:e[c])}else if("real"in b&&"imag"in b&&(e=c=null,b.real instanceof Float32Array?c=b.real:Array.isArray(b.real)&&(c=new Float32Array(b.real)),b.imag instanceof Float32Array?e=b.imag:Array.isArray(b.imag)&&(e=new Float32Array(b.imag)),c instanceof Float32Array&&e instanceof Float32Array)){4096<c.length&&(c=c.subarray(0,4096));4096<e.length&&(e=e.subarray(0,4096));0!==c[0]&&(c[0]=0);0!==e[0]&&(e[0]=0);
var r=this.context.createPeriodicWave(c,e);this.source.setPeriodicWave(r);this.customs.real=c;this.customs.imag=e}break;case "octave":if(void 0===b)return this.octave;c=this.octave=parseFloat(b);e=(this.source.detune.minValue||-4800)/1200;r=(this.source.detune.maxValue||4800)/1200;c>=e&&c<=r&&(this.source.detune.value=this.fine+1200*c);break;case "fine":if(void 0===b)return this.fine;c=this.fine=parseFloat(b);-1200<=c&&1200>=c&&(this.source.detune.value=c+1200*this.octave);break;case "volume":case "gain":if(void 0===
b)return this.volume.gain.value;c=parseFloat(b);e=this.volume.gain.minValue||0;r=this.volume.gain.maxValue||1;c>=e&&c<=r&&(this.volume.gain.value=c)}return this};c.prototype.start=function(a,b){if(this.isActive){var c=this.source.type,e=this.source.frequency.value,r=this.source.detune.value;this.isStop||(this.source.stop(this.context.currentTime),this.source.disconnect(0));this.source=this.context.createOscillator();this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable;
this.source.start=this.source.start||this.source.noteOn;this.source.stop=this.source.stop||this.source.noteOff;"custom"===c?(c=this.context.createPeriodicWave(this.customs.real,this.customs.imag),this.source.setPeriodicWave(c)):this.source.type=c;this.source.frequency.value=e;this.source.detune.value=r;this.volume.connect(a);this.source.start(b);this.isStop=!1}else this.isStop||(this.source.stop(this.context.currentTime),this.isStop=!0),this.source.disconnect(0);return this};c.prototype.stop=function(a){this.isStop||
(this.source.stop(a),this.source.disconnect(0),this.isStop=!0);return this};c.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);return this};c.prototype.toString=function(){return"[OscillatorModule Oscillator]"};Array.isArray(a)||(a=[a]);for(var b=0,e=a.length;b<e;b++)this.sources[b]=new c(this.context,Boolean(a[b])),this.eg.generators[b]=this.context.createGain(),this.eg.generators[b].gain.setTargetAtTime=
this.eg.generators[b].gain.setTargetAtTime||this.eg.generators[b].gain.setTargetValueAtTime;return this};A.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var e=v.prototype.param.call(this,b,c)}return void 0===e?this:e};A.prototype.ready=function(a,c){var b=parseFloat(a),e=parseFloat(c);this.times.start=0<=b?b:0;this.times.stop=e>=b?e:0;return this};A.prototype.start=function(a,
c,b){var e=this.context.currentTime+this.times.start;Array.isArray(a)||(a=[a]);for(var f=0,h=a.length;f<h;f++){var g=parseFloat(a[f]);a[f]=0<=g?g:0}this.eg.clear();this.processor.disconnect(0);this.processor.onaudioprocess=null;this.connect(this.processor,c);f=0;for(h=a.length;f<h&&!(f>=this.sources.length);f++)c=this.sources[f],g=a[f],c.start(this.processor,e),this.eg.ready(f,c.source,c.volume),this.glide.ready(g).start(c.source,e);this.eg.start(e);this.on(e);this.isAnalyser||(this.analyser.start("time"),
this.analyser.start("fft"),this.isAnalyser=!0);a=this.times.stop-this.times.start;if(0<a){var m=this;x.setTimeout(function(){m.stop(b)},1E3*a)}"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);e.set(b);a.set(c)};return this};A.prototype.stop=function(a){var c=this.context.currentTime+
this.times.stop;this.eg.stop(c);this.glide.stop();this.filter.stop(c);for(var b=0,e=this.plugins.length;b<e;b++)this.plugins[b].plugin.stop(c,this.eg.release);var f=this;"[object Function]"===Object.prototype.toString.call(a)?this.processor.onaudioprocess=a:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);e.set(b);a.set(c);if(f.eg.isStop()){b=f.context.currentTime;
c=0;for(e=f.sources.length;c<e;c++)f.sources[c].stop(b);f.off(b);f.analyser.stop("time");f.analyser.stop("fft");f.isAnalyser=!1;this.disconnect(0);this.onaudioprocess=null}};return this};A.prototype.get=function(a){a=parseInt(a);if(0<=a&&a<this.sources.length)return this.sources[a].source;a=Array(this.sources.length);for(var c=0,b=this.sources.length;c<b;c++)a[c]=this.sources[c].source;return a};A.prototype.length=function(){return this.sources.length};A.prototype.params=function(){var a=v.prototype.params.call(this);
a.oscillator={glide:{type:this.glide.type,time:this.glide.time}};for(var c=0,b=this.sources.length;c<b;c++){var e=this.sources[c];a.oscillator["oscillator"+c]={state:e.isActive,gain:e.volume.gain.value,type:e.source.type,octave:e.octave,fine:e.fine}}return a};A.prototype.toString=function(){return"[OscillatorModule]"};D.prototype=Object.create(v.prototype);D.prototype.constructor=D;D.prototype.setup=function(a,c,b,e,f,h){if("[object Object]"===Object.prototype.toString.call(a)){var g=a;"resources"in
g&&(a=g.resources);"settings"in g&&(c=g.settings);"timeout"in g&&(b=g.timeout);"success"in g&&(e=g.success);"error"in g&&(f=g.error);"progress"in g&&(h=g.progress)}Array.isArray(a)||(a=[a]);this.resources=a;Array.isArray(c)||(c=[c]);this.buffers.length=a.length;a=0;for(g=c.length;a<g;a++){if("buffer"in c[a])if(g=parseInt(c[a].buffer),0<=g&&g<this.buffers.length)c[a].buffer=g;else return;else return;c[a].rate="rate"in c[a]&&0<=c[a].rate?parseFloat(c[a].rate):1;c[a].loop="loop"in c[a]?Boolean(c[a].loop):
!1;c[a].start="start"in c[a]&&0<=c[a].start?parseFloat(c[a].start):0;c[a].end="end"in c[a]&&0<=c[a].end?parseFloat(c[a].end):0;c[a].volume="volume"in c[a]&&0<=c[a].volume&&1>=c[a].volume?parseFloat(c[a].volume):1;a=0;for(g=c.length;a<g;a++)this.isStops[a]=!0,this.volumes[a]=this.context.createGain(),this.eg.generators[a]=this.context.createGain(),this.eg.generators[a].gain.setTargetAtTime=this.eg.generators[a].gain.setTargetAtTime||this.eg.generators[a].gain.setTargetValueAtTime;this.settings=c}var m=
!1,r=parseInt(b),n=this;c=function(a,b){var c=new XMLHttpRequest;c.timeout=0<r?r:6E4;c.ontimeout=function(a){m||"[object Function]"!==Object.prototype.toString.call(f)||f(a,"timeout");m=!0};c.onprogress=function(a){m?c.abort():"[object Function]"===Object.prototype.toString.call(h)&&h(a)};c.onerror=function(a){m||"[object Function]"!==Object.prototype.toString.call(f)||f(a,"error");m=!0};c.onload=function(a){200===c.status&&function(c){c instanceof ArrayBuffer&&n.context.decodeAudioData(c,function(c){n.buffers[b]=
c;c=0;for(var f=n.buffers.length;c<f;c++)if(void 0===n.buffers[c])return;"[object Function]"===Object.prototype.toString.call(e)&&e.call(n,a,n.buffers)},function(a){"[object Function]"===Object.prototype.toString.call(f)&&f(a,"decode")})}.call(n,c.response)};c.open("GET",a,!0);c.responseType="arraybuffer";c.send(null)};a=0;for(g=this.resources.length;a<g;a++)"[object String]"===Object.prototype.toString.call(this.resources[a])?c.call(this,this.resources[a],a):this.resources[a]instanceof AudioBuffer&&
(this.buffers[a]=this.resources[a]);return this};D.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var e=v.prototype.param.call(this,b,c);if(void 0!==e)return e;switch(b){case "transpose":if(void 0===c)return this.transpose;b=parseFloat(c);0<b&&(this.transpose=b)}}return this};D.prototype.ready=function(a,c){var b=parseFloat(a),e=parseFloat(c);this.times.start=0<=b?b:0;this.times.stop=
e>=b?e:0;return this};D.prototype.start=function(a,c,b){if(0<=a&&a<this.settings.length){var e=parseInt(a),f=this.settings[e].buffer,h=this.settings[e].rate,g=this.settings[e].loop,m=this.settings[e].start,r=this.settings[e].end,n=this.settings[e].volume;if(void 0!==this.buffers[f]){void 0!==this.sources[e]&&(this.sources[e].stop(this.context.currentTime),this.sources[e].disconnect(0),delete this.sources[e]);a=this.context.createBufferSource();a.start=a.start||a.noteGrainOn;a.stop=a.stop||a.noteOff;
a.buffer=this.buffers[f];a.playbackRate.value=h*this.transpose;a.loop=g;a.loopStart=m;a.loopEnd=r;this.volumes[e].gain.value=n;this.eg.ready(e,a,this.volumes[e]);this.volumes[e].connect(this.processor);this.connect(this.processor,c);c=this.context.currentTime+this.times.start;a.start(c);this.sources[e]=a;this.eg.start(c);this.on(c);this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);this.isStops[e]=!1;var p=this;c=this.times.stop-this.times.start;0<c&&x.setTimeout(function(){p.stop(e)},
1E3*c);a.onended=function(){p.isStops[e]=!0};"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){p.isStop=p.isStops.every(function(a,b,c){return a});if(p.isStop)p.on(p.context.currentTime),p.eg.clear(),p.analyser.stop("time"),p.analyser.stop("fft"),p.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null;else{var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=
a.outputBuffer.getChannelData(1);e.set(b);a.set(c)}};return this}}};D.prototype.stop=function(a){if(0<=a&&a<this.settings.length&&(a=parseInt(a),void 0!==this.buffers[this.settings[a].buffer]&&void 0!==this.sources[a])){a=this.context.currentTime+this.times.stop;this.eg.stop(a);this.filter.stop(a);for(var c=0,b=this.plugins.length;c<b;c++)this.plugins[c].plugin.stop(a,this.eg.release);return this}};D.prototype.get=function(a){a=parseInt(a);return 0<=a&&a<this.buffers.length?this.buffers[a]:this.buffers};
D.prototype.params=function(){var a=v.prototype.params.call(this);a.oneshot={transpose:this.transpose};return a};D.prototype.toString=function(){return"[OneshotModule]"};z.prototype=Object.create(v.prototype);z.prototype.constructor=z;z.prototype.setup=function(a,c){if(0<arguments.length&&"[object Object]"===Object.prototype.toString.call(arguments[0]))for(var b in arguments[0])this.setup(b,arguments[0][b]);else 1<arguments.length&&(b=String(a).replace(/-/g,"").toLowerCase(),b in this.callbacks&&
"[object Function]"===Object.prototype.toString.call(c)&&(this.callbacks[b]=c));return this};z.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var e=v.prototype.param.call(this,b,c);if(void 0!==e)return e;switch(b){case "playbackrate":if(void 0===c)return this.source.playbackRate.value;b=parseFloat(c);var e=this.source.playbackRate.minValue||0,f=this.source.playbackRate.maxValue||
1024;b>=e&&b<=f&&(this.source.playbackRate.value=b);break;case "loop":case "looping":if(void 0===c)return this.source.loop;this.source.loop=Boolean(c);break;case "currenttime":if(void 0===c)return this.currentTime;b=parseFloat(c);if(this.buffer instanceof AudioBuffer)f=this.buffer.duration;else{this.currentTime=0;break}0<=b&&b<=f&&(this.paused?(this.stop(),this.currentTime=b):(this.stop(),this.start(b)));break;case "duration":return this.buffer instanceof AudioBuffer?this.buffer.duration:0;case "samplerate":return this.buffer instanceof
AudioBuffer?this.buffer.sampleRate:this.SAMPLE_RATE;case "channels":return this.buffer instanceof AudioBuffer?this.buffer.numberOfChannels:0}}return this};z.prototype.ready=function(a){a instanceof ArrayBuffer&&(this.context.decodeAudioData(a,function(a){this.buffer=a;this.analyser.start("time-all-L",a);this.analyser.start("time-all-R",a);this.callbacks.ready(a)}.bind(this),this.callbacks.error.bind(this)),this.callbacks.decode(a));return this};z.prototype.start=function(a,c,b){if(this.buffer instanceof
AudioBuffer&&this.paused){var e=this.context.currentTime;a=parseFloat(a);this.currentTime=0<=a&&a<=this.buffer.duration?a:0;var f=this.source.playbackRate.value,h=this.source.loop;this.source=this.context.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.buffer=this.buffer;this.source.playbackRate.value=f;this.source.loop=h;this.source.connect(this.processor);this.connect(this.processor,c);this.source.start(e,
a,this.buffer.duration-a);this.analyser.start("time");this.analyser.start("fft");this.paused=!1;this.on(e);this.callbacks.start(this.source,this.currentTime);var g=this;"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);if(g.currentTime<Math.floor(g.source.buffer.duration)){for(var f=
0;f<this.bufferSize;f++)e[f]=g.vocalcanceler.start(b[f],c[f]),a[f]=g.vocalcanceler.start(c[f],b[f]),g.currentTime+=1*g.source.playbackRate.value/g.source.buffer.sampleRate,0===Math.floor(g.currentTime*g.source.buffer.sampleRate)%(.1*g.source.buffer.sampleRate)&&g.callbacks.update(g.source,g.currentTime);g.analyser.timeAllL.update(g.currentTime);g.analyser.timeAllR.update(g.currentTime)}else g.source.loop?g.currentTime=0:g.end.call(g)}}return this};z.prototype.stop=function(){if(this.buffer instanceof
AudioBuffer&&!this.paused){var a=this.context.currentTime;this.source.stop(a);this.off(a,!0);this.analyser.stop("time");this.analyser.stop("fft");this.processor.disconnect(0);this.processor.onaudioprocess=null;this.paused=!0;this.callbacks.stop(this.source,this.currentTime)}return this};z.prototype.get=function(){return this.source};z.prototype.toggle=function(a,c,b){this.paused?this.start(a,c,b):this.stop();return this};z.prototype.end=function(){this.stop();this.currentTime=0;this.callbacks.ended(this.source,
this.currentTime);return this};z.prototype.isBuffer=function(){return this.buffer instanceof AudioBuffer?!0:!1};z.prototype.isSource=function(){return this.source instanceof AudioBufferSourceNode&&this.source.buffer instanceof AudioBuffer?!0:!1};z.prototype.isPaused=function(){return this.paused};z.prototype.params=function(){var a=v.prototype.params.call(this);a.audio={playbackrate:this.source.playbackRate.value,vocalcanceler:{depth:this.vocalcanceler.depth}};return a};z.prototype.toString=function(){return"[AudioModule]"};
B.prototype=Object.create(z.prototype);B.prototype.constructor=B;B.prototype.setup=function(a,c,b,e){if("[object Object]"===Object.prototype.toString.call(a)){var f=a;"id"in f&&(a=f.id);"type"in f&&(c=f.type);"formats"in f&&(b=f.formats);"callbacks"in f&&(e=f.callbacks)}f=String(a);c="video"!==String(c).toLowerCase()?"audio":"video";this.media=null!==a&&""!==f?document.getElementById(f):document.createElement(c);if(this.media instanceof HTMLMediaElement){Array.isArray(b)||(b=[b]);a=0;for(f=b.length;a<
f;a++){var h=c+"/"+String(b[a]).toLowerCase();if(/^(?:maybe|probably)/.test(this.media.canPlayType(h))){this.ext=b[a];break}}if(""===this.ext)throw Error("Media format that can be played does not exist.");if("[object Object]"===Object.prototype.toString.call(e))for(var g in e)this.callbacks[g.toLowerCase()]="[object Function]"===Object.prototype.toString.call(e[g])?e[g]:function(){};var m=this;this.media.addEventListener("loadstart",function(a){m.source instanceof MediaElementAudioSourceNode||(m.source=
m.context.createMediaElementSource(this));"loadstart"in m.callbacks&&m.callbacks.loadstart(a,this)},!1);this.media.addEventListener("loadedmetadata",function(a){m.duration=this.duration;"loadedmetadata"in m.callbacks&&m.callbacks.loadedmetadata(a,this)},!1);this.media.addEventListener("ended",function(a){this.pause();m.off(m.context.currentTime);m.analyser.stop("time");m.analyser.stop("fft");m.processor.disconnect(0);m.processor.onaudioprocess=null;"ended"in m.callbacks&&m.callbacks.ended(a,this)},
!1);for(g in this.callbacks)this.media.addEventListener(g,function(a){m.callbacks[a.type.toLowerCase()](a,this)},!1);return this}this.media=null};B.prototype.param=function(a,c){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var e=v.prototype.param.call(this,b,c);if(void 0!==e)return e;switch(b){case "playbackrate":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;
e=parseFloat(c);.5<=e&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=e),this.playbackRate=e);break;case "currenttime":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media.currentTime:0;e=parseFloat(c);if(this.media instanceof HTMLMediaElement)b=this.duration;else return;0<=e&&e<=b&&(this.media.currentTime=e);break;case "loop":case "muted":case "controls":if(void 0===c)return this.media instanceof HTMLMediaElement?this.media[b]:this[b];this.media instanceof HTMLMediaElement&&
(this.media[b]=Boolean(c));this[b]=Boolean(c);break;case "width":case "height":if(void 0===c)return this.media instanceof HTMLVideoElement?this.media[b]:0;e=parseInt(c);0<=e&&this.media instanceof HTMLVideoElement&&(this.media[b]=e);break;case "duration":return this.duration;case "channels":return this.source instanceof MediaElementAudioSourceNode?this.source.channelCount:0}}return this};B.prototype.ready=function(a){a=String(a);try{-1!==a.indexOf("data:")||-1!==a.indexOf("blob:")?this.media.src=
a:this.media.src=a+"."+this.ext}catch(c){throw Error("The designated resource cannot be loaded.");}return this};B.prototype.start=function(a,c,b){if(this.source instanceof MediaElementAudioSourceNode&&this.media.paused){this.source.connect(this.processor);this.connect(this.processor,c);this.media.play();a=parseFloat(a);this.media.currentTime=0<=a&&a<=this.duration?a:0;this.media.playbackRate=this.playbackRate;this.media.controls=this.controls;this.media.loop=this.loop;this.media.muted=this.muted;
this.on(this.context.currentTime);this.analyser.start("time");this.analyser.start("fft");var e=this;"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),m=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);for(var r=0;r<this.bufferSize;r++)m[r]=e.vocalcanceler.start(b[r],c[r]),a[r]=e.vocalcanceler.start(c[r],b[r])}}return this};B.prototype.stop=
function(){this.source instanceof MediaElementAudioSourceNode&&!this.media.paused&&(this.media.pause(),this.off(this.context.currentTime,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null);return this};B.prototype.get=function(){return this.media};B.prototype.toggle=function(a,c,b){this.media instanceof HTMLMediaElement&&(this.media.paused?this.start(a,c,b):this.stop());return this};B.prototype.isMedia=function(){return this.media instanceof
HTMLMediaElement?!0:!1};B.prototype.isSource=function(){return this.source instanceof MediaElementAudioSourceNode?!0:!1};B.prototype.isPaused=function(){return this.media instanceof HTMLMediaElement?this.media.paused:!0};B.prototype.fullscreen=function(){if(this.media instanceof HTMLVideoElement)if(this.media.webkitRequestFullscreen)this.media.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(this.media.mozRequestFullScreen)this.media.mozRequestFullScreen();else if(this.media.requestFullscreen)this.media.requestFullscreen();
else throw Error("Cannot change to full screen.");return this};B.prototype.exitFullscreen=function(){if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullscreen)document.mozCancelFullscreen();else if(document.exitFullscreen)document.exitFullscreen();else throw Error("Cannot exit from full screen.");return this};B.prototype.params=function(){var a=v.prototype.params.call(this);a.media={playbackrate:this.playbackRate,vocalcanceler:{depth:this.vocalcanceler.depth}};
return a};B.prototype.toString=function(){return"[MediaModule]"};F.prototype=Object.create(v.prototype);F.prototype.constructor=F;F.prototype.setup=function(a,c,b){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;Boolean(a)&&(this.medias.video=!0);"[object Function]"===Object.prototype.toString.call(c)&&(this.callbacks.stream=c);"[object Function]"===Object.prototype.toString.call(b)&&(this.callbacks.error=b);return this};F.prototype.param=function(a,c){if("[object Object]"===
Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var e=v.prototype.param.call(this,b,c)}return void 0===e?this:e};F.prototype.ready=function(){return this};F.prototype.start=function(a,c){if(void 0===navigator.getUserMedia)throw Error("Cannot use WebRTC.");var b=!1,e=this,f=function(a,c,f){this.source=this.context.createMediaStreamSource(a);this.source.connect(this.processor);this.connect(this.processor,c);this.on(this.context.currentTime);
b||(this.analyser.start("time"),this.analyser.start("fft"),b=!0);"[object Function]"===Object.prototype.toString.call(f)?this.processor.onaudioprocess=f:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1),f=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);for(var g=0;g<this.bufferSize;g++)f[g]=e.noisegate.start(b[g]),a[g]=e.noisegate.start(c[g])}};this.isStop=!1;navigator.getUserMedia(this.medias,function(b){e.isStop||
(f.call(e,b,a,c),e.callbacks.stream(b))},function(a){e.callbacks.error(a)});return this};F.prototype.stop=function(){this.source=null;this.off(this.context.currentTime,!0);this.analyser.stop("time");this.analyser.stop("fft");this.processor.disconnect(0);this.processor.onaudioprocess=null;this.isStop=!0;return this};F.prototype.get=function(){return this.source};F.prototype.toggle=function(a,c){this.isStreaming()?this.stop():this.start(a,c);return this};F.prototype.isStreaming=function(){return this.isStop?
!1:!0};F.prototype.params=function(){var a=v.prototype.params.call(this);a.stream={noisegate:{level:this.noisegate.level}};return a};F.prototype.toString=function(){return"[StreamModule]"};H.prototype=Object.create(v.prototype);H.prototype.constructor=H;H.prototype.mix=function(a){Array.isArray(a)||(a=[a]);this.sources=a;for(var c=0,b=this.sources.length;c<b;c++){var e=this.sources[c];if(!(e instanceof A||e instanceof D||e instanceof z||e instanceof B||e instanceof F))return;this.off(this.context.currentTime,
!1);e.analyser.stop("time");e.analyser.stop("fft");e.isAnalyser=!1;e.recorder.stop();e.session.close();e.processor.disconnect(0);e.processor.connect(this.processor)}this.connect(this.processor);this.on(this.context.currentTime);this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);var f=this;this.processor.onaudioprocess=function(b){var c=b.inputBuffer.getChannelData(0),e=b.inputBuffer.getChannelData(1),r=b.outputBuffer.getChannelData(0);b=b.outputBuffer.getChannelData(1);
for(var n=!1,p=0;10>p;p++){var t=a[p];t instanceof A&&t.eg.isStop()?n=!0:t instanceof D&&t.isStop?n=!0:t instanceof z&&t.paused?n=!0:t instanceof B&&t.media.paused?n=!0:t instanceof F&&t.isStop&&(n=!0)}n?(f.stop(f.context.currentTime,!0),f.analyser.stop("time"),f.analyser.stop("fft"),f.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null):(r.set(c),b.set(e))};return this};H.prototype.get=function(a){a=parseInt(a);return 0<=a&&a<this.sources.length?this.sources[a]:this.sources};H.prototype.toString=
function(){return"[MixerModule]"};t.ONE_MINUTES=60;t.EQUAL_TEMPERAMENT=12;t.QUARTER_NOTE=4;t.REGEXP_MML=/\s*(?:T\d+)\s*|\s*(?:O\d+)\s*|\s*(?:(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*\s*/gi;t.REGEXP_TEMPO=/T\d+/i;t.REGEXP_OCTAVE=/O\d+/i;t.REGEXP_NOTE=/(?:(?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*/i;
t.REGEXP_CHORD=/((?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*/i;t.REGEXP_DURATION=/(?:[CDEFGABR][#+-]?)+((?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*)/i;t.ERROR_MML_STRING="MML";t.ERROR_MML_TEMPO="TEMPO";t.ERROR_MML_OCTAVE="OCTAVE";t.ERROR_MML_NOTE="NOTE";t.prototype.setup=function(a,c){if(0<arguments.length&&"[object Object]"===Object.prototype.toString.call(arguments[0]))for(var b in arguments[0])this.setup(b,arguments[0][b]);else 1<
arguments.length&&(b=String(a).toLowerCase(),b in this.callbacks&&"[object Function]"===Object.prototype.toString.call(c)&&(this.callbacks[b]=c));return this};t.prototype.ready=function(a,c){null!==this.source&&this.stop();this.sequences=[];this.timerids=[];this.prev=[];if(Array.isArray(a)){for(var b=0,e=a.length;b<e;b++)if(!(a[b]instanceof OscillatorNode))return;this.source=a}else if(a instanceof OscillatorNode)this.source=[a];else if(a instanceof A||a instanceof D)this.source=a;else return;for(Array.isArray(c)||
(c=[c]);0<c.length;){var f=[],h=String(c.shift()).match(t.REGEXP_MML);if(null===h){this.callbacks.error(t.ERROR_MML_STRING,"");return}for(var g=0,m=function(a,b){var c=0;switch(b){case "C":c=3;break;case "D":c=5;break;case "E":c=7;break;case "F":c=8;break;case "G":c=10;break;case "A":c=12;break;case "B":c=14;break;case "R":return"R"}c=t.EQUAL_TEMPERAMENT*(a-1)+c;return 0<=c?c:-1},r=function(a){var b=Math.pow(2,1/12);return 0<=a?27.5*Math.pow(b,a):-1};0<h.length;){var n=h.shift().trim();if(t.REGEXP_TEMPO.test(n)){var p=
parseInt(n.slice(1));if(0<p)p=t.ONE_MINUTES/p;else{this.callbacks.error(t.ERROR_MML_TEMPO,n);return}}else if(t.REGEXP_OCTAVE.test(n)){var w=parseInt(n.slice(1));if(0>w){this.callbacks.error(t.ERROR_MML_OCTAVE,n);return}}else if(t.REGEXP_NOTE.test(n)){if(void 0===p){this.callbacks.error(t.ERROR_MML_TEMPO,n);return}if(void 0===w){this.callbacks.error(t.ERROR_MML_OCTAVE,n);return}for(var v=n.match(t.REGEXP_CHORD)[1],y=[],b=0,e=v.length;b<e;b++){var x=v.charAt(b),x=m.call(this,w,x.toUpperCase());switch(v.charAt(b+
1)){case "#":case "+":x++;b++;break;case "-":x--,b++}x>=y[0]&&(x-=t.EQUAL_TEMPERAMENT);if(0>x){this.callbacks.error(t.ERROR_MML_NOTE,n);return}y.push(x)}v=[];b=0;for(e=y.length;b<e;b++){x="R"!==y[b]?r.call(this,y[b],n):0;if(-1===x){this.callbacks.error(t.ERROR_MML_NOTE,n);return}v.push(x)}e=n.split("&");for(b=0;0<e.length;)switch(x=e.shift().match(t.REGEXP_DURATION)[1],parseInt(x)){case 1:case 2:case 4:case 8:case 16:case 32:case 64:case 128:case 256:var z=t.QUARTER_NOTE/parseInt(x),b=b+(-1!==x.indexOf(".")?
1.5*z*p:z*p);break;case 6:b+=2*p/3;break;case 12:b+=p/3;break;case 18:b+=2*p/9;break;case 24:b+=.5*p/3;break;case 36:b+=p/9;break;case 48:b+=.25*p/3;break;case 72:b+=.5*p/9;break;case 96:b+=.125*p/3;break;case 144:b+=.25*p/9;break;case 192:b+=.0625*p/3;break;default:this.callbacks.error(t.ERROR_MML_NOTE,n)}n=g;e=n+b;g+=b;f.push({indexes:y,frequencies:v,start:n,duration:b,stop:e})}}0<f.length&&(f.reverse(),this.sequences.push(f),this.timerids.push(null))}return this.sequences};t.prototype.start=function(a,
c,b){var e=parseInt(a);if(0<=e&&e<this.sequences.length){if(!Array.isArray(this.sequences[e]))return this;if(0===this.sequences[e].length)return this.stop(b),this.callbacks.ended(),this;var f=this.sequences[e].pop();if(Array.isArray(this.source)){a=0;for(var h=this.source.length;a<h;a++){var g=this.source[a],m=g.type,r=g.detune.value,g=this.context.createOscillator();g.start=g.start||g.noteOn;g.stop=g.stop||g.noteOff;g.type=m;g.frequency.value=f.frequencies[a];g.detune.value=r;if(Array.isArray(c))for(g.connect(c[0]),
a=0,h=c.length;a<h;a++)if(m=c[a],a<h-1){r=c[a+1];if(!(m instanceof AudioNode&&r instanceof AudioNode))return;m.connect(r)}else m.connect(this.context.destination);else g.connect(this.context.destination);g.start(this.context.currentTime);g.stop(this.context.currentTime+f.duration);this.source[a]=g}a=0;for(h=f.indexes.length;a<h;a++)"R"!==f.indexes[a]&&this.callbacks.start(f,a)}else if(this.source instanceof A)for(this.source.start(f.frequencies,c,b),a=0,h=f.indexes.length;a<h;a++)"R"!==f.indexes[a]&&
this.callbacks.start(f,a);else if(this.source instanceof D)for(a=0,h=f.indexes.length;a<h;a++)"R"!==f.indexes[a]&&(this.source.start(f.indexes[a],c,b),this.callbacks.start(f,a));var n=this;this.timerids[e]=x.setTimeout(function(){if(Array.isArray(n.source))for(var a=0,g=f.indexes.length;a<g;a++)"R"!==f.indexes[a]&&n.callbacks.stop(f,a);else if(n.source instanceof A)for(n.source.stop(f.frequencies,b),a=0,g=f.indexes.length;a<g;a++)"R"!==f.indexes[a]&&n.callbacks.stop(f,a);else if(n.source instanceof
D)for(a=0,g=f.indexes.length;a<g;a++)"R"!==f.indexes[a]&&(n.source.stop(f.indexes[a],b),n.callbacks.stop(f,a));n.prev=f;n.start(e,c,b);f=null},1E3*f.duration)}return this};t.prototype.stop=function(a){var c=this.prev;if(0===c.length)return this;if(Array.isArray(this.source))for(var b=0,e=c.indexes.length;b<e;b++)"R"!==c.indexes[b]&&this.callbacks.stop(c,b);else if(this.source instanceof A)for(this.source.stop(c.frequencies,a),b=0,e=c.indexes.length;b<e;b++)"R"!==c.indexes[b]&&this.callbacks.stop(c,
b);else if(this.source instanceof D)for(b=0,e=c.indexes.length;b<e;b++)"R"!==c.indexes[b]&&(this.source.stop(c.indexes[b],a),this.callbacks.stop(c,b));b=0;for(e=this.timerids.length;b<e;b++)x.clearTimeout(this.timerids[b]),this.timerids[b]=null;return this};t.prototype.get=function(a){a=parseInt(a);return 0<=a&&a<this.sequences.length?this.sequences[a]:this.sequences};t.prototype.toggle=function(a,c,b){this.isPaused()?this.start(a,c,b):this.stop();return this};t.prototype.isSequences=function(){return Array.isArray(this.sequences[0])?
!0:!1};t.prototype.isPaused=function(){for(var a=0,c=this.timerids.length;a<c;a++){var b=this.timerids[a];if(null!==b&&void 0!==b)return!1}return!0};t.prototype.download=function(a){return"data:text/plain;base64,"+x.btoa(function(a){for(var b="",e=0,f=a.length;e<f;e++)var h=a.charCodeAt(e),b=255<h?b+("&#"+h+";"):b+a.charAt(e);return b}(String(a)))};t.prototype.toString=function(){return"[MML]"};var L=new v(y),I={oscillator:new A(y),oneshot:new D(y),audio:new z(y),media:new B(y),fallback:new E,stream:new F(y),
mixer:new H(y),mml:new t(y)},J={oscillator:new A(y),oneshot:new D(y),audio:new z(y),media:new B(y),fallback:new E,stream:new F(y),mixer:new H(y),mml:new t(y)};w=function(a,c){var b=String(a).replace(/-/g,"").toLowerCase();switch(b){case "oscillator":if(void 0===c)return I.oscillator;b=parseInt(c);if(0<=b&&b<I.oscillator.sources.length)return I.oscillator.sources[b];break;case "oneshot":case "audio":case "media":case "fallback":case "stream":case "mixer":case "mml":return I[b]}};w.IS_XSOUND=M;w.SAMPLE_RATE=
L.SAMPLE_RATE;w.BUFFER_SIZE=L.BUFFER_SIZE;w.NUM_INPUT=L.NUM_INPUT;w.NUM_OUTPUT=L.NUM_OUTPUT;w.read=N;w.file=O;w.ajax=P;w.decode=Q;w.toFrequencies=R;w.convertTime=S;w.noConflict=T;w.clone=function(){return function(a,c){var b=String(a).replace(/-/g,"").toLowerCase();switch(b){case "oscillator":if(void 0===c)return J.oscillator;b=parseInt(c);if(0<=b&&b<J.oscillator.sources.length)return J.oscillator.sources[b];break;case "oneshot":case "audio":case "media":case "fallback":case "stream":case "mixer":case "mml":return J[b]}}};
w.free=function(a){Array.isArray(a)||(a=[a]);for(var c=0,b=a.length;c<b;c++){var e=a[c];if(null!==e){for(var f in I)e===I[f]&&(I[f]=null);for(f in J)e===J[f]&&(J[f]=null)}}};w.get=function(){return y};w.getCurrentTime=function(){return y.currentTime};w.toString=function(){return"[XSound]"};x.XSound=w;x.X=w;L=null}else{var U=new E;w=function(){return U};w.IS_XSOUND=M;w.SAMPLE_RATE=null;w.BUFFER_SIZE=null;w.NUM_INPUT=null;w.NUM_OUTPUT=null;w.read=N;w.file=O;w.ajax=P;w.decode=Q;w.toFrequencies=R;w.convertTime=
S;w.noConflict=T;w.get=function(){return null};w.getCurrentTime=function(){return 0};w.clone=function(){var a=new E;return function(){return a}};w.toString=function(){return"[XSound]"};x.XSound=w;x.X=w}})(window);