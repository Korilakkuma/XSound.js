/** 
 * xsound.min.js
 * @fileoverview Web Audio API Library
 *
 * Copyright 2012, 2013, 2014@Tomohiro IKEDA
 * Released under the MIT license
 */
(function(u){function L(){}function E(){this.media=null;this.ext="";this.duration=0;this.playbackRate=this.volume=1;this.muted=this.loop=this.controls=!1;this.callbacks={}}function x(a,d){function b(a){this.listener=a.listener;this.dopplerFactor=1;this.speedOfSound=343.3;this.positions={x:0,y:0,z:0};this.fronts={x:0,y:0,z:-1};this.ups={x:0,y:1,z:0};this.velocities={x:0,y:0,z:0};this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z);this.listener.setOrientation(this.fronts.x,
this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z);this.listener.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z)}function f(a){function t(a){this.isActive=!1;this.SAMPLE_RATE=a;this.drawType="";this.svgParent=this.svg=this.context=this.canvas=null;this.interval=1E3;this.timerid=null;this.styles={shape:"line",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],wave:"rgba(0, 0, 255, 1.0)",grid:"rgba(255, 0, 0, 1.0)",text:"rgba(255, 255, 255, 1.0)",
font:"13px Arial",width:1.5,cap:"round",join:"miter",top:15,right:15,bottom:15,left:15}}function g(a){t.call(this,a);this.savedImage=null;this.length=0;this.currentTime="rgba(255, 255, 255, 1.0)";this.plotinterval=.0625;this.textinterval=60}function c(a){t.call(this,a);this.textinterval=.005}function b(a){t.call(this,a);this.type="uint";this.size=256;this.textinterval=1E3}u.requestAnimationFrame=u.requestAnimationFrame||u.webkitRequestAnimationFrame||u.mozRequestAnimationFrame||function(a){u.setTimeout(a,
1E3/60)};u.cancelAnimationFrame=u.cancelAnimationFrame||u.webkitCancelAnimationFrame||u.mozCancelAnimationFrame||u.clearTimeout;this.analyser=a.createAnalyser();this.input=a.createGain();this.output=a.createGain();this.input.connect(this.analyser);this.analyser.connect(this.output);t.prototype=Object.create(L.prototype);t.prototype.constructor=t;g.prototype=Object.create(t.prototype);c.prototype=Object.create(t.prototype);b.prototype=Object.create(t.prototype);g.prototype.constructor=g;c.prototype.constructor=
c;b.prototype.constructor=b;this.timeAllL=new g(a.sampleRate);this.timeAllR=new g(a.sampleRate);this.time=new c(a.sampleRate);this.fft=new b(a.sampleRate);this.analyser.fftSize=2048;this.analyser.minDecibels=-100;this.analyser.maxDecibels=-30;this.analyser.smoothingTimeConstant=.8;t.prototype.setup=function(a,l,c){switch(String(a).toLowerCase()){case "canvas":this.drawType="canvas";this.canvas=document.getElementById(String(l));this.canvas instanceof HTMLCanvasElement&&(this.context=this.canvas.getContext("2d"));
break;case "svg":this.drawType="svg",this.svg=document.getElementById(String(l)),this.svg instanceof SVGElement&&(this.svgParent=document.getElementById(String(c)))}return this};t.prototype.param=function(a,l){var c=String(a).replace(/-/g,"").toLowerCase();switch(c){case "interval":if(void 0===l)return this.interval;if("auto"===String(l).toLowerCase())this.interval="auto";else{var g=parseFloat(l);0<=g&&(this.interval=g)}break;case "shape":if(void 0===l)return this.styles.shape;g=String(l).toLowerCase();
if("line"===g||"rect"===g)this.styles.shape="gradient"!==this.styles.wave?g:"rect";break;case "grad":if(void 0===l)return this.styles.grad;Array.isArray(l)||(l=[l]);for(var c=!1,g=0,b=l.length;g<b;g++){var t=l[g];if("offset"in t&&"color"in t){if(t=parseFloat(t.offset),isNaN(t)||0>t||1<t){c=!0;break}}else{c=!0;break}}c||(this.styles.grad=l);break;case "wave":case "grid":case "text":case "font":case "cap":case "join":if(void 0===l)return this.styles[c];"[object String]"===Object.prototype.toString.call(l)&&
("wave"===c&&"gradient"===l&&(this.styles.shape="rect"),this.styles[c]="font"===c?l:l.toLowerCase());break;case "width":case "top":case "right":case "bottom":case "left":if(void 0===l)return this.styles[c];g="width"===c?parseFloat(l):parseInt(l);0<=g&&(this.styles[c]=g)}};t.prototype.start=function(a,l,c){switch(this.drawType){case "canvas":this.drawToCanvas(a,l,c);break;case "svg":this.drawToSVG(a,l,c)}return this};t.prototype.download=function(){switch(this.drawType){case "canvas":return this.canvas.toDataURL("image/png").replace("image/png",
"image/octet-stream");case "svg":return this.svgParent.innerHTML;default:return this}};t.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);return this};t.prototype.drawToCanvas=function(a){};t.prototype.drawToSVG=function(a){};t.prototype.toString=function(){return"[SoundModule Visualizer]"};g.prototype.param=function(a,l){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,
a[c]);else{c=String(a).replace(/-/g,"").toLowerCase();var g=t.prototype.param.call(this,c,l);if(void 0!==g)return g;switch(c){case "currenttime":if(void 0===l)return this.currentTime;"[object String]"===Object.prototype.toString.call(l)&&(this.currentTime=l.toLowerCase());break;case "plotinterval":case "textinterval":if(void 0===l)return this[c];g=parseFloat(l);0<g&&(this[c]=g)}}return this};g.prototype.drawToCanvas=function(a){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;
var l=this.context,c=this.canvas.width,g=this.canvas.height,t=c-(this.styles.left+this.styles.right),b=g-(this.styles.top+this.styles.bottom),d=Math.floor(b/2)+this.styles.top,h=0,f=0,e="",e=Math.floor(this.plotinterval*this.SAMPLE_RATE),m=Math.floor(this.textinterval*this.SAMPLE_RATE);l.clearRect(0,0,c,g);switch(this.styles.shape){case "line":l.strokeStyle=this.styles.wave;l.lineWidth=this.styles.width;l.lineCap=this.styles.cap;l.lineJoin=this.styles.join;l.beginPath();for(var D=0,s=a.length;D<s;D++)0===
D%e&&(h=Math.floor(D/s*t)+this.styles.left,f=Math.floor(b/2*(1-a[D]))+this.styles.top,0===D?l.moveTo(h,f):l.lineTo(h,f));l.stroke();break;case "rect":for("gradient"!==this.styles.wave&&(l.fillStyle=this.styles.wave),D=0,s=a.length;D<s;D++)if(0===D%e){h=Math.floor(D/s*t)+this.styles.left;f=-1*Math.floor(b/2*a[D]);if("gradient"===this.styles.wave){for(var q=b/2+this.styles.top,q=l.createLinearGradient(0,q,0,q+f),k=0,n=this.styles.grad.length;k<n;k++){var p=this.styles.grad[k];q.addColorStop(p.offset,
p.color)}l.fillStyle=q}l.fillRect(h,d,this.styles.width,f)}}if("none"!==this.styles.grid||"none"!==this.styles.text){D=0;for(s=a.length;D<s;D++)0===D%m&&(h=Math.floor(D/s*t)+this.styles.left,e=Math.floor(D/this.SAMPLE_RATE)+" min","none"!==this.styles.grid&&(l.fillStyle=this.styles.grid,l.fillRect(h,this.styles.top,1,b)),"none"!==this.styles.text&&(l.fillStyle=this.styles.text,l.font=this.styles.font,l.fillText(e,h-l.measureText(e).width/2,g)));d=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];D=0;for(s=
d.length;D<s;D++)e=d[D],h=Math.floor(c-l.measureText(e).width),f=Math.floor((1-parseFloat(e.trim()))*(b/2))+this.styles.top,"none"!==this.styles.grid&&(l.fillStyle=this.styles.grid,l.fillRect(this.styles.left,f,t,1)),f-=parseInt(l.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(l.fillStyle=this.styles.text,l.font=this.styles.font,l.fillText(e,h,f))}this.savedImage=l.getImageData(0,0,c,g);this.length=a.length;l.fillStyle=this.currentTime;l.fillRect(this.styles.left,this.styles.top,1,b);
return this};g.prototype.drawToSVG=function(a){if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return this;var l=this.svgParent.innerHTML.match(/(<svg[^<>]*>).*<\/svg>/)[1]+"</svg>",c=this.svg.getAttribute("width"),g=this.svg.getAttribute("height"),t=c-(this.styles.left+this.styles.right),b=g-(this.styles.top+this.styles.bottom),d=Math.floor(b/2)+this.styles.top,h=0,f=0,e="",e=Math.floor(this.plotinterval*this.SAMPLE_RATE),m=Math.floor(this.textinterval*
this.SAMPLE_RATE),s="";switch(this.styles.shape){case "line":s+="stroke : "+this.styles.wave+"; ";s=s+"fill : none; "+("stroke-width : "+this.styles.width+"; ");s+="stroke-linecap : "+this.styles.cap+"; ";s+="stroke-linejoin : "+this.styles.join+";";break;case "rect":if("gradient"===this.styles.wave){var q;q='<defs><linearGradient id="svg-linear-gradient" x1="0%" y1="0%" x2="0%" y2="100%">';for(var k=0,n=this.styles.grad.length;k<n;k++){var p=this.styles.grad[k];q+='<stop offset="'+p.offset+'" stop-color="'+
p.color+'" />'}q+="</linearGradient>";q+="</defs>";s+="stroke : none; ";s+="fill : url(#svg-linear-gradient); "}else s+="stroke : none; ",s+="fill : "+this.styles.wave+"; ";s+="stroke-width : 0;"}var p="stroke : none; "+("fill : "+this.styles.grid+"; "),p=p+"stroke-width : 0;",n=this.styles.font.match(/\s*(\d+)px (.*)/),k=n[2],C=n[1],r;r="stroke : none; "+("fill : "+this.styles.text+"; ");r+="font-family : "+k+"; ";r+="font-size : "+C+";";var v;v="stroke : none; "+("fill : "+this.currentTime+"; ");
v+="stroke-width : 0;";this.svgParent.innerHTML=l;l=this.svgParent.innerHTML.replace("</svg>","");"gradient"===this.styles.wave&&(l+=q);switch(this.styles.shape){case "line":l+='<path style="'+s+'" d="';k=0;for(n=a.length;k<n;k++)0===k%e&&(h=Math.floor(k/n*t)+this.styles.left,f=Math.floor(b/2*(1-a[k]))+this.styles.top,0===k?l+="M"+h+" "+f:(l+=" ",l+="L"+h+" "+f));l+='" />';break;case "rect":for(k=0,n=a.length;k<n;k++)0===k%e&&(h=Math.floor(k/n*t)+this.styles.left,f=Math.floor(b/2*a[k]),l+=0>f?'<rect style="'+
s+'" x="'+h+'" y="'+d+'" width="'+this.styles.width+'" height="'+-f+'" />':'<rect style="'+s+'" x="'+h+'" y="'+d+'" width="'+this.styles.width+'" height="'+f+'" transform="translate('+this.styles.width+" 0) rotate(180 "+h+" "+d+')" />')}if("none"!==this.styles.grid||"none"!==this.styles.text){k=0;for(n=a.length;k<n;k++)0===k%m&&(h=Math.floor(k/n*t)+this.styles.left,e=Math.floor(k/this.SAMPLE_RATE)+" min","none"!==this.styles.grid&&(l+='<rect style="'+p+'" x="'+h+'" y="'+this.styles.top+'" width="1" height="'+
b+'" />'),"none"!==this.styles.text&&(l+='<text text-anchor="middle" style="'+r+'" x="'+h+'" y="'+g+'">'+e+"</text>"));g=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];k=0;for(n=g.length;k<n;k++)e=g[k],h=c,f=Math.floor((1-parseFloat(e.trim()))*(b/2))+this.styles.top,"none"!==this.styles.grid&&(l+='<rect style="'+p+'" x="'+this.styles.left+'" y="'+f+'" width="'+t+'" height="1" />'),f-=Math.floor(parseInt(C)/4),"none"!==this.styles.text&&(l+='<text text-anchor="end" style="'+r+'" x="'+h+'" y="'+f+'">'+e+
"</text>")}l+='<rect class="svg-current-time" style="'+v+'" x="'+this.styles.left+'" y="'+this.styles.top+'" width="1" height="'+b+'" />';l+="</svg>";this.savedImage=this.svgParent.innerHTML=l;this.length=a.length;return this};g.prototype.update=function(a){switch(this.drawType){case "canvas":if(this.canvas instanceof HTMLCanvasElement&&this.isActive)break;else return;case "svg":if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return}a=parseFloat(a);if(!(isNaN(a)||
0>a)){var l=0,c=0,g=0,t=0,g=0;switch(this.drawType){case "canvas":if(this.savedImage instanceof ImageData){var b=this.context,l=this.canvas.width,c=this.canvas.height,g=l-(this.styles.left+this.styles.right),t=c-(this.styles.top+this.styles.bottom),g=Math.floor(a*this.SAMPLE_RATE/this.length*g)+this.styles.left;b.clearRect(0,0,l,c);b.putImageData(this.savedImage,0,0);b.fillStyle=this.currentTime;b.fillRect(g,this.styles.top,1,t)}break;case "svg":c=this.svgParent.getElementsByClassName("svg-current-time")[0],
c instanceof SVGElement&&(l=this.svg.getAttribute("width"),this.svg.getAttribute("height"),g=l-(this.styles.left+this.styles.right),g=Math.floor(a*this.SAMPLE_RATE/this.length*g),c.setAttribute("transform","translate("+g+" 0)"))}return this}};g.prototype.drag=function(a){var l=null,c=!0;switch(this.drawType){case "canvas":if(this.canvas instanceof HTMLCanvasElement&&this.isActive){l=this.canvas;c=!0;break}else return;case "svg":if(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&
this.isActive)l=this.svgParent,c=!1;else return}var g="",b="",t="";/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?(g="touchstart",b="touchmove",t="touchend"):(g="mousedown",b="mousemove",t="mouseup");var d=function(l){var c=0,g=0;switch(this.drawType){case "canvas":c=this.canvas.offsetLeft;g=this.canvas.width;break;case "svg":c=this.svgParent.offsetLeft,g=this.svg.getAttribute("width")}l-=c+this.styles.left;g-=this.styles.left+this.styles.right;0>l&&(l=0);l>g&&(l=g);g=l/g*this.length/this.SAMPLE_RATE;
this.update(g);"[object Function]"===Object.prototype.toString.call(a)&&a(g)},h=function(a){if(a.pageX)return a.pageX;if(a.touches[0])return a.touches[0].pageX},f=!1,e=this;l.addEventListener(g,function(a){null!==e.savedImage&&(d.call(e,h(a)),f=!0)},c);l.addEventListener(b,function(a){a.preventDefault();f&&null!==e.savedImage&&d.call(e,h(a))},c);u.addEventListener(t,function(a){f=!1},!0);return this};g.prototype.toString=function(){return"[SoundModule Analyser TimeAll]"};c.prototype.param=function(a,
l){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else{c=String(a).replace(/-/g,"").toLowerCase();var g=t.prototype.param.call(this,c,l);if(void 0!==g)return g;switch(c){case "textinterval":if(void 0===l)return this.textinterval;c=parseFloat(l);0<c&&(this.textinterval=c)}}return this};c.prototype.drawToCanvas=function(a){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var l=this.context,c=this.canvas.width,g=this.canvas.height,
b=c-(this.styles.left+this.styles.right),t=g-(this.styles.top+this.styles.bottom),d=Math.floor(t/2)+this.styles.top,h=0,f=0,e="",s=Math.floor(this.textinterval*this.SAMPLE_RATE);l.clearRect(0,0,c,g);switch(this.styles.shape){case "line":l.strokeStyle=this.styles.wave;l.lineWidth=this.styles.width;l.lineCap=this.styles.cap;l.lineJoin=this.styles.join;l.beginPath();for(var m=0,k=a.length;m<k;m++)h=Math.floor(m/k*b)+this.styles.left,f=Math.floor((1-a[m]/255)*t)+this.styles.top,0===m?l.moveTo(h,f):l.lineTo(h,
f);l.stroke();break;case "rect":for("gradient"!==this.styles.wave&&(l.fillStyle=this.styles.wave),m=0,k=a.length;m<k;m++){h=Math.floor(m/k*b)+this.styles.left;f=Math.floor((.5-a[m]/255)*t);if("gradient"===this.styles.wave){for(var e=t/2+this.styles.top,e=l.createLinearGradient(0,e,0,e+f),q=0,n=this.styles.grad.length;q<n;q++){var p=this.styles.grad[q];e.addColorStop(p.offset,p.color)}l.fillStyle=e}l.fillRect(h,d,this.styles.width,f)}}if("none"!==this.styles.grid||"none"!==this.styles.text){m=0;for(k=
a.length;m<k;m++)0===m%s&&(h=Math.floor(m/k*b)+this.styles.left,e=Math.floor(m/this.SAMPLE_RATE*1E3)+" ms","none"!==this.styles.grid&&(l.fillStyle=this.styles.grid,l.fillRect(h,this.styles.top,1,t)),"none"!==this.styles.text&&(l.fillStyle=this.styles.text,l.font=this.styles.font,l.fillText(e,h-l.measureText(e).width/2,g)));a=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];m=0;for(k=a.length;m<k;m++)e=a[m],h=Math.floor(c-l.measureText(e).width),f=Math.floor((1-parseFloat(e.trim()))*(t/2))+this.styles.top,
"none"!==this.styles.grid&&(l.fillStyle=this.styles.grid,l.fillRect(this.styles.left,f,b,1)),f-=parseInt(l.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(l.fillStyle=this.styles.text,l.font=this.styles.font,l.fillText(e,h,f))}return this};c.prototype.drawToSVG=function(l){if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return this;var a=this.svgParent.innerHTML.match(/(<svg[^<>]*>).*<\/svg>/)[1]+"</svg>",c=this.svg.getAttribute("width"),g=this.svg.getAttribute("height"),
t=c-(this.styles.left+this.styles.right),b=g-(this.styles.top+this.styles.bottom),d=Math.floor(b/2)+this.styles.top,h=0,f=0,e="",m=Math.floor(this.textinterval*this.SAMPLE_RATE),e="";switch(this.styles.shape){case "line":e+="stroke : "+this.styles.wave+"; ";e=e+"fill : none; "+("stroke-width : "+this.styles.width+"; ");e+="stroke-linecap : "+this.styles.cap+"; ";e+="stroke-linejoin : "+this.styles.join+";";break;case "rect":if("gradient"===this.styles.wave){var s;s='<defs><linearGradient id="svg-linear-gradient" x1="0%" y1="0%" x2="0%" y2="100%">';
for(var k=0,q=this.styles.grad.length;k<q;k++){var n=this.styles.grad[k];s+='<stop offset="'+n.offset+'" stop-color="'+n.color+'" />'}s+="</linearGradient>";s+="</defs>";e+="stroke : none; ";e+="fill : url(#svg-linear-gradient); "}else e+="stroke : none; ",e+="fill : "+this.styles.wave+"; ";e+="stroke-width : 0;"}var n="stroke : none; "+("fill : "+this.styles.grid+"; "),n=n+"stroke-width : 0;",q=this.styles.font.match(/\s*(\d+)px (.*)/),k=q[2],p=q[1],r;r="stroke : none; "+("fill : "+this.styles.text+
"; ");r+="font-family : "+k+"; ";r+="font-size : "+p+";";this.svgParent.innerHTML=a;a=this.svgParent.innerHTML.replace("</svg>","");"gradient"===this.styles.wave&&(a+=s);switch(this.styles.shape){case "line":a+='<path style="'+e+'" d="';k=0;for(q=l.length;k<q;k++)h=Math.floor(k/q*t)+this.styles.left,f=Math.floor((1-l[k]/255)*b)+this.styles.top,0===k?a+="M"+h+" "+f:(a+=" ",a+="L"+h+" "+f);a+='" />';break;case "rect":for(k=0,q=l.length;k<q;k++)h=Math.floor(k/q*t)+this.styles.left,f=Math.floor((l[k]/
255-.5)*b),a+=0>f?'<rect style="'+e+'" x="'+h+'" y="'+d+'" width="'+this.styles.width+'" height="'+-f+'" />':'<rect style="'+e+'" x="'+h+'" y="'+d+'" width="'+this.styles.width+'" height="'+f+'" transform="translate('+this.styles.width+" 0) rotate(180 "+h+" "+d+')" />'}if("none"!==this.styles.grid||"none"!==this.styles.text){k=0;for(q=l.length;k<q;k++)0===k%m&&(h=Math.floor(k/q*t)+this.styles.left,e=Math.floor(k/this.SAMPLE_RATE*1E3)+" ms","none"!==this.styles.grid&&(a+='<rect style="'+n+'" x="'+
h+'" y="'+this.styles.top+'" width="1" height="'+b+'" />'),"none"!==this.styles.text&&(a+='<text text-anchor="middle" style="'+r+'" x="'+h+'" y="'+g+'">'+e+"</text>"));l=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];k=0;for(q=l.length;k<q;k++)e=l[k],h=c,f=Math.floor((1-parseFloat(e.trim()))*(b/2))+this.styles.top,"none"!==this.styles.grid&&(a+='<rect style="'+n+'" x="'+this.styles.left+'" y="'+f+'" width="'+t+'" height="1" />'),f-=Math.floor(parseInt(p)/4),"none"!==this.styles.text&&(a+='<text text-anchor="end" style="'+
r+'" x="'+h+'" y="'+f+'">'+e+"</text>")}this.svgParent.innerHTML=a+"</svg>";return this};c.prototype.toString=function(){return"[SoundModule Analyser Time]"};b.prototype.param=function(a,l){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)this.param(c,a[c]);else{c=String(a).replace(/-/g,"").toLowerCase();var g=t.prototype.param.call(this,c,l);if(void 0!==g)return g;switch(c){case "type":if(void 0===l)return this.type;c=String(l).toLowerCase();if("uint"===c||"float"===c)this.type=
c;break;case "size":if(void 0===l)return this.size;c=parseFloat(l);0<=c&&1024>=c&&(this.size=c);break;case "textinterval":if(void 0===l)return this.textinterval;c=parseFloat(l);0<c&&(this.textinterval=c)}}return this};b.prototype.drawToCanvas=function(a,l,c){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;var g=parseFloat(l),b=parseFloat(c),t=b-g;c=this.context;l=this.canvas.width;var d=this.canvas.height,e=l-(this.styles.left+this.styles.right),h=d-(this.styles.top+this.styles.bottom),
f=0,s=0,k="",m=this.size>a.length?a.length:this.size,q=Math.floor(this.textinterval/(this.SAMPLE_RATE/(2*a.length)));c.clearRect(0,0,l,d);switch(this.type){case "float":c.strokeStyle="gradient"!==this.styles.wave?this.styles.wave:"rgba(0, 0, 255, 1.0)";c.lineWidth=this.styles.width;c.lineCap=this.styles.cap;c.lineJoin=this.styles.join;c.beginPath();for(var n=0;n<m;n++)f=Math.floor(n/m*e)+this.styles.left,s=Math.abs(a[n]-b)*(h/t)+this.styles.top,0===n?c.moveTo(f,s):c.lineTo(f,s);c.stroke();break;default:switch(this.styles.shape){case "line":c.strokeStyle=
this.styles.wave;c.lineWidth=this.styles.width;c.lineCap=this.styles.cap;c.lineJoin=this.styles.join;c.beginPath();for(n=0;n<m;n++)f=Math.floor(n/m*e)+this.styles.left,s=Math.floor((1-a[n]/255)*h)+this.styles.top,0===n?c.moveTo(f,s):c.lineTo(f,s);c.stroke();break;case "rect":for("gradient"!==this.styles.wave&&(c.fillStyle=this.styles.wave),n=0;n<m;n++){f=Math.floor(n/m*e)+this.styles.left;s=-1*Math.floor(a[n]/255*h);if("gradient"===this.styles.wave){for(var k=h+this.styles.top,k=c.createLinearGradient(0,
k,0,k+s),p=0,r=this.styles.grad.length;p<r;p++){var C=this.styles.grad[p];k.addColorStop(C.offset,C.color)}c.fillStyle=k}c.fillRect(f,h+this.styles.top,this.styles.width,s)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(n=a=0;n<m;n++)0===n%q&&(f=Math.floor(n/m*e)+this.styles.left,a=Math.floor(n/q*this.textinterval),k=1E3>a?a+" Hz":String(a/1E3).slice(0,3)+" kHz","none"!==this.styles.grid&&(c.fillStyle=this.styles.grid,c.fillRect(f,this.styles.top,1,h)),"none"!==this.styles.text&&(c.fillStyle=
this.styles.text,c.font=this.styles.font,c.fillText(k,f-c.measureText(k).width/2,d)));switch(this.type){case "float":for(n=g;n<=b;n+=10)k=n+"dB",f=l-Math.floor(c.measureText(k).width),s=Math.floor(-1*(n-b)/t*h)+this.styles.top,"none"!==this.styles.grid&&(c.fillStyle=this.styles.grid,c.fillRect(this.styles.left,s,e,1)),s-=parseInt(c.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(c.fillStyle=this.styles.text,c.font=this.styles.font,c.fillText(k,f,s));break;default:for(a=["0.00","0.25",
"0.50","0.75","1.00"],n=0,g=a.length;n<g;n++)k=a[n],f=l-Math.floor(c.measureText(k).width),s=(1-parseFloat(k))*h+this.styles.top,"none"!==this.styles.grid&&(c.fillStyle=this.styles.grid,c.fillRect(this.styles.left,s,e,1)),s-=parseInt(c.font.match(/\s*(\d+)px.*/)[1]/4),"none"!==this.styles.text&&(c.fillStyle=this.styles.text,c.font=this.styles.font,c.fillText(k,f,s))}}return this};b.prototype.drawToSVG=function(a,l,c){if(!(this.svg instanceof SVGElement&&this.svgParent instanceof HTMLElement&&this.isActive))return this;
l=parseFloat(l);var g=parseFloat(c),b=g-l;c=this.svgParent.innerHTML.match(/(<svg[^<>]*>).*<\/svg>/)[1]+"</svg>";var t=this.svg.getAttribute("width"),d=this.svg.getAttribute("height"),h=t-(this.styles.left+this.styles.right),e=d-(this.styles.top+this.styles.bottom),f=0,s=0,k="",m=this.size>a.length?a.length:this.size,q=Math.floor(this.textinterval/(this.SAMPLE_RATE/(2*a.length))),k="";switch(this.styles.shape){case "line":k+="stroke : "+this.styles.wave+"; ";k=k+"fill : none; "+("stroke-width : "+
this.styles.width+"; ");k+="stroke-linecap : "+this.styles.cap+"; ";k+="stroke-linejoin : "+this.styles.join+";";break;case "rect":if("uint"===this.type&&"gradient"===this.styles.wave){var n;n='<defs><linearGradient id="svg-linear-gradient" x1="0%" y1="0%" x2="0%" y2="100%">';for(var p=0,r=this.styles.grad.length;p<r;p++){var C=this.styles.grad[p];n+='<stop offset="'+C.offset+'" stop-color="'+C.color+'" />'}n+="</linearGradient>";n+="</defs>";k+="stroke : none; ";k+="fill : url(#svg-linear-gradient); ";
k+="stroke-width : 0;"}else"uint"===this.type&&"gradient"!==this.styles.wave?(k+="stroke : none; ",k+="fill : "+this.styles.wave+"; ",k+="stroke-width : 0;"):"uint"!==this.type&&(k+="stroke : rgba(0, 0, 255, 1.0); ",k+="fill : none; ",k+="stroke-width : "+this.styles.width+"; ",k+="stroke-linecap : "+this.styles.cap+"; ",k+="stroke-linejoin : "+this.styles.join+";")}var C="stroke : none; "+("fill : "+this.styles.grid+"; "),C=C+"stroke-width : 0;",v=this.styles.font.match(/\s*(\d+)px (.*)/),p=v[2],
v=v[1],u;u="stroke : none; "+("fill : "+this.styles.text+"; ");u+="font-family : "+p+"; ";u+="font-size : "+v+";";this.svgParent.innerHTML=c;c=this.svgParent.innerHTML.replace("</svg>","");"uint"===this.type&&"gradient"===this.styles.wave&&(c+=n);switch(this.type){case "float":c+='<path style="'+k+'" d="';for(p=0;p<m;p++)f=Math.floor(p/m*h)+this.styles.left,s=Math.floor(e/b*(a[p]-g)*-1)+this.styles.top,0===p?c+="M"+f+" "+s:(c+=" ",c+="L"+f+" "+s);c+='" />';break;default:switch(this.styles.shape){case "line":c+=
'<path style="'+k+'" d="';for(p=0;p<m;p++)f=Math.floor(p/m*h)+this.styles.left,s=Math.floor((1-a[p]/255)*e)+this.styles.top,0===p?c+="M"+f+" "+s:(c+=" ",c+="L"+f+" "+s);c+='" />';break;case "rect":for(p=0;p<m;p++)f=Math.floor(p/m*h)+this.styles.left,s=Math.floor(a[p]/255*e),c+='<rect style="'+k+'" x="'+f+'" y="'+(this.styles.top+e)+'" width="'+this.styles.width+'" height="'+s+'" transform="translate('+this.styles.width+" 0) rotate(180 "+f+" "+(this.styles.top+e)+')" />'}}if("none"!==this.styles.grid||
"none"!==this.styles.text){for(p=a=0;p<m;p++)0===p%q&&(f=Math.floor(p/m*h)+this.styles.left,a=Math.floor(p/q*this.textinterval),k=1E3>a?a+" Hz":String(a/1E3).slice(0,3)+" kHz","none"!==this.styles.grid&&(c+='<rect style="'+C+'" x="'+f+'" y="'+this.styles.top+'" width="1" height="'+e+'" />'),"none"!==this.styles.text&&(c+='<text text-anchor="middle" style="'+u+'" x="'+f+'" y="'+d+'">'+k+"</text>"));switch(this.type){case "float":for(p=l;p<=g;p+=10)k=p+"dB",f=t,s=Math.floor(-1*(p-g)/b*e)+this.styles.top,
"none"!==this.styles.grid&&(c+='<rect style="'+C+'" x="'+this.styles.left+'" y="'+s+'" width="'+h+'" height="1" />'),s-=Math.floor(parseInt(v)/4),"none"!==this.styles.text&&(c+='<text text-anchor="end" style="'+u+'" x="'+f+'" y="'+s+'">'+k+"</text>");break;default:for(a=["0.00","0.25","0.50","0.75","1.00"],p=0,r=a.length;p<r;p++)k=a[p],f=t,s=(1-parseFloat(k))*e+this.styles.top,"none"!==this.styles.grid&&(c+='<rect style="'+C+'" x="'+this.styles.left+'" y="'+s+'" width="'+h+'" height="1" />'),s-=Math.floor(parseInt(v)/
4),"none"!==this.styles.text&&(c+='<text text-anchor="end" style="'+u+'" x="'+f+'" y="'+s+'">'+k+"</text>")}}this.svgParent.innerHTML=c+"</svg>";return this};b.prototype.toString=function(){return"[SoundModule Analyser FFT]"}}function e(a,b,g,c){this.SAMPLE_RATE=a.sampleRate;this.context=a;this.processor=a.createScriptProcessor(b,g,c);this.mixRs=this.mixLs=null;this.trackLs=[];this.trackRs=[];this.numtrack=0;this.activeTrack=-1;this.paused=!0;this.gainR=this.gainL=1}function m(a,b,g,c,d){this.isActive=
!1;this.context=a;this.analyser=d;this.sender=a.createScriptProcessor(b,g,c);this.receiver=a.createScriptProcessor(b,g,c);this.websocket=null;this.paused=!0}function h(a,b){this.isActive=!0;this.context=a;this.input=a.createGain();this.output=a.createGain();this.lfo=a.createOscillator();this.depth=a.createGain();this.rate=this.lfo.frequency;this.processor=a.createScriptProcessor(b,1,2);this.lfo.start=this.lfo.start||this.lfo.noteOn;this.lfo.stop=this.lfo.stop||this.lfo.noteOff;this.values={};this.isStop=
!0}function q(a,b){h.call(this,a,b);this.compressor=a.createDynamicsCompressor();this.compressor.threshold.value=-24;this.compressor.knee.value=30;this.compressor.ratio.value=12;this.compressor.attack.value=.003;this.compressor.release.value=.25;this.connect()}function k(a,b){h.call(this,a,b);this.distortion=a.createWaveShaper();this.drive=a.createGain();this.color=a.createBiquadFilter();this.tone=a.createBiquadFilter();this.type="clean";this.numberOfSamples=4096;this.drive.gain.value=1;this.color.type=
"[object String]"===Object.prototype.toString.call(this.color.type)?"bandpass":this.color.BANDPASS||2;this.color.frequency.value=350;this.color.Q.value=Math.SQRT1_2;this.color.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.state(!1)}function p(a,b){h.call(this,a,b);this.lowpass=a.createBiquadFilter();this.lowpass.type="[object String]"===
Object.prototype.toString.call(this.lowpass.type)?"lowpass":this.lowpass.LOWPASS||0;this.lowpass.frequency.value=350;this.lowpass.gain.value=0;this.lowpass.Q.value=1;this.depth.gain.value=0;this.depthRate=this.rate.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.lowpass.frequency)}function n(a,b){h.call(this,a,b);this.bass=a.createBiquadFilter();this.middle=a.createBiquadFilter();this.treble=a.createBiquadFilter();this.presence=a.createBiquadFilter();this.bass.type="[object String]"===
Object.prototype.toString.call(this.bass.type)?"lowshelf":this.bass.LOWSHELF||3;this.middle.type="[object String]"===Object.prototype.toString.call(this.middle.type)?"peaking":this.middle.PEAKING||5;this.treble.type="[object String]"===Object.prototype.toString.call(this.treble.type)?"peaking":this.treble.PEAKING||5;this.presence.type="[object String]"===Object.prototype.toString.call(this.presence.type)?"highshelf":this.presence.HIGHSHELF||4;this.bass.frequency.value=500;this.middle.frequency.value=
1E3;this.treble.frequency.value=2E3;this.presence.frequency.value=4E3;this.middle.Q.value=Math.SQRT1_2;this.treble.Q.value=Math.SQRT1_2;this.bass.gain.value=0;this.middle.gain.value=0;this.treble.gain.value=0;this.presence.gain.value=0;this.connect()}function C(a,b){h.call(this,a,b);this.filter=a.createBiquadFilter();this.filter.frequency.setTargetAtTime=this.filter.frequency.setTargetAtTime||this.filter.frequency.setTargetValueAtTime;this.filter.type="[object String]"===Object.prototype.toString.call(this.filter.type)?
"lowpass":this.filter.LOWPASS||0;this.filter.frequency.value=350;this.filter.Q.value=1;this.filter.gain.value=0;this.maxFrequency=this.filter.frequency.value;this.attack=.01;this.decay=.3;this.release=this.sustain=1;this.state(!1)}function r(a,b){h.call(this,a,b);this.amplitudeL=a.createGain();this.amplitudeR=a.createGain();this.splitter=a.createChannelSplitter(2);this.merger=a.createChannelMerger(2);this.amplitudeL.gain.value=1;this.amplitudeR.gain.value=1;this.depth.gain.value=0;this.rate.value=
0;this.state(!1);this.lfoSplitter=a.createChannelSplitter(2);this.lfo.connect(this.depth);this.depth.connect(this.processor);this.processor.connect(this.lfoSplitter);this.lfoSplitter.connect(this.amplitudeL.gain,0);this.lfoSplitter.connect(this.amplitudeR.gain,1)}function v(a,b){h.call(this,a,b);this.amplitude=a.createGain();this.amplitude.gain.value=1;this.depth.gain.value=0;this.rate.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.amplitude.gain)}function H(a,b){h.call(this,
a,b);this.amplitude=a.createGain();this.amplitude.gain.value=0;this.depth.gain.value=1;this.rate.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.amplitude.gain)}function w(a,b){h.call(this,a,b);this.MAXIMUM_STAGES=24;this.numberOfStages=12;this.filters=Array(this.MAXIMUM_STAGES);for(var g=0;g<this.MAXIMUM_STAGES;g++)this.filters[g]=a.createBiquadFilter(),this.filters[g].type="[object String]"===Object.prototype.toString.call(this.filters[g].type)?"allpass":this.filters[g].ALLPASS||
7,this.filters[g].frequency.value=350,this.filters[g].Q.value=1,this.filters[g].gain.value=0;this.mix=a.createGain();this.feedback=a.createGain();this.depth.gain.value=0;this.rate.value=0;this.mix.gain.value=0;this.depthRate=this.feedback.gain.value=0;this.state(!1);this.lfo.connect(this.depth);for(g=0;g<this.MAXIMUM_STAGES;g++)this.depth.connect(this.filters[g].frequency)}function x(a,b){h.call(this,a,b);this.delay=a.createDelay();this.mix=a.createGain();this.tone=a.createBiquadFilter();this.feedback=
a.createGain();this.delay.delayTime.value=0;this.depth.gain.value=0;this.rate.value=0;this.mix.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.depthRate=this.feedback.gain.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.delay.delayTime)}function z(a,b){h.call(this,a,b);this.delay=a.createDelay();this.mix=
a.createGain();this.tone=a.createBiquadFilter();this.feedback=a.createGain();this.delay.delayTime.value=0;this.depth.gain.value=0;this.rate.value=0;this.mix.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.depthRate=this.feedback.gain.value=0;this.state(!1);this.lfo.connect(this.depth);this.depth.connect(this.delay.delayTime)}function J(a,
b){h.call(this,a,b);this.MAX_DELAY_TIME=5;this.delay=a.createDelay(this.MAX_DELAY_TIME);this.dry=a.createGain();this.wet=a.createGain();this.tone=a.createBiquadFilter();this.feedback=a.createGain();this.delay.delayTime.value=0;this.dry.gain.value=1;this.wet.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.feedback.gain.value=0;this.state(!1)}
function y(a,b){h.call(this,a,b);this.rirs=[];this.convolver=a.createConvolver();this.dry=a.createGain();this.wet=a.createGain();this.tone=a.createBiquadFilter();this.decodeAudioData=function(g,c,b){a.decodeAudioData(g,c,b)};this.dry.gain.value=1;this.wet.gain.value=0;this.tone.type="[object String]"===Object.prototype.toString.call(this.tone.type)?"lowpass":this.tone.LOWPASS||0;this.tone.frequency.value=350;this.tone.Q.value=Math.SQRT1_2;this.tone.gain.value=0;this.state(!1)}function A(a,b){h.call(this,
a,b);this.panner=a.createPanner();this.positions={x:0,y:0,z:0};this.orientations={x:1,y:0,z:0};this.velocities={x:0,y:0,z:0};this.panner.refDistance=1;this.panner.maxDistance=1E4;this.panner.rolloffFactor=1;this.panner.coneInnerAngle=360;this.panner.coneOuterAngle=360;this.panner.coneOuterGain=0;this.panner.panningModel="[object String]"===Object.prototype.toString.call(this.panner.panningModel)?"HRTF":this.panner.HRTF||1;this.panner.distanceModel="[object String]"===Object.prototype.toString.call(this.panner.distanceModel)?
"inverse":this.panner.INVERSE_DISTANCE||1;this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z);this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z);this.panner.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z);this.state(!1)}function B(a){this.context=a;this.generators=[];this.activeIndexes=[];this.activeCounter=0;this.attack=.01;this.decay=.3;this.sustain=.5;this.release=1}this.context=a;this.SAMPLE_RATE=a.sampleRate;this.NUM_OUTPUT=
this.NUM_INPUT=2;var K=navigator.userAgent;if(void 0!==d)switch(parseInt(d)){case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:this.BUFFER_SIZE=parseInt(d);break;default:return}else/(Win(dows )?NT 6\.2)/.test(K)?this.BUFFER_SIZE=1024:/(Win(dows )?NT 6\.1)/.test(K)?this.BUFFER_SIZE=1024:/(Win(dows )?NT 6\.0)/.test(K)?this.BUFFER_SIZE=2048:/Win(dows )?(NT 5\.1|XP)/.test(K)?this.BUFFER_SIZE=4096:/Mac|PPC/.test(K)?this.BUFFER_SIZE=1024:/Linux/.test(K)?this.BUFFER_SIZE=8192:/iPhone|iPad|iPod/.test(K)?
this.BUFFER_SIZE=2048:this.BUFFER_SIZE=16384;this.masterVolume=a.createGain();this.processor=a.createScriptProcessor(this.BUFFER_SIZE,this.NUM_INPUT,this.NUM_OUTPUT);m.prototype=Object.create(L.prototype);h.prototype=Object.create(L.prototype);m.prototype.constructor=m;h.prototype.constructor=h;q.prototype=Object.create(h.prototype);k.prototype=Object.create(h.prototype);p.prototype=Object.create(h.prototype);n.prototype=Object.create(h.prototype);C.prototype=Object.create(h.prototype);v.prototype=
Object.create(h.prototype);H.prototype=Object.create(h.prototype);r.prototype=Object.create(h.prototype);w.prototype=Object.create(h.prototype);x.prototype=Object.create(h.prototype);z.prototype=Object.create(h.prototype);J.prototype=Object.create(h.prototype);y.prototype=Object.create(h.prototype);A.prototype=Object.create(h.prototype);q.prototype.constructor=q;k.prototype.constructor=k;p.prototype.constructor=p;n.prototype.constructor=n;C.prototype.constructor=C;v.prototype.constructor=v;H.prototype.constructor=
H;r.prototype.constructor=r;w.prototype.constructor=w;x.prototype.constructor=x;z.prototype.constructor=z;J.prototype.constructor=J;y.prototype.constructor=y;A.prototype.constructor=A;this.Effector=h;this.plugins=[];b.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "dopplerfactor":if(void 0===b)return this.listener.dopplerFactor;var c=parseFloat(b);0<=c&&(this.listener.dopplerFactor=
c);break;case "speedofsound":if(void 0===b)return this.listener.speedOfSound;c=parseFloat(b);0<=c&&(this.listener.speedOfSound=c);break;case "x":case "y":case "z":if(void 0===b)return this.positions[g];c=parseFloat(b);isNaN(c)||(this.positions[g]=c,this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case "fx":case "fy":case "fz":if(void 0===b)return this.fronts[g.charAt(1)];c=parseFloat(b);isNaN(c)||(this.fronts[g.charAt(1)]=c,this.listener.setOrientation(this.fronts.x,
this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z));break;case "ux":case "uy":case "uz":if(void 0===b)return this.ups[g.charAt(1)];c=parseFloat(b);isNaN(c)||(this.ups[g.charAt(1)]=c,this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z));break;case "vx":case "vy":case "vz":if(void 0===b)return this.velocities[g.charAt(1)];c=parseFloat(b);isNaN(c)||(this.velocities[g.charAt(1)]=c,this.listener.setVelocity(this.velocities.x,this.velocities.y,
this.velocities.z))}return this};b.prototype.toString=function(){return"[SoundModule Listener]"};f.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "fftsize":if(void 0===b)return this.analyser.fftSize;var c=parseInt(b);switch(c){case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:this.analyser.fftSize=c}break;case "frequencybincount":return this.analyser.frequencyBinCount;
case "mindecibels":case "maxdecibels":if(void 0===b)return this.analyser[g.replace("decibels","Decibels")];c=parseFloat(b);isNaN(c)||(this.analyser[g.replace("decibels","Decibels")]=c,this.analyser.minDecibels>=this.analyser.maxDecibels&&(this.analyser.minDecibels=-100,this.analyser.maxDecibels=-30));break;case "smoothingtimeconstant":if(void 0===b)return this.analyser.smoothingTimeConstant;c=parseFloat(b);0<=c&&1>=c&&(this.analyser.smoothingTimeConstant=c)}return this};f.prototype.start=function(a,
b){var g=this;switch(String(a).replace(/-/g,"").toLowerCase()){case "timealll":if(b instanceof AudioBuffer&&0<b.numberOfChannels){var c=new Float32Array(b.length);c.set(b.getChannelData(0));this.timeAllL.start(c)}break;case "timeallr":b instanceof AudioBuffer&&1<b.numberOfChannels&&(c=new Float32Array(b.length),c.set(b.getChannelData(1)),this.timeAllR.start(c));break;case "time":c=new Uint8Array(this.analyser.fftSize);this.analyser.getByteTimeDomainData(c);this.time.start(c);this.time.timerid="auto"===
this.time.interval?requestAnimationFrame(function(){g.start(a)}):u.setTimeout(function(){g.start(a)},this.time.interval);break;case "fft":"uint"===this.fft.type?(c=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(c),this.fft.start(c)):(c=new Float32Array(this.analyser.frequencyBinCount),this.analyser.getFloatFrequencyData(c),this.fft.start(c,this.analyser.minDecibels,this.analyser.maxDecibels)),this.fft.timerid="auto"===this.fft.interval?requestAnimationFrame(function(){g.start(a)}):
u.setTimeout(function(){g.start(a)},this.fft.interval)}return this};f.prototype.stop=function(a){switch(String(a).replace(/-/g,"").toLowerCase()){case "time":"auto"===this.time.interval?u.cancelAnimationFrame(this.time.timerid):u.clearTimeout(this.time.timerid);this.time.timerid=null;break;case "fft":"auto"===this.fft.interval?u.cancelAnimationFrame(this.fft.timerid):u.clearTimeout(this.fft.timerid),this.fft.timerid=null}return this};f.prototype.domain=function(a){a=String(a).replace(/-/g,"").toLowerCase();
switch(a){case "timealll":case "timeallr":return this["timeAll"+a.slice(-1).toUpperCase()];case "time":case "fft":return this[a]}};f.prototype.toString=function(){return"[SoundModule Analyser]"};e.prototype.setup=function(a){a=parseInt(a);if(0<a){this.numTrack=a;this.trackLs=Array(this.numTrack);this.trackRs=Array(this.numTrack);for(var b=0;b<a;b++)this.trackLs[b]=[];for(b=0;b<a;b++)this.trackRs[b]=[]}else this.numTrack=1,this.trackLs=Array(this.numTrack),this.trackRs=Array(this.numTrack),this.trackLs[0]=
[],this.trackRs[0]=[];return this};e.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "gainl":case "gainr":if(void 0===b)return this["gain"+g.slice(-1).toUpperCase()];var c=parseFloat(b);0<=c&&1>=c&&(this["gain"+g.slice(-1).toUpperCase()]=c)}return this};e.prototype.ready=function(a){this.isTrack(a)&&(this.activeTrack=a);return this};e.prototype.start=function(){if(-1!==
this.activeTrack&&this.paused){var a=this;this.paused=!1;this.processor.onaudioprocess=function(b){if(-1!==a.activeTrack){var g=b.inputBuffer.getChannelData(0);b=b.inputBuffer.getChannelData(1);for(var c=new Float32Array(this.bufferSize),d=new Float32Array(this.bufferSize),f=0;f<this.bufferSize;f++)c[f]=a.gainL*g[f],d[f]=a.gainR*b[f];a.trackLs[a.activeTrack].push(c);a.trackRs[a.activeTrack].push(d)}else this.disconnect(0),this.onaudioprocess=null}}return this};e.prototype.stop=function(){this.activeTrack=
-1;this.paused=!0;this.processor.disconnect(0);this.processor.onaudioprocess=null;return this};e.prototype.isTrack=function(a){a=parseInt(a);return 0<=a&&a<this.numTrack?!0:!1};e.prototype.getActiveTrack=function(){return this.activeTrack};e.prototype.mix=function(){-1!==this.activeTrack&&this.stop();var a=function(a){for(var b=this["track"+a+"s"],c=null,l=0,d=0,f=0,e=0,h=c=0,k=b.length;h<k;h++)c<b[h].length&&(c=b[h].length);for(c=new Float32Array(c*this.processor.bufferSize);;){h=0;for(k=b.length;h<
k;h++)b[h][f]instanceof Float32Array&&(l+=b[h][f][e],d++);if(0<d)c[f*this.processor.bufferSize+e]=l/d,d=l=0,e<this.processor.bufferSize-1?e++:(f++,e=0);else{this["mix"+a+"s"]=c;break}}};a.call(this,"L");a.call(this,"R");return this};e.prototype.clear=function(a){-1!==this.activeTrack&&this.stop();if("all"===String(a).toLowerCase()){a=0;for(var b=this.trackLs.length;a<b;a++)this.trackLs[a].length=0;a=0;for(b=this.trackRs.length;a<b;a++)this.trackRs[a].length=0}else this.isTrack(a)&&(this.trackLs[a].length=
0,this.trackRs[a].length=0);return this};e.prototype.create=function(a,b,g,c){-1!==this.activeTrack&&this.stop();var d=null,f=null;"all"===String(a).toLowerCase()?(this.mix(),d=this.mixLs,f=this.mixRs):this.isTrack(a)&&(d=this.trackLs[a-1],f=this.trackRs[a-1]);if(0!==d.length||0!==f.length){a=1===b?1:2;g=8===g?8:16;b=1===a?Math.min(d.length,f.length):2*Math.min(d.length,f.length);var h=null;switch(g){case 8:for(var h=new Uint8Array(b),e=0;e<b;e++){var k=0,k=0===e%a?(d[parseInt(e/a)]+1)/2*(Math.pow(2,
8)-1):(f[parseInt(e/a)]+1)/2*(Math.pow(2,8)-1);k>Math.pow(2,8)-1&&(k=Math.pow(2,8)-1);k<Math.pow(2,0)-1&&(k=Math.pow(2,0)-1);h[e]=parseInt(k)}break;case 16:for(h=new Int16Array(b),e=0;e<b;e++)k=0===e%a?d[parseInt(e/a)]*Math.pow(2,15):f[parseInt(e/a)]*Math.pow(2,15),k>+Math.pow(2,15)-1&&(k=Math.pow(2,15)-1),k<-Math.pow(2,15)-1&&(k=-Math.pow(2,15)-1),h[e]=parseInt(k)}var m=36+g/8*b,f=8+(28+(8+g/8*b)),e=this.SAMPLE_RATE,k=g/8*a*e,d=g/8*b;switch(String(c).toLowerCase()){case "base64":c="RIFF"+String.fromCharCode(m>>
0&255,m>>8&255,m>>16&255,m>>24&255);c+="WAVE";c+="fmt "+String.fromCharCode(16,0,0,0);c+=String.fromCharCode(1,0);c+=String.fromCharCode(a,0);c+=String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255);c+=String.fromCharCode(k>>0&255,k>>8&255,k>>16&255,k>>24&255);c+=String.fromCharCode(g/8*a,0);c+=String.fromCharCode(g,0);c+="data";c+=String.fromCharCode(d>>0&255,d>>8&255,d>>16&255,d>>24&255);for(e=0;e<b;e++)switch(g){case 8:c+=String.fromCharCode(h[e]);break;case 16:c+=String.fromCharCode(h[e]>>
0&255,h[e]>>8&255)}return"data:audio/wav;base64,"+u.btoa(c);default:c=[82,73,70,70];c[4]=m>>0&255;c[5]=m>>8&255;c[6]=m>>16&255;c[7]=m>>24&255;c[8]=87;c[9]=65;c[10]=86;c[11]=69;c[12]=102;c[13]=109;c[14]=116;c[15]=32;c[16]=16;c[17]=0;c[18]=0;c[19]=0;c[20]=1;c[21]=0;c[22]=a;c[23]=0;c[24]=e>>0&255;c[25]=e>>8&255;c[26]=e>>16&255;c[27]=e>>24&255;c[28]=k>>0&255;c[29]=k>>8&255;c[30]=k>>16&255;c[31]=k>>24&255;c[32]=g/8*a;c[33]=0;c[34]=g;c[35]=0;c[36]=100;c[37]=97;c[38]=116;c[39]=97;c[40]=d>>0&255;c[41]=d>>
8&255;c[42]=d>>16&255;c[43]=d>>24&255;for(e=0;e<b;e++)switch(g){case 8:c[f-d+e]=h[e];break;case 16:c[f-d+2*e+0]=h[e]>>0&255,c[f-d+2*e+1]=h[e]>>8&255}u.URL=u.URL||u.webkitURL;c=new Blob([new Uint8Array(c)],{type:"audio/wav"});return u.URL.createObjectURL(c)}}};e.prototype.toString=function(){return"[SoundModule Recorder]"};m.prototype.setup=function(a,b,g,c,e,d,f){if(!navigator.onLine)throw this.isActive=!1,this.paused=!0,this.connect(),this.websocket=null,Error("Now Offline.");if("[object Object]"===
Object.prototype.toString.call(a)){var h=a;"tls"in h&&(a=h.tls);"host"in h&&(b=h.host);"port"in h&&(g=h.port);"path"in h&&(c=h.path);"open"in h&&(e=h.open);"close"in h&&(d=h.close);"error"in h&&(f=h.error)}a=a?"wss://":"ws://";"/"!==c.charAt(0)&&(c="/"+c);g=parseInt(g);if(!(isNaN(g)||0>g||65535<g)){this.websocket=new WebSocket(a+b+":"+g+c);this.websocket.binaryType="arraybuffer";var k=this;this.websocket.onopen=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a,k.websocket)};
this.websocket.onclose=function(a){k.isActive=!1;k.paused=!0;k.connect();"[object Function]"===Object.prototype.toString.call(d)&&d(a,k.websocket)};this.websocket.onerror=function(a){k.isActive=!1;k.paused=!0;k.connect();"[object Function]"===Object.prototype.toString.call(f)&&f(a,k.websocket)};this.websocket.onmessage=function(a){if(!k.isActive)k.analyser.stop("time"),k.analyser.stop("fft");else if(a.data instanceof ArrayBuffer){var c=Math.floor(a.data.byteLength/Float32Array.BYTES_PER_ELEMENT/2),
b=c*Float32Array.BYTES_PER_ELEMENT,g=new Float32Array(a.data,0,c),l=new Float32Array(a.data,b,c);k.analyser.start("time");k.analyser.start("fft");k.receiver.onaudioprocess=function(a){var c=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);g instanceof Float32Array&&c.set(g);l instanceof Float32Array&&a.set(l);l=g=null;k.isActive&&null!==k.websocket||(k.analyser.stop("time"),k.analyser.stop("fft"))}}};return this}};m.prototype.connect=function(){this.receiver.disconnect(0);this.sender.disconnect(0);
this.receiver.onaudioprocess=null;this.sender.onaudioprocess=null;this.isActive?(this.receiver.connect(this.analyser.input),this.analyser.output.connect(this.context.destination)):this.paused=!0;return this};m.prototype.start=function(){if(this.isActive&&this.isConnected()&&this.paused){this.paused=!1;var a=this;this.sender.onaudioprocess=function(b){if(a.isActive&&a.isConnected()){var g=b.inputBuffer.getChannelData(0);b=b.inputBuffer.getChannelData(1);for(var c=new Float32Array(2*this.bufferSize),
e=parseInt(c.length/2),d=0;d<this.bufferSize;d++)c[d]=g[d],c[e+d]=b[d];0===a.websocket.bufferedAmount&&a.websocket.send(c)}}}return this};m.prototype.close=function(){this.websocket instanceof WebSocket&&(this.isActive=!1,this.paused=!0,this.connect(),this.websocket.close(),this.websocket=null);return this};m.prototype.isConnected=function(){return this.websocket instanceof WebSocket&&this.websocket.readyState===WebSocket.OPEN?!0:!1};m.prototype.state=function(a,b,g){if(void 0===a)return this.isActive;
"[object Function]"===Object.prototype.toString.call(g)&&g();var c=this,e=u.setInterval(function(){c.websocket instanceof WebSocket&&0!==c.websocket.bufferedAmount||("toggle"===String(a).toLowerCase()?c.isActive=!c.isActive:c.isActive=Boolean(a),c.connect(),"[object Function]"===Object.prototype.toString.call(b)&&b(),u.clearInterval(e))},10);return this};m.prototype.toString=function(){return"[SoundModule Session]"};h.prototype.param=function(a,b){};h.prototype.connect=function(){};h.prototype.start=
function(a){if(this.isActive&&this.isStop){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;this.lfo.start(a);this.isStop=!1}return this};h.prototype.stop=function(a,b){if(this.isActive&&!this.isStop){var g=parseFloat(a),c=parseFloat(b);if(isNaN(g)||g<this.context.currentTime)g=this.context.currentTime;if(isNaN(c)||0>c)c=0;var e=this.lfo.type,d=this.lfo.frequency.value;this.lfo.stop(g+c);this.lfo=this.context.createOscillator();this.lfo.start=this.lfo.start||this.lfo.noteOn;
this.lfo.stop=this.lfo.stop||this.lfo.noteOff;this.lfo.type=e;this.lfo.frequency.value=d;this.rate=this.lfo.frequency;this.isStop=!0}return this};h.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);this.connect();this.start(this.context.currentTime);return this};h.prototype.toString=function(){return"[SoundModule Effector]"};q.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,
a[g]);else if(g=String(a).replace(/-/g,"").toLowerCase(),g in this.compressor){if(void 0===b)return this.compressor[g].value;var c=parseFloat(b),e={threshold:-100,knee:0,ratio:1,attack:0,release:0},d={threshold:0,knee:40,ratio:20,attack:1,release:1},d=this.compressor[g].maxValue||d[g];c>=(this.compressor[g].minValue||e[g])&&c<=d&&(this.compressor[g].value=c)}return this};q.prototype.connect=function(){this.input.disconnect(0);this.compressor.disconnect(0);this.isActive?(this.input.connect(this.compressor),
this.compressor.connect(this.output)):this.input.connect(this.output);return this};q.prototype.toString=function(){return"[SoundModule Compressor]"};k.createCurve=function(a,b){if(0<a&&1>a){for(var g=new Float32Array(b),c=2*a/(1-a),e=0;e<b;e++){var d=2*(e-0)/(b-0)+-1;g[e]=(1+c)*d/(1+c*Math.abs(d))}return g}return null};k.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "curve":if(void 0===
b)return this.distortion.curve;g=null;switch(String(b).toLowerCase()){case "clean":this.type="clean";g=k.createCurve(0,this.numberOfSamples);break;case "crunch":this.type="crunch";g=k.createCurve(.5,this.numberOfSamples);break;case "overdrive":this.type="overdrive";g=k.createCurve(.7,this.numberOfSamples);break;case "distortion":this.type="distortion";g=k.createCurve(.8,this.numberOfSamples);break;case "fuzz":this.type="fuzz";g=k.createCurve(.9,this.numberOfSamples);break;default:b instanceof Float32Array&&
(g=b)}this.distortion.curve=g;break;case "samples":if(void 0===b)return this.numberOfSamples;var c=parseInt(b);0<=c&&(this.numberOfSamples=c,this.param("curve",this.type));break;case "drive":if(void 0===b)return this.drive.gain.value;var c=parseFloat(b),e=this.drive.gain.minValue||0,d=this.drive.gain.maxValue||1;c>=e&&c<=d&&(this.drive.gain.value=c);break;case "color":case "tone":if(void 0===b)return this[g].frequency.value;c=parseFloat(b);e=this[g].frequency.minValue||10;d=this[g].frequency.maxValue||
this.context.sampleRate/2;c>=e&&c<=d&&(this[g].frequency.value=c)}return this};k.prototype.connect=function(){this.input.disconnect(0);this.distortion.disconnect(0);this.drive.disconnect(0);this.color.disconnect(0);this.tone.disconnect(0);this.isActive?(this.input.connect(this.color),this.color.connect(this.distortion),this.distortion.connect(this.drive),this.drive.connect(this.tone),this.tone.connect(this.output)):this.input.connect(this.output)};k.prototype.toString=function(){return"[SoundModule Distortion]"};
p.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "frequency":case "cutoff":if(void 0===b)return this.lowpass.frequency.value;g=parseFloat(b);var c=this.lowpass.frequency.minValue||10,e=this.lowpass.frequency.maxValue||this.context.sampleRate/2;g>=c&&g<=e&&(this.lowpass.frequency.value=g,this.depth.gain.value=this.lowpass.frequency.value*this.depthRate);break;case "depth":if(void 0===
b)return this.depthRate;g=parseFloat(b);0<=g&&1>=g&&(this.depth.gain.value=this.lowpass.frequency.value*g,this.depthRate=g);break;case "rate":if(void 0===b)return this.rate.value;g=parseFloat(b);c=this.rate.minValue||0;e=this.rate.maxValue||1E5;g>=c&&g<=e&&(this.rate.value=g);break;case "resonance":if(void 0===b)return this.lowpass.Q.value;g=parseFloat(b);c=this.lowpass.Q.minValue||1E-4;e=this.lowpass.Q.maxValue||1E3;g>=c&&g<=e&&(this.lowpass.Q.value=g)}return this};p.prototype.stop=function(a,b){h.prototype.stop.call(this,
a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.lowpass.frequency));return this};p.prototype.connect=function(){this.input.disconnect(0);this.lowpass.disconnect(0);this.isActive?(this.input.connect(this.lowpass),this.lowpass.connect(this.output)):this.input.connect(this.output)};p.prototype.toString=function(){return"[SoundModule Wah]"};n.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=
String(a).replace(/-/g,"").toLowerCase(),g){case "bass":case "middle":case "treble":case "presence":if(void 0===b)return this[g].gain.value;var c=parseFloat(b),e=this[g].gain.maxValue||40;c>=(this[g].gain.minValue||-40)&&c<=e&&(this[g].gain.value=c)}return this};n.prototype.connect=function(){this.input.disconnect(0);this.bass.disconnect(0);this.middle.disconnect(0);this.treble.disconnect(0);this.presence.disconnect(0);this.isActive?(this.input.connect(this.bass),this.bass.connect(this.middle),this.middle.connect(this.treble),
this.treble.connect(this.presence),this.presence.connect(this.output)):this.input.connect(this.output)};n.prototype.toString=function(){return"[SoundModule Equalizer]"};C.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "type":if(void 0===b)return this.filter.type;var c=String(b).toLowerCase();g={lowpass:this.filter.LOWPASS||0,highpass:this.filter.HIGHPASS||1,bandpass:this.filter.BANDPASS||
2,lowshelf:this.filter.LOWSHELF||3,highshelf:this.filter.HIGHSHELF||4,peaking:this.filter.PEAKING||5,notch:this.filter.NOTCH||6,allpass:this.filter.ALLPASS||7};c in g&&(this.filter.type="[object String]"===Object.prototype.toString.call(this.filter.type)?c:g[c]);break;case "frequency":case "cutoff":if(void 0===b)return this.filter.frequency.value;c=parseFloat(b);g=this.filter.frequency.minValue||10;var e=this.filter.frequency.maxValue||this.context.sampleRate/2;c>=g&&c<=e&&(this.maxFrequency=c,this.filter.frequency.value=
c);break;case "gain":if(void 0===b)return this.filter.gain.value;c=parseFloat(b);g=this.filter.gain.minValue||-40;e=this.filter.gain.maxValue||40;c>=g&&c<=e&&(this.filter.gain.value=c);break;case "q":if(void 0===b)return this.filter.Q.value;c=parseFloat(b);g=this.filter.Q.minValue||1E-4;e=this.filter.Q.maxValue||1E3;c>=g&&c<=e&&(this.filter.Q.value=c);break;case "attack":case "decay":case "sustain":case "release":if(void 0===b)return this[g];c=parseFloat(b);0<=c&&(this[g]=c)}return this};C.prototype.connect=
function(){this.input.disconnect(0);this.filter.disconnect(0);this.isActive?(this.input.connect(this.filter),this.filter.connect(this.output)):this.input.connect(this.output)};C.prototype.start=function(a){this.filter.frequency.value=this.maxFrequency;if(this.isActive){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;var b=a+this.attack,g=this.decay,c=this.sustain*this.filter.frequency.value;this.filter.frequency.cancelScheduledValues(a);this.filter.frequency.setValueAtTime(this.filter.frequency.defaultValue,
a);this.filter.frequency.linearRampToValueAtTime(this.maxFrequency,b);this.filter.frequency.setTargetAtTime(c,b,g)}return this};C.prototype.stop=function(a){if(this.isActive){a=parseFloat(a)-this.release;if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;var b=this.release;this.filter.frequency.cancelScheduledValues(a);this.filter.frequency.setValueAtTime(this.filter.frequency.value,a);this.filter.frequency.setTargetAtTime(this.filter.frequency.defaultValue,a,b);this.filter.frequency.setValueAtTime(this.maxFrequency,
a+b)}return this};C.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(a);this.connect();return this};C.prototype.toString=function(){return"[SoundModule Filter]"};r.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "depth":if(void 0===b)return this.depth.gain.value;g=
parseFloat(b);var c=this.depth.gain.minValue||0,e=this.depth.gain.maxValue||1;g>=c&&g<=e&&(this.depth.gain.value=g);break;case "rate":if(void 0===b)return this.rate.value;g=parseFloat(b);c=this.rate.minValue||0;e=this.rate.maxValue||1E5;g>=c&&g<=e&&(this.rate.value=g)}return this};r.prototype.connect=function(){this.input.disconnect(0);this.amplitudeL.disconnect(0);this.amplitudeR.disconnect(0);this.splitter.disconnect(0);this.splitter.disconnect(1);this.merger.disconnect(0);this.isActive?(this.input.connect(this.splitter),
this.splitter.connect(this.amplitudeL,0,0),this.splitter.connect(this.amplitudeR,1,0),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output)):this.input.connect(this.output)};r.prototype.start=function(a){if(this.isActive&&this.isStop){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;this.lfo.start(a);this.isStop=!1;var b=this;this.processor.onaudioprocess=function(a){var c=a.inputBuffer.getChannelData(0),
e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);if(b.isActive&&0!==b.depth.gain.value&&0!==b.rate.value)for(var d=0;d<this.bufferSize;d++)e[d]=c[d],a[d]=-c[d];else for(d=0;d<this.bufferSize;d++)e[d]=0,a[d]=0}}return this};r.prototype.stop=function(a,b){h.prototype.stop.call(this,a,b);this.isActive&&(this.processor.disconnect(0),this.processor.onaudioprocess=null,this.lfo.connect(this.depth),this.depth.connect(this.processor),this.processor.connect(this.lfoSplitter),this.lfoSplitter.connect(this.amplitudeL.gain,
0),this.lfoSplitter.connect(this.amplitudeR.gain,1));return this};r.prototype.toString=function(){return"[SoundModule Autopanner]"};v.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "depth":if(void 0===b)return this.depth.gain.value;g=parseFloat(b);var c=this.depth.gain.minValue||0,e=this.depth.gain.maxValue||1;g>=c&&g<=e&&(this.depth.gain.value=g);break;case "rate":if(void 0===
b)return this.rate.value;g=parseFloat(b);c=this.rate.minValue||0;e=this.rate.maxValue||1E5;g>=c&&g<=e&&(this.rate.value=g);break;case "wave":if(void 0===b)return this.lfo.type;g=String(b).toLowerCase();this.lfo.SINE=this.lfo.SINE||0;this.lfo.SQUARE=this.lfo.SQUARE||1;this.lfo.SAWTOOTH=this.lfo.SAWTOOTH||2;this.lfo.TRIANGLE=this.lfo.TRIANGLE||3;c={sine:this.lfo.SINE,square:this.lfo.SQUARE,sawtooth:this.lfo.SAWTOOTH,triangle:this.lfo.TRIANGLE};g in c&&(this.lfo.type="[object String]"===Object.prototype.toString.call(this.lfo.type)?
g:c[g])}return this};v.prototype.connect=function(){this.input.disconnect(0);this.amplitude.disconnect(0);this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output)};v.prototype.stop=function(a,b){h.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain));return this};v.prototype.toString=function(){return"[SoundModule Tremolo]"};H.prototype.param=function(a,b){if("[object Object]"===
Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "depth":if(void 0===b)return this.depth.gain.value;g=parseFloat(b);var c=this.depth.gain.minValue||0,e=this.depth.gain.maxValue||1;g>=c&&g<=e&&(this.depth.gain.value=g);break;case "rate":if(void 0===b)return this.rate.value;g=parseFloat(b);c=this.rate.minValue||0;e=this.rate.maxValue||1E5;g>=c&&g<=e&&(this.rate.value=g)}return this};H.prototype.connect=function(){this.input.disconnect(0);
this.amplitude.disconnect(0);this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output)};H.prototype.stop=function(a,b){h.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain));return this};H.prototype.toString=function(){return"[SoundModule Ringmodulator]"};w.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);
else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "stage":if(void 0===b)return this.numberOfStages;var c=parseInt(b),e,d=this.MAXIMUM_STAGES;0<=c&&c<=d&&(this.numberOfStages=c,this.connect());break;case "frequency":case "cutoff":if(void 0===b)return this.filters[0].frequency.value;c=parseFloat(b);e=this.filters[0].frequency.minValue||10;d=this.filters[0].frequency.maxValue||this.context.sampleRate/2;if(c>=e&&c<=d){for(g=0;g<this.MAXIMUM_STAGES;g++)this.filters[g].frequency.value=c;this.depth.gain.value=
this.filters[0].frequency.value*this.depthRate}break;case "resonance":if(void 0===b)return this.filters[0].Q.value;c=parseFloat(b);e=this.filters[0].Q.minValue||1E-4;d=this.filters[0].Q.maxValue||1E3;if(c>=e&&c<=d)for(g=0;g<this.MAXIMUM_STAGES;g++)this.filters[0].Q.value=c;break;case "depth":if(void 0===b)return this.depthRate;c=parseFloat(b);d=this.filters[0].frequency.value;0<=c&&c<=d&&(this.depth.gain.value=this.filters[0].frequency.value*c,this.depthRate=c);break;case "rate":if(void 0===b)return this.rate.value;
c=parseFloat(b);e=this.rate.minValue||0;d=this.rate.maxValue||1E5;c>=e&&c<=d&&(this.rate.value=c);break;case "mix":case "feedback":if(void 0===b)return this[g].gain.value;c=parseFloat(b);e=this[g].gain.minValue||0;d=this[g].gain.maxValue||1;c>=e&&c<=d&&(this[g].gain.value=c)}return this};w.prototype.connect=function(){this.input.disconnect(0);for(var a=0;a<this.MAXIMUM_STAGES;a++)this.filters[a].disconnect(0);this.mix.disconnect(0);this.feedback.disconnect(0);this.input.connect(this.output);if(this.isActive&&
0<this.numberOfStages)for(this.input.connect(this.filters[0]),a=0;a<this.numberOfStages;a++)a<this.numberOfStages-1?this.filters[a].connect(this.filters[a+1]):(this.filters[a].connect(this.mix),this.mix.connect(this.output),this.filters[a].connect(this.feedback),this.feedback.connect(this.filters[0]))};w.prototype.stop=function(a,b){h.prototype.stop.call(this,a,b);if(this.isActive){this.lfo.connect(this.depth);for(var g=0;g<this.MAXIMUM_STAGES;g++)this.depth.connect(this.filters[g].frequency)}return this};
w.prototype.toString=function(){return"[SoundModule Phaser]"};x.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),g){case "delaytime":case "time":if(void 0===b)return this.delay.delayTime.value;var c=parseFloat(b),e=this.delay.delayTime.minValue||0,d=this.delay.delayTime.maxValue||1;c>=e&&c<=d&&(this.delay.delayTime.value=c,this.depth.gain.value=this.delay.delayTime.value*
this.depthRate);break;case "depth":if(void 0===b)return this.depthRate;c=parseFloat(b);0<=c&&1>=c&&(this.depth.gain.value=this.delay.delayTime.value*c,this.depthRate=c);break;case "rate":if(void 0===b)return this.rate.value;c=parseFloat(b);e=this.rate.minValue||0;d=this.rate.maxValue||1E5;c>=e&&c<=d&&(this.rate.value=c);break;case "mix":case "feedback":if(void 0===b)return this[g].gain.value;c=parseFloat(b);e=this[g].gain.minValue||0;d=this[g].gain.maxValue||1;c>=e&&c<=d&&(this[g].gain.value=c);break;
case "tone":if(void 0===b)return this.tone.frequency.value;c=parseFloat(b);e=this.tone.frequency.minValue||10;d=this.tone.frequency.maxValue||this.context.sampleRate/2;c>=e&&c<=d&&(this.tone.frequency.value=c)}return this};x.prototype.connect=function(){this.input.disconnect(0);this.delay.disconnect(0);this.mix.disconnect(0);this.tone.disconnect(0);this.feedback.disconnect(0);this.input.connect(this.output);this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),
this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay))};x.prototype.stop=function(a,b){h.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime));return this};x.prototype.toString=function(){return"[SoundModule Flanger]"};z.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var g in a)this.param(g,a[g]);else switch(g=String(a).replace(/-/g,"").toLowerCase(),
g){case "delaytime":case "time":if(void 0===b)return this.delay.delayTime.value;var c=parseFloat(b),e=this.delay.delayTime.minValue||0,d=this.delay.delayTime.maxValue||1;c>=e&&c<=d&&(this.delay.delayTime.value=c,this.depth.gain.value=this.delay.delayTime.value*this.depthRate);break;case "depth":if(void 0===b)return this.depthRate;c=parseFloat(b);0<=c&&1>=c&&(this.depth.gain.value=this.delay.delayTime.value*c,this.depthRate=c);break;case "rate":if(void 0===b)return this.rate.value;c=parseFloat(b);
e=this.rate.minValue||0;d=this.rate.maxValue||1E5;c>=e&&c<=d&&(this.rate.value=c);break;case "mix":case "feedback":if(void 0===b)return this[g].gain.value;c=parseFloat(b);e=this[g].gain.minValue||0;d=this[g].gain.maxValue||1;c>=e&&c<=d&&(this[g].gain.value=c);break;case "tone":if(void 0===b)return this.tone.frequency.value;c=parseFloat(b);e=this.tone.frequency.minValue||10;d=this.tone.frequency.maxValue||this.context.sampleRate/2;c>=e&&c<=d&&(this.tone.frequency.value=c)}return this};z.prototype.connect=
function(){this.input.disconnect(0);this.delay.disconnect(0);this.mix.disconnect(0);this.tone.disconnect(0);this.feedback.disconnect(0);this.input.connect(this.output);this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay))};z.prototype.stop=function(a,b){h.prototype.stop.call(this,a,b);this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime));
return this};z.prototype.toString=function(){return"[SoundModule Chorus]"};J.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)this.param(e,a[e]);else switch(e=String(a).replace(/-/g,"").toLowerCase(),e){case "delaytime":case "time":if(void 0===b)return this.delay.delayTime.value;var c=parseFloat(b),d=this.delay.delayTime.minValue||0,f=this.delay.delayTime.maxValue||this.MAX_DELAY_TIME;c>=d&&c<=f&&(this.delay.delayTime.value=c);break;case "dry":case "wet":case "feedback":if(void 0===
b)return this[e].gain.value;c=parseFloat(b);d=this[e].gain.minValue||0;f=this[e].gain.maxValue||1;c>=d&&c<=f&&(this[e].gain.value=c);break;case "tone":if(void 0===b)return this.tone.frequency.value;c=parseFloat(b);d=this.tone.frequency.minValue||10;f=this.tone.frequency.maxValue||this.context.sampleRate/2;c>=d&&c<=f&&(this.tone.frequency.value=c)}return this};J.prototype.connect=function(){this.input.disconnect(0);this.delay.disconnect(0);this.dry.disconnect(0);this.wet.disconnect(0);this.tone.disconnect(0);
this.feedback.disconnect(0);this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.wet),this.wet.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay)):this.input.connect(this.output)};J.prototype.toString=function(){return"[SoundModule Delay]"};y.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)this.param(e,
a[e]);else switch(e=String(a).replace(/-/g,"").toLowerCase(),e){case "type":if(void 0===b)return this.convolver.buffer;var c=parseInt(b),d=0,f=this.rirs.length-1;null===b?(this.convolver.buffer=null,this.input.disconnect(0),this.input.connect(this.output)):c>=d&&c<=f&&(this.convolver.buffer=this.rirs[c],this.connect());break;case "dry":case "wet":if(void 0===b)return this[e].gain.value;c=parseFloat(b);d=this[e].gain.minValue||0;f=this[e].gain.maxValue||1;c>=d&&c<=f&&(this[e].gain.value=c);break;case "tone":if(void 0===
b)return this.tone.frequency.value;c=parseFloat(b);d=this.tone.frequency.minValue||10;f=this.tone.frequency.maxValue||this.context.sampleRate/2;c>=d&&c<=f&&(this.tone.frequency.value=c);break;case "rirs":return this.rirs}return this};y.prototype.connect=function(){this.input.disconnect(0);this.convolver.disconnect(0);this.dry.disconnect(0);this.wet.disconnect(0);this.tone.disconnect(0);this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.convolver),
this.convolver.connect(this.wet),this.wet.connect(this.output)):this.input.connect(this.output)};y.prototype.start=function(a,b){if(a instanceof AudioBuffer||null===a)this.convolver.buffer=a,this.rirs.push(a);else if(a instanceof ArrayBuffer){var e=this;"[object Function]"!==Object.prototype.toString.call(b)&&(b=function(){});this.decodeAudioData(a,function(a){e.convolver.buffer=a;e.rirs.push(a)},b)}return this};y.prototype.preset=function(a,b,e,c,d){if("[object Object]"===Object.prototype.toString.call(a)){var f=
a;"rirs"in f&&(a=f.rirs);"timeout"in f&&(b=f.timeout);"success"in f&&(e=f.success);"error"in f&&(c=f.error);"progress"in f&&(d=f.progress)}Array.isArray(a)||(a=[a]);this.rirs=Array(a.length);var h=!1,k=parseInt(b),m=this;b=function(a,b){var f=new XMLHttpRequest;void 0===F||F?f.responseType="arraybuffer":f.overrideMimeType("text/plain; charset=x-user-defined");f.timeout=0<k?k:6E4;f.ontimeout=function(a){h||"[object Function]"!==Object.prototype.toString.call(c)||c(a,"timeout");h=!0};f.onprogresss=
function(a){h?f.abort():"[object Function]"===Object.prototype.toString.call(d)&&d(a)};f.onerror=function(a){h||"[object Function]"!==Object.prototype.toString.call(c)||c(a,"error");h=!0};f.onload=function(d){if(200===f.status){var h=null,k=function(a){a instanceof ArrayBuffer&&m.context.decodeAudioData(a,function(a){m.rirs[b]=a;a=0;for(var c=m.rirs.length;a<c;a++)if(void 0===m.rirs[a])return;"[object Function]"===Object.prototype.toString.call(e)&&e.call(m,d,m.rirs)},function(){"[object Function]"===
Object.prototype.toString.call(c)&&c(null,"decode")})};if(void 0===F||F)h=f.response,k.call(m,h);else{for(var l=f.responseText,q=[],n=0,p=l.length;n<p;n++)q.push(l.charCodeAt(n)&255);var l="audio/"+a.slice(-3),q=new Blob([new Uint8Array(q)],{type:l}),t=new FileReader;t.readAsArrayBuffer(q);t.onerror=function(a){if("[object Function]"===Object.prototype.toString.call(c)){var b="";switch(t.error.code){case t.error.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case t.error.SECURITY_ERR:b="SECURITY_ERR";break;
case t.error.ABORT_ERR:b="ABORT_ERR";break;case t.error.NOT_READABLE_ERR:b="NOT_READABLE_ERR";break;case t.error.ENCODING_ERR:b="ENCODING_ERR";break;default:b="ERR"}c(a,b)}};t.onload=function(){h=t.result;k.call(m,h)}}}};f.open("GET",a,!0);f.send(null)};for(var f=0,q=a.length;f<q;f++)"[object String]"===Object.prototype.toString.call(a[f])?b.call(this,a[f],f):a[f]instanceof AudioBuffer&&(this.rirs[f]=a[f]);return this};y.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?
this.isActive=!this.isActive:this.isActive=Boolean(a);this.connect();return this};y.prototype.toString=function(){return"[SoundModule Reverb]"};A.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)this.param(e,a[e]);else switch(e=String(a).replace(/-/g,"").toLowerCase(),e){case "x":case "y":case "z":if(void 0===b)return this.positions[e];var c=parseFloat(b);isNaN(c)||(this.positions[e]=c,this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z));
break;case "ox":case "oy":case "oz":if(void 0===b)return this.orientations[e.charAt(1)];c=parseFloat(b);isNaN(c)||(this.orientations[e.charAt(1)]=c,this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z));break;case "vx":case "vy":case "vz":if(void 0===b)return this.velocities[e.charAt(1)];c=parseFloat(b);isNaN(c)||(this.velocities[e.charAt(1)]=c,this.panner.setVelocity(this.velocities.x,this.velocities.y,this.velocities.z));break;case "refdistance":if(void 0===b)return this.panner.refDistance;
c=parseFloat(b);isNaN(c)||(this.panner.refDistance=c);break;case "maxdistance":if(void 0===b)return this.panner.maxDistance;c=parseFloat(b);isNaN(c)||(this.panner.maxDistance=c);break;case "rollofffactor":if(void 0===b)return this.panner.rolloffFactor;c=parseFloat(b);isNaN(c)||(this.panner.rolloffFactor=c);break;case "coneinnerangle":if(void 0===b)return this.panner.coneInnerAngle;c=parseFloat(b);isNaN(c)||(this.panner.coneInnerAngle=c);break;case "coneouterangle":if(void 0===b)return this.panner.coneOuterAngle;
c=parseFloat(b);isNaN(c)||(this.panner.coneOuterAngle=c);break;case "coneoutergain":if(void 0===b)return this.panner.coneOuterGain;c=parseFloat(b);isNaN(c)||(this.panner.coneOuterGain=c);break;case "panningmodel":if(void 0===b)return this.panner.panningModel;c=/HRTF/i.test(b)?String(b).toUpperCase():String(b).toLowerCase();e={equalpower:this.panner.EQUALPOWER||0,HRTF:this.panner.HRTF||1};c in e&&(this.panner.panningModel="[object String]"===Object.prototype.toString.call(this.panner.panningModel)?
c:e[c]);break;case "distancemodel":if(void 0===b)return this.panner.distanceModel;c=String(b).replace(/-/g,"").toLowerCase();e={linear:this.panner.LINEAR_DISTANCE||0,inverse:this.panner.INVERSE_DISTANCE||1,exponential:this.panner.EXPONENTIAL_DISTANCE||2};c in e&&(this.panner.distanceModel="[object String]"===Object.prototype.toString.call(this.panner.distanceModel)?c:e[c])}return this};A.prototype.connect=function(){this.input.disconnect(0);this.panner.disconnect(0);this.isActive?(this.input.connect(this.panner),
this.panner.connect(this.output)):this.input.connect(this.output)};A.prototype.toString=function(){return"[SoundModule Panner]"};B.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)this.param(e,a[e]);else switch(e=String(a).replace(/-/g,"").toLowerCase(),e){case "attack":case "decay":case "sustain":case "release":if(void 0===b)return this[e];var c=parseFloat(b);0<=c&&(this[e]=c)}return this};B.prototype.isStop=function(){for(var a=0,b=0,e=this.activeIndexes.length;b<
e;b++){var c=this.activeIndexes[b];if(void 0!==c){if(.001<this.generators[c].gain.value)return!1;a++;if(a===this.activeCounter)return!0}}};B.prototype.ready=function(a,b,e){a=0<=parseInt(a)?parseInt(a):0;b.connect(this.generators[a]);this.generators[a].connect(e);this.activeIndexes[a]=a;this.activeCounter++;return this};B.prototype.start=function(a){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;for(var b=a+this.attack,e=this.decay,c=this.sustain,d=0,f=this.activeIndexes.length;d<
f;d++){var h=this.activeIndexes[d];void 0!==h&&(this.generators[h].gain.cancelScheduledValues(a),this.generators[h].gain.setValueAtTime(0,a),this.generators[h].gain.linearRampToValueAtTime(1,b),this.generators[h].gain.setTargetAtTime(c,b,e))}return this};B.prototype.stop=function(a){a=parseFloat(a)-this.release;if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;for(var b=this.release,e=0,c=this.activeIndexes.length;e<c;e++){var d=this.activeIndexes[e];void 0!==d&&(this.generators[d].gain.cancelScheduledValues(a),
this.generators[d].gain.setValueAtTime(this.generators[d].gain.value,a),this.generators[d].gain.setTargetAtTime(0,a,b))}return this};B.prototype.clear=function(){this.activeIndexes=[];this.activeCounter=0;return this};B.prototype.toString=function(){return"[OscillatorModule EnvelopeGenerator]"};this.listener=new b(a);this.analyser=new f(a);this.recorder=new e(a,this.BUFFER_SIZE,this.NUM_INPUT,this.NUM_OUTPUT);this.session=new m(a,this.BUFFER_SIZE,this.NUM_INPUT,this.NUM_OUTPUT,this.analyser);this.eg=
new B(a);this.compressor=new q(a,this.BUFFER_SIZE);this.distortion=new k(a,this.BUFFER_SIZE);this.wah=new p(a,this.BUFFER_SIZE);this.equalizer=new n(a,this.BUFFER_SIZE);this.filter=new C(a,this.BUFFER_SIZE);this.tremolo=new v(a,this.BUFFER_SIZE);this.ringmodulator=new H(a,this.BUFFER_SIZE);this.autopanner=new r(a,this.BUFFER_SIZE);this.phaser=new w(a,this.BUFFER_SIZE);this.flanger=new x(a,this.BUFFER_SIZE);this.chorus=new z(a,this.BUFFER_SIZE);this.delay=new J(a,this.BUFFER_SIZE);this.reverb=new y(a,
this.BUFFER_SIZE);this.panner=new A(a,this.BUFFER_SIZE);this.modules=[this.panner,this.compressor,this.distortion,this.wah,this.equalizer,this.filter,this.autopanner,this.tremolo,this.ringmodulator,this.phaser,this.flanger,this.chorus,this.delay,this.reverb]}function A(a){function d(a){this.context=a;this.frequencies={start:-1,end:0};this.time=this.rate=0;this.type="linear"}x.call(this,a);this.sources=[];this.times={start:0,stop:0};this.isAnalyser=!1;this.glide=new d(a);d.prototype.param=function(a,
d){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)this.param(e,a[e]);else switch(e=String(a).replace(/-/g,"").toLowerCase(),e){case "time":if(void 0===d)return this.time;e=parseFloat(d);0<=e&&(this.time=e);break;case "type":if(void 0===d)return this.type;e=String(d).toLowerCase();if("linear"===e||"exponential"===e)this.type=e}return this};d.prototype.ready=function(a){this.frequencies.end=a;a=-1===this.frequencies.start?0:this.frequencies.end-this.frequencies.start;-1===this.frequencies.start||
0===this.time||0===a?this.frequencies.start=this.frequencies.end:this.rate=a/this.time;return this};d.prototype.start=function(a,d){var e=parseFloat(d);if(isNaN(e)||e<this.context.currentTime)e=this.context.currentTime;var m=e+this.time;a.frequency.cancelScheduledValues(e);a.frequency.setValueAtTime(this.frequencies.start,e);a.frequency[this.type+"RampToValueAtTime"](this.frequencies.end,m);return this};d.prototype.stop=function(){this.frequencies.start=this.frequencies.end;return this};d.prototype.toString=
function(){return"[OscillatorModule Glide]"}}function B(a){x.call(this,a);this.sources=[];this.resources=[];this.buffers=[];this.volumes=[];this.isStops=[];this.settings=[];this.times={start:0,stop:0};this.transpose=1;this.isStop=!0;this.isAnalyser=!1}function z(a){function d(){this.depth=0}x.call(this,a);this.source=a.createBufferSource();this.buffer=null;this.currentTime=0;this.paused=!0;this.callbacks={decode:function(){},ready:function(){},start:function(){},stop:function(){},update:function(){},
ended:function(){},error:function(){}};this.vocalcanceler=new d;d.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)this.param(e,a[e]);else switch(e=String(a).replace(/-/g,"").toLowerCase(),e){case "depth":if(void 0===d)return this.depth;e=parseFloat(d);0<=e&&1>=e&&(this.depth=e)}return this};d.prototype.start=function(a,d){return a-this.depth*d}}function y(a){z.call(this,a);this.media=this.source=null;this.ext="";this.duration=0;this.playbackRate=
1;this.muted=this.loop=this.controls=!1;this.callbacks={loadstart:function(){}}}function G(a){x.call(this,a);this.source=null;this.medias={audio:!0,video:!1};this.callbacks={stream:function(){},error:function(){}};this.isStop=!0}function I(a){x.call(this,a);this.sources=[];this.isAnalyser=!1}function r(a){this.context=a;this.source=null;this.sequences=[];this.timerids=[];this.prev=[];this.callbacks={start:function(){},stop:function(){},ended:function(){},error:function(){}}}var v,N=u.AudioContext||
u.webkitAudioContext?!0:!1,F=u.webkitAudioContext?!0:!1;L.prototype.state=function(a){};var Q=function(a,d,b,f,e){if("[object Object]"===Object.prototype.toString.call(a)){var m=a;"file"in m&&(a=m.file);"type"in m&&(d=m.type);"success"in m&&(b=m.success);"error"in m&&(f=m.error);"progress"in m&&(e=m.progress)}if(a instanceof Blob){var h=new FileReader;h.onprogress=function(a){"[object Function]"===Object.prototype.toString.call(e)&&e(a)};h.onerror=function(a){if("[object Function]"===Object.prototype.toString.call(f)){var b=
"";switch(h.error.code){case h.error.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case h.error.SECURITY_ERR:b="SECURITY_ERR";break;case h.error.ABORT_ERR:b="ABORT_ERR";break;case h.error.NOT_READABLE_ERR:b="NOT_READABLE_ERR";break;case h.error.ENCODING_ERR:b="ENCODING_ERR";break;default:b="ERR"}f(a,b)}};h.onload=function(a){if("[object Function]"===Object.prototype.toString.call(b)){var e=h.result;"[object String]"===Object.prototype.toString.call(e)&&-1===e.indexOf("data:")&&-1===e.indexOf("blob:")&&(e=
e.replace(/<(\/?script.*?)>/gi,"<$1>"));b(a,e)}};/arraybuffer/i.test(d)?h.readAsArrayBuffer(a):/dataurl/i.test(d)?h.readAsDataURL(a):/text/i.test(d)&&h.readAsText(a,"UTF-8")}else"[object Function]"===Object.prototype.toString.call(f)&&f(null,"FILE_IS_NOT_BLOB")},R=function(a,d,b,f,e){if("[object Object]"===Object.prototype.toString.call(a)){var m=a;"event"in m&&(a=m.event);"type"in m&&(d=m.type);"success"in m&&(b=m.success);"error"in m&&(f=m.error);"progress"in m&&(e=m.progress)}if(a instanceof Event){m=
null;if("drop"===a.type)a.stopImmediatePropagation(),a.preventDefault(),m=a.dataTransfer.files[0];else if("change"===a.type&&"files"in a.target)m=a.target.files[0];else return;if(m instanceof File){if(/text/i.test(d)&&-1===m.type.indexOf("text"))throw Error("Please upload text file.");if(/arraybuffer|dataurl/i.test(d)&&-1===m.type.indexOf("audio"))throw Error("Please upload audio file.");this.read({file:m,type:d,success:b,error:f,progress:e});return m}throw Error("Please upload file.");}},S=function(a,
d,b,f,e){if("[object Object]"===Object.prototype.toString.call(a)){var m=a;"url"in m&&(a=m.url);"timeout"in m&&(d=m.timeout);"success"in m&&(b=m.success);"error"in m&&(f=m.error);"progress"in m&&(e=m.progress)}var h=new XMLHttpRequest;void 0===F||F?h.responseType="arraybuffer":h.overrideMimeType("text/plain; charset=x-user-defined");d=parseInt(d);h.timeout=0<d?d:6E4;h.ontimeout=function(a){"[object Function]"===Object.prototype.toString.call(f)&&f(a,"timeout")};h.onprogress=function(a){"[object Function]"===
Object.prototype.toString.call(e)&&e(a)};h.onerror=function(a){"[object Function]"===Object.prototype.toString.call(f)&&f(a,"error")};h.onload=function(e){if(200===h.status){var d=null;if(void 0===F||F)d=h.response,d instanceof ArrayBuffer&&"[object Function]"===Object.prototype.toString.call(b)&&b(e,d);else{for(var m=h.responseText,n=[],r=0,v=m.length;r<v;r++)n.push(m.charCodeAt(r)&255);var m="audio/"+a.slice(-3),n=new Blob([new Uint8Array(n)],{type:m}),u=new FileReader;u.readAsArrayBuffer(n);u.onerror=
function(a){if("[object Function]"===Object.prototype.toString.call(f)){var b="";switch(u.error.code){case u.error.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case u.error.SECURITY_ERR:b="SECURITY_ERR";break;case u.error.ABORT_ERR:b="ABORT_ERR";break;case u.error.NOT_READABLE_ERR:b="NOT_READABLE_ERR";break;case u.error.ENCODING_ERR:b="ENCODING_ERR";break;default:b="ERR"}f(a,b)}};u.onload=function(){d=u.result;d instanceof ArrayBuffer&&"[object Function]"===Object.prototype.toString.call(b)&&b(e,d)}}}};
h.open("GET",a,!0);h.send(null)},T=function(a,d,b,f){a instanceof AudioContext&&d instanceof ArrayBuffer&&("[object Function]"!==Object.prototype.toString.call(b)&&(b=function(){}),"[object Function]"!==Object.prototype.toString.call(f)&&(f=function(){}),a.decodeAudioData(d,b,f))},U=function(a){var d=Math.pow(2,1/12);Array.isArray(a)||(a=[a]);for(var b=Array(a.length),f=0,e=a.length;f<e;f++){var m=parseInt(a[f]);b[f]=0<=m?27.5*Math.pow(d,m):0}return b},V=function(a){var d=parseFloat(a);if(0<=d){a=
Math.floor(d/60);var b=Math.floor(d%60),d=d-parseInt(d);return{minutes:a,seconds:b,milliseconds:d}}},W=function(a){u.X===v&&(u.X=void 0);a&&u.XSound===v&&(u.XSound=void 0);return v};E.prototype.setup=function(a,d,b,f){if("[object Object]"===Object.prototype.toString.call(a)){var e=a;"id"in e&&(a=e.id);"type"in e&&(d=e.type);"formats"in e&&(b=e.formats);"callbacks"in e&&(f=e.callbacks)}e=String(a);d="video"!==String(d).toLowerCase()?"audio":"video";this.media=null!==a&&""!==e?document.getElementById(e):
document.createElement(d);if(this.media instanceof HTMLMediaElement){Array.isArray(b)||(b=[b]);a=0;for(e=b.length;a<e;a++){var m=d+"/"+String(b[a]).toLowerCase();if(/^(?:maybe|probably)/.test(this.media.canPlayType(m))){this.ext=b[a];break}}if(""===this.ext)throw Error("Media format that can be played does not exist.");if("[object Object]"===Object.prototype.toString.call(f))for(var h in f)this.callbacks[h.toLowerCase()]="[object Function]"===Object.prototype.toString.call(f[h])?f[h]:function(){};
var q=this;for(h in this.callbacks)switch(h){case "loadedmetadata":this.media.addEventListener("loadedmetadata",function(a){q.duration=this.duration;q.callbacks.loadedmetadata(a,this)},!1);break;default:this.media.addEventListener(h,function(a){q.callbacks[a.type.toLowerCase()](a,this)},!1)}return this}this.media=null};E.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else switch(b=String(a).replace(/-/g,"").toLowerCase(),b){case "mastervolume":if(void 0===
d)return this.media instanceof HTMLMediaElement?this.media.volume:this.volume;var f=parseFloat(d);0<=f&&1>=f&&(this.media instanceof HTMLMediaElement&&(this.media.volume=f),this.volume=f);break;case "playbackrate":if(void 0===d)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;f=parseFloat(d);.5<=f&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=f),this.playbackRate=f);break;case "currenttime":if(void 0===d)return this.media instanceof HTMLMediaElement?
this.media.currentTime:0;f=parseFloat(d);if(this.media instanceof HTMLMediaElement)b=this.duration;else return;0<=f&&f<=b&&(this.media.currentTime=f);break;case "loop":case "muted":case "controls":if(void 0===d)return this.media instanceof HTMLMediaElement?this.media[b]:this[b];this.media instanceof HTMLMediaElement&&(this.media[b]=Boolean(d));this[b]=Boolean(d);break;case "width":case "height":if(void 0===d)return this.media instanceof HTMLVideoElement?this.media[b]:0;f=parseInt(d);0<=f&&this.media instanceof
HTMLVideoElement&&(this.media[b]=f);break;case "duration":return this.duration;case "channels":return}return this};E.prototype.ready=function(a){a=String(a);try{-1!==a.indexOf("data:")||-1!==a.indexOf("blob:")?this.media.src=a:this.media.src=a+"."+this.ext}catch(d){throw Error("The designated resource cannot be loaded.");}return this};E.prototype.start=function(a){this.media instanceof HTMLMediaElement&&this.media.paused&&(this.media.play(),a=parseFloat(a),this.media.currentTime=0<=a&&a<=this.duration?
a:0,this.media.playbackRate=this.playbackRate,this.media.controls=this.controls,this.media.loop=this.loop,this.media.muted=this.muted);return this};E.prototype.stop=function(){this.media instanceof HTMLMediaElement&&!this.media.paused&&this.media.pause();return this};E.prototype.toggle=function(a){this.media instanceof HTMLMediaElement&&(this.media.paused?this.start(a):this.stop());return this};E.prototype.get=function(){return this.media};E.prototype.isMedia=function(){return this.media instanceof
HTMLMediaElement?!0:!1};E.prototype.isSource=function(){return this.isMedia()};E.prototype.isPaused=function(){return this.media instanceof HTMLMediaElement?this.media.paused:!0};E.prototype.fullscreen=function(){if(this.media instanceof HTMLVideoElement)if(this.media.webkitRequestFullscreen)this.media.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(this.media.mozRequestFullScreen)this.media.mozRequestFullScreen();else if(this.media.requestFullscreen)this.media.requestFullscreen();else throw Error("Cannot change to full screen.");
return this};E.prototype.exitFullscreeen=function(){if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullscreen)document.mozCancelFullscreen();else if(document.exitFullscreen)document.exitFullscreen();else throw Error("Cannot exit from full screen.");return this};E.prototype.toString=function(){return"[MediaFallbackModule]"};if(N){u.AudioContext=u.AudioContext||u.webkitAudioContext;var w=new AudioContext;w.createScriptProcessor=w.createScriptProcessor||w.createJavaScriptNode;
w.createGain=w.createGain||w.createGainNode;w.createDelay=w.createDelay||w.createDelayNode;w.createPeriodicWave=w.createPeriodicWave||w.createWaveTable;x.prototype.setup=function(){};x.prototype.param=function(a,d){switch(String(a).replace(/-/g,"").toLowerCase()){case "mastervolume":if(void 0===d)return this.masterVolume.gain.value;var b=parseFloat(d),f=this.masterVolume.gain.maxValue||1;b>=(this.masterVolume.gain.minValue||0)&&b<=f&&(this.masterVolume.gain.value=b)}};x.prototype.ready=function(){};
x.prototype.start=function(){};x.prototype.stop=function(){};x.prototype.get=function(){};x.prototype.resize=function(a){x.call(this,w,a);return this};x.prototype.connect=function(a,d){Array.isArray(d)&&(this.modules=d);a.disconnect(0);0<this.modules.length?a.connect(this.modules[0].input):a.connect(this.masterVolume);for(var b=0,f=this.modules.length;b<f;b++)this.modules[b].output.disconnect(0),b<this.modules.length-1?this.modules[b].output.connect(this.modules[b+1].input):this.modules[b].output.connect(this.masterVolume);
this.masterVolume.connect(this.analyser.input);this.analyser.output.connect(this.context.destination);this.masterVolume.connect(this.recorder.processor);this.recorder.processor.connect(this.context.destination);this.masterVolume.connect(this.session.sender);this.session.sender.connect(this.context.destination);return this};x.prototype.module=function(a){a=String(a).replace(/-/g,"").toLowerCase();switch(a){case "listener":case "analyser":case "recorder":case "session":case "compressor":case "distortion":case "wah":case "equalizer":case "filter":case "tremolo":case "ringmodulator":case "autopanner":case "phaser":case "flanger":case "chorus":case "delay":case "reverb":case "panner":return this[a];
case "eg":if(a in this)return this[a];case "glide":if(a in this)return this[a];case "vocalcanceler":if(a in this)return this[a];default:for(var d=0,b=this.plugins.length;d<b;d++)if(a===this.plugins[d].name)return this.plugins[d].plugin}};x.prototype.on=function(a){a=parseFloat(a);if(isNaN(a)||a<this.context.currentTime)a=this.context.currentTime;this.chorus.start(a);this.flanger.start(a);this.phaser.start(a);this.autopanner.start(a);this.tremolo.start(a);this.ringmodulator.start(a);this.wah.start(a);
this.filter.start(a);for(var d=0,b=this.plugins.length;d<b;d++)this.plugins[d].plugin.start(a);return this};x.prototype.off=function(a,d){var b=parseFloat(a);if(isNaN(b)||b<this.context.currentTime)b=this.context.currentTime;this.chorus.stop(b);this.flanger.stop(b);this.phaser.stop(b);this.autopanner.stop(b);this.tremolo.stop(b);this.ringmodulator.stop(b);this.wah.stop(b);if(d)for(var f=0,e=this.plugins.length;f<e;f++)this.plugins[f].plugin.stop(b);return this};x.prototype.install=function(a,d){"[object Function]"===
Object.prototype.toString.call(d)&&(d.prototype=new this.Effector(w,this.BUFFER_SIZE),this.plugins.push({name:String(a).toLowerCase(),plugin:new d(w)}));return this};x.prototype.toString=function(){return"[SoundModule]"};A.prototype=Object.create(x.prototype);A.prototype.constructor=A;A.prototype.setup=function(a){function d(a,b){this.isActive=b;this.context=a;this.source=a.createOscillator();this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable;this.source.start=this.source.start||
this.source.noteOn;this.source.stop=this.source.stop||this.source.noteOff;this.volume=a.createGain();this.isStop=!0;this.fine=this.octave=0;this.customs={real:new Float32Array([0,1]),imag:new Float32Array([0,1])}}d.prototype=Object.create(L.prototype);d.prototype.constructor=d;d.prototype.param=function(a,b){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)this.param(d,a[d]);else switch(d=String(a).replace(/-/g,"").toLowerCase(),d){case "type":if(void 0===b)return this.source.type;
if("[object Object]"!==Object.prototype.toString.call(b)){d=String(b).toLowerCase();this.source.SINE=this.source.SINE||0;this.source.SQUARE=this.source.SQUARE||1;this.source.SAWTOOTH=this.source.SAWTOOTH||2;this.source.TRIANGLE=this.source.TRIANGLE||3;var f={sine:this.source.SINE,square:this.source.SQUARE,sawtooth:this.source.SAWTOOTH,triangle:this.source.TRIANGLE};d in f&&(this.source.type="[object String]"===Object.prototype.toString.call(this.source.type)?d:f[d])}else if("real"in b&&"imag"in b&&
(f=d=null,b.real instanceof Float32Array?d=b.real:Array.isArray(b.real)&&(d=new Float32Array(b.real)),b.imag instanceof Float32Array?f=b.imag:Array.isArray(b.imag)&&(f=new Float32Array(b.imag)),d instanceof Float32Array&&f instanceof Float32Array)){4096<d.length&&(d=d.subarray(0,4096));4096<f.length&&(f=f.subarray(0,4096));0!==d[0]&&(d[0]=0);0!==f[0]&&(f[0]=0);var k=this.context.createPeriodicWave(d,f);this.source.setPeriodicWave(k);this.customs.real=d;this.customs.imag=f}break;case "octave":if(void 0===
b)return this.octave;d=this.octave=parseFloat(b);f=(this.source.detune.minValue||-4800)/1200;k=(this.source.detune.maxValue||4800)/1200;d>=f&&d<=k&&(this.source.detune.value=this.fine+1200*d);break;case "fine":if(void 0===b)return this.fine;d=this.fine=parseFloat(b);-1200<=d&&1200>=d&&(this.source.detune.value=d+1200*this.octave);break;case "volume":case "gain":if(void 0===b)return this.volume.gain.value;d=parseFloat(b);f=this.volume.gain.minValue||0;k=this.volume.gain.maxValue||1;d>=f&&d<=k&&(this.volume.gain.value=
d)}return this};d.prototype.start=function(a,b){if(this.isActive){var d=this.source.type,f=this.source.frequency.value,k=this.source.detune.value;this.isStop||(this.source.stop(this.context.currentTime),this.source.disconnect(0));this.source=this.context.createOscillator();this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable;this.source.start=this.source.start||this.source.noteOn;this.source.stop=this.source.stop||this.source.noteOff;"custom"===d?(d=this.context.createPeriodicWave(this.customs.real,
this.customs.imag),this.source.setPeriodicWave(d)):this.source.type=d;this.source.frequency.value=f;this.source.detune.value=k;this.volume.connect(a);this.source.start(b);this.isStop=!1}else this.isStop||(this.source.stop(this.context.currentTime),this.isStop=!0),this.source.disconnect(0);return this};d.prototype.stop=function(a){this.isStop||(this.source.stop(a),this.source.disconnect(0),this.isStop=!0);return this};d.prototype.state=function(a){if(void 0===a)return this.isActive;"toggle"===String(a).toLowerCase()?
this.isActive=!this.isActive:this.isActive=Boolean(a);return this};d.prototype.toString=function(){return"[OscillatorModule Oscillator]"};Array.isArray(a)||(a=[a]);for(var b=0,f=a.length;b<f;b++)this.sources[b]=new d(this.context,Boolean(a[b])),this.eg.generators[b]=this.context.createGain(),this.eg.generators[b].gain.setTargetAtTime=this.eg.generators[b].gain.setTargetAtTime||this.eg.generators[b].gain.setTargetValueAtTime;return this};A.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,
a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var f=x.prototype.param.call(this,b,d)}return void 0===f?this:f};A.prototype.ready=function(a,d){var b=parseFloat(a),f=parseFloat(d);this.times.start=0<=b?b:0;this.times.stop=f>=b?f:0;return this};A.prototype.start=function(a,d,b){var f=this.context.currentTime+this.times.start;Array.isArray(a)||(a=[a]);for(var e=0,m=a.length;e<m;e++){var h=parseFloat(a[e]);a[e]=0<=h?h:0}this.eg.clear();this.processor.disconnect(0);this.processor.onaudioprocess=
null;this.connect(this.processor,d);e=0;for(m=a.length;e<m&&!(e>=this.sources.length);e++)d=this.sources[e],h=a[e],d.start(this.processor,f),this.eg.ready(e,d.source,d.volume),this.glide.ready(h).start(d.source,f);this.eg.start(f);this.on(f);this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);a=this.times.stop-this.times.start;if(0<a){var q=this;u.setTimeout(function(){q.stop(b)},1E3*a)}"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=
b:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);e.set(b);a.set(d)};return this};A.prototype.stop=function(a){var d=this.context.currentTime+this.times.stop;this.eg.stop(d);this.glide.stop();this.filter.stop(d);for(var b=0,f=this.plugins.length;b<f;b++)this.plugins[b].plugin.stop(d,this.eg.release);var e=this;void 0===F||F||u.setTimeout(function(){for(var a=e.context.currentTime,
b=0,d=e.sources.length;b<d;b++)e.sources[b].stop(a);e.off(a);e.analyser.stop("time");e.analyser.stop("fft");e.isAnalyser=!1;e.processor.disconnect(0);e.processor.onaudioprocess=null},1E3*(this.times.stop+this.eg.release));"[object Function]"===Object.prototype.toString.call(a)?this.processor.onaudioprocess=a:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),f=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);f.set(b);
a.set(d);if(e.eg.isStop()){b=e.context.currentTime;d=0;for(f=e.sources.length;d<f;d++)e.sources[d].stop(b);e.off(b);e.analyser.stop("time");e.analyser.stop("fft");e.isAnalyser=!1;this.disconnect(0);this.onaudioprocess=null}};return this};A.prototype.get=function(a){a=parseInt(a);if(0<=a&&a<this.sources.length)return this.sources[a].source;a=Array(this.sources.length);for(var d=0,b=this.sources.length;d<b;d++)a[d]=this.sources[d].source;return a};A.prototype.length=function(){return this.sources.length};
A.prototype.toString=function(){return"[OscillatorModule]"};B.prototype=Object.create(x.prototype);B.prototype.constructor=B;B.prototype.setup=function(a,d,b,f,e,m){if("[object Object]"===Object.prototype.toString.call(a)){var h=a;"resources"in h&&(a=h.resources);"settings"in h&&(d=h.settings);"timeout"in h&&(b=h.timeout);"success"in h&&(f=h.success);"error"in h&&(e=h.error);"progress"in h&&(m=h.progress)}Array.isArray(a)||(a=[a]);this.resources=a;Array.isArray(d)||(d=[d]);this.buffers.length=a.length;
a=0;for(h=d.length;a<h;a++){if("buffer"in d[a])if(h=parseInt(d[a].buffer),0<=h&&h<this.buffers.length)d[a].buffer=h;else return;else return;d[a].rate="rate"in d[a]&&0<=d[a].rate?parseFloat(d[a].rate):1;d[a].loop="loop"in d[a]?Boolean(d[a].loop):!1;d[a].start="start"in d[a]&&0<=d[a].start?parseFloat(d[a].start):0;d[a].end="end"in d[a]&&0<=d[a].end?parseFloat(d[a].end):0;d[a].volume="volume"in d[a]&&0<=d[a].volume&&1>=d[a].volume?parseFloat(d[a].volume):1;a=0;for(h=d.length;a<h;a++)this.isStops[a]=
!0,this.volumes[a]=this.context.createGain(),this.eg.generators[a]=this.context.createGain(),this.eg.generators[a].gain.setTargetAtTime=this.eg.generators[a].gain.setTargetAtTime||this.eg.generators[a].gain.setTargetValueAtTime;this.settings=d}var q=!1,k=parseInt(b),p=this;d=function(a,b){var d=new XMLHttpRequest;void 0===F||F?d.responseType="arraybuffer":d.overrideMimeType("text/plain; charset=x-user-defined");d.timeout=0<k?k:6E4;d.ontimeout=function(a){q||"[object Function]"!==Object.prototype.toString.call(e)||
e(a,"timeout");q=!0};d.onprogress=function(a){q?d.abort():"[object Function]"===Object.prototype.toString.call(m)&&m(a)};d.onerror=function(a){q||"[object Function]"!==Object.prototype.toString.call(e)||e(a,"error");q=!0};d.onload=function(h){if(200===d.status){var k=null,m=function(a){a instanceof ArrayBuffer&&p.context.decodeAudioData(a,function(a){p.buffers[b]=a;a=0;for(var d=p.buffers.length;a<d;a++)if(void 0===p.buffers[a])return;"[object Function]"===Object.prototype.toString.call(f)&&f.call(p,
h,p.buffers)},function(){"[object Function]"===Object.prototype.toString.call(e)&&e(null,"decode")})};if(void 0===F||F)k=d.response,m.call(p,k);else{for(var q=d.responseText,r=[],v=0,u=q.length;v<u;v++)r.push(q.charCodeAt(v)&255);var q="audio/"+a.slice(-3),r=new Blob([new Uint8Array(r)],{type:q}),w=new FileReader;w.readAsArrayBuffer(r);w.onerror=function(a){if("[object Function]"===Object.prototype.toString.call(e)){var b="";switch(w.error.code){case w.error.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;
case w.error.SECURITY_ERR:b="SECURITY_ERR";break;case w.error.ABORT_ERR:b="ABORT_ERR";break;case w.error.NOT_READABLE_ERR:b="NOT_READABLE_ERR";break;case w.error.ENCODING_ERR:b="ENCODING_ERR";break;default:b="ERR"}e(a,b)}};w.onload=function(){k=w.result;m.call(p,k)}}}};d.open("GET",a,!0);d.send(null)};a=0;for(h=this.resources.length;a<h;a++)"[object String]"===Object.prototype.toString.call(this.resources[a])?d.call(this,this.resources[a],a):this.resources[a]instanceof AudioBuffer&&(this.buffers[a]=
this.resources[a]);return this};B.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var f=x.prototype.param.call(this,b,d);if(void 0!==f)return f;switch(b){case "transpose":if(void 0===d)return this.transpose;b=parseFloat(d);0<b&&(this.transpose=b)}}return this};B.prototype.ready=function(a,d){var b=parseFloat(a),f=parseFloat(d);this.times.start=0<=b?b:0;this.times.stop=f>=b?f:0;
return this};B.prototype.start=function(a,d,b){if(0<=a&&a<this.settings.length){var f=parseInt(a),e=this.settings[f].buffer,m=this.settings[f].rate,h=this.settings[f].loop,q=this.settings[f].start,k=this.settings[f].end,p=this.settings[f].volume;if(void 0!==this.buffers[e]){void 0!==this.sources[f]&&(this.sources[f].stop(this.context.currentTime),this.sources[f].disconnect(0),delete this.sources[f]);a=this.context.createBufferSource();a.start=a.start||a.noteGrainOn;a.stop=a.stop||a.noteOff;a.buffer=
this.buffers[e];a.playbackRate.value=m*this.transpose;a.loop=h;a.loopStart=q;a.loopEnd=k;this.volumes[f].gain.value=p;this.eg.ready(f,a,this.volumes[f]);this.volumes[f].connect(this.processor);this.connect(this.processor,d);d=this.context.currentTime+this.times.start;a.start(d);this.sources[f]=a;this.eg.start(d);this.on(d);this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);this.isStops[f]=!1;var n=this;d=this.times.stop-this.times.start;0<d&&u.setTimeout(function(){n.stop(f)},
1E3*d);a.onended=function(){n.isStops[f]=!0};"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){n.isStop=n.isStops.every(function(a,b,d){return a});if(n.isStop)n.on(n.context.currentTime),n.eg.clear(),n.analyser.stop("time"),n.analyser.stop("fft"),n.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null;else{var b=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=
a.outputBuffer.getChannelData(1);e.set(b);a.set(d)}};return this}}};B.prototype.stop=function(a){if(0<=a&&a<this.settings.length&&(a=parseInt(a),void 0!==this.buffers[this.settings[a].buffer]&&void 0!==this.sources[a])){a=this.context.currentTime+this.times.stop;this.eg.stop(a);this.filter.stop(a);for(var d=0,b=this.plugins.length;d<b;d++)this.plugins[d].plugin.stop(a,this.eg.release);return this}};B.prototype.get=function(a){a=parseInt(a);return 0<=a&&a<this.buffers.length?this.buffers[a]:this.buffers};
B.prototype.toString=function(){return"[OneshotModule]"};z.prototype=Object.create(x.prototype);z.prototype.constructor=z;z.prototype.setup=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.setup(b,a[b]);else b=String(a).replace(/-/g,"").toLowerCase(),b in this.callbacks&&"[object Function]"===Object.prototype.toString.call(d)&&(this.callbacks[b]=d);return this};z.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,
a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var f=x.prototype.param.call(this,b,d);if(void 0!==f)return f;switch(b){case "playbackrate":if(void 0===d)return this.source.playbackRate.value;b=parseFloat(d);var f=this.source.playbackRate.minValue||0,e=this.source.playbackRate.maxValue||1024;b>=f&&b<=e&&(this.source.playbackRate.value=b);break;case "loop":case "looping":if(void 0===d)return this.source.loop;this.source.loop=Boolean(d);break;case "currenttime":if(void 0===d)return this.currentTime;
b=parseFloat(d);if(this.buffer instanceof AudioBuffer)e=this.buffer.duration;else{this.currentTime=0;break}0<=b&&b<=e&&(this.paused?(this.stop(),this.currentTime=b):(this.stop(),this.start(b)));break;case "duration":return this.buffer instanceof AudioBuffer?this.buffer.duration:0;case "samplerate":return this.buffer instanceof AudioBuffer?this.buffer.sampleRate:this.SAMPLE_RATE;case "channels":return this.buffer instanceof AudioBuffer?this.buffer.numberOfChannels:0}}return this};z.prototype.ready=
function(a){a instanceof ArrayBuffer&&(this.context.decodeAudioData(a,function(a){this.buffer=a;this.analyser.start("time-all-L",a);this.analyser.start("time-all-R",a);this.callbacks.ready(a)}.bind(this),this.callbacks.error.bind(this)),this.callbacks.decode(a));return this};z.prototype.start=function(a,d,b){if(this.buffer instanceof AudioBuffer&&this.paused){var f=this.context.currentTime;a=parseFloat(a);this.currentTime=0<=a&&a<=this.buffer.duration?a:0;var e=this.source.playbackRate.value,m=this.source.loop;
this.source=this.context.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.buffer=this.buffer;this.source.playbackRate.value=e;this.source.loop=m;void 0===F||F?(this.source.connect(this.processor),this.connect(this.processor,d)):this.connect(this.source,d);this.source.start(f,a,this.buffer.duration-a);this.analyser.start("time");this.analyser.start("fft");this.paused=!1;this.on(f);this.callbacks.start(this.source,
this.currentTime);var h=this;"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);if(h.currentTime<Math.floor(h.source.buffer.duration)){for(var f=0;f<this.bufferSize;f++)e[f]=h.vocalcanceler.start(b[f],d[f]),a[f]=h.vocalcanceler.start(d[f],b[f]),h.currentTime+=1*h.source.playbackRate.value/
h.source.buffer.sampleRate,0===Math.floor(h.currentTime*h.source.buffer.sampleRate)%(.1*h.source.buffer.sampleRate)&&h.callbacks.update(h.source,h.currentTime);h.analyser.timeAllL.update(h.currentTime);h.analyser.timeAllR.update(h.currentTime)}else h.source.loop?h.currentTime=0:h.end.call(h)}}return this};z.prototype.stop=function(){if(this.buffer instanceof AudioBuffer&&!this.paused){var a=this.context.currentTime;this.source.stop(a);this.off(a,!0);this.analyser.stop("time");this.analyser.stop("fft");
this.processor.disconnect(0);this.processor.onaudioprocess=null;this.paused=!0;this.callbacks.stop(this.source,this.currentTime)}return this};z.prototype.get=function(){return this.source};z.prototype.toggle=function(a,d,b){this.paused?this.start(a,d,b):this.stop();return this};z.prototype.end=function(){this.stop();this.currentTime=0;this.callbacks.ended(this.source,this.currentTime);return this};z.prototype.isBuffer=function(){return this.buffer instanceof AudioBuffer?!0:!1};z.prototype.isSource=
function(){return this.source instanceof AudioBufferSourceNode&&this.source.buffer instanceof AudioBuffer?!0:!1};z.prototype.isPaused=function(){return this.paused};z.prototype.toString=function(){return"[AudioModule]"};y.prototype=Object.create(z.prototype);y.prototype.constructor=y;y.prototype.setup=function(a,d,b,f){if("[object Object]"===Object.prototype.toString.call(a)){var e=a;"id"in e&&(a=e.id);"type"in e&&(d=e.type);"formats"in e&&(b=e.formats);"callbacks"in e&&(f=e.callbacks)}e=String(a);
d="video"!==String(d).toLowerCase()?"audio":"video";this.media=null!==a&&""!==e?document.getElementById(e):document.createElement(d);if(this.media instanceof HTMLMediaElement){Array.isArray(b)||(b=[b]);a=0;for(e=b.length;a<e;a++){var m=d+"/"+String(b[a]).toLowerCase();if(/^(?:maybe|probably)/.test(this.media.canPlayType(m))){this.ext=b[a];break}}if(""===this.ext)throw Error("Media format that can be played does not exist.");if("[object Object]"===Object.prototype.toString.call(f))for(var h in f)this.callbacks[h.toLowerCase()]=
"[object Function]"===Object.prototype.toString.call(f[h])?f[h]:function(){};var q=this;for(h in this.callbacks)switch(h){case "loadstart":this.media.addEventListener("loadstart",function(a){q.source instanceof MediaElementAudioSourceNode||(q.source=q.context.createMediaElementSource(this));q.callbacks.loadstart(a,this)},!1);break;case "loadedmetadata":this.media.addEventListener("loadedmetadata",function(a){q.duration=this.duration;q.callbacks.loadedmetadata(a,this)},!1);break;case "ended":this.media.addEventListener("ended",
function(a){this.pause();q.off(q.context.currentTime);q.analyser.stop("time");q.analyser.stop("fft");q.processor.disconnect(0);q.processor.onaudioprocess=null;q.callbacks.ended(a,this)},!1);break;default:this.media.addEventListener(h,function(a){q.callbacks[a.type.toLowerCase()](a,this)},!1)}return this}this.media=null};y.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var f=x.prototype.param.call(this,
b,d);if(void 0!==f)return f;switch(b){case "playbackrate":if(void 0===d)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;f=parseFloat(d);.5<=f&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=f),this.playbackRate=f);break;case "currenttime":if(void 0===d)return this.media instanceof HTMLMediaElement?this.media.currentTime:0;f=parseFloat(d);if(this.media instanceof HTMLMediaElement)b=this.duration;else return;0<=f&&f<=b&&(this.media.currentTime=
f);break;case "loop":case "muted":case "controls":if(void 0===d)return this.media instanceof HTMLMediaElement?this.media[b]:this[b];this.media instanceof HTMLMediaElement&&(this.media[b]=Boolean(d));this[b]=Boolean(d);break;case "width":case "height":if(void 0===d)return this.media instanceof HTMLVideoElement?this.media[b]:0;f=parseInt(d);0<=f&&this.media instanceof HTMLVideoElement&&(this.media[b]=f);break;case "duration":return this.duration;case "channels":return this.source instanceof MediaElementAudioSourceNode?
this.source.channelCount:0}}return this};y.prototype.ready=function(a){a=String(a);try{-1!==a.indexOf("data:")||-1!==a.indexOf("blob:")?this.media.src=a:this.media.src=a+"."+this.ext}catch(d){throw Error("The designated resource cannot be loaded.");}return this};y.prototype.start=function(a,d,b){if(this.source instanceof MediaElementAudioSourceNode&&this.media.paused){this.source.connect(this.processor);this.connect(this.processor,d);this.media.play();a=parseFloat(a);this.media.currentTime=0<=a&&
a<=this.duration?a:0;this.media.playbackRate=this.playbackRate;this.media.controls=this.controls;this.media.loop=this.loop;this.media.muted=this.muted;this.on(this.context.currentTime);this.analyser.start("time");this.analyser.start("fft");var f=this;"[object Function]"===Object.prototype.toString.call(b)?this.processor.onaudioprocess=b:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),q=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);
for(var k=0;k<this.bufferSize;k++)q[k]=f.vocalcanceler.start(b[k],d[k]),a[k]=f.vocalcanceler.start(d[k],b[k])}}return this};y.prototype.stop=function(){this.source instanceof MediaElementAudioSourceNode&&!this.media.paused&&(this.media.pause(),this.off(this.context.currentTime,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null);return this};y.prototype.get=function(){return this.media};y.prototype.toggle=function(a,d,b){this.media instanceof
HTMLMediaElement&&(this.media.paused?this.start(a,d,b):this.stop());return this};y.prototype.isMedia=function(){return this.media instanceof HTMLMediaElement?!0:!1};y.prototype.isSource=function(){return this.source instanceof MediaElementAudioSourceNode?!0:!1};y.prototype.isPaused=function(){return this.media instanceof HTMLMediaElement?this.media.paused:!0};y.prototype.fullscreen=function(){if(this.media instanceof HTMLVideoElement)if(this.media.webkitRequestFullscreen)this.media.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
else if(this.media.mozRequestFullScreen)this.media.mozRequestFullScreen();else if(this.media.requestFullscreen)this.media.requestFullscreen();else throw Error("Cannot change to full screen.");return this};y.prototype.exitFullscreeen=function(){if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullscreen)document.mozCancelFullscreen();else if(document.exitFullscreen)document.exitFullscreen();else throw Error("Cannot exit from full screen.");return this};y.prototype.toString=
function(){return"[MediaModule]"};G.prototype=Object.create(x.prototype);G.prototype.constructor=G;G.prototype.setup=function(a,d,b){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;Boolean(a)&&(this.medias.video=!0);"[object Function]"===Object.prototype.toString.call(d)&&(this.callbacks.stream=d);"[object Function]"===Object.prototype.toString.call(b)&&(this.callbacks.error=b);return this};G.prototype.param=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.param(b,
a[b]);else{b=String(a).replace(/-/g,"").toLowerCase();var f=x.prototype.param.call(this,b,d)}return void 0===f?this:f};G.prototype.ready=function(){return this};G.prototype.start=function(a,d){if(void 0===navigator.getUserMedia)throw Error("Cannot use WebRTC.");var b=!1,f=this,e=function(a,d,e){this.source=this.context.createMediaStreamSource(a);this.source.connect(this.processor);this.connect(this.processor,d);this.on(this.context.currentTime);b||(this.analyser.start("time"),this.analyser.start("fft"),
b=!0);"[object Function]"===Object.prototype.toString.call(e)?this.processor.onaudioprocess=e:this.processor.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);e.set(b);a.set(d)}};this.isStop=!1;navigator.getUserMedia(this.medias,function(b){f.isStop||(e.call(f,b,a,d),f.callbacks.stream(b))},function(a){f.callbacks.error(a)});return this};G.prototype.stop=function(){this.source=null;
this.off(this.context.currentTime,!0);this.analyser.stop("time");this.analyser.stop("fft");this.processor.disconnect(0);this.processor.onaudioprocess=null;this.isStop=!0;return this};G.prototype.get=function(){return this.source};G.prototype.toggle=function(a,d){this.isStreaming()?this.stop():this.start(a,d);return this};G.prototype.isStreaming=function(){return this.isStop?!1:!0};G.prototype.toString=function(){return"[StreamModule]"};I.prototype=Object.create(x.prototype);I.prototype.constructor=
I;I.prototype.mix=function(a){Array.isArray(a)||(a=[a]);this.sources=a;for(var d=0,b=this.sources.length;d<b;d++){var f=this.sources[d];if(!(f instanceof A||f instanceof B||f instanceof z||f instanceof y||f instanceof G))return;this.off(this.context.currentTime,!1);f.analyser.stop("time");f.analyser.stop("fft");f.isAnalyser=!1;f.recorder.stop();f.session.close();f.processor.disconnect(0);f.processor.connect(this.processor)}this.connect(this.processor);this.on(this.context.currentTime);this.isAnalyser||
(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);var e=this;this.processor.onaudioprocess=function(b){var d=b.inputBuffer.getChannelData(0),f=b.inputBuffer.getChannelData(1),k=b.outputBuffer.getChannelData(0);b=b.outputBuffer.getChannelData(1);for(var p=!1,n=0;10>n;n++){var r=a[n];r instanceof A&&r.eg.isStop()?p=!0:r instanceof B&&r.isStop?p=!0:r instanceof z&&r.paused?p=!0:r instanceof y&&r.media.paused?p=!0:r instanceof G&&r.isStop&&(p=!0)}p?(e.stop(e.context.currentTime,
!0),e.analyser.stop("time"),e.analyser.stop("fft"),e.isAnalyser=!1,this.disconnect(0),this.onaudioprocess=null):(k.set(d),b.set(f))};return this};I.prototype.get=function(a){a=parseInt(a);return 0<=a&&a<this.sources.length?this.sources[a]:this.sources};I.prototype.toString=function(){return"[MixerModule]"};r.ONE_MINUTES=60;r.EQUAL_TEMPERAMENT=12;r.QUARTER_NOTE=4;r.REGEXP_MML=/\s*(?:T\d+)\s*|\s*(?:O\d+)\s*|\s*(?:(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*\s*/gi;
r.REGEXP_TEMPO=/T\d+/i;r.REGEXP_OCTAVE=/O\d+/i;r.REGEXP_NOTE=/(?:(?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*/i;r.REGEXP_CHORD=/((?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*/i;r.REGEXP_DURATION=/(?:[CDEFGABR][#+-]?)+((?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*)/i;r.ERROR_MML_STRING="MML";r.ERROR_MML_TEMPO="TEMPO";
r.ERROR_MML_OCTAVE="OCTAVE";r.ERROR_MML_NOTE="NOTE";r.prototype.setup=function(a,d){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)this.setup(b,a[b]);else b=String(a).toLowerCase(),b in this.callbacks&&"[object Function]"===Object.prototype.toString.call(d)&&(this.callbacks[b]=d);return this};r.prototype.ready=function(a,d){null!==this.source&&this.stop();this.sequences=[];this.timerids=[];this.prev=[];if(Array.isArray(a)){for(var b=0,f=a.length;b<f;b++)if(!(a[b]instanceof
OscillatorNode))return;this.source=a}else if(a instanceof OscillatorNode)this.source=[a];else if(a instanceof A||a instanceof B)this.source=a;else return;for(Array.isArray(d)||(d=[d]);0<d.length;){var e=[],m=String(d.shift()).match(r.REGEXP_MML);if(null===m){this.callbacks.error(r.ERROR_MML_STRING,"");return}for(var h=0,q=function(a,b){var d=0;switch(b){case "C":d=3;break;case "D":d=5;break;case "E":d=7;break;case "F":d=8;break;case "G":d=10;break;case "A":d=12;break;case "B":d=14;break;case "R":return"R"}d=
r.EQUAL_TEMPERAMENT*(a-1)+d;return 0<=d?d:-1},k=function(a){var b=Math.pow(2,1/12);return 0<=a?27.5*Math.pow(b,a):-1};0<m.length;){var p=m.shift().trim();if(r.REGEXP_TEMPO.test(p)){var n=parseInt(p.slice(1));if(0<n)n=r.ONE_MINUTES/n;else{this.callbacks.error(r.ERROR_MML_TEMPO,p);return}}else if(r.REGEXP_OCTAVE.test(p)){var v=parseInt(p.slice(1));if(0>v){this.callbacks.error(r.ERROR_MML_OCTAVE,p);return}}else if(r.REGEXP_NOTE.test(p)){if(void 0===n){this.callbacks.error(r.ERROR_MML_TEMPO,p);return}if(void 0===
v){this.callbacks.error(r.ERROR_MML_OCTAVE,p);return}for(var u=p.match(r.REGEXP_CHORD)[1],w=[],b=0,f=u.length;b<f;b++){var x=u.charAt(b),x=q.call(this,v,x.toUpperCase());switch(u.charAt(b+1)){case "#":case "+":x++;b++;break;case "-":x--,b++}x>=w[0]&&(x-=r.EQUAL_TEMPERAMENT);if(0>x){this.callbacks.error(r.ERROR_MML_NOTE,p);return}w.push(x)}u=[];b=0;for(f=w.length;b<f;b++){x="R"!==w[b]?k.call(this,w[b],p):0;if(-1===x){this.callbacks.error(r.ERROR_MML_NOTE,p);return}u.push(x)}f=p.split("&");for(b=0;0<
f.length;)switch(x=f.shift().match(r.REGEXP_DURATION)[1],parseInt(x)){case 1:case 2:case 4:case 8:case 16:case 32:case 64:case 128:case 256:var y=r.QUARTER_NOTE/parseInt(x),b=b+(-1!==x.indexOf(".")?1.5*y*n:y*n);break;case 6:b+=2*n/3;break;case 12:b+=n/3;break;case 18:b+=2*n/9;break;case 24:b+=.5*n/3;break;case 36:b+=n/9;break;case 48:b+=.25*n/3;break;case 72:b+=.5*n/9;break;case 96:b+=.125*n/3;break;case 144:b+=.25*n/9;break;case 192:b+=.0625*n/3;break;default:this.callbacks.error(r.ERROR_MML_NOTE,
p)}p=h;f=p+b;h+=b;e.push({indexes:w,frequencies:u,start:p,duration:b,stop:f})}}0<e.length&&(e.reverse(),this.sequences.push(e),this.timerids.push(null))}return this.sequences};r.prototype.start=function(a,d,b){var f=parseInt(a);if(0<=f&&f<this.sequences.length){if(!Array.isArray(this.sequences[f]))return this;if(0===this.sequences[f].length)return this.stop(b),this.callbacks.ended(),this;var e=this.sequences[f].pop();if(Array.isArray(this.source)){a=0;for(var m=this.source.length;a<m;a++){var h=this.source[a],
q=h.type,k=h.detune.value,h=this.context.createOscillator();h.start=h.start||h.noteOn;h.stop=h.stop||h.noteOff;h.type=q;h.frequency.value=e.frequencies[a];h.detune.value=k;if(Array.isArray(d))for(h.connect(d[0]),a=0,m=d.length;a<m;a++)if(q=d[a],a<m-1){k=d[a+1];if(!(q instanceof AudioNode&&k instanceof AudioNode))return;q.connect(k)}else q.connect(this.context.destination);else h.connect(this.context.destination);h.start(this.context.currentTime);h.stop(this.context.currentTime+e.duration);this.source[a]=
h}a=0;for(m=e.indexes.length;a<m;a++)"R"!==e.indexes[a]&&this.callbacks.start(e,a)}else if(this.source instanceof A)for(this.source.start(e.frequencies,d,b),a=0,m=e.indexes.length;a<m;a++)"R"!==e.indexes[a]&&this.callbacks.start(e,a);else if(this.source instanceof B)for(a=0,m=e.indexes.length;a<m;a++)"R"!==e.indexes[a]&&(this.source.start(e.indexes[a],d,b),this.callbacks.start(e,a));var p=this;this.timerids[f]=u.setTimeout(function(){if(Array.isArray(p.source))for(var a=0,h=e.indexes.length;a<h;a++)"R"!==
e.indexes[a]&&p.callbacks.stop(e,a);else if(p.source instanceof A)for(p.source.stop(e.frequencies,b),a=0,h=e.indexes.length;a<h;a++)"R"!==e.indexes[a]&&p.callbacks.stop(e,a);else if(p.source instanceof B)for(a=0,h=e.indexes.length;a<h;a++)"R"!==e.indexes[a]&&(p.source.stop(e.indexes[a],b),p.callbacks.stop(e,a));p.prev=e;p.start(f,d,b);e=null},1E3*e.duration)}return this};r.prototype.stop=function(a){var d=this.prev;if(0===d.length)return this;if(Array.isArray(this.source))for(var b=0,f=d.indexes.length;b<
f;b++)"R"!==d.indexes[b]&&this.callbacks.stop(d,b);else if(this.source instanceof A)for(this.source.stop(d.frequencies,a),b=0,f=d.indexes.length;b<f;b++)"R"!==d.indexes[b]&&this.callbacks.stop(d,b);else if(this.source instanceof B)for(b=0,f=d.indexes.length;b<f;b++)"R"!==d.indexes[b]&&(this.source.stop(d.indexes[b],a),this.callbacks.stop(d,b));b=0;for(f=this.timerids.length;b<f;b++)u.clearTimeout(this.timerids[b]),this.timerids[b]=null;return this};r.prototype.get=function(a){a=parseInt(a);return 0<=
a&&a<this.sequences.length?this.sequences[a]:this.sequences};r.prototype.toggle=function(a,d,b){this.isPaused()?this.start(a,d,b):this.stop();return this};r.prototype.isSequences=function(){return Array.isArray(this.sequences[0])?!0:!1};r.prototype.isPaused=function(){for(var a=0,d=this.timerids.length;a<d;a++){var b=this.timerids[a];if(null!==b&&void 0!==b)return!1}return!0};r.prototype.download=function(a){return"data:text/plain;base64,"+u.btoa(function(a){for(var b="",f=0,e=a.length;f<e;f++)var m=
a.charCodeAt(f),b=255<m?b+("&#"+m+";"):b+a.charAt(f);return b}(String(a)))};r.prototype.toString=function(){return"[MML]"};var M=new x(w),O=new A(w),X=new B(w),Y=new z(w),P=new y(w),Z=new E,$=new G(w),aa=new I(w),ba=new r(w);v=function(a,d){switch(String(a).replace(/-/g,"").toLowerCase()){case "oscillator":if(void 0===d)return O;var b=parseInt(d);if(0<=b&&b<O.sources.length)return O.sources[b];break;case "oneshot":return X;case "audio":return Y;case "media":return P;case "fallback":return Z;case "stream":return $;
case "mixer":return aa;case "mml":return ba}};v.IS_XSOUND=N;v.FULL_MODE=F;v.SAMPLE_RATE=M.SAMPLE_RATE;v.BUFFER_SIZE=M.BUFFER_SIZE;v.NUM_INPUT=M.NUM_INPUT;v.NUM_OUTPUT=M.NUM_OUTPUT;v.read=Q;v.file=R;v.ajax=S;v.decode=T;v.toFrequencies=U;v.convertTime=V;v.noConflict=W;v.clone=function(){var a=new A(w),d=new B(w),b=new z(w),f=new y(w),e=new E,m=new G(w),h=new I(w),q=new r(w);return function(k,p){switch(String(k).replace(/-/g,"").toLowerCase()){case "oscillator":if(void 0===p)return a;var n=parseInt(p);
if(0<=n&&n<a.sources.length)return a.sources[n];break;case "oneshot":return d;case "audio":return b;case "media":return f;case "fallback":return e;case "stream":return m;case "mixer":return h;case "mml":return q}}};v.free=function(a){Array.isArray(a)||(a=[a]);var d=0;for(a=a.length;d<a;d++);};v.get=function(){return w};v.getCurrentTime=function(){return w.currentTime}}else{var P=new E;v=function(){return P};v.IS_XSOUND=N;v.SAMPLE_RATE=null;v.BUFFER_SIZE=null;v.NUM_INPUT=null;v.NUM_OUTPUT=null;v.read=
Q;v.file=R;v.ajax=S;v.decode=T;v.toFrequencies=U;v.convertTime=V;v.noConflict=W;v.get=function(){return null};v.getCurrentTime=function(){return 0};v.clone=function(){var a=new E;return function(){return a}}}v.toString=function(){return"[XSound]"};u.XSound=v;u.X=v})(window);